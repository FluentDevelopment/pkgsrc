$NetBSD: patch-ae,v 1.1 2006/12/03 10:11:50 xtraeme Exp $

--- Makefile.ref.orig	2003-11-15 01:10:55.000000000 +0100
+++ Makefile.ref	2006-12-03 11:01:14.000000000 +0100
@@ -55,8 +55,6 @@
 
 ifdef USE_MSVC
 OTHER_LIBS += fdlibm/$(OBJDIR)/fdlibm.lib
-else
-OTHER_LIBS += -Lfdlibm/$(OBJDIR) -lfdm
 endif
 
 ifdef JS_THREADSAFE
@@ -80,7 +78,8 @@
 #
 # XCFLAGS may be set in the environment or on the gmake command line
 #
-CFLAGS          += $(OPTIMIZER) $(OS_CFLAGS) $(DEFINES) $(INCLUDES) $(XCFLAGS)
+CFLAGS          += -L$(PREFIX)/lib $(OPTIMIZER) $(OS_CFLAGS) $(DEFINES) \
+			$(INCLUDES) $(XCFLAGS)
 
 LDFLAGS		= $(XLDFLAGS)
 
@@ -241,12 +240,9 @@
 	prmjtime.c	\
 	$(NULL)
 
-PREDIRS	+= fdlibm
 
 ifdef USE_MSVC
 FDLIBM_LIBRARY = fdlibm/$(OBJDIR)/fdlibm.lib
-else
-FDLIBM_LIBRARY = fdlibm/$(OBJDIR)/libfdm.a
 endif
 JSMATH_PRELINK	= $(OBJDIR)/jsmathtemp.o
 # Flag for incremental linking
@@ -300,9 +296,9 @@
 $(PROGRAM): $(PROG_OBJS) $(LIBRARY) $(FDLIBM_LIBRARY)
 	link.exe -out:"$@" $(EXE_LINK_FLAGS) $^
 else
-$(PROGRAM): $(PROG_OBJS) $(LIBRARY) $(FDLIBM_LIBRARY)
-	$(CC) -o $@ $(CFLAGS) $(PROG_OBJS) $(LIBRARY) $(LDFLAGS) $(OTHER_LIBS) \
-	    $(PROG_LIBS)
+$(PROGRAM): $(PROG_OBJS) $(SHARED_LIBRARY) $(FDLIBM_LIBRARY)
+	$(CC) -o $@ $(CFLAGS) $(PROG_OBJS) -L$(OBJDIR) $(LDFLAGS) \
+		$(OTHER_LIBS) $(PROG_LIBS) -ljs -lm
 endif
 
 $(PROGRAM).pure: $(PROG_OBJS) $(LIBRARY)
