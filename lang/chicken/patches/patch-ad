$NetBSD: patch-ad,v 1.2 2004/09/05 18:31:59 seb Exp $

--- testsuites/makefile.in.orig	2004-06-27 23:25:12.000000000 +0200
+++ testsuites/makefile.in
@@ -1,5 +1,9 @@
 # makefile for Chicken test-suite
 
+SHELL= @SHELL@
+
+top_builddir = ..
+
 # XXX WARNING XXX
 # This makefile will remove *.c files, you've been warned.
 
@@ -8,29 +12,32 @@ TESTCASES = test-example test-r5rs test-
 .PHONY : all quicktests $(TESTCASES)
 
 INCDIR = ..
-CHICKEN = chicken
+CHICKEN = ../chicken
 CSI = csi
 CHICKENFLAGS = -hygienic -include-path .. -optimize-level 1
 LIBDIR = ..
 CCOPTS = `../chicken-config -cflags | sed s%-I@prefix@/include%%g`
 LIBS = `../chicken-config -libs | sed s%-L@prefix@/lib%%g | sed "s%@prefix@/lib/\(lib[-A-Za-z0-9_]*\.a\)%$(LIBDIR)/\1%g"`
 
+CC = @CC@
+LIBTOOL = @LIBTOOL@
+
 all : $(TESTCASES)
 
 test-example :
-	$(CHICKEN) $@.scm $(CHICKENFLAGS) -output-file $@.c && \
-	  $(CC) $(CFLAGS) $(CCOPTS) $@.c -L$(LIBDIR) -I$(INCDIR) $(LIBS) -o $@ && \
-	  ./$@
+	$(CHICKEN) $@.scm $(CHICKENFLAGS) -output-file $@.c
+	  $(LIBTOOL) --mode=link $(CC) $(CFLAGS) $(CCOPTS) $@.c -L$(LIBDIR) -I$(INCDIR) $(LIBS) -o $@
+	  $(LIBTOOL) --mode=execute ./$@
 
 test-r5rs :
-	$(CHICKEN) $@.scm $(CHICKENFLAGS) -output-file $@.c && \
-	  $(CC) $(CFLAGS) $(CCOPTS) $@.c -L$(LIBDIR) -I$(INCDIR) $(LIBS) -o $@ && \
-	  ./$@
+	$(CHICKEN) $@.scm $(CHICKENFLAGS) -output-file $@.c
+	  $(LIBTOOL) --mode=link $(CC) $(CFLAGS) $(CCOPTS) $@.c -L$(LIBDIR) -I$(INCDIR) $(LIBS) -o $@
+	  $(LIBTOOL) --mode=execute ./$@
 
 test-test-infrastructure :
-	$(CHICKEN) $@.scm $(CHICKENFLAGS) -output-file $@.c && \
-	  $(CC) $(CFLAGS) $(CCOPTS) $@.c -L$(LIBDIR) -I$(INCDIR) $(LIBS) -o $@ && \
-	  ./$@
+	$(CHICKEN) $@.scm $(CHICKENFLAGS) -output-file $@.c
+	  $(LIBTOOL) --mode=link $(CC) $(CFLAGS) $(CCOPTS) $@.c -L$(LIBDIR) -I$(INCDIR) $(LIBS) -o $@
+	  $(LIBTOOL) --mode=execute ./$@
 
 clean:
 	rm -f *.c $(TESTCASES)
