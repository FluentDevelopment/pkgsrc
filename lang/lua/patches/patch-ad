$NetBSD: patch-ad,v 1.5 2006/06/01 06:52:28 rillig Exp $

--- src/lib/Makefile.orig	2003-03-28 12:49:56.000000000 +0000
+++ src/lib/Makefile	2006-06-01 07:25:02.631381504 +0100
@@ -7,16 +7,21 @@ include $(LUA)/config
 EXTRA_DEFS= $(POPEN) $(TMPNAM) $(DEGREES) $(LOADLIB)
 
 OBJS= lauxlib.o lbaselib.o ldblib.o liolib.o lmathlib.o ltablib.o lstrlib.o loadlib.o
+LOBJS= $(OBJS:.o=.lo)
 SRCS= lauxlib.c lbaselib.c ldblib.c liolib.c lmathlib.c ltablib.c lstrlib.c loadlib.c
 
 T= $(LIB)/liblualib.a
+LT= $(T:.a=.la)
 
-all:	$T
+all:	$(LT)
 
 $T:	$(OBJS)
 	$(AR) $@ $(OBJS)
 	$(RANLIB) $@
 
+$(LT):	$(LOBJS)
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o $@ $(LOBJS) -rpath $(INSTALL_LIB) -version-info $(LV) $(DLLIB)
+
 clean:
 	rm -f $(OBJS) $T
 
