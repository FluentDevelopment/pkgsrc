$NetBSD: patch-at,v 1.9 2006/02/02 20:47:26 rillig Exp $

--- configure.orig	2006-01-04 10:26:42.000000000 +0100
+++ configure
@@ -483,7 +483,7 @@ mksharedlibrpath=''
 
 if test $withsharedlibs = "yes"; then
   case "$host" in
-    *-*-linux-gnu|*-*-linux|*-*-freebsd[3-9]*)
+    *-*-linux-gnu|*-*-linux|*-*-freebsd[3-9]*|*-*-netbsd*|*-*-dragonfly*)
       sharedcccompopts="-fPIC"
       mksharedlib="$bytecc -shared -o"
       bytecclinkopts="$bytecclinkopts -Wl,-E"
@@ -571,10 +571,12 @@ case "$host" in
   sparc*-*-linux*)              arch=sparc; system=linux;;
   i[3456]86-*-linux*)           arch=i386; system=linux_`sh ./runtest elf.c`;;
   i[3456]86-*-*bsd*)            arch=i386; system=bsd_`sh ./runtest elf.c`;;
+  i[3456]86-*-dragonfly*)       arch=i386; system=bsd_`sh ./runtest elf.c`;;
   i[3456]86-*-nextstep*)        arch=i386; system=nextstep;;
   i[3456]86-*-solaris*)         arch=i386; system=solaris;;
   i[3456]86-*-beos*)            arch=i386; system=beos;;
   i[3456]86-*-cygwin*)          arch=i386; system=cygwin;;
+  i[3456]86-*-interix3*)        arch=i386; system=interix3;;
   mips-*-irix6*)                arch=mips; system=irix;;
   hppa1.1-*-hpux*)              arch=hppa; system=hpux;;
   hppa2.0*-*-hpux*)             arch=hppa; system=hpux;;
@@ -659,6 +661,7 @@ case "$arch,$model,$system" in
     profiling='prof'
     case "$nativecc" in gcc*) ;; *) cc_profile='-xpg';; esac;;
   amd64,*,linux) profiling='prof';;
+  power,*,bsd) profiling='prof';;
   *) profiling='noprof';;
 esac
 
@@ -1047,6 +1050,7 @@ if test "$pthread_wanted" = "yes"; then
   case "$host" in
     *-*-solaris*)  pthread_link="-lpthread -lposix4";;
     *-*-freebsd*)  pthread_link="-pthread";;
+    *-*-dragonfly*)  pthread_link="-pthread";;
     *-*-openbsd*)  pthread_link="-pthread";;
     *)             pthread_link="-lpthread";;
   esac
@@ -1094,6 +1098,7 @@ fi
 x11_include="not found"
 x11_link="not found"
 
+if test "$disable_x11" != "yes"; then
 for dir in \
     $x11_include_dir          \
                               \
@@ -1140,6 +1145,7 @@ do
     break
   fi
 done
+fi
 
 if test "$x11_include" = "not found"; then
   x11_try_lib_dir=''
@@ -1229,31 +1235,8 @@ dbm_include="not found"
 dbm_link="not found"
 use_gdbm_ndbm=no
 
-for dir in /usr/include /usr/include/db1 /usr/include/gdbm; do
-  if test -f $dir/ndbm.h; then
-    dbm_include=$dir
-    if sh ./hasgot dbm_open; then
-      dbm_link=""
-    elif sh ./hasgot -lndbm dbm_open; then
-      dbm_link="-lndbm"
-    elif sh ./hasgot -ldb1 dbm_open; then
-      dbm_link="-ldb1"
-    elif sh ./hasgot -lgdbm dbm_open; then
-      dbm_link="-lgdbm"
-    elif sh ./hasgot -lgdbm_compat -lgdbm dbm_open; then
-      dbm_link="-lgdbm_compat -lgdbm" 
-    fi
-    break
-  fi
-  if test -f $dir/gdbm-ndbm.h; then
-    dbm_include=$dir
-    use_gdbm_ndbm=yes
-    if sh ./hasgot -lgdbm_compat -lgdbm dbm_open; then
-      dbm_link="-lgdbm_compat -lgdbm"
-    fi
-    break   
-  fi
-done
+dbm_include=/usr/include
+dbm_link=${BDB_LIBS}
 if test "$dbm_include" = "not found" || test "$dbm_link" = "not found"; then
   echo "NDBM not found, the \"dbm\" library will not be supported."
 else
@@ -1265,8 +1248,8 @@ else
   fi
   echo "DBM_INCLUDES=$dbm_include" >> Makefile
   echo "DBM_LINK=$dbm_link" >> Makefile
-  if test "$use_gdbm_ndbm" = "yes"; then
-    echo "#define DBM_USES_GDBM_NDBM" >> s.h
+  if test ${BDB_BUILTIN} != "yes"; then
+    echo "#define DBM_USES_DB" >> s.h
   fi
   otherlibraries="$otherlibraries dbm"
 fi
