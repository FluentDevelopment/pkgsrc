$NetBSD: patch-ab,v 1.3 2002/02/08 06:29:43 jlam Exp $

--- make/lib.mak.orig	Thu May 18 21:26:31 2000
+++ make/lib.mak
@@ -53,36 +53,18 @@
 LIBNAME_MIN		= $(LIBNAME_MAJ).$(MINOR_VERSION)
 LIBNAME_PAT		= $(LIBNAME_MIN).$(BUILD_NUMBER)$(BUILD_TYPE)
 
-$(LIBDIR)/$(LIB_BASENAME): $(LIBDIR)/$(LIBNAME_PAT)
-	@rm -f $(LIBDIR)/$(LIB_BASENAME)
-	ln -s $(LIBDIR)/$(LIBNAME_PAT) $(LIBDIR)/$(LIB_BASENAME)
-	@rm -f $(LIBDIR)/$(LIBNAME_MAJ)
-	ln -s $(LIBDIR)/$(LIBNAME_PAT) $(LIBDIR)/$(LIBNAME_MAJ)
-	@rm -f $(LIBDIR)/$(LIBNAME_MIN)
-	ln -s $(LIBDIR)/$(LIBNAME_PAT) $(LIBDIR)/$(LIBNAME_MIN)
-
-$(LIBDIR)/$(LIBNAME_PAT): $(OBJS)
+$(LIBDIR)/$(LIB_BASENAME): $(OBJS)
 	@if [ ! -d $(LIBDIR) ] ; then mkdir $(LIBDIR) ; fi
-	gcc -shared -Wl,-soname,$(LIB_BASENAME).1 -o $(LIBDIR)/$(LIBNAME_PAT) $(OBJS)
+	$(LIBTOOL) --tag=CXX $(CPLUS) -o $(LIBDIR)/$(LIB_BASENAME) \
+		$(OBJS:.o=.lo) -rpath $(INSTALLLIB_DIR) \
+		-version-info $(MAJOR_VERSION):$(MINOR_VERSION)
 
 CLEAN_FILES += $(LIBDIR)/$(LIBNAME_PAT) $(LIBDIR)/$(LIB_BASENAME) $(LIBDIR)/$(LIBNAME_MAJ) $(LIBDIR)/$(LIBNAME_MIN)
 
-install: $(LIBDIR)/$(LIBNAME_PAT)
-	$(INSTALL) $(LIBDIR)/$(LIBNAME_PAT) $(INSTALLLIB_DIR)/$(LIBNAME_PAT)
-	ln -s $(INSTALLLIB_DIR)/$(LIBNAME_PAT) $(INSTALLLIB_DIR)/$(LIB_BASENAME)
-	ln -s $(INSTALLLIB_DIR)/$(LIBNAME_PAT) $(INSTALLLIB_DIR)/$(LIBNAME_MAJ)
-	ln -s $(INSTALLLIB_DIR)/$(LIBNAME_PAT) $(INSTALLLIB_DIR)/$(LIBNAME_MIN)
-
-else
+install: $(LIBDIR)/$(LIB_BASENAME)
+	$(LIBTOOL) $(BSD_INSTALL_DATA) $(LIBDIR)/$(LIB_BASENAME) $(INSTALLLIB_DIR)
 
-$(LIBDIR)/$(LIB_BASENAME): $(OBJS)
-	@if [ ! -d $(LIBDIR) ] ; then mkdir $(LIBDIR) ; fi
-ifdef P_USE_RANLIB
-	$(AR) rc $(LIBDIR)/$(LIB_BASENAME) $(OBJS)
-	$(RANLIB) $(LIBDIR)/$(LIB_BASENAME)
 else
-	$(AR) rcs $(LIBDIR)/$(LIB_BASENAME) $(OBJS)
-endif
 
 CLEAN_FILES += $(LIBDIR)/$(LIB_BASENAME)
 
