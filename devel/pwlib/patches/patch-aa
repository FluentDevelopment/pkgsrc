$NetBSD: patch-aa,v 1.3 2002/12/01 18:31:42 jdolecek Exp $

--- make/unix.mak.orig	Tue Nov 12 12:56:46 2002
+++ make/unix.mak	Sun Dec  1 15:11:09 2002
@@ -433,7 +433,7 @@
 
 
 ifndef PWLIBDIR
-PWLIBDIR = $(HOME)/pwlib
+PWLIBDIR = @PREFIX@
 endif
 
 ###############################################################################
@@ -819,19 +819,15 @@
 
 P_PTHREADS	:= 1
 
-ifeq ($(MACHTYPE),x86)
-STDCCFLAGS	+= -m486
-endif
-
 STDCCFLAGS	+= -DP_NETBSD
 LDLIBS		+= -lossaudio
 
 ifdef P_PTHREADS
-STDCCFLAGS += -I/usr/pkg/pthreads/include
-LDFLAGS	+= -L/usr/pkg/pthreads/lib
-LDLIBS	+= -lpthread
-CC              := /usr/pkg/pthreads/bin/pgcc
-CPLUS           := /usr/pkg/pthreads/bin/pg++
+# need to put $(PREFIX)/include after library includes, so that
+# the build wouldn't pick up potential intalled pwlib headers
+# from $(PREFIX)
+STDCCFLAGS += -I$(UNIX_INC_DIR) -I$(PWLIBDIR)/include -I@PTHREADS_PREFIX@/include
+LDFLAGS	+= -L@PTHREADS_PREFIX@/lib -lpthread
 endif
 
 P_USE_RANLIB		:= 1
@@ -1222,7 +1218,7 @@
 endif
 
 ifeq ($(P_SHAREDLIB),1)
-LIB_SUFFIX	= so
+LIB_SUFFIX	= la
 else
 LIB_SUFFIX	= a
 ifndef DEBUG
@@ -1234,8 +1230,9 @@
 LIB_TYPE	=
 endif
 
+INSTALL_DIR = ${PREFIX}
 ifndef INSTALL_DIR
-INSTALL_DIR	= /usr/local
+INSTALL_DIR	= /usr/pkg
 endif
 
 ifndef INSTALLBIN_DIR
@@ -1303,7 +1300,7 @@
 PW_LIBDIR	= $(PWLIBDIR)/lib
 
 # set name of the PT library
-PTLIB_BASE	= pt_$(PLATFORM_TYPE)_$(OBJ_SUFFIX)
+PTLIB_BASE	= pt
 PTLIB_FILE	= lib$(PTLIB_BASE)$(LIB_TYPE).$(LIB_SUFFIX)
 PT_OBJBASE	= obj_$(PLATFORM_TYPE)_$(OBJDIR_SUFFIX)
 PT_OBJDIR	= $(PW_LIBDIR)/$(PT_OBJBASE)
@@ -1432,6 +1429,6 @@
 # add library directory to library path and include the library
 LDFLAGS		+= -L$(PW_LIBDIR)
 
-LDLIBS		+= -l$(PTLIB_BASE)$(LIB_TYPE)
+LDLIBS		+= $(PW_LIBDIR)/$(PTLIB_FILE)
 
 # End of unix.mak
