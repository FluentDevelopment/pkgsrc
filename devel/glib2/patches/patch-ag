$NetBSD: patch-ag,v 1.6 2006/02/25 13:31:03 wiz Exp $

--- gmodule/gmodule-dl.c.orig	2004-02-20 02:41:00.000000000 +0100
+++ gmodule/gmodule-dl.c
@@ -140,10 +140,16 @@ _g_module_symbol (gpointer     handle,
 		  const gchar *symbol_name)
 {
   gpointer p;
+  const gchar *errstr;
   
   p = dlsym (handle, symbol_name);
   if (!p)
-    g_module_set_error (fetch_dlerror (FALSE));
+    {
+      errstr = fetch_dlerror (FALSE);
+      if (!errstr)
+	errstr = "symbol not found";
+      g_module_set_error (errstr);
+    }
   
   return p;
 }
