$NetBSD: patch-al,v 1.7 2006/02/07 18:15:50 wiz Exp $

--- src/audio/openbsd/SDL_openbsdaudio.c.orig	2004-01-04 17:49:15.000000000 +0100
+++ src/audio/openbsd/SDL_openbsdaudio.c
@@ -46,8 +46,12 @@
 #include "SDL_audiodev_c.h"
 #include "SDL_openbsdaudio.h"
 
-/* The tag name used by OpenBSD audio */
+/* The tag name used by NetBSD/OpenBSD audio */
+#ifdef __NetBSD__
+#define OBSD_DRIVER_NAME         "netbsd"
+#else
 #define OBSD_DRIVER_NAME         "openbsd"
+#endif
 
 /* Open the audio device for playback, and don't block if busy */
 /* #define USE_BLOCKING_WRITES */
@@ -132,7 +136,11 @@ static SDL_AudioDevice
 }
 
 AudioBootStrap OPENBSD_AUDIO_bootstrap = {
+#ifdef __NetBSD__
+	OBSD_DRIVER_NAME, "Native NetBSD audio",
+#else
 	OBSD_DRIVER_NAME, "Native OpenBSD audio",
+#endif
 	Audio_Available, Audio_CreateDevice
 };
 
@@ -140,6 +148,7 @@ AudioBootStrap OPENBSD_AUDIO_bootstrap =
 static void
 OBSD_WaitAudio(_THIS)
 {
+#ifdef __OpenBSD__
 	/* Check to see if the thread-parent process is still alive */
 	{ static int cnt = 0;
 		/* Note that this only works with thread implementations 
@@ -151,6 +160,7 @@ OBSD_WaitAudio(_THIS)
 			}
 		}
 	}
+#endif
 
 #ifndef USE_BLOCKING_WRITES /* Not necessary when using blocking writes */
 	/* See if we need to use timed audio synchronization */
@@ -262,20 +272,20 @@ OBSD_Status(_THIS)
 	return;
     }
 
-    fprintf(stderr,"
-[play/record info]
-buffer size	:   %d bytes
-sample rate	:   %i Hz
-channels	:   %i
-precision	:   %i-bit
-encoding	:   0x%x
-seek		:   %i
-sample count	:   %i
-EOF count	:   %i
-paused		:   %s
-error occured	:   %s
-waiting		:   %s
-active		:   %s
+    fprintf(stderr,"\n\
+[play/record info]\n\
+buffer size	:   %d bytes\n\
+sample rate	:   %i Hz\n\
+channels	:   %i\n\
+precision	:   %i-bit\n\
+encoding	:   0x%x\n\
+seek		:   %i\n\
+sample count	:   %i\n\
+EOF count	:   %i\n\
+paused		:   %s\n\
+error occured	:   %s\n\
+waiting		:   %s\n\
+active		:   %s\n\
 ",
     info.play.buffer_size,
     info.play.sample_rate,
@@ -290,13 +300,13 @@ active		:   %s
     info.play.waiting ? "yes" : "no",
     info.play.active ? "yes": "no");
 
-    fprintf(stderr,"
-[audio info]
-monitor_gain	:   %i
-hw block size	:   %d bytes
-hi watermark	:   %i
-lo watermark	:   %i
-audio mode	:   %s
+    fprintf(stderr,"\n\
+[audio info]\n\
+monitor_gain	:   %i\n\
+hw block size	:   %d bytes\n\
+hi watermark	:   %i\n\
+lo watermark	:   %i\n\
+audio mode	:   %s\n\
 ",  
     info.monitor_gain,
     info.blocksize,
@@ -388,6 +398,9 @@ OBSD_OpenAudio(_THIS, SDL_AudioSpec *spe
     	spec->channels = 1;
     AUDIO_INITINFO(&info);
     info.play.sample_rate = spec->freq;
+    info.blocksize = spec->size;
+    info.hiwat = 5;
+    info.lowat = 3;
     (void)ioctl(audio_fd, AUDIO_SETINFO, &info);
     (void)ioctl(audio_fd, AUDIO_GETINFO, &info);
     spec->freq  = info.play.sample_rate;
