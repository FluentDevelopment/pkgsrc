$NetBSD: patch-am,v 1.3 2002/07/13 16:17:33 wiz Exp $

--- configure.orig	Thu Nov  8 08:28:08 2001
+++ configure
@@ -3588,10 +3588,7 @@
     if test x$enable_audio = xyes -a x$enable_nas = xyes; then
         echo $ac_n "checking for NAS audio support""... $ac_c" 1>&6
 echo "configure:3591: checking for NAS audio support" >&5
-        have_nas=no
-        if test -r /usr/X11R6/include/audio/audiolib.h; then
-            have_nas=yes
-        fi
+        have_nas=yes
         echo "$ac_t""$have_nas" 1>&6
         if test x$have_nas = xyes; then
             CFLAGS="$CFLAGS -DNAS_SUPPORT"
@@ -3683,7 +3680,7 @@
                   NASMFLAGS="-f win32"
                   ;;
               *)
-                  NASMFLAGS="-f elf"
+                  test -n "$NASMFLAGS" || NASMFLAGS="-f elf"
                   ;;
             esac
             
@@ -5582,8 +5579,8 @@
             pthread_lib="-pthread"
             ;;
         *-*-netbsd*)
-            pthread_cflags="-I/usr/pkg/include -D_REENTRANT"
-            pthread_lib="-L/usr/pkg/lib -lpthread -lsem"
+            pthread_cflags="-D_REENTRANT"
+            pthread_lib="-lpthread"
             ;;
         *-*-openbsd*)
             pthread_cflags="-D_REENTRANT"
@@ -6588,11 +6585,13 @@
         CheckDummyVideo
         CheckDiskAudio
         CheckNASM
+        CheckOPENBSDAUDIO
         CheckOSS
         CheckARTSC
         CheckESD
         CheckNAS
         CheckX11
+        CheckDGA
         CheckAAlib
         CheckOpenGL
         CheckPTHREAD
@@ -7553,7 +7552,20 @@
 __EOF__
   cat >>$new <$old
 
-            
+	    if test x$use_pthreads = xyes -a x$enable_pthread_sem != xyes; then
+		
+  echo "Copying src/thread/generic/SDL_syssem.c -> src/thread/SDL_syssem.c"
+  old="$srcdir/src/thread/generic/SDL_syssem.c"
+  new="$srcdir/src/thread/SDL_syssem.c"
+  cat >$new <<__EOF__
+/* WARNING:  This file was automatically generated!
+ * Original: $old
+ */
+__EOF__
+  cat >>$new <$old
+
+	    else
+		
   echo "Copying src/thread/linux/SDL_syssem.c -> src/thread/SDL_syssem.c"
   old="$srcdir/src/thread/linux/SDL_syssem.c"
   new="$srcdir/src/thread/SDL_syssem.c"
@@ -7564,6 +7576,7 @@
 __EOF__
   cat >>$new <$old
 
+	    fi
             
   echo "Copying src/thread/generic/SDL_syssem_c.h -> src/thread/SDL_syssem_c.h"
   old="$srcdir/src/thread/generic/SDL_syssem_c.h"
@@ -8842,6 +8855,10 @@
 
 if test $ARCH = solaris; then
   SDL_RLD_FLAGS="-R\${exec_prefix}/lib"
+fi
+
+if test $ARCH = netbsd; then
+  SDL_RLD_FLAGS="-Wl,-rpath,\${exec_prefix}/lib -Wl,-rpath,${X11BASE}/lib"
 fi
 
 if test $ARCH = openbsd; then
