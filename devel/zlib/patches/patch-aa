$NetBSD: patch-aa,v 1.6 2004/05/08 01:06:26 tv Exp $

--- Makefile.in.orig	2003-11-09 02:29:23.000000000 +0000
+++ Makefile.in
@@ -16,9 +16,7 @@
 # To install in $HOME instead of /usr/local, use:
 #    make install prefix=$HOME
 
-CC=cc
 
-CFLAGS=-O
 #CFLAGS=-O -DMAX_WBITS=14 -DMAX_MEM_LEVEL=7
 #CFLAGS=-g -DDEBUG
 #CFLAGS=-O3 -Wall -Wwrite-strings -Wpointer-arith -Wconversion \
@@ -54,7 +52,6 @@ OBJA =
 
 TEST_OBJS = example.o minigzip.o
 
-all: example$(EXE) minigzip$(EXE)
 
 check: test
 test: all
@@ -77,11 +74,11 @@ match.o: match.S
 	mv _match.o match.o
 	rm -f _match.s
 
-$(SHAREDLIBV): $(OBJS)
-	$(LDSHARED) -o $@ $(OBJS)
-	rm -f $(SHAREDLIB) $(SHAREDLIBM)
-	ln -s $@ $(SHAREDLIB)
-	ln -s $@ $(SHAREDLIBM)
+all: $(OBJS)
+	${LIBTOOL} --mode=link ${CC} -o libz.la ${OBJS:.o=.lo} -rpath ${PREFIX}/lib -version-info 1:2
+
+.c.o:
+	${LIBTOOL} --mode=compile ${CC} ${CPPFLAGS} ${CFLAGS} -c $<
 
 example$(EXE): example.o $(LIBS)
 	$(CC) $(CFLAGS) -o $@ example.o $(LDFLAGS)
@@ -90,6 +87,11 @@ minigzip$(EXE): minigzip.o $(LIBS)
 	$(CC) $(CFLAGS) -o $@ minigzip.o $(LDFLAGS)
 
 install: $(LIBS)
+	${BSD_INSTALL_DATA} zconf.h zlib.h ${PREFIX}/include
+	${BSD_INSTALL_DATA} zlib.3 ${PREFIX}/man/man3
+	${LIBTOOL} --mode=install ${BSD_INSTALL_LIB} libz.la ${PREFIX}/lib
+
+installold: $(LIBS)
 	-@if [ ! -d $(exec_prefix) ]; then mkdir -p $(exec_prefix); fi
 	-@if [ ! -d $(includedir)  ]; then mkdir -p $(includedir); fi
 	-@if [ ! -d $(libdir)      ]; then mkdir -p $(libdir); fi
