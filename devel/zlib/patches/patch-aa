$NetBSD: patch-aa,v 1.11 2007/05/15 19:39:12 heinz Exp $

--- Makefile.in.orig	2005-07-18 04:25:21.000000000 +0200
+++ Makefile.in
@@ -16,7 +16,6 @@
 # To install in $HOME instead of /usr/local, use:
 #    make install prefix=$HOME
 
-CC=cc
 
 CFLAGS=-O
 #CFLAGS=-O -DMAX_WBITS=14 -DMAX_MEM_LEVEL=7
@@ -54,10 +53,9 @@ OBJA =
 
 TEST_OBJS = example.o minigzip.o
 
-all: example$(EXE) minigzip$(EXE)
 
 check: test
-test: all
+test: all example minigzip
 	@LD_LIBRARY_PATH=.:$(LD_LIBRARY_PATH) ; export LD_LIBRARY_PATH; \
 	echo hello world | ./minigzip | ./minigzip -d || \
 	  echo '		*** minigzip test FAILED ***' ; \
@@ -77,19 +75,24 @@ match.o: match.S
 	mv _match.o match.o
 	rm -f _match.s
 
-$(SHAREDLIBV): $(OBJS)
-	$(LDSHARED) -o $@ $(OBJS)
-	rm -f $(SHAREDLIB) $(SHAREDLIBM)
-	ln -s $@ $(SHAREDLIB)
-	ln -s $@ $(SHAREDLIBM)
+all: $(OBJS)
+	${LIBTOOL} --mode=link ${CC} ${CPPFLAGS} ${CFLAGS} ${PKGSRC_LDFLAGS} -o libz.la ${OBJS:.o=.lo} -rpath ${PREFIX}/lib -version-info 1:2
+
+.c.o:
+	${LIBTOOL} --mode=compile ${CC} ${CPPFLAGS} ${CFLAGS} -c $<
 
 example$(EXE): example.o $(LIBS)
-	$(CC) $(CFLAGS) -o $@ example.o $(LDFLAGS)
+	${LIBTOOL} --mode=link ${CC} ${CPPFLAGS} ${CFLAGS} ${PKGSRC_LDFLAGS} -o $@ $>
 
 minigzip$(EXE): minigzip.o $(LIBS)
-	$(CC) $(CFLAGS) -o $@ minigzip.o $(LDFLAGS)
+	${LIBTOOL} --mode=link ${CC} ${CPPFLAGS} ${CFLAGS} ${PKGSRC_LDFLAGS} -o $@ $>
 
 install: $(LIBS)
+	${BSD_INSTALL_DATA} zconf.h zlib.h ${DESTDIR}${PREFIX}/include
+	${BSD_INSTALL_DATA} zlib.3 ${DESTDIR}${PREFIX}/${PKGMANDIR}/man3
+	${LIBTOOL} --mode=install ${BSD_INSTALL_LIB} libz.la ${DESTDIR}${PREFIX}/lib
+
+installold: $(LIBS)
 	-@if [ ! -d $(exec_prefix) ]; then mkdir -p $(exec_prefix); fi
 	-@if [ ! -d $(includedir)  ]; then mkdir -p $(includedir); fi
 	-@if [ ! -d $(libdir)      ]; then mkdir -p $(libdir); fi
