$NetBSD: patch-aa,v 1.10 2007/01/13 13:50:11 schwarz Exp $

--- Makefile.in.orig	2004-09-15 16:27:20.000000000 +0200
+++ Makefile.in	2005-04-10 12:48:19.000000000 +0200
@@ -16,7 +16,6 @@
 # To install in $HOME instead of /usr/local, use:
 #    make install prefix=$HOME
 
-CC=cc
 
 CFLAGS=-O
 #CFLAGS=-O -DMAX_WBITS=14 -DMAX_MEM_LEVEL=7
@@ -54,7 +53,6 @@
 
 TEST_OBJS = example.o minigzip.o
 
-all: example$(EXE) minigzip$(EXE)
 
 check: test
 test: all
@@ -77,11 +75,11 @@
 	mv _match.o match.o
 	rm -f _match.s
 
-$(SHAREDLIBV): $(OBJS)
-	$(LDSHARED) -o $@ $(OBJS)
-	rm -f $(SHAREDLIB) $(SHAREDLIBM)
-	ln -s $@ $(SHAREDLIB)
-	ln -s $@ $(SHAREDLIBM)
+all: $(OBJS)
+	${LIBTOOL} --mode=link ${CC} ${CPPFLAGS} ${CFLAGS} ${PKGSRC_LDFLAGS} -o libz.la ${OBJS:.o=.lo} -rpath ${PREFIX}/lib -version-info 1:2
+
+.c.o:
+	${LIBTOOL} --mode=compile ${CC} ${CPPFLAGS} ${CFLAGS} -c $<
 
 example$(EXE): example.o $(LIBS)
 	$(CC) $(CFLAGS) -o $@ example.o $(LDFLAGS)
@@ -90,6 +88,11 @@
 	$(CC) $(CFLAGS) -o $@ minigzip.o $(LDFLAGS)
 
 install: $(LIBS)
+	${BSD_INSTALL_DATA} zconf.h zlib.h ${PREFIX}/include
+	${BSD_INSTALL_DATA} zlib.3 ${PREFIX}/${PKGMANDIR}/man3
+	${LIBTOOL} --mode=install ${BSD_INSTALL_LIB} libz.la ${PREFIX}/lib
+
+installold: $(LIBS)
 	-@if [ ! -d $(exec_prefix) ]; then mkdir -p $(exec_prefix); fi
 	-@if [ ! -d $(includedir)  ]; then mkdir -p $(includedir); fi
 	-@if [ ! -d $(libdir)      ]; then mkdir -p $(libdir); fi
