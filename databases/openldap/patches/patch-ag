$NetBSD: patch-ag,v 1.3 2004/11/26 02:52:14 jlam Exp $

--- servers/slapd/Makefile.in.orig	2004-07-25 18:31:04.000000000 -0400
+++ servers/slapd/Makefile.in
@@ -74,6 +74,10 @@ XLIBS = $(SLAPD_STATIC_DEPENDS) $(SLAPD_
 XXLIBS = $(SLAPD_LIBS) $(SECURITY_LIBS) $(LUTIL_LIBS)
 XXXLIBS = $(LTHREAD_LIBS) $(SLAPI_LIBS) $(MODULES_LIBS)
 
+AC_CFLAGS += $(DL_CFLAGS)
+AC_LDFLAGS += $(DL_LDFLAGS)
+AC_LIBS += $(DL_LIBS)
+
 BUILD_OPT = "--enable-slapd"
 BUILD_SRV = @BUILD_SLAPD@
 
@@ -401,17 +405,14 @@ install-schema: FORCE
 		else \
 			echo "PRESERVING EXISTING SCHEMA FILE $$SD" ; \
 		fi ; \
-		$(INSTALL) $(INSTALLFLAGS) -m 444 $$i $$SD.default ; \
 	done
 
 install-conf: FORCE
 	@-$(MKDIR) $(DESTDIR)$(sysconfdir)
-	@-$(INSTALL) -m 700 -d $(DESTDIR)$(localstatedir)/openldap-data
-	$(INSTALL) $(INSTALLFLAGS) -m 600 slapd.conf.tmp $(DESTDIR)$(sysconfdir)/slapd.conf.default
 	if test ! -f $(DESTDIR)$(sysconfdir)/slapd.conf; then \
 		echo "installing slapd.conf in $(sysconfdir)"; \
-		echo "$(INSTALL) $(INSTALLFLAGS) -m 600 slapd.conf.tmp $(DESTDIR)$(sysconfdir)/slapd.conf"; \
-		$(INSTALL) $(INSTALLFLAGS) -m 600 slapd.conf.tmp $(DESTDIR)$(sysconfdir)/slapd.conf; \
+		echo "$(INSTALL) $(INSTALLFLAGS) -m 444 slapd.conf.tmp $(DESTDIR)$(sysconfdir)/slapd.conf"; \
+		$(INSTALL) $(INSTALLFLAGS) -m 444 slapd.conf.tmp $(DESTDIR)$(sysconfdir)/slapd.conf; \
 	else \
 		echo "PRESERVING EXISTING CONFIGURATION FILE $(DESTDIR)$(sysconfdir)/slapd.conf" ; \
 	fi
