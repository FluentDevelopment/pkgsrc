$NetBSD: patch-aa,v 1.2 2003/06/10 09:54:42 wiz Exp $

--- ../dist/Makefile.in.orig	Fri Aug 30 20:11:56 2002
+++ ../dist/Makefile.in
@@ -11,7 +11,7 @@ exec_prefix=@exec_prefix@
 bindir=	@bindir@
 includedir=@includedir@
 libdir=	@libdir@
-docdir=	$(prefix)/docs
+docdir= $(prefix)/share/doc/db4
 
 dmode=	755
 emode=	555
@@ -42,7 +42,7 @@ INSTALLER=	@INSTALLER@
 LIBTOOL=	@LIBTOOL@
 
 POSTLINK=	@POSTLINK@
-SOLINK=		@MAKEFILE_SOLINK@
+SOLINK=		@MAKEFILE_SOLINK@ -version-info @DB_VERSION_MINOR@:@DB_VERSION_PATCH@
 SOFLAGS=	@SOFLAGS@
 SOMAJOR=	@DB_VERSION_MAJOR@
 SOVERSION=	@DB_VERSION_MAJOR@.@DB_VERSION_MINOR@
@@ -59,13 +59,13 @@ LDFLAGS=	@LDFLAGS@
 LIBS=		@LIBS@
 LIBSO_LIBS=	@LIBSO_LIBS@
 
-libdb=		libdb.a
-libso_base=	libdb
-libso=		$(libso_base)-$(SOVERSION).@SOSUFFIX@
-libso_static=	$(libso_base)-$(SOVERSION).a
-libso_target=	$(libso_base)-$(SOVERSION).la
+libdb=		$(libso_base).la
+libso_base=	libdb4
+libso=		$(libso_base).@SOSUFFIX@.$(SOVERSION)
+libso_static=	$(libso_base).la
+libso_target=	$(libso_base).la
 libso_default=	$(libso_base).@SOSUFFIX@
-libso_major=	$(libso_base)-$(SOMAJOR).@SOSUFFIX@
+libso_major=	$(libso_base).@SOSUFFIX@.$(SOMAJOR)
 
 ##################################################
 # C++ API.
@@ -78,13 +78,13 @@ CXXLINK=	@MAKEFILE_CXXLINK@
 XSOLINK=	@MAKEFILE_XSOLINK@
 LIBXSO_LIBS=	@LIBXSO_LIBS@
 
-libcxx=		libdb_cxx.a
-libxso_base=	libdb_cxx
-libxso=		$(libxso_base)-$(SOVERSION).@SOSUFFIX@
-libxso_static=	$(libxso_base)-$(SOVERSION).a
-libxso_target=	$(libxso_base)-$(SOVERSION).la
+libcxx=		libdb4_cxx.a
+libxso_base=	libdb4_cxx
+libxso=		$(libxso_base).@SOSUFFIX@.$(SOVERSION)
+libxso_static=	$(libxso_base).a
+libxso_target=	$(libxso_base).la
 libxso_default=	$(libxso_base).@SOSUFFIX@
-libxso_major=	$(libxso_base)-$(SOMAJOR).@SOSUFFIX@
+libxso_major=	$(libxso_base).@SOSUFFIX@.$(SOMAJOR)
 
 ##################################################
 # Java API.
@@ -107,16 +107,16 @@ JAVA_DBDIR=	$(JAVA_SRCDIR)/$(JAVA_DBREL)
 JAVA_EXDIR=	$(JAVA_SRCDIR)/$(JAVA_EXREL)
 JAVA_RPCDIR=	$(srcdir)/rpc_server/java
 
-libj_jarfile=	db.jar
+libj_jarfile=	db4.jar
 libj_exjarfile=	dbexamples.jar
 rpc_jarfile=	dbsvc.jar
-libjso_base=	libdb_java
-libjso=		$(libjso_base)-$(SOVERSION).@JMODSUFFIX@
+libjso_base=	libdb4_java
+libjso=		$(libjso_base).@JMODSUFFIX@.$(SOVERSION)
 libjso_static=	$(libjso_base)-$(SOVERSION).a
-libjso_target=	$(libjso_base)-$(SOVERSION).la
+libjso_target=	$(libjso_base).la
 libjso_default=	$(libjso_base).@JMODSUFFIX@
-libjso_major=	$(libjso_base)-$(SOMAJOR).@JMODSUFFIX@
-libjso_g=	$(libjso_base)-$(SOVERSION)_g.@JMODSUFFIX@
+libjso_major=	$(libjso_base).@JMODSUFFIX@.$(SOMAJOR)
+libjso_g=	$(libjso_base)_g.@JMODSUFFIX@.${SOVERSION}
 
 ##################################################
 # TCL API.
@@ -125,12 +125,12 @@ libjso_g=	$(libjso_base)-$(SOVERSION)_g.
 ##################################################
 TCFLAGS=	@TCFLAGS@
 LIBTSO_LIBS=	@LIBTSO_LIBS@
-libtso_base=	libdb_tcl
-libtso=		$(libtso_base)-$(SOVERSION).@MODSUFFIX@
+libtso_base=	libdb4_tcl
+libtso=		$(libtso_base).@MODSUFFIX@.$(SOVERSION)
 libtso_static=	$(libtso_base)-$(SOVERSION).a
-libtso_target=	$(libtso_base)-$(SOVERSION).la
+libtso_target=	$(libtso_base).la
 libtso_default=	$(libtso_base).@MODSUFFIX@
-libtso_major=	$(libtso_base)-$(SOMAJOR).@MODSUFFIX@
+libtso_major=	$(libtso_base).@MODSUFFIX@.$(SOMAJOR)
 
 ##################################################
 # db_dump185 UTILITY
@@ -364,8 +364,8 @@ RPC_JAVASRV_SRCS=\
 
 UTIL_PROGS=\
 	@ADDITIONAL_PROGS@ \
-	db_archive db_checkpoint db_deadlock \
-	db_dump db_load db_printlog db_recover db_stat db_upgrade db_verify
+	db4_archive db4_checkpoint db4_deadlock \
+	db4_dump db4_load db4_printlog db4_recover db4_stat db4_upgrade db4_verify
 
 ##################################################
 # List of files installed into the library directory.
@@ -410,14 +410,6 @@ install-strip install: all @INSTALL_TARG
 ##################################################
 library_build: @INSTALL_LIBS@ @ADDITIONAL_LANG@ $(UTIL_PROGS)
 
-$(libdb): $(C_OBJS)
-	$(ar) cr $@ $(C_OBJS)
-	test ! -f $(ranlib) || $(ranlib) $@
-
-$(libcxx): $(CXX_OBJS) $(C_OBJS)
-	$(ar) cr $@ $(CXX_OBJS) $(C_OBJS)
-	test ! -f $(ranlib) || $(ranlib) $@
-
 $(libso_target): $(C_OBJS)
 	$(SOLINK) $(SOFLAGS) $(LDFLAGS) -o $@ $(C_OBJS) $(LIBSO_LIBS)
 
@@ -441,7 +433,7 @@ java:	$(libj_jarfile) $(libj_exjarfile)
 
 $(libj_jarfile): $(JAVA_DBSRCS)
 	@test -d $(JAVA_CLASSTOP) || \
-	   ($(mkdir) -p $(JAVA_CLASSTOP) && $(chmod) $(dmode) $(JAVA_CLASSTOP))
+	    ($(mkdir) -p $(JAVA_CLASSTOP) && $(chmod) $(dmode) $(JAVA_CLASSTOP))
 	$(JAVAC) -d $(JAVA_CLASSTOP) $(JAVACFLAGS) $(JAVA_DBSRCS)
 	cd $(JAVA_CLASSTOP) && $(JAR) cf ../$(libj_jarfile) $(JAVA_DBREL)
 
@@ -463,17 +455,17 @@ $(rpc_jarfile): $(libj_jarfile) $(RPC_JA
 ##################################################
 # Utilities
 ##################################################
-berkeley_db_svc: $(RPC_SRV_OBJS) util_log@o@ $(DEF_LIB)
+berkeley_db4_svc: $(RPC_SRV_OBJS) util_log@o@ $(DEF_LIB)
 	$(CCLINK) -o $@ $(LDFLAGS) \
 	    $(RPC_SRV_OBJS) util_log@o@ $(DEF_LIB) $(LIBS)
 	$(POSTLINK) $@
 
-berkeley_db_cxxsvc: $(RPC_CXXSRV_OBJS) util_log@o@ $(DEF_LIB_CXX)
+berkeley_db4_cxxsvc: $(RPC_CXXSRV_OBJS) util_log@o@ $(DEF_LIB_CXX)
 	$(CXXLINK) -o $@ $(LDFLAGS) \
 	    $(RPC_CXXSRV_OBJS) util_log@o@ $(DEF_LIB_CXX) $(LIBS)
 	$(POSTLINK) $@
 
-berkeley_db_javasvc: $(rpc_jarfile)
+berkeley_db4_javasvc: $(rpc_jarfile)
 	echo > $@ "#!/bin/sh"
 	echo >> $@ CLASSPATH="$(CLASSPATH):$(rpc_jarfile):$(JAVA_RPCDIR)/oncrpc.jar"
 	echo >> $@ LD_LIBRARY_PATH=.libs
@@ -481,53 +473,53 @@ berkeley_db_javasvc: $(rpc_jarfile)
 	echo >> $@ exec java com.sleepycat.db.rpcserver.DbServer \$$@
 	chmod +x $@
 
-db_archive: db_archive@o@ util_sig@o@ $(DEF_LIB)
+db4_archive: db_archive@o@ util_sig@o@ $(DEF_LIB)
 	$(CCLINK) -o $@ $(LDFLAGS) \
 	    db_archive@o@ util_sig@o@ $(DEF_LIB) $(LIBS)
 	$(POSTLINK) $@
 
-db_checkpoint: db_checkpoint@o@ util_log@o@ util_sig@o@ $(DEF_LIB)
+db4_checkpoint: db_checkpoint@o@ util_log@o@ util_sig@o@ $(DEF_LIB)
 	$(CCLINK) -o $@ $(LDFLAGS) \
 	    db_checkpoint@o@ util_log@o@ util_sig@o@ $(DEF_LIB) $(LIBS)
 	$(POSTLINK) $@
 
-db_deadlock: db_deadlock@o@ util_log@o@ util_sig@o@ $(DEF_LIB)
+db4_deadlock: db_deadlock@o@ util_log@o@ util_sig@o@ $(DEF_LIB)
 	$(CCLINK) -o $@ $(LDFLAGS) \
 	    db_deadlock@o@ util_log@o@ util_sig@o@ $(DEF_LIB) $(LIBS)
 	$(POSTLINK) $@
 
-db_dump: db_dump@o@ util_cache@o@ util_sig@o@ $(DEF_LIB)
+db4_dump: db_dump@o@ util_cache@o@ util_sig@o@ $(DEF_LIB)
 	$(CCLINK) -o $@ $(LDFLAGS) db_dump@o@ util_cache@o@ util_sig@o@ $(DEF_LIB) $(LIBS)
 	$(POSTLINK) $@
 
-db_dump185: db_dump185@o@ @LTLIBOBJS@
+db4_dump185: db_dump185@o@ @LTLIBOBJS@
 	$(CCLINK) -o $@ $(LDFLAGS) db_dump185@o@ @LTLIBOBJS@ $(DB185LIB)
 	$(POSTLINK) $@
 
-db_load: db_load@o@ util_cache@o@ util_sig@o@ $(DEF_LIB)
+db4_load: db_load@o@ util_cache@o@ util_sig@o@ $(DEF_LIB)
 	$(CCLINK) -o $@ $(LDFLAGS) db_load@o@ util_cache@o@ util_sig@o@ $(DEF_LIB) $(LIBS)
 	$(POSTLINK) $@
 
-db_printlog: db_printlog@o@ util_sig@o@ $(DEF_LIB)
+db4_printlog: db_printlog@o@ util_sig@o@ $(DEF_LIB)
 	$(CCLINK) -o $@ $(LDFLAGS) \
 	    db_printlog@o@ util_sig@o@ $(DEF_LIB) $(LIBS)
 	$(POSTLINK) $@
 
-db_recover: db_recover@o@ util_sig@o@ $(DEF_LIB)
+db4_recover: db_recover@o@ util_sig@o@ $(DEF_LIB)
 	$(CCLINK) -o $@ $(LDFLAGS) \
 	    db_recover@o@ util_sig@o@ $(DEF_LIB) $(LIBS)
 	$(POSTLINK) $@
 
-db_stat: db_stat@o@ util_cache@o@ util_sig@o@ $(DEF_LIB)
+db4_stat: db_stat@o@ util_cache@o@ util_sig@o@ $(DEF_LIB)
 	$(CCLINK) -o $@ $(LDFLAGS) db_stat@o@ util_cache@o@ util_sig@o@ $(DEF_LIB) $(LIBS)
 	$(POSTLINK) $@
 
-db_upgrade: db_upgrade@o@ util_sig@o@ $(DEF_LIB)
+db4_upgrade: db_upgrade@o@ util_sig@o@ $(DEF_LIB)
 	$(CCLINK) -o $@ $(LDFLAGS) \
 	    db_upgrade@o@ util_sig@o@ $(DEF_LIB) $(LIBS)
 	$(POSTLINK) $@
 
-db_verify: db_verify@o@ util_cache@o@ util_sig@o@ $(DEF_LIB)
+db4_verify: db_verify@o@ util_cache@o@ util_sig@o@ $(DEF_LIB)
 	$(CCLINK) -o $@ $(LDFLAGS) \
 	    db_verify@o@ util_cache@o@ util_sig@o@ $(DEF_LIB) $(LIBS)
 	$(POSTLINK) $@
@@ -548,12 +540,9 @@ INCDOT=	db.h db_cxx.h @ADDITIONAL_INCS@
 INCINC=	cxx_common.h cxx_except.h
 install_include:
 	@echo "Installing DB include files: $(includedir) ..."
-	@test -d $(includedir) || \
-	    ($(mkdir) -p $(includedir) && $(chmod) $(dmode) $(includedir))
-	@cd $(includedir) && $(rm) -f $(INCDOT) $(INCINC)
-	@$(cp) -p $(INCDOT) $(includedir)
-	@cd $(srcdir)/dbinc/ && $(cp) -p $(INCINC) $(includedir)
-	@cd $(includedir) && $(chmod) $(fmode) $(INCDOT) $(INCINC)
+	${BSD_INSTALL_DATA_DIR} ${includedir}
+	${BSD_INSTALL_DATA} ${INCDOT} ${includedir}
+	@cd $(srcdir)/dbinc/ && ${BSD_INSTALL_DATA} $(INCINC) $(includedir)
 
 uninstall_include:
 	@cd $(includedir) && $(rm) -f $(INCDOT) $(INCINC)
@@ -565,8 +554,6 @@ install_lib:
 	@cd $(libdir) && $(rm) -f $(LIB_INSTALL_FILE_LIST)
 	@$(INSTALLER) @INSTALL_LIBS@ $(libdir)
 	@(cd $(libdir) && \
-	    test -f $(libso) && $(ln) -s $(libso) $(libso_default); \
-	    test -f $(libso) && $(ln) -s $(libso) $(libso_major); \
 	    test -f $(libso_static) && $(ln) -s $(libso_static) $(libdb); \
 	    test -f $(libxso) && $(ln) -s $(libxso) $(libxso_default); \
 	    test -f $(libxso) && $(ln) -s $(libxso) $(libxso_major); \
@@ -605,8 +592,7 @@ DOCLIST=\
 	sleepycat utility
 install_docs:
 	@echo "Installing documentation: $(docdir) ..."
-	@test -d $(docdir) || \
-	    ($(mkdir) -p $(docdir) && $(chmod) $(dmode) $(docdir))
+	${BSD_INSTALL_DATA_DIR} $(docdir)
 	@cd $(docdir) && $(rm) -rf $(DOCLIST)
 	@cd $(srcdir)/docs && $(cp) -pr $(DOCLIST) $(docdir)/
 
