$NetBSD: patch-aa,v 1.1 2004/07/28 02:50:22 kim Exp $

--- filter.c	2004/01/23 07:14:32	1.29
+++ filter.c	2004/03/25 18:19:38	1.30
@@ -1,6 +1,6 @@
 
 /*
- * $Id: patch-aa,v 1.1 2004/07/28 02:50:22 kim Exp $
+ * $Id: patch-aa,v 1.1 2004/07/28 02:50:22 kim Exp $
  *
  * by JH <jheinonen@users.sourceforge.net>
  *
@@ -618,6 +618,7 @@
 mutt_read_line(FILE *in, char **alias, char **rest)
 {
 	char *line, *ptr, *tmp;
+	size_t alias_len;
 
 	if( !(line = ptr = getaline(in)) )
 		return 1; /* error / EOF */
@@ -640,13 +641,16 @@
 	while( ! ISSPACE(*ptr) )
 		ptr++;
 
-	if( (*alias = (char *)malloc(ptr - tmp)) == NULL) {
+	/* includes also the trailing zero */
+	alias_len = (size_t)(ptr - tmp + 1);
+
+	if( (*alias = (char *)malloc(alias_len)) == NULL) {
 		free(line);
 		return 1;
 	}
 
-	strncpy(*alias, tmp, ptr - tmp - 1);
-	*(*alias + (ptr - tmp - 1)) = 0;
+	strncpy(*alias, tmp, alias_len - 1);
+	*(*alias + alias_len - 1) = 0;
 
 	while(ISSPACE(*ptr))
 		ptr++;
