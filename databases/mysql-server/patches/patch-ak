$NetBSD: patch-ak,v 1.5 2002/12/13 14:19:55 tron Exp $

--- sql/sql_parse.cc.orig	Thu Feb 14 18:30:14 2002
+++ sql/sql_parse.cc	Fri Dec 13 14:46:28 2002
@@ -105,6 +105,8 @@
   NET *net= &thd->net;
   thd->db=0;
 
+  if (passwd[0] && strlen(passwd) != SCRAMBLE_LENGTH)
+    return 1;
   if (!(thd->user = my_strdup(user, MYF(0))))
   {
     send_error(net,ER_OUT_OF_RESOURCES);
@@ -764,8 +766,8 @@
       thread_safe_increment(com_other,&LOCK_thread_count);
       slow_command = TRUE;
       char* data = packet + 1;
-      uint db_len = *data;
-      uint tbl_len = *(data + db_len + 1);
+      uint db_len = *(uchar *)*data;
+      uint tbl_len = *(uchar *)(data + db_len + 1);
       char* db = sql_alloc(db_len + tbl_len + 2);
       memcpy(db, data + 1, db_len);
       char* tbl_name = db + db_len;
