$NetBSD: patch-ap,v 1.4 2003/02/16 23:08:59 seb Exp $

--- perl-shared/Makefile.PL.in.orig	Thu Mar 21 21:52:35 2002
+++ perl-shared/Makefile.PL.in
@@ -6,14 +6,34 @@ use Config;
 # Specify the location of the archive containing PIC compiled object files.
 my $librrd = "-L../src/.libs/ -lrrd_private"  ;
 
+my $CGILIB_INC = $ENV{CGILIB_INC};
+my $CGILIB_LIB = $ENV{CGILIB_LIB};
+my $GD_INC = $ENV{GD_INC};
+my $GD_LIB = $ENV{GD_LIB};
+my $JPEG_INC = $ENV{JPEG_INC};
+my $JPEG_LIB = $ENV{JPEG_LIB};
+my $ZLIB_INC = $ENV{ZLIB_INC};
+my $ZLIB_LIB = $ENV{ZLIB_LIB};
+my $PNG_INC = $ENV{PNG_INC};
+my $PNG_LIB = $ENV{PNG_LIB};
+my $TTF_INC = $ENV{TTF_INC};
+my $TTF_LIB = $ENV{TTF_LIB};
+
+my $_RPATH = $ENV{_RPATH};
+
+my $MY_INCS = "-I".join (" -I", ($CGILIB_INC, $GD_INC, $JPEG_INC, $ZLIB_INC, $PNG_INC, $TTF_INC));
+my $MY_LIBS = join "-L".(" -L", ($CGILIB_LIB, $GD_LIB, $JPEG_LIB, $ZLIB_LIB, $PNG_LIB, $TTF_LIB));
+my $MY_DLIBS = "-Wl,$_RPATH".join (" -Wl,$_RPATH", ($CGILIB_LIB, $GD_LIB, $JPEG_LIB, $ZLIB_LIB, $PNG_LIB, $TTF_LIB));
+
 WriteMakefile(
     'NAME'         => 'RRDs',
     'VERSION_FROM' => '@top_srcdir@/perl-shared/RRDs.pm', # finds $VERSION
     'DEFINE'	   => "-DPERLPATCHLEVEL=$Config{PATCHLEVEL}",
-    'INC'          => '-I@top_srcdir@/src -I@top_srcdir@/gd1.3',
+    'INC'          => "-I@top_srcdir@/src $MY_INCS",
+    'LIBS'         => "$MY_LIBS -lcgi -lm -lgd -lpng -lz -ljpeg -lttf",
     # where to look for the necessary libraries 
     # Perl will figure out which one is valid
-    'depend'	   => {'RRDs.c' => "../src/.libs/librrd_private.a"},
-    'dynamic_lib'  => {'OTHERLDFLAGS' => "$librrd -lm"},
+    'depend'       => {'RRDs.c' => "../src/librrd_private.la"},
+    'dynamic_lib'  => {'OTHERLDFLAGS' => "$librrd $MY_DLIBS"},
     'realclean'    => {FILES => 't/demo?.rrd t/demo?.gif' }
 );
