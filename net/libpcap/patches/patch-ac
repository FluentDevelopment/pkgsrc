$NetBSD: patch-ac,v 1.1 2005/08/10 13:48:22 drochner Exp $

--- Makefile.in.orig	2003-12-15 02:35:03.000000000 +0100
+++ Makefile.in
@@ -41,7 +41,7 @@ VPATH = @srcdir@
 # You shouldn't need to edit anything below.
 #
 
-CC = @CC@
+CC = ${LIBTOOL} --mode=compile @CC@
 CCOPT = @V_CCOPT@
 INCLS = -I. @V_INCLS@
 DEFS = @DEFS@ @V_DEFS@
@@ -67,7 +67,8 @@ YACC = @V_YACC@
 # Explicitly define compilation rule since SunOS 4's make doesn't like gcc.
 # Also, gcc does not remove the .o before forking 'as', which can be a
 # problem if you don't own the file but can write to the directory.
-.c.o:
+.SUFFIXES:	.lo
+.c.lo:
 	@rm -f $@
 	$(CC) $(CFLAGS) -c $(srcdir)/$*.c
 
@@ -83,7 +84,7 @@ SRC =	$(PSRC) $(FSRC) $(CSRC) $(SSRC) $(
 
 # We would like to say "OBJ = $(SRC:.c=.o)" but Ultrix's make cannot
 # hack the extra indirection
-OBJ =	$(PSRC:.c=.o) $(FSRC:.c=.o) $(CSRC:.c=.o) $(SSRC:.c=.o) $(GENSRC:.c=.o) $(LIBOBJS)
+OBJ =	$(PSRC:.c=.lo) $(FSRC:.c=.lo) $(CSRC:.c=.lo) $(SSRC:.c=.lo) $(GENSRC:.c=.lo) $(LIBOBJS)
 HDR =	pcap.h pcap-int.h pcap-namedb.h pcap-nit.h pcap-pf.h \
 	ethertype.h gencode.h gnuc.h
 GENHDR = \
@@ -97,12 +98,10 @@ TAGFILES = \
 
 CLEANFILES = $(OBJ) libpcap.a $(GENSRC) $(GENHDR) lex.yy.c
 
-all: libpcap.a
+all: libpcap.la
 
-libpcap.a: $(OBJ)
-	@rm -f $@
-	ar rc $@ $(OBJ) $(LIBS)
-	$(RANLIB) $@
+libpcap.la: $(OBJ)
+	${LIBTOOL} --mode=link @CC@ -rpath ${PREFIX}/lib ${LDFLAGS} $(OBJ) -o libpcap.la
 
 shared: libpcap.$(DYEXT)
 
@@ -126,10 +125,10 @@ scanner.c: $(srcdir)/scanner.l
 	@rm -f $@
 	$(LEX) -t $< > $$$$.$@; mv $$$$.$@ $@
 
-scanner.o: scanner.c tokdefs.h
+scanner.lo: scanner.c tokdefs.h
 	$(CC) $(CFLAGS) -c scanner.c
 
-pcap.o: version.h
+pcap.lo: version.h
 
 tokdefs.h: grammar.c
 grammar.c: $(srcdir)/grammar.y
@@ -138,14 +137,14 @@ grammar.c: $(srcdir)/grammar.y
 	mv y.tab.c grammar.c
 	mv y.tab.h tokdefs.h
 
-grammar.o: grammar.c
+grammar.lo: grammar.c
 	@rm -f $@
 	$(CC) $(CFLAGS) -Dyylval=pcap_lval -c grammar.c
 
-version.o: version.c
+version.lo: version.c
 	$(CC) $(CFLAGS) -c version.c
 
-snprintf.o: $(srcdir)/missing/snprintf.c
+snprintf.lo: $(srcdir)/missing/snprintf.c
 	$(CC) $(CFLAGS) -o $@ -c $(srcdir)/missing/snprintf.c
 
 version.c: $(srcdir)/VERSION
@@ -167,14 +166,13 @@ bpf_filter.c: $(srcdir)/bpf/net/bpf_filt
 	rm -f bpf_filter.c
 	ln -s $(srcdir)/bpf/net/bpf_filter.c bpf_filter.c
 
-bpf_filter.o: bpf_filter.c
+bpf_filter.lo: bpf_filter.c
 	$(CC) $(CFLAGS) -c bpf_filter.c
 
-install: libpcap.a 
+install: libpcap.la 
 	[ -d $(DESTDIR)$(libdir) ] || \
 	    (mkdir -p $(DESTDIR)$(libdir); chmod 755 $(DESTDIR)$(libdir))
-	$(INSTALL_DATA) libpcap.a $(DESTDIR)$(libdir)/libpcap.a
-	$(RANLIB) $(DESTDIR)$(libdir)/libpcap.a
+	${LIBTOOL} --mode=install $(INSTALL_DATA) libpcap.la $(DESTDIR)$(libdir)
 	[ -d $(DESTDIR)$(includedir) ] || \
 	    (mkdir -p $(DESTDIR)$(includedir); chmod 755 $(DESTDIR)$(includedir))
 	$(INSTALL_DATA) $(srcdir)/pcap.h $(DESTDIR)$(includedir)/pcap.h
