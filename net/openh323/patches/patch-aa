$NetBSD: patch-aa,v 1.3 2002/12/03 21:48:18 jdolecek Exp $

--- src/Makefile.orig	Wed Nov  6 23:58:29 2002
+++ src/Makefile	Tue Dec  3 17:11:38 2002
@@ -704,7 +704,7 @@
 
 ####################################################
 
-include $(PWLIBDIR)/make/common.mak
+include $(PWLIBDIR)/share/pwlib/make/common.mak
 
 ####################################################
 
@@ -717,7 +717,7 @@
 LIB_BASENAME=$(OH323_BASE)
 LIB_FILENAME=$(OH323_FILE)
 
-include $(PWLIBDIR)/make/lib.mak
+include $(PWLIBDIR)/share/pwlib/make/lib.mak
 
 ####################################################
 
@@ -746,15 +746,7 @@
 
 # If we're cross compiling, we want the host's asnparser
 # otherwise use the one for the current platform
-ASNPARSE_DIR = $(HOSTPWLIBDIR)/tools/asnparser
-ASNPARSER = $(ASNPARSE_DIR)/obj_$(HOST_PLATFORM_TYPE)_r/asnparser
-
-
-# If not cross compiling then make sure asnparser is built
-ifeq ($(PLATFORM_TYPE),$(HOST_PLATFORM_TYPE))
-$(ASNPARSER):
-	$(MAKE) -C $(ASNPARSE_DIR) opt
-endif
+ASNPARSER = $(PREFIX)/bin/asnparser
 
 
 ifdef ASN_EXCLUDE
@@ -906,68 +898,68 @@
 
 $(OH323_OBJDIR)/%.o : $(VIC_DIR)/%.cxx
 	@if [ ! -d $(OH323_OBJDIR) ] ; then mkdir -p $(OH323_OBJDIR) ; fi
-	$(CPLUS) -I$(VIC_DIR) $(STDCCFLAGS) $(CFLAGS) -c $< -o $@
+	$(LIBTOOL) --tag=CXX $(CPLUS) -I$(VIC_DIR) $(STDCCFLAGS) $(CFLAGS) -c $< -o $@
 
 $(OH323_OBJDIR)/%.o : $(VIC_DIR)/%.c
 	@if [ ! -d $(OH323_OBJDIR) ] ; then mkdir -p $(OH323_OBJDIR) ; fi
-	$(CC) -I$(VIC_DIR) $(STDCCFLAGS) $(CFLAGS) -c $< -o $@
+	$(LIBTOOL) --tag=CC $(CC) -I$(VIC_DIR) $(STDCCFLAGS) $(CFLAGS) -c $< -o $@
 
 $(DEPDIR)/%.dep : $(VIC_DIR)/%.c
 	@if [ ! -d $(DEPDIR) ] ; then mkdir -p $(DEPDIR) ; fi
 	@printf %s $(OH323_OBJDIR)/ > $@
-	$(CPLUS) -I$(VIC_DIR) $(STDCCFLAGS) $(CFLAGS) -M $< >> $@
+	$(LIBTOO) --tag=CXX $(CPLUS) -I$(VIC_DIR) $(STDCCFLAGS) $(CFLAGS) -M $< >> $@
 
 $(DEPDIR)/%.dep : $(VIC_DIR)/%.cxx
 	@if [ ! -d $(DEPDIR) ] ; then mkdir -p $(DEPDIR) ; fi
 	@printf %s $(OH323_OBJDIR)/ > $@
-	$(CPLUS) -I$(VIC_DIR) $(STDCCFLAGS) $(CFLAGS) -M $< >> $@
+	$(LIBTOO) --tag=CXX $(CPLUS) -I$(VIC_DIR) $(STDCCFLAGS) $(CFLAGS) -M $< >> $@
 
 
 # Build rules for the GSM codec
 
 $(OH323_OBJDIR)/%.o : $(GSM_SRCDIR)/%.c
 	@if [ ! -d $(OH323_OBJDIR) ] ; then mkdir -p $(OH323_OBJDIR) ; fi
-	$(CC) -ansi -I$(GSM_INCDIR) -DWAV49 -DNeedFunctionPrototypes=1 $(OPTCCFLAGS) $(CFLAGS) -c $< -o $@
+	$(LIBTOOL) --tag=CC $(CC) -ansi -I$(GSM_INCDIR) -DWAV49 -DNeedFunctionPrototypes=1 $(OPTCCFLAGS) $(CFLAGS) -c $< -o $@
 
 $(DEPDIR)/%.dep : $(GSM_SRCDIR)/%.c
 	@if [ ! -d $(DEPDIR) ] ; then mkdir -p $(DEPDIR) ; fi
 	@printf %s $(OH323_OBJDIR)/ > $@
-	$(CC) -ansi -I$(GSM_INCDIR) -DWAV49 -DNeedFunctionPrototypes=1 $(CFLAGS) -M $< >> $@
+	$(LIBTOOL) --tag=CC $(CC) -ansi -I$(GSM_INCDIR) -DWAV49 -DNeedFunctionPrototypes=1 $(CFLAGS) -M $< >> $@
 
 
 # Build rules for the G.726 codec
 
 $(OH323_OBJDIR)/%.o : $(G726_DIR)/%.c
 	@if [ ! -d $(OH323_OBJDIR) ] ; then mkdir -p $(OH323_OBJDIR) ; fi
-	$(CC) $(CFLAGS) -c $< -o $@
+	$(LIBTOOL) --tag=CC $(CC) $(CFLAGS) -c $< -o $@
 
 $(DEPDIR)/%.dep : $(G726_DIR)/%.c
 	@if [ ! -d $(DEPDIR) ] ; then mkdir -p $(DEPDIR) ; fi
 	@printf %s $(OH323_OBJDIR)/ > $@
-	$(CC) $(CFLAGS) -M $< >> $@
+	$(LIBTOOL) --tag=CC $(CC) $(CFLAGS) -M $< >> $@
 
 
 # Build rules for the LPC10 codec
 
 $(OH323_OBJDIR)/%.o : $(LPC10_SRCDIR)/%.c
 	@if [ ! -d $(OH323_OBJDIR) ] ; then mkdir -p $(OH323_OBJDIR) ; fi
-	$(CC) -I$(LPC10_INCDIR) $(OPTCCFLAGS) $(CFLAGS) -c $< -o $@
+	$(LIBTOOL) --tag=CC $(CC) -I$(LPC10_INCDIR) $(OPTCCFLAGS) $(CFLAGS) -c $< -o $@
 
 $(DEPDIR)/%.dep : $(LPC10_SRCDIR)/%.c
 	@if [ ! -d $(DEPDIR) ] ; then mkdir -p $(DEPDIR) ; fi
 	@printf %s $(OH323_OBJDIR)/ > $@
-	$(CC) -I$(LPC10_INCDIR) $(CFLAGS) -M $< >> $@
+	$(LIBTOOL) --tag=CC $(CC) -I$(LPC10_INCDIR) $(CFLAGS) -M $< >> $@
 
 # Build rules for the Speex codec
 
 $(OH323_OBJDIR)/%.o : $(SPEEX_SRCDIR)/%.c
 	@if [ ! -d $(OH323_OBJDIR) ] ; then mkdir -p $(OH323_OBJDIR) ; fi
-	$(CC) $(SPEEX_FLAGS) -I$(SPEEX_INCDIR) $(OPTCCFLAGS) $(CFLAGS) -c $< -o $@
+	$(LIBTOOL) --tag=CC $(CC) $(SPEEX_FLAGS) -I$(SPEEX_INCDIR) $(OPTCCFLAGS) $(CFLAGS) -c $< -o $@
 
 $(DEPDIR)/%.dep : $(SPEEX_SRCDIR)/%.c
 	@if [ ! -d $(DEPDIR) ] ; then mkdir -p $(DEPDIR) ; fi
 	@printf %s $(OH323_OBJDIR)/ > $@
-	$(CC) $(SPEEX_FLAGS) -I$(SPEEX_INCDIR) $(CFLAGS) -M $< >> $@
+	$(LIBTOOL) --tag=CC $(CC) $(SPEEX_FLAGS) -I$(SPEEX_INCDIR) $(CFLAGS) -M $< >> $@
 
 
 notrace::
