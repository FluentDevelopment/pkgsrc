$NetBSD: patch-ab,v 1.2 2006/03/14 01:58:47 joerg Exp $

--- libtun6/tun6.c.orig	2006-02-02 21:01:54.000000000 +0000
+++ libtun6/tun6.c
@@ -70,7 +70,8 @@ struct in6_ifreq {
 static const char *os_driver = "Linux";
 
 #elif defined (HAVE_FREEBSD) || defined (HAVE_OPENBSD) || \
-	defined (HAVE_NETBSD) || defined (HAVE_DARWIN)
+	defined (HAVE_NETBSD) || defined (HAVE_DARWIN) || \
+	defined (HAVE_DRAGONFLY)
 /*
  * BSD tunneling driver
  * NOTE: the driver does NOT really work on NetBSD
@@ -84,11 +85,18 @@ static const char *os_driver = "Linux";
 # define USE_TUNHEAD
 static const char *os_driver = "FreeBSD";
 
+# elif defined(HAVE_DRAGONFLY)
+#  include <net/if_var.h>
+#  include <net/tun/if_tun.h>
+# define USE_TUNHEAD
+static const char *os_driver = "DragonFly";
+
 # elif defined (HAVE_OPENBSD)
 #  define USE_TUNHEAD
 static const char *os_driver = "OpenBSD";
 
 # elif defined (HAVE_NETBSD)
+#  define USE_TUNHEAD
 static const char *os_driver = "NetBSD";
 
 # elif defined (HAVE_DARWIN)
@@ -705,7 +713,7 @@ tun6_recv (const tun6 *t, const fd_set *
 	/* TUNTAP driver */
 	if (head.tun_linux.proto != htons (ETH_P_IPV6))
 		return -1; /* only accept IPv6 packets */
-#elif defined (HAVE_FREEBSD) || defined (HAVE_OPENBSD)
+#elif defined (HAVE_FREEBSD) || defined (HAVE_OPENBSD) || defined (HAVE_NETBSD) || defined(HAVE_DRAGONFLY)
 	/* FreeBSD driver */
 	if (head.tun_bsd != htonl (AF_INET6))
 		return -1;
@@ -733,7 +741,7 @@ tun6_send (const tun6 *t, const void *pa
 	uint16_t flags;
 	uint16_t proto;
 } head = { 0, htons (ETH_P_IPV6) };
-#elif defined (HAVE_FREEBSD) || defined (HAVE_OPENBSD)
+#elif defined (HAVE_FREEBSD) || defined (HAVE_OPENBSD) || defined (HAVE_NETBSD) || defined(HAVE_DRAGONFLY)
 	uint32_t head = htonl (AF_INET6);
 #endif
 
