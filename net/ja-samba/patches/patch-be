$NetBSD: patch-be,v 1.1 2004/07/23 16:45:43 taca Exp $

--- smbd/mangle_hash.c.orig	2003-05-20 11:17:18.000000000 +0900
+++ smbd/mangle_hash.c
@@ -622,7 +622,7 @@ static void cache_mangled_name( char *ma
  * ************************************************************************** **
  */
 
-static BOOL check_mangled_cache( char *s )
+static BOOL check_mangled_cache( char *s, size_t maxlen )
 {
   ubi_cacheEntryPtr FoundPtr;
   char             *ext_start = NULL;
@@ -660,7 +660,7 @@ static BOOL check_mangled_cache( char *s
     if(saved_ext)
     {
       /* Replace the saved_ext as it was truncated. */
-      (void)pstrcat( s, saved_ext );
+     (void)safe_strcat( s, saved_ext, maxlen );
       SAFE_FREE(saved_ext);
     }
     return( False );
@@ -672,11 +672,11 @@ static BOOL check_mangled_cache( char *s
 
   DEBUG( 3, ("Found %s on mangled stack ", s) );
 
-  (void)pstrcpy( s, found_name );
+  (void)safe_strcpy( s, found_name, maxlen );
   if( saved_ext )
   {
     /* Replace the saved_ext as it was truncated. */
-    (void)pstrcat( s, saved_ext );
+    (void)safe_strcat( s, saved_ext,maxlen );
     SAFE_FREE(saved_ext);
   }
 
