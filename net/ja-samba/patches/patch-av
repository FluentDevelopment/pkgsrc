$NetBSD: patch-av,v 1.1 2003/06/04 16:25:33 taca Exp $

--- rpc_server/srv_srvsvc_nt.c.orig	2003-05-20 11:22:11.000000000 +0900
+++ rpc_server/srv_srvsvc_nt.c
@@ -38,9 +38,16 @@ static void init_srv_share_info_1(pipes_
 	pstring net_name;
 	pstring remark;
 	uint32 type;
+	int len;
+	enum remote_arch_types ra_type;
 
-	StrnCpy(net_name, lp_servicename(snum),
-		(get_remote_arch() == RA_WIN2K) ? 127 : 12);
+	ra_type = get_remote_arch();
+	if ((ra_type == RA_WIN2K) || (ra_type == RA_WINXP) ||
+	    (ra_type == RA_WIN2K3))
+		len = 127;
+	else
+		len = 12;
+	StrnCpy(net_name, lp_servicename(snum), len);
 	pstrcpy(remark, lp_comment(snum));
 	standard_sub_conn(p->conn, remark, sizeof(remark));
 	len_net_name = strlen(net_name);
