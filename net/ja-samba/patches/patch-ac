$NetBSD: patch-ac,v 1.5 2003/08/30 01:31:13 taca Exp $

--- configure.orig	2003-08-22 17:45:58.000000000 +0900
+++ configure
@@ -21463,6 +21463,49 @@ echo "${ECHO_T}no" >&6
 
 fi;
 
+echo $ac_n "checking for __libc_sched_setscheduler in -lc""... $ac_c" 1>&6
+echo "configure:11950: checking for __libc_sched_setscheduler in -lc" >&5
+ac_lib_var=`echo c'_'__libc_sched_setscheduler | sed 'y%./+-%__p_%'`
+if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  ac_save_LIBS="$LIBS"
+LIBS="-lc  $LIBS"
+cat > conftest.$ac_ext <<EOF
+#line 11958 "configure"
+#include "confdefs.h"
+/* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
+char __libc_sched_setscheduler();
+
+int main() {
+__libc_sched_setscheduler()
+; return 0; }
+EOF
+if { (eval echo configure:11969: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  eval "ac_cv_lib_$ac_lib_var=yes"
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  eval "ac_cv_lib_$ac_lib_var=no"
+fi
+rm -f conftest*
+LIBS="$ac_save_LIBS"
+
+fi
+if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+  PAM_NEEDS_LIBC=
+else
+  echo "$ac_t""no" 1>&6
+PAM_NEEDS_LIBC=-lc
+fi
+
+
+
 #################################################
 # check for a NISPLUS password database
 echo "$as_me:$LINENO: checking whether to use NISPLUS SAM database" >&5
@@ -26993,6 +27036,7 @@ s,@TERMLDFLAGS@,$TERMLDFLAGS,;t t
 s,@ROFF@,$ROFF,;t t
 s,@DYNEXP@,$DYNEXP,;t t
 s,@SHDYNEXP@,$SHDYNEXP,;t t
+s%@PAM_NEEDS_LIBC@%$PAM_NEEDS_LIBC%g
 s,@LDAPLIBS@,$LDAPLIBS,;t t
 s,@QUOTAOBJS@,$QUOTAOBJS,;t t
 s,@WINBIND_TARGETS@,$WINBIND_TARGETS,;t t
