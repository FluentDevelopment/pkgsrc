$NetBSD: patch-bb,v 1.3 2003/04/08 03:39:14 taca Exp $

--- smbd/trans2.c.orig	2003-03-17 13:17:56.000000000 +0900
+++ smbd/trans2.c
@@ -217,7 +217,6 @@ static int call_trans2open(connection_st
 	int16 open_ofun;
 	int32 open_size;
 	char *pname;
-	int16 namelen;
 
 	pstring fname;
 	mode_t unixmode;
@@ -247,9 +246,8 @@ static int call_trans2open(connection_st
 	open_ofun = SVAL(params,12);
 	open_size = IVAL(params,14);
 	pname = &params[28];
-	namelen = strlen(pname)+1;
 
-	StrnCpy(fname,pname,namelen);
+	pstrcpy(fname,pname);
 	if (strchr(fname,'?'))
 		return(ERROR_DOS(ERRDOS,ERRinvalidname));
 
