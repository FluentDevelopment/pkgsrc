$NetBSD: patch-aw,v 1.1 2004/08/17 17:32:44 taca Exp $

--- rpc_server/srv_spoolss_nt.c.orig	2003-07-17 20:34:06.000000000 +0900
+++ rpc_server/srv_spoolss_nt.c
@@ -2842,6 +2842,12 @@ static WERROR printserver_notify_info(pi
 	info->data=NULL;
 	info->count=0;
 
+	/* a bug in xp sp2 rc2 causes it to send a fnpcn request without 
+	   sending a ffpcn() request first */
+
+	if ( !option )
+		return WERR_BADFID;
+
 	for (i=0; i<option->count; i++) {
 		option_type = &(option->ctr.type[i]);
 		
@@ -2903,6 +2909,12 @@ static WERROR printer_notify_info(pipes_
 	info->data=NULL;
 	info->count=0;
 
+	/* a bug in xp sp2 rc2 causes it to send a fnpcn request without 
+	   sending a ffpcn() request first */
+
+	if ( !option )
+		return WERR_BADFID;
+
 	get_printer_snum(p, hnd, &snum);
 
 	for (i=0; i<option->count; i++) {
