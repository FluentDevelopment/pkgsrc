# $NetBSD: Makefile,v 1.10 2004/05/08 07:37:40 snj Exp $

DISTNAME=	freeradius-0.9.3
CATEGORIES=	net
MASTER_SITES=	ftp://ftp.freeradius.org/pub/radius/ \
		ftp://ftp.Awfulhak.org/pub/radius/

MAINTAINER=	david@netbsd-fr.org
HOMEPAGE=	http://www.freeradius.org/
COMMENT=	Free RADIUS server implementation

CONFLICTS+=	radiusd-cistron*
USE_GNU_TOOLS+=	make
GNU_CONFIGURE=	yes
USE_BUILDLINK3= YES
USE_LIBTOOL=	YES
USE_PKGINSTALL=	YES
LTCONFIG_OVERRIDE=	${WRKSRC}/ltconfig
PTHREAD_OPTS+=	native

CONFIGURE_ARGS=		--quiet
CONFIGURE_ARGS+=	--with-logdir=/var/log
CONFIGURE_ARGS+=	--disable-ltdl-install
CONFIGURE_ARGS+=	--with-ltdl-lib=${PREFIX}/lib
CONFIGURE_ARGS+=	--with-ltdl-include=${PREFIX}/include
CONFIGURE_ARGS+=	--localstatedir=/var
CONFIGURE_ARGS+=	--sysconfdir=${PKG_SYSCONFDIR}
CONFIGURE_ARGS+=        --without-rlm_ippool
CONFIGURE_ARGS+=        --without-rlm_smb

RCD_SCRIPTS=		radiusd

OWN_DIRS=		/var/run/radiusd

PKG_SYSCONFSUBDIR=	raddb
EGDIR=			${PREFIX}/share/examples/freeradius
CONF_FILES=		# Contents set in HEADER file

post-install:
	${INSTALL_DATA_DIR} ${EGDIR}
	cd ${WRKSRC}/raddb && for f in [a-z]*; do \
		${INSTALL_DATA} $$f ${EGDIR}/$$f; \
	done

.include "../../databases/gdbm/buildlink3.mk"
.include "../../devel/libtool/buildlink3.mk"
.include "../../mk/pthread.buildlink3.mk"

.if defined(PTHREAD_TYPE) && ${PTHREAD_TYPE} == "none"
CONFIGURE_ARGS+=	--with-threads=no
.endif

.include "../../mk/bsd.pkg.mk"
