$NetBSD: patch-ab,v 1.6 2002/03/12 17:35:31 tron Exp $

--- zlib/infblock.c.orig	Mon Mar 11 06:55:33 2002
+++ zlib/infblock.c	Tue Mar 12 18:31:47 2002
@@ -315,7 +315,6 @@
         t = inflate_trees_dynamic(257 + (t & 0x1f), 1 + ((t >> 5) & 0x1f),
                                   s->sub.trees.blens, &bl, &bd, &tl, &td,
                                   s->hufts, z);
-        ZFREE(z, s->sub.trees.blens);
         if (t != Z_OK)
         {
           if (t == (uInt)Z_DATA_ERROR)
@@ -326,7 +325,6 @@
           r = t;
           LEAVE
         }
-	ZFREE(z, s->sub.trees.blens);
         Tracev((stderr, "inflate:       trees ok\n"));
         if ((c = inflate_codes_new(bl, bd, tl, td, z)) == Z_NULL)
         {
@@ -335,6 +333,7 @@
         }
         s->sub.decode.codes = c;
       }
+      ZFREE(z, s->sub.trees.blens);
       s->mode = CODES;
     case CODES:
       UPDATE
