$NetBSD: patch-ah,v 1.7 2004/02/20 23:25:14 christos Exp $

--- configure.orig	2002-04-08 10:45:00.000000000 -0400
+++ configure	2004-02-20 18:18:08.000000000 -0500
@@ -6724,7 +6724,7 @@
 fi
 
 SNMPCONFPATH=""
-tmpset="$sysconfdir/snmp"
+tmpset="$sysconfdir"
 while test "x$tmpset" != "x$SNMPCONFPATH"; do
   SNMPCONFPATH="$tmpset"
   eval tmpset="$tmpset"
@@ -8180,73 +8180,40 @@
 fi
 
 
-echo $ac_n "checking for rpmGetFilesystemList in -lrpm""... $ac_c" 1>&6
-echo "configure:8185: checking for rpmGetFilesystemList in -lrpm" >&5
-ac_lib_var=`echo rpm'_'rpmGetFilesystemList | sed 'y%./+-%__p_%'`
-if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
-else
-  ac_save_LIBS="$LIBS"
-LIBS="-lrpm  $LIBS"
-cat > conftest.$ac_ext <<EOF
-#line 8193 "configure"
-#include "confdefs.h"
-/* Override any gcc2 internal prototype to avoid an error.  */
-/* We use char because int might match the return type of a gcc2
-    builtin and then its argument prototype would still apply.  */
-char rpmGetFilesystemList();
+#AC_CHECK_LIB(rpm, rpmGetFilesystemList,[
+#  AC_DEFINE(HAVE_LIBRPM)
+#  LIBS="-lrpm $_rpmlibs $LIBS"
+#  CFLAGS="$CFLAGS -I/usr/include/rpm"
+#],[
+#  dnl rpm-4.0.3 librpmdb actually contains what we need.
+#  AC_CHECK_LIB(rpmdb, rpmdbOpen,[
+#    AC_DEFINE(HAVE_LIBRPM)
+#    LIBS="-lrpmdb -lrpm $_rpmlibs $LIBS"
+#    CFLAGS="$CFLAGS -I/usr/include/rpm"
+#  ],,-lrpm $_rpmlibs)
+#])
 
-int main() {
-rpmGetFilesystemList()
-; return 0; }
-EOF
-if { (eval echo configure:8204: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
-  rm -rf conftest*
-  eval "ac_cv_lib_$ac_lib_var=yes"
-else
-  echo "configure: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-  rm -rf conftest*
-  eval "ac_cv_lib_$ac_lib_var=no"
-fi
-rm -f conftest*
-LIBS="$ac_save_LIBS"
-
-fi
-if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
-  echo "$ac_t""yes" 1>&6
-  
-  cat >> confdefs.h <<\EOF
-#define HAVE_LIBRPM 1
-EOF
-
-  LIBS="-lrpm $_rpmlibs $LIBS"
-  CFLAGS="$CFLAGS -I/usr/include/rpm"
-
-else
-  echo "$ac_t""no" 1>&6
-
-    echo $ac_n "checking for rpmdbOpen in -lrpmdb""... $ac_c" 1>&6
-echo "configure:8231: checking for rpmdbOpen in -lrpmdb" >&5
-ac_lib_var=`echo rpmdb'_'rpmdbOpen | sed 'y%./+-%__p_%'`
+echo $ac_n "checking for kstat_lookup in -lkstat""... $ac_c" 1>&6
+echo "configure:8198: checking for kstat_lookup in -lkstat" >&5
+ac_lib_var=`echo kstat'_'kstat_lookup | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
-LIBS="-lrpmdb -lrpm $_rpmlibs $LIBS"
+LIBS="-lkstat  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 8239 "configure"
+#line 8290 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
     builtin and then its argument prototype would still apply.  */
-char rpmdbOpen();
+char kstat_lookup();
 
 int main() {
-rpmdbOpen()
+kstat_lookup()
 ; return 0; }
 EOF
-if { (eval echo configure:8250: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8301: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -8261,43 +8228,39 @@
 fi
 if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
   echo "$ac_t""yes" 1>&6
-  
-    cat >> confdefs.h <<\EOF
-#define HAVE_LIBRPM 1
+    ac_tr_lib=HAVE_LIB`echo kstat | sed -e 's/[^a-zA-Z0-9_]/_/g' \
+    -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_lib 1
 EOF
 
-    LIBS="-lrpmdb -lrpm $_rpmlibs $LIBS"
-    CFLAGS="$CFLAGS -I/usr/include/rpm"
-  
+  LIBS="-lkstat $LIBS"
+
 else
   echo "$ac_t""no" 1>&6
 fi
 
-
-fi
-
-
-echo $ac_n "checking for kstat_lookup in -lkstat""... $ac_c" 1>&6
-echo "configure:8282: checking for kstat_lookup in -lkstat" >&5
-ac_lib_var=`echo kstat'_'kstat_lookup | sed 'y%./+-%__p_%'`
+echo $ac_n "checking for kvm_read in -lkvm""... $ac_c" 1>&6
+echo "configure:8329: checking for kvm_read in -lkvm" >&5
+ac_lib_var=`echo kvm'_'kvm_read | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
-LIBS="-lkstat  $LIBS"
+LIBS="-lkvm  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 8290 "configure"
+#line 8337 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
     builtin and then its argument prototype would still apply.  */
-char kstat_lookup();
+char kvm_read();
 
 int main() {
-kstat_lookup()
+kvm_read()
 ; return 0; }
 EOF
-if { (eval echo configure:8301: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8348: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -8312,36 +8275,38 @@
 fi
 if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
   echo "$ac_t""yes" 1>&6
-    ac_tr_lib=HAVE_LIB`echo kstat | sed -e 's/[^a-zA-Z0-9_]/_/g' \
+    ac_tr_lib=HAVE_LIB`echo kvm | sed -e 's/[^a-zA-Z0-9_]/_/g' \
     -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'`
   cat >> confdefs.h <<EOF
 #define $ac_tr_lib 1
 EOF
 
-  LIBS="-lkstat $LIBS"
+  LIBS="-lkvm $LIBS"
 
 else
   echo "$ac_t""no" 1>&6
 fi
 
-echo $ac_n "checking for kvm_read in -lkvm""... $ac_c" 1>&6
-echo "configure:8329: checking for kvm_read in -lkvm" >&5
-ac_lib_var=`echo kvm'_'kvm_read | sed 'y%./+-%__p_%'`
+---
+
+echo $ac_n "checking for des_crypt in -ldes""... $ac_c" 1>&6
+echo "configure:8329: checking for des_crypt in -ldes" >&5
+ac_lib_var=`echo des'_'des_crypt | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_save_LIBS="$LIBS"
-LIBS="-lkvm  $LIBS"
+LIBS="-ldes  $LIBS"
 cat > conftest.$ac_ext <<EOF
 #line 8337 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
     builtin and then its argument prototype would still apply.  */
-char kvm_read();
+char des_crypt();
 
 int main() {
-kvm_read()
+des_crypt()
 ; return 0; }
 EOF
 if { (eval echo configure:8348: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
@@ -8359,13 +8324,13 @@
 fi
 if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
   echo "$ac_t""yes" 1>&6
-    ac_tr_lib=HAVE_LIB`echo kvm | sed -e 's/[^a-zA-Z0-9_]/_/g' \
+    ac_tr_lib=HAVE_LIB`echo des | sed -e 's/[^a-zA-Z0-9_]/_/g' \
     -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'`
   cat >> confdefs.h <<EOF
 #define $ac_tr_lib 1
 EOF
 
-  LIBS="-lkvm $LIBS"
+  LIBS="-ldes $LIBS"
 
 else
   echo "$ac_t""no" 1>&6
@@ -8884,7 +8849,7 @@
 
 fi
 
-for ac_hdr in stdarg.h string.h fcntl.h limits.h sys/file.h sys/ioctl.h syslog.h unistd.h netinet/tcpip.h netinet/in.h netinet/ip.h netinet/ip_icmp.h net/if.h netdb.h sys/dmap.h machine/pte.h xti.h sys/sockio.h sys/socket.h sys/un.h fstab.h sys/fs.h mtab.h ufs/fs.h ufs/ffs/fs.h sys/fixpoint.h machine/param.h sys/vm.h vm/vm.h sys/vmmeter.h sys/vmparam.h sys/vmmac.h sys/vmsystm.h sys/mbuf.h sys/time.h sys/swap.h inet/mib2.h sys/statvfs.h sys/vfs.h sys/mnttab.h sys/user.h sys/proc.h sys/select.h mntent.h sys/mntent.h kstat.h utsname.h sys/utsname.h sys/cdefs.h getopt.h locale.h pthread.h sys/loadavg.h regex.h linux/tasks.h pwd.h grp.h utmpx.h
+for ac_hdr in stdarg.h string.h fcntl.h limits.h sys/file.h sys/ioctl.h syslog.h unistd.h netinet/tcpip.h netinet/in.h netinet/ip.h netinet/ip_icmp.h net/if.h netdb.h sys/dmap.h machine/pte.h xti.h sys/sockio.h sys/socket.h sys/un.h fstab.h sys/fs.h mtab.h ufs/fs.h ufs/ffs/fs.h sys/fixpoint.h machine/param.h vm/vm.h sys/vmmeter.h sys/vmparam.h sys/vmmac.h sys/vmsystm.h sys/mbuf.h sys/time.h sys/swap.h inet/mib2.h sys/statvfs.h sys/vfs.h sys/mnttab.h sys/user.h sys/proc.h sys/select.h mntent.h sys/mntent.h kstat.h utsname.h sys/utsname.h sys/cdefs.h getopt.h locale.h pthread.h sys/loadavg.h regex.h linux/tasks.h pwd.h grp.h utmpx.h
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
@@ -9044,7 +9009,7 @@
 fi
 done
 
-for ac_hdr in sys/mount.h vm/swap_pager.h ufs/ufs/dinode.h
+for ac_hdr in sys/mount.h ufs/ufs/dinode.h
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
@@ -12141,11 +12106,7 @@
 #include <sys/param.h>
 #endif
 #include <sys/types.h>
-#define KERNEL
-#define _KERNEL
 #include <sys/socket.h>
-#undef KERNEL
-#undef _KERNEL
 #include <net/route.h>
 
 
@@ -12197,11 +12158,7 @@
 #include <sys/param.h>
 #endif
 #include <sys/types.h>
-#define KERNEL
-#define _KERNEL
 #include <sys/socket.h>
-#undef KERNEL
-#undef _KERNEL
 #include <net/route.h>
 
 int main() {
@@ -12235,11 +12192,7 @@
 #include <sys/param.h>
 #endif
 #include <sys/types.h>
-#define KERNEL
-#define _KERNEL
 #include <sys/socket.h>
-#undef KERNEL
-#undef _KERNEL
 #include <net/route.h>
 
 int main() {
@@ -12340,11 +12293,7 @@
 #include <sys/param.h>
 #endif
 #include <sys/types.h>
-#define KERNEL
-#define _KERNEL
 #include <sys/socket.h>
-#undef KERNEL
-#undef _KERNEL
 #include <net/route.h>
 
 int main() {
@@ -12407,11 +12356,7 @@
 #include <sys/param.h>
 #endif
 #include <sys/types.h>
-#define KERNEL
-#define _KERNEL
 #include <sys/socket.h>
-#undef KERNEL
-#undef _KERNEL
 #include <net/route.h>
 
 
@@ -12477,11 +12422,7 @@
 #include <sys/param.h>
 #endif
 #include <sys/types.h>
-#define KERNEL
-#define _KERNEL
 #include <sys/socket.h>
-#undef KERNEL
-#undef _KERNEL
 #include <net/route.h>
 
 
@@ -12547,11 +12488,7 @@
 #include <sys/param.h>
 #endif
 #include <sys/types.h>
-#define KERNEL
-#define _KERNEL
 #include <sys/socket.h>
-#undef KERNEL
-#undef _KERNEL
 #include <net/route.h>
 
 
@@ -12617,11 +12554,7 @@
 #include <sys/param.h>
 #endif
 #include <sys/types.h>
-#define KERNEL
-#define _KERNEL
 #include <sys/socket.h>
-#undef KERNEL
-#undef _KERNEL
 #include <net/route.h>
 
 
