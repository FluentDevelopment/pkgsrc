$NetBSD: patch-ab,v 1.2 2005/02/27 22:06:10 jschauma Exp $

--- configure.orig	Mon Mar 12 07:47:41 2001
+++ configure	Sun Feb 27 16:08:19 2005
@@ -536,7 +536,6 @@
 
 
 
-test "$libdir" = "\${exec_prefix}/lib" && libdir="/lib"
 
 # Check whether --enable-socksdns or --disable-socksdns was given.
 if test "${enable_socksdns+set}" = set; then
@@ -1272,7 +1271,7 @@
 done
 
 
-for ac_func in strcspn strdup strerror strspn strtol
+for ac_func in strcspn strdup strerror strspn strtol dlopen
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
 echo "configure:1279: checking for $ac_func" >&5
@@ -1323,9 +1322,11 @@
 EOF
  
 else
+if [ ${ac_func} != "dlopen" ]; then
   echo "$ac_t""no" 1>&6
 { echo "configure: error: "Required function not found"" 1>&2; exit 1; }
 fi
+fi
 done
 
 
@@ -1733,6 +1734,7 @@
 SIMPLELIBS=${LIBS}
 LIBS=
 
+if [ $ac_cv_func_dlopen != "yes" ]; then
 echo $ac_n "checking for dlsym in -ldl""... $ac_c" 1>&6
 echo "configure:1738: checking for dlsym in -ldl" >&5
 ac_lib_var=`echo dl'_'dlsym | sed 'y%./+-%__p_%'`
@@ -1780,6 +1782,7 @@
   echo "$ac_t""no" 1>&6
 { echo "configure: error: "libdl is required"" 1>&2; exit 1; }
 fi
+fi
 
 
 echo $ac_n "checking for RTLD_NEXT from dlfcn.h""... $ac_c" 1>&6
@@ -1977,7 +1980,11 @@
 
     echo $ac_n "checking location of libc""... $ac_c" 1>&6
 echo "configure:1980: checking location of libc" >&5
+  if test "$OPSYS" != "IRIX"; then
   LIBC=`$LDD /bin/ls | $GREP "libc" | $AWK ' { print $3 } '`
+  else
+    LIBC=/usr/lib$ABI/libc.so
+  fi
 
   cat >> confdefs.h <<EOF
 #define LIBC "${LIBC}"
@@ -1992,6 +1999,8 @@
 imp2='(int __fd, struct sockaddr * __addr, int __len) {'
 proto3='(int, const struct sockaddr *, socklen_t);'
 imp3='(int __fd, const struct sockaddr * __addr, socklen_t __len) {'
+proto4='(int, const void *, socklen_t);'
+imp4='(int __fd, const void * __addr, socklen_t __len) {'
 echo $ac_n "checking for correct connect prototype""... $ac_c" 1>&6
 echo "configure:1997: checking for correct connect prototype" >&5
 if test "$cross_compiling" = yes; then
@@ -2056,6 +2065,26 @@
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
   rm -fr conftest*
+  
+    if test "$cross_compiling" = yes; then
+  PROTO=""
+else
+  cat > conftest.$ac_ext <<EOF
+#line 2045 "configure"
+#include "confdefs.h"
+
+      #include <sys/socket.h>
+      int connect$proto4
+      int main() {return(0);}
+    
+EOF
+if { (eval echo configure:2053: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+then
+  PROTO="$proto4"; IMP="$imp4"
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -fr conftest*
   PROTO=""
 fi
 rm -fr conftest*
@@ -2066,6 +2095,9 @@
 rm -fr conftest*
 fi
 
+fi
+rm -fr conftest*
+fi
 
 fi
 rm -fr conftest*
