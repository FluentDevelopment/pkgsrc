$NetBSD: patch-aa,v 1.3 2004/02/18 23:09:03 kristerw Exp $

--- Makefile.orig	Tue Jul 14 15:41:40 1998
+++ Makefile	Wed Feb 18 22:53:19 2004
@@ -3,8 +3,8 @@
 
 #BinInstallPath=$(ARCH)/
 #LibInstallPath=images/
-BinInstallPath=/usr/X11R6/bin/
-LibInstallPath=/usr/lib/Wormz/
+BinInstallPath=$(PREFIX)/bin/
+LibInstallPath=$(PREFIX)/share/Wormz/
 
 #AllDepths=16
 AllDepths=8 16 24
@@ -29,13 +29,18 @@
 ifeq ($(TYPEOS),Linux)
 ARCH=Linux
 EXTRALIBS=-lm
+else
+ifeq ($(TYPEOS),NetBSD)
+ARCH=NetBSD
+EXTRALIBS=-lm
+else
 #!!!
 #EXTRALIBS=-lefence
-else
 
 endif
 endif
 endif
+endif
 
 ifdef USE_GGI
 EXTRAGGILIBS=-lggi -lt1
@@ -43,11 +48,11 @@
 
 ifdef ARCH
 
-INSTALL=install
-INSTALLBIN=install -s
+INSTALL=install -c
+INSTALLBIN=install -c -s
 INSTALLDIR=install -d
 
-CC=gcc
+#CC=gcc
 CDEFS=-D$(ARCH) -DARCHDIR=\"$(ARCHDIR)\" -DColorDepth=$(Depth)
 
 OPTFLAGS=-O2
@@ -60,8 +65,8 @@
 #-lefence
 CFLAGS=-pipe $(INCLUDE) $(OPTFLAGS) $(DEBUGFLAGS) $(WARNFLAGS) $(CDEFS)
 #-Wshadow
-X11INCLUDE=-I/usr/openwin/share/include/
-STDINCLUDE=-I/usr/local/lib/g++-include/ -I/usr/include/g++/
+X11INCLUDE=-I${X11BASE}/include
+STDINCLUDE=
 INCLUDE=-I./include -I. $(X11INCLUDE) $(STDINCLUDE)
 
 
@@ -108,7 +113,7 @@
 
 SrcsClient=$(SrcsClientND) $(SrcsClientDD)
 ObjsClient=$(ObjsClientND) $(ObjsClientDD)
-LibsClient=-L/usr/X11R6/lib/ -L/usr/local/lib/ -lX11 -lXext $(EXTRALIBS) $(EXTRAGGILIBS)
+LibsClient=${LDFLAGS} -L${X11BASE}/lib -lX11 -lXext $(EXTRALIBS) $(EXTRAGGILIBS)
 
 SrcsServer=$(foreach dir,$(DirsServer),$(wildcard $(dir)/*.cc))
 SrcsServerNotDir=$(notdir $(SrcsServer))
@@ -120,7 +125,7 @@
 SrcsRunnerNotDir=$(notdir $(SrcsRunner))
 ObjsRunnerNotDir=$(SrcsRunnerNotDir:.cc=.o)
 ObjsRunner=$(addprefix $(OBJDIR),$(ObjsRunnerNotDir))
-LibsRunner=-L/usr/X11R6/lib/ -L/usr/local/lib/ -lX11
+LibsRunner=${LDFLAGS} -L${LOCALBASE}/lib -L${PREFIX}/lib/ -lX11
 
 AllDSrcs=$(foreach dir,$(DepthDepenceDirs),$(wildcard $(dir)/*.cc))
 AllNSrcs=$(foreach dir,$(NotDepthDepenceDirs),$(wildcard $(dir)/*.cc))
@@ -130,10 +135,10 @@
 
 
 $(OBJDIR)%$(Depth).o: %.cc
-	$(CC) $(CFLAGS) -c $< -o $@
+	$(CXX) $(CFLAGS) -c $< -o $@
 
 $(OBJDIR)%.o: %.cc
-	$(CC) $(CFLAGS) -c $< -o $@
+	$(CXX) $(CFLAGS) -c $< -o $@
 
 DEPEND=$(OBJDIR).depend
 
@@ -147,9 +152,9 @@
 	Depth=xxx $(MAKE) real-depend
 	
 real-depend:
-	$(CC) $(CFLAGS) -MM $(AllNSrcs) | \
+	$(CXX) $(CFLAGS) -MM $(AllNSrcs) | \
 	awk '/^[^ ]/ { print "$(OBJDIR)" $$0 } /^ / { print $$0 }' > $(DEPEND)
-	$(CC) $(CFLAGS) -MM $(AllDSrcs) | \
+	$(CXX) $(CFLAGS) -MM $(AllDSrcs) | \
 	awk '/^[^ ]/ { print "$(OBJDIR)" $$0 } /^ / { print $$0 }' > .deptmp
 	for i in $(AllDepths); do \
 	sed s/\\\.o/$$i\\\.o/g < .deptmp >> $(DEPEND) ; done
@@ -160,13 +165,13 @@
 	rm -f `find . -name \*~`
 	
 $(TargetClient): $(ObjsClient)
-	$(CC) $(CFLAGS) -o $(TargetClient) $(LibsClient) $(ObjsClient)
+	$(CXX) $(CFLAGS) -o $(TargetClient) $(LibsClient) $(ObjsClient)
 
 $(TargetRunner): $(ObjsRunner)
-	$(CC) $(CFLAGS) -o $(TargetRunner) $(LibsRunner) $(ObjsRunner)
+	$(CXX) $(CFLAGS) -o $(TargetRunner) $(LibsRunner) $(ObjsRunner)
 	
 $(TargetServer): $(ObjsServer)
-	$(CC) $(CFLAGS) -o $(TargetServer) $(LibsServer) $(ObjsServer)
+	$(CXX) $(CFLAGS) -o $(TargetServer) $(LibsServer) $(ObjsServer)
 
 Client-target: $(TargetClient)
 
@@ -178,14 +183,14 @@
 Create-PathConfig:
 	echo '#ifndef _PathConfig_hh_' > $(PathConfig)
 	echo '#define _PathConfig_hh_' >> $(PathConfig)
-	echo '#define ClientBinInstallPath "$(LibInstallPath)$(TargetNameClient)"' >> $(PathConfig)
+	echo '#define ClientBinInstallPath "$(BinInstallPath)$(TargetNameClient)"' >> $(PathConfig)
 	echo '#define ServerBinInstallPath "$(BinInstallPath)$(TargetNameServer)"' >> $(PathConfig)
 	echo '#define LibInstallPath "$(LibInstallPath)"' >> $(PathConfig)
 	echo '#define '$(DEF_USE_GGI) >> $(PathConfig)
 	echo '#endif' >> $(PathConfig)
 
 install-client2:
-	$(INSTALLBIN) $(TargetClient) $(LibInstallPath)$(TargetNameClient)
+	$(INSTALLBIN) $(TargetClient) $(BinInstallPath)$(TargetNameClient)
 	
 install: all
 	$(INSTALLDIR) $(BinInstallPath)
