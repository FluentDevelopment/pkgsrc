$NetBSD: patch-aj,v 1.1 2001/09/24 03:56:02 taca Exp $

--- pl/htmlsplit.pl.orig	Wed Jan 10 17:42:52 2001
+++ pl/htmlsplit.pl
@@ -72,15 +72,16 @@
 
     my $id = 0;
 #    $cont =~ s/(<a\s[^>]*href=(["']))#(.+?)(\2[^>]*>)/$1$3.html$4/gi; #'
+    $cont =~ s#(<a[^>]*\s+)name=(["'])\2([^>]*>(.*?)</a>)#$1$4#sgi;
     $cont =~ s {
-                \G(.+?)                                      # 1
-	        (<h([1-6])>)?\s*                             # 2, 3
-                <a[^>]*\s+name=([a-zA-Z0-9-\.]+|             # 4,
-                (["']).+?\5)[^>]*>(.*?)</a>                  # 5,6
-                \s*(</h\3>)?                                 # 7
-             } {
-                write_partial_file($1, $4, $6, $id++, $mtime, \%info)
-             }sgexi;
+		\G(.+?)					# 1
+		(<h([1-6])>)?\s*			# 2, 3
+		<a[^>]*\s+name=([a-zA-Z0-9-\.]+|	# 4,
+		(["']).+?\5)[^>]*>(.*?)</a>		# 5,6
+		\s*(</h\3>)?				# 7
+	     } {
+		write_partial_file($1, $4, $6, $id++, $mtime, \%info)
+	     }sgexi;
     write_partial_file($cont, "", "", $id, $mtime, \%info);
 
     return @{$info{'names'}};
@@ -130,6 +131,9 @@
     my $orig_title    = $info_ref->{'title'};
     my $prev_name     = $info_ref->{'name'};
     my $prev_anchored = $info_ref->{'anchored'};
+
+    $prev_name =~ s#\n\r##sg;
+    $prev_name =~ s#\n##sg;
 
     html::remove_html_elements(\$prev_anchored);
     $prev_anchored =~ s/^\s+//;
