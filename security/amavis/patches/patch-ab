$NetBSD: patch-ab,v 1.6 2003/04/11 22:06:24 cjep Exp $

--- src/scanmails/scanmails.in.orig	2000-10-31 16:47:28.000000000 +0000
+++ src/scanmails/scanmails.in
@@ -360,7 +360,7 @@ else
 	sendmail_flags="${sendmail_flags} -C${origconf}"
    else
 	SENDER="$2"
-	RECIPIENT="$7"
+	RECIPIENT="$4"
    fi
 fi
 
@@ -455,6 +455,8 @@ if [ "x$x_header" = "xyes" ] && [ "x${fo
     cat | ${formail} -f -A "${X_Header_String}" >${tmpdir}/receivedmail
 else
     cat >${tmpdir}/receivedmail
+    awk <${tmpdir}/receivedmail >${tmpdir}/header '/^$/ {exit 0;} // {print;}'
+    maildest=`grep '^To:' ${tmpdir}/header | head -1 | cut -d' ' -f 2-`
 fi
 
 mkdir ${tmpdir}/unpacked
@@ -1287,7 +1289,7 @@ Subject: VIRUS IN YOUR MAIL TO ${receive
 
                    V I R U S  A L E R T
 
-  Our viruschecker found a VIRUS in your email to "${receiver}".
+  Our viruschecker found a VIRUS in your email to "${maildest}".
            We stopped delivery of this email!
 
     Now it is on you to check your system for viruses           
@@ -1313,7 +1315,7 @@ if [ "x${notifyreceiver}" = "xyes" ] ; t
 
 ############### send a mail to the addressee ########################
 
-cat <<EOF| ${sendmail_wrapper} ${sendmail_flags}
+cat <<EOF| cat - ${tmpdir}/header | ${sendmail_wrapper} ${sendmail_flags}
 From: ${mailfrom}
 To: ${receiver}
 Subject: VIRUS IN A MAIL FOR YOU FROM ${sender}
@@ -1328,6 +1330,8 @@ Subject: VIRUS IN A MAIL FOR YOU FROM ${
   
   Please contact your system administrator for details
 
+  The header of the stopped message was:
+
 EOF
 fi
 
