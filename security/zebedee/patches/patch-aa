$NetBSD: patch-aa,v 1.4 2002/03/20 15:16:31 taca Exp $

--- Makefile.orig	Fri Mar 15 19:47:06 2002
+++ Makefile
@@ -20,6 +20,7 @@
 CC_linux = gcc -pthread
 CC_solaris = gcc
 CC_freebsd = gcc -pthread
+CC_netbsd = cc
 CC_tru64 = cc
 CC_irix = cc -n32 -woff 1110
 CC_hpux = cc -Ae +DAportable
@@ -28,7 +29,7 @@
 # Optimise/debug compilation
 
 #OPTIM = -Wall -g
-OPTIM = -O3
+OPTIM = -O
 
 # Location of gmp include and library
 #
@@ -40,19 +41,19 @@
 
 # Location of Blowfish include and library
 
-BFINC = -I../blowfish-0.9.5a
-BFLIB = ../blowfish-0.9.5a/libblowfish.a
+BFINC =
+BFLIB =
 
 # Location of zlib include and library
 
-ZINC = -I../zlib-1.1.4
-ZLIB = ../zlib-1.1.4/libz.a
+ZINC =
+ZLIB =
 
 # Location of bzlib include and library
 # Set these empty if you don't want bzib2 support
 
-BZINC = -I../bzip2-1.0.1
-BZLIB = ../bzip2-1.0.1/libbz2.a
+BZINC =
+BZLIB =
 
 #
 # Tools needed for Perl "POD"-format documentation conversion.
@@ -68,9 +69,9 @@
 
 # Installation directories for the Linux/Solaris/*NIX World
 
-ROOTDIR = /usr
+ROOTDIR =$(LOCALBASE)
 BINDIR = $(ROOTDIR)/bin
-ZBDDIR = $(ROOTDIR)/lib/zebedee
+ZBDDIR = $(ROOTDIR)/share/doc/zebedee
 MANDIR = $(ROOTDIR)/man/man1
 
 # This is a BSD-style install
@@ -80,6 +81,7 @@
 INSTALL_linux = install -c
 INSTALL_solaris = /usr/ucb/install -c
 INSTALL_freebsd = install -c
+INSTALL_netbsd = install -c
 INSTALL_tru64 = installbsd -c
 INSTALL_irix = install -c
 INSTALL_hpux = install -c
@@ -118,6 +120,7 @@
 DEFINES_linux = -DHAVE_PTHREADS
 DEFINES_solaris = -D_REENTRANT -DHAVE_PTHREADS
 DEFINES_freebsd = -DHAVE_PTHREADS -DBUGGY_FORK_WITH_THREADS
+DEFINES_netbsd =
 DEFINES_tru64 = -D_REENTRANT -DHAVE_PTHREADS
 DEFINES_irix = -D_REENTRANT -DHAVE_PTHREADS -Dinline=
 DEFINES_hpux = -D_REENTRANT -DHAVE_PTHREADS -DDONT_HAVE_SELECT_H -Dinline=
@@ -134,6 +137,7 @@
 OSLIBS_linux = -lpthread
 OSLIBS_solaris = -lsocket -lnsl -lthread
 OSLIBS_freebsd =
+OSLIBS_netbsd = -lcrypto -lbz2 -lz
 OSLIBS_tru64 = -lpthread
 OSLIBS_irix = -lpthread
 OSLIBS_hpux = -lpthread -lnsl
@@ -161,17 +165,17 @@
 	client1.key client2.key clients.id
 
 TXTFILES = README.txt LICENCE.txt GPL2.txt CHANGES.txt \
-	zebedee.html ftpgw.tcl.html zebedee.ja_JP.html zebedee.iss
+	zebedee.html ftpgw.tcl.html zebedee.ja_JP.html
 
 EXTRAFILES = $(ZBDFILES) $(TXTFILES)
 
 all : precheck zebedee$(EXE) zebedee.1 zebedee.html ftpgw.tcl.1 ftpgw.tcl.html zebedee.ja_JP.html
 
 precheck :
-	@ if test -z "$(OS)"; then echo "Use '$(MAKE) OS=xxx' where xxx is win32, linux, solaris, freebsd, tru64, irix or hpux"; exit 1; fi
+	@ if test -z "$(OS)"; then echo "Use '$(MAKE) OS=xxx' where xxx is win32, linux, solaris, freebsd, netbsd, tru64, irix or hpux"; exit 1; fi
 
 zebedee$(EXE) : $(OBJS)
-	$(CC) $(CFLAGS) -o zebedee$(EXE) $(OBJS) $(LIBS)
+	$(CC) $(LDFLAGS) -o zebedee$(EXE) $(OBJS) $(LIBS)
 
 huge.o : huge.h
 
@@ -201,12 +205,12 @@
 
 install : precheck zebedee$(EXE) zebedee.1 ftpgw.tcl.1 $(ZBDFILES) $(TXTFILES)
 	-mkdir -p $(BINDIR) $(MANDIR) $(ZBDDIR)
-	$(INSTALL) zebedee$(EXE) $(BINDIR)
+	$(INSTALL) -s -m 755 zebedee$(EXE) $(BINDIR)
 	$(INSTALL) -m 0755 ftpgw.tcl $(BINDIR)
-	$(INSTALL) zebedee.1 $(MANDIR)
-	$(INSTALL) ftpgw.tcl.1 $(MANDIR)
-	$(INSTALL) $(ZBDFILES) $(ZBDDIR)
-	$(INSTALL) $(TXTFILES) $(ZBDDIR)
+	$(INSTALL) -m 0444 zebedee.1 $(MANDIR)
+	$(INSTALL) -m 0444 ftpgw.tcl.1 $(MANDIR)
+	$(INSTALL) -m 0444 $(ZBDFILES) $(ZBDDIR)
+	$(INSTALL) -m 0444 $(TXTFILES) $(ZBDDIR)
 
 clean : precheck
 	rm -f zebedee$(EXE) *.o core *.1 *.html *.tmp *.bak
