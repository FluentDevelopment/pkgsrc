$NetBSD: patch-ab,v 1.3 2006/10/28 15:14:59 schwarz Exp $

--- SSLeay.xs.orig	2003-05-28 08:55:02.000000000 +0200
+++ SSLeay.xs	2006-10-28 14:25:40.000000000 +0200
@@ -40,7 +40,7 @@
  */
 
 
-static void InfoCallback(SSL *s,int where,int ret)
+static void InfoCallback(const SSL *s,int where,int ret)
     {
     char *str;
     int w;
@@ -107,7 +107,7 @@
         int rand_bytes_read;
 
 	if(!bNotFirstTime) {
-               SSLeay_add_all_algorithms();
+	       SSL_library_init();
                SSL_load_error_strings();
                ERR_load_crypto_strings();
 	       bNotFirstTime = 1;
@@ -130,6 +130,8 @@
 		/* v2 is the default */
 		ctx = SSL_CTX_new(SSLv2_client_method());
 	}		
+	if (ctx == 0)
+	   croak("SSL_CTX_new failed");
 	SSL_CTX_set_options(ctx,SSL_OP_ALL|0);
 
 	SSL_CTX_set_default_verify_paths(ctx);
