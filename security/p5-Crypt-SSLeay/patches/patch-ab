$NetBSD: patch-ab,v 1.2 2006/08/22 23:10:57 abs Exp $

--- SSLeay.xs.orig	2003-05-28 07:55:02.000000000 +0100
+++ SSLeay.xs
@@ -107,7 +107,7 @@ SSL_CTX_new(packname, ssl_version)
         int rand_bytes_read;
 
 	if(!bNotFirstTime) {
-               SSLeay_add_all_algorithms();
+	       SSL_library_init();
                SSL_load_error_strings();
                ERR_load_crypto_strings();
 	       bNotFirstTime = 1;
@@ -130,6 +130,8 @@ SSL_CTX_new(packname, ssl_version)
 		/* v2 is the default */
 		ctx = SSL_CTX_new(SSLv2_client_method());
 	}		
+	if (ctx == 0)
+	   croak("SSL_CTX_new failed");
 	SSL_CTX_set_options(ctx,SSL_OP_ALL|0);
 
 	SSL_CTX_set_default_verify_paths(ctx);
