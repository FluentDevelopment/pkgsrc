$NetBSD: patch-ab,v 1.16 2004/04/27 12:30:23 markd Exp $

--- configure.ac.orig	2004-02-24 18:47:04.000000000 +1300
+++ configure.ac
@@ -438,6 +438,9 @@ mips-sony-bsd|mips-sony-newsos4)
 	;;
 esac
 
+# pkgsrc handles any rpath settings this package needs
+need_dash_r=
+
 # Allow user to specify flags
 AC_ARG_WITH(cflags,
 	[  --with-cflags           Specify additional flags to pass to compiler],
@@ -767,6 +770,10 @@ AC_ARG_WITH(tcp-wrappers,
 			AC_MSG_CHECKING(for libwrap)
 			AC_TRY_LINK(
 				[
+#ifdef HAVE_SYS_CDEFS_H
+#include <sys/cdefs.h>
+#endif
+#include <stdio.h>
 #include <tcpd.h>
 					int deny_severity = 0, allow_severity = 0;
 				],
@@ -2725,9 +2732,17 @@ AC_TRY_COMPILE([
 )
 if test -z "$conf_utmpx_location"; then
 	if test x"$system_utmpx_path" = x"no" ; then
-		AC_DEFINE(DISABLE_UTMPX)
+		for f in /var/run/utmpx; do
+			if test -f $f ; then
+				conf_utmpx_location=$f
+			fi
+		done
+		if test -z "$conf_utmpx_location"; then
+			AC_DEFINE(DISABLE_UTMPX)
+		fi
 	fi
-else
+fi
+if test -n "$conf_utmpx_location"; then
 	AC_DEFINE_UNQUOTED(CONF_UTMPX_FILE, "$conf_utmpx_location")
 fi	
 
@@ -2750,9 +2765,17 @@ AC_TRY_COMPILE([
 )
 if test -z "$conf_wtmpx_location"; then
 	if test x"$system_wtmpx_path" = x"no" ; then
-		AC_DEFINE(DISABLE_WTMPX)
+		for f in /var/log/wtmpx; do
+			if test -f $f ; then
+				conf_wtmpx_location=$f
+			fi
+		done
+		if test -z "$conf_wtmpx_location"; then
+			AC_DEFINE(DISABLE_WTMPX)
+		fi
 	fi
-else
+fi
+if test -n "$conf_wtmpx_location"; then
 	AC_DEFINE_UNQUOTED(CONF_WTMPX_FILE, "$conf_wtmpx_location")
 fi	
 
@@ -2793,7 +2816,7 @@ echo "OpenSSH has been configured with t
 echo "                     User binaries: $B"
 echo "                   System binaries: $C"
 echo "               Configuration files: $D"
-echo "                   Askpass program: $E"
+echo "                   Askpass program: ${ASKPASS_PROGRAM}"
 echo "                      Manual pages: $F"
 echo "                          PID file: $G"
 echo "  Privilege separation chroot path: $H"
