$NetBSD: patch-ab,v 1.6 2001/12/03 08:21:23 martti Exp $

--- configure.ac.orig	Mon Dec  3 08:43:01 2001
+++ configure.ac	Mon Dec  3 08:44:59 2001
@@ -132,7 +132,7 @@
         )
 	;;
 *-*-netbsd*)
-	need_dash_r=1
+	#need_dash_r=1		# buildlink.mk
 	;;
 *-*-freebsd*)
 	check_for_libcrypt_later=1
@@ -152,7 +152,7 @@
 *-*-solaris*)
 	CPPFLAGS="$CPPFLAGS -I/usr/local/include"
 	LDFLAGS="$LDFLAGS -L/usr/local/lib -R/usr/local/lib" 
-	need_dash_r=1
+	#need_dash_r=1		# buildlink.mk
 	AC_DEFINE(PAM_SUN_CODEBASE)
 	AC_DEFINE(LOGIN_NEEDS_UTMPX)
 	AC_DEFINE(LOGIN_NEEDS_TERM)
@@ -518,6 +518,7 @@
 
 # Check whether user wants TCP wrappers support
 TCPW_MSG="no"
+TCPW_LIB=""
 AC_ARG_WITH(tcp-wrappers,
 	[  --with-tcp-wrappers[[=PATH]]      Enable tcpwrappers support
                             (optionally in PATH)],
@@ -550,6 +551,8 @@
 			AC_MSG_CHECKING(for libwrap)
 			AC_TRY_LINK(
 				[
+#include <sys/cdefs.h>
+#include <stdio.h>
 #include <tcpd.h>
 					int deny_severity = 0, allow_severity = 0;
 				],
@@ -558,6 +561,7 @@
 					AC_MSG_RESULT(yes)
 					AC_DEFINE(LIBWRAP)
 					TCPW_MSG="yes"
+					TCPW_LIB="-lwrap"
 				],
 				[
 					AC_MSG_ERROR([*** libwrap missing])
@@ -566,6 +570,7 @@
 		fi
 	]
 )
+AC_SUBST(TCPW_LIB)
 
 dnl    Checks for library functions.
 AC_CHECK_FUNCS(arc4random atexit b64_ntop bcopy bindresvport_sa \
