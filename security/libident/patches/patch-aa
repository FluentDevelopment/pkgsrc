$NetBSD: patch-aa,v 1.7 2007/06/21 18:33:19 minskim Exp $

--- Makefile.orig	1997-01-17 11:10:55.000000000 -0800
+++ Makefile
@@ -4,25 +4,28 @@
 
 MAKE=make
 SHELL=/bin/sh
-RM=rm -f
 RANLIB=ranlib
-AR=ar cq
+RM=rm -f
+AR=${LIBTOOL} --mode=link cc -rpath ${PREFIX}/lib -version-info 0:22 -o
+CC=${LIBTOOL} --mode=compile cc
 
-INSTROOT=/usr/local
+INSTROOT=${PREFIX}
 LIBDIR=$(INSTROOT)/lib
 INCDIR=$(INSTROOT)/include
 MANDIR=$(INSTROOT)/man/man3
 
+.PHONY: install
+
 #
 # Add -g for debugging information
 #
 # Add -DHAVE_ANSIHEADERS if your system have the ANSI C header files
 # needed for our purposes (stdlib, string, unistd).
 #
-CFLAGS = -O
+#CFLAGS = -O
 
 LDLIBS =
-LIBIDENT = libident.a
+LIBIDENT = libident.la
 
 OBJS = ident.o id_open.o id_close.o id_query.o id_parse.o support.o version.o
 
@@ -33,6 +36,7 @@ fail:
 	@echo aix
 	@echo bsd
 	@echo bsd2.11
+	@echo netbsd
 	@echo dynix
 	@echo hpux
 	@echo irix
@@ -52,8 +56,8 @@ all: 	$(LIBIDENT)
 
 $(LIBIDENT):	$(OBJS)
 	-$(RM) $(LIBIDENT)
-	$(AR) $(LIBIDENT) $(OBJS)
-	-$(RANLIB) $(LIBIDENT)
+	$(AR) $(LIBIDENT) $(OBJS:.o=.lo)
+#	-$(RANLIB) $(LIBIDENT)
 
 testers: lookup-tester ident-tester
 
@@ -82,13 +86,9 @@ version:
 #
 
 install:
-	-$(RM) $(LIBDIR)/$(LIBIDENT)
-	cp $(LIBIDENT) $(LIBDIR)/$(LIBIDENT)
-	-$(RANLIB) $(LIBDIR)/$(LIBIDENT)
-	-$(RM) $(INCDIR)/ident.h
-	cp ident.h $(INCDIR)/ident.h
-	-$(RM) $(MANDIR)/ident.3
-	cp ident.3 $(MANDIR)/ident.3
+	${LIBTOOL} --mode=install ${BSD_INSTALL_DATA} ${LIBIDENT} ${PREFIX}/lib
+	${BSD_INSTALL_DATA} ident.h ${INCDIR}/ident.h
+	${BSD_INSTALL_DATA} ident.3 ${MANDIR}/ident.3
 
 clean:
 	-$(RM) $(LIBIDENT) ident-tester lookup-tester *~ core *.o \#*
@@ -126,6 +126,8 @@ bsd:
 bsd2.11:
 	@$(MAKE) all CC="$(CC)" CFLAGS="-O -DSIGRETURNTYPE=int -DHAVE_ANSIHEADERS"
 
+netbsd:
+	@$(MAKE) all CC="$(CC)" CFLAGS="${CFLAGS} -Wall -DHAVE_ANSIHEADERS"
 
 #
 #
