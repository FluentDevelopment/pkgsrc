$NetBSD: patch-af,v 1.17 2007/09/09 12:54:37 taca Exp $

--- configure.in.orig	2007-09-07 01:19:57.000000000 +0900
+++ configure.in
@@ -129,7 +129,6 @@ dnl
 test "$mandir" = '${prefix}/man' && mandir='$(prefix)/man'
 test "$bindir" = '${exec_prefix}/bin' && bindir='$(exec_prefix)/bin'
 test "$sbindir" = '${exec_prefix}/sbin' && sbindir='$(exec_prefix)/sbin'
-test "$sysconfdir" = '${prefix}/etc' -a X"$with_stow" != X"yes" && sysconfdir='/etc'
 
 dnl
 dnl Deprecated --with options (these all warn or generate an error)
@@ -252,6 +251,19 @@ AC_ARG_WITH(csops, [  --with-csops      
 		;;
 esac])
 
+AC_ARG_WITH(nbsdops, [  --with-nbsdops          add NetBSD standard options],
+[case $with_nbsdops in
+    yes)	echo 'Adding NetBSD standard options'
+		CHECKSIA=false
+		with_ignore_dot=yes
+		with_env_editor=yes
+		with_tty_tickets=yes
+		;;
+    no)		;;
+    *)		echo "Ignoring unknown argument to --with-nbsdops: $with_nbsdops"
+		;;
+esac])
+
 AC_ARG_WITH(passwd, [  --without-passwd        don't use passwd/shadow file for authentication],
 [case $with_passwd in
     yes|no)	AC_MSG_CHECKING(whether to use shadow/passwd file authentication)
@@ -1470,7 +1482,7 @@ case "$host" in
 		    AC_CHECK_FUNCS(auth_challenge, [AUTH_EXCL_DEF="BSD_AUTH"])
 		fi
 		;;
-    *-*-freebsd*)
+    *-*-freebsd*|*-*-dragonfly*)
 		# FreeBSD has a real setreuid(2) starting with 2.1 and
 		# backported to 2.0.5.  We just take 2.1 and above...
 		case "$OSREV" in
@@ -1484,6 +1496,8 @@ case "$host" in
 		CHECKSHADOW="false"
 		test -z "$with_pam" && AUTH_EXCL_DEF="PAM"
 		: ${with_logincap='maybe'}
+		# We really want libutil.
+		SUDO_LIBS="${SUDO_LIBS} -lutil"
 		;;
     *-*-*openbsd*)
 		# OpenBSD has a real setreuid(2) starting with 3.3 but
@@ -1512,10 +1526,12 @@ case "$host" in
 		CHECKSHADOW="false"
 		test -z "$with_pam" && AUTH_EXCL_DEF="PAM"
 		: ${with_logincap='maybe'}
+		# We really want libutil.
+		SUDO_LIBS="${SUDO_LIBS} -lutil"
 		;;
     *-*-dragonfly*)
 		if test "$with_skey" = "yes"; then
-		     SUDO_LIBS="${SUDO_LIBS} -lmd"
+		     SUDO_LIBS="${SUDO_LIBS} -lutil -lmd"
 		fi
 		CHECKSHADOW="false"
 		test -z "$with_pam" && AUTH_EXCL_DEF="PAM"
@@ -2047,16 +2063,6 @@ if test ${with_kerb5-'no'} != "no" -a -z
 fi
 
 dnl
-dnl Some systems put login_cap(3) in libutil
-dnl
-if test ${with_logincap-'no'} = "yes"; then
-    case "$OS" in
-	freebsd|netbsd)	SUDO_LIBS="${SUDO_LIBS} -lutil"
-	;;
-    esac
-fi
-
-dnl
 dnl extra AFS libs and includes
 dnl
 if test ${with_AFS-'no'} = "yes"; then
