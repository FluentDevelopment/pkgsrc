$NetBSD: patch-af,v 1.16 2007/08/18 15:09:13 taca Exp $

--- configure.in.orig	2007-07-16 22:51:21.000000000 -0400
+++ configure.in	2007-07-23 11:15:42.000000000 -0400
@@ -123,7 +123,6 @@
 test "$mandir" = '${prefix}/man' && mandir='$(prefix)/man'
 test "$bindir" = '${exec_prefix}/bin' && bindir='$(exec_prefix)/bin'
 test "$sbindir" = '${exec_prefix}/sbin' && sbindir='$(exec_prefix)/sbin'
-test "$sysconfdir" = '${prefix}/etc' -a X"$with_stow" != X"yes" && sysconfdir='/etc'
 
 dnl
 dnl Deprecated --with options (these all warn or generate an error)
@@ -246,6 +245,19 @@
 		;;
 esac])
 
+AC_ARG_WITH(nbsdops, [  --with-nbsdops          add NetBSD standard options],
+[case $with_nbsdops in
+    yes)	echo 'Adding NetBSD standard options'
+		CHECKSIA=false
+		with_ignore_dot=yes
+		with_env_editor=yes
+		with_tty_tickets=yes
+		;;
+    no)		;;
+    *)		echo "Ignoring unknown argument to --with-nbsdops: $with_nbsdops"
+		;;
+esac])
+
 AC_ARG_WITH(passwd, [  --without-passwd        don't use passwd/shadow file for authentication],
 [case $with_passwd in
     yes)	;;
@@ -1466,7 +1478,7 @@
 		    AC_CHECK_FUNCS(auth_challenge, [with_bsdauth=maybe])
 		fi
 		;;
-    *-*-freebsd*)
+    *-*-freebsd*|*-*-dragonfly*)
 		# FreeBSD has a real setreuid(2) starting with 2.1 and
 		# backported to 2.0.5.  We just take 2.1 and above...
 		case "$OSREV" in
@@ -1482,6 +1494,8 @@
 		fi
 		: ${with_pam='maybe'}
 		: ${with_logincap='maybe'}
+		# We really want libutil.
+		SUDO_LIBS="${SUDO_LIBS} -lutil"
 		;;
     *-*-*openbsd*)
 		# OpenBSD has a real setreuid(2) starting with 3.3 but
@@ -1515,10 +1529,12 @@
 		: ${with_logincap='maybe'}
 		dnl future versions of NetBSD (> 2.0) may include pam
 		: ${with_pam='maybe'}
+		# We really want libutil.
+		SUDO_LIBS="${SUDO_LIBS} -lutil"
 		;;
     *-*-dragonfly*)
 		if test "$with_skey" = "yes"; then
-		     SUDO_LIBS="${SUDO_LIBS} -lmd"
+		     SUDO_LIBS="${SUDO_LIBS} -lutil -lmd"
 		fi
 		if test "$CHECKSHADOW" = "true"; then
 		    CHECKSHADOW="false"
@@ -1895,16 +1911,6 @@
 fi
 
 dnl
-dnl Some systems put login_cap(3) in libutil
-dnl
-if test "$with_logincap" = "yes"; then
-    case "$OS" in
-	freebsd|netbsd)	SUDO_LIBS="${SUDO_LIBS} -lutil"
-	;;
-    esac
-fi
-
-dnl
 dnl PAM support.  Systems that might support PAM set with_pam=maybe
 dnl and we do that actual tests here.
 dnl
