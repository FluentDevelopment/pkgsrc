$NetBSD: patch-ab,v 1.6 2006/10/04 12:07:53 obache Exp $

--- aclocal.m4.orig	2006-05-18 15:30:08.000000000 -0400
+++ aclocal.m4
@@ -1696,7 +1696,7 @@ AC_DEFUN([CYRUS_BERKELEY_DB_CHK_LIB],
 	    LIBS="$saved_LIBS -l$dbname"
 	    AC_TRY_LINK([#include <db.h>],
 	    [db_create(NULL, NULL, 0);],
-	    BDB_LIBADD="$BDB_LIBADD -l$dbname"; dblib="berkeley"; dbname=db,
+	    BDB_LIBADD="$BDB_LIBADD -l$dbname"; dblib="berkeley"; dbname=db; break,
             dblib="no")
 	    if test "$dblib" = "berkeley"; then break; fi
           done
@@ -3016,8 +3016,11 @@ if test "$gssapi" != no; then
   AC_MSG_RESULT([with implementation ${gss_impl}])
   AC_CHECK_LIB(resolv,res_search,GSSAPIBASE_LIBS="$GSSAPIBASE_LIBS -lresolv")
   SASL_MECHS="$SASL_MECHS libgssapiv2.la"
-  SASL_STATIC_OBJS="$SASL_STATIC_OBJS gssapi.o"
-  SASL_STATIC_SRCS="$SASL_STATIC_SRCS ../plugins/gssapi.c"
+  if test "$enable_static" = yes; then
+    SASL_STATIC_OBJS="$SASL_STATIC_OBJS gssapi.o"
+    SASL_STATIC_SRCS="$SASL_STATIC_SRCS ../plugins/gssapi.c"
+    AC_DEFINE(STATIC_GSSAPIV2, [], [Link GSSAPI Staticly])
+  fi
 
   cmu_save_LIBS="$LIBS"
   LIBS="$LIBS $GSSAPIBASE_LIBS"
