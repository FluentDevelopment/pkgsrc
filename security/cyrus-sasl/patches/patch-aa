$NetBSD: patch-aa,v 1.5 2002/09/07 07:37:39 jlam Exp $

--- configure.in.orig	Fri Mar 23 17:47:27 2001
+++ configure.in
@@ -69,6 +69,12 @@ dnl let's just link against local.  othe
 CPPFLAGS="-I/usr/local/include ${CPPFLAGS}"
 CMU_ADD_LIBPATH("/usr/local/lib")
 
+AC_PATH_PROG(SED, sed, no)
+if test "$SED" = "no"; then
+  AC_ERROR([sed is required to build sasl-config])
+fi
+AC_SUBST(SED)
+
 AM_DISABLE_STATIC
 
 CMU_PROG_LIBTOOL
@@ -364,8 +370,11 @@ if test "$with_des" != no; then
     CPPFLAGS="$CPPFLAGS -I${with_des}/include"
     LDFLAGS="$LDFLAGS -L${with_des}/lib"
   fi
-  AC_CHECK_LIB(des, des_pcbc_encrypt, [LIB_DES="-ldes";
-				       with_des=yes], with_des=no)
+  AC_CHECK_LIB(des, des_pcbc_encrypt,
+	AC_CHECK_HEADER(des.h, [LIB_DES="-ldes";
+				with_des=yes],
+			with_des=no),
+	with_des=no)
 
   if test "$with_des" = no; then
     dnl if openssl is around, we might be able to use that for des
@@ -476,7 +485,7 @@ AC_ARG_ENABLE(gssapi, [  --enable-gssapi
 
 if test "$gssapi" != no; then
   if test -d ${gssapi}; then
-     CPPFLAGS="$CPPFLAGS -I$gssapi/include"
+     CPPFLAGS="$CPPFLAGS -I$gssapi/include -I$gssapi/include/krb5"
      LDFLAGS="$LDFLAGS -L$gssapi/lib"
   fi
   AC_CHECK_HEADER(gssapi.h, AC_DEFINE(HAVE_GSSAPI_H),
@@ -661,6 +670,9 @@ AC_SUBST(SNPRINTFOBJS)
 
 LTLIBOBJS=`echo "$LIBOBJS" | sed 's/\.o/.lo/g'`
 AC_SUBST(LTLIBOBJS)
+
+dnl Check for /dev/urandom
+AC_CHECK_FILE(/dev/urandom, AC_DEFINE_UNQUOTED(SASL_DEV_RANDOM, "/dev/urandom"))
 
 AC_CHECK_HEADERS(getopt.h unistd.h crypt.h pwd.h shadow.h paths.h)
 AC_C_CONST
