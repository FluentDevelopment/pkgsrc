#! @SH@
# $NetBSD: download-vulnerability-list,v 1.15 2003/08/22 10:11:58 agc Exp $

: ${PKGVULNDIR=@PKGVULNDIR@}

if [ ! -e ${PKGVULNDIR} ]; then
	echo "Creating ${PKGVULNDIR}"
	/bin/mkdir -p ${PKGVULNDIR} || (echo "Can't create ${PKGVULNDIR}" 1>&2; exit 1)
fi

VUL_SOURCE="ftp://ftp.netbsd.org/pub/NetBSD/packages/distfiles/vulnerabilities"
NEW_VUL_LIST=vulnerabilities.$$
EXIST_VUL_LIST=vulnerabilities

cd ${PKGVULNDIR}
@FETCH_CMD@ -o ${NEW_VUL_LIST} ${VUL_SOURCE}
existsize=0
newsize=0
if [ -f ${EXIST_VUL_LIST} ]; then
	existsize=`@WC@ -l ${EXIST_VUL_LIST} | @AWK@ '{ print $1 }'`
fi
if [ -f ${NEW_VUL_LIST} ]; then
	newsize=`@WC@ -l ${NEW_VUL_LIST} | @AWK@ '{ print $1 }'`
fi
if [ $newsize -lt $existsize ]; then
	echo "New vulnerability list ($newsize lines) is smaller than existing list ($existsize lines)" 1>&2
	/bin/rm -f ${NEW_VUL_LIST}
	exit 1
fi

chmod a+r ${NEW_VUL_LIST}
/bin/mv -f ${NEW_VUL_LIST} ${EXIST_VUL_LIST}

exit 0
