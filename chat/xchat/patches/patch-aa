$NetBSD: patch-aa,v 1.8 2004/04/14 21:27:25 tron Exp $

--- src/common/server.c.orig	Tue Dec  3 08:06:31 2002
+++ src/common/server.c	Wed Apr 14 23:18:45 2004
@@ -837,7 +837,7 @@
 	struct sock5_connect1 sc1;
 	unsigned char *sc2;
 	unsigned int packetlen, addrlen;
-	unsigned char buf[10];
+	unsigned char buf[260];
 
 	sc1.version = 5;
 	sc1.nmethods = 1;
@@ -878,7 +878,7 @@
 	{
 		if (recv (sok, buf, 1, 0) != 1)
 			return 1;
-		packetlen = buf[0] + 2;
+		packetlen = buf[0] + 2;	/* can't exceed 260 */
 		if (recv (sok, buf, packetlen, 0) != packetlen)
 			return 1;
 	}
