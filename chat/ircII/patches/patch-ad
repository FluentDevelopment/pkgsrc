$NetBSD: patch-ad,v 1.3 2002/03/10 14:06:43 mrg Exp $

Index: source/icb.c
===================================================================
RCS file: /home/cvs/ircii/source/icb.c,v
retrieving revision 2.47
diff -p -r2.47 icb.c
*** source/icb.c	2002/02/05 18:14:45	2.47
--- source/icb.c	2002/03/10 14:00:50
*************** IRCII_RCSID("@(#)$eterna: icb.c,v 2.47 2
*** 62,67 ****
--- 62,68 ----
  #include "icb.h"
  #include "hook.h"
  #include "ignore.h"
+ #include "flood.h"
  
  /* sender functions */
  static	void	icb_put_login _((u_char *, u_char *, u_char *, u_char *, u_char *));
*************** icb_got_public(line)
*** 154,160 ****
  		break;
  	}
  
! 	if (do_hook(PUBLIC_LIST, "%s %s %s", ap[0], get_server_icbgroup(parsing_server_index), ap[1]))
  		put_it("%s<%s>%s %s", high, ap[0], high, ap[1]);
  out:
  	set_lastlog_msg_level(level);
--- 155,162 ----
  		break;
  	}
  
! 	if (check_flooding(ap[0], PUBLIC_FLOOD, ap[1]) &&
! 	    do_hook(PUBLIC_LIST, "%s %s %s", ap[0], get_server_icbgroup(parsing_server_index), ap[1]))
  		put_it("%s<%s>%s %s", high, ap[0], high, ap[1]);
  out:
  	set_lastlog_msg_level(level);
*************** icb_got_msg(line)
*** 192,198 ****
  		break;
  	}
  
! 	if (do_hook(MSG_LIST, "%s %s", ap[0], ap[1]))
  	{
  		if (away_set)
  		{
--- 194,201 ----
  		break;
  	}
  
! 	if (check_flooding(ap[0], MSG_FLOOD, ap[1]) &&
! 	    do_hook(MSG_LIST, "%s %s", ap[0], ap[1]))
  	{
  		if (away_set)
  		{
