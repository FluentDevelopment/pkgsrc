$NetBSD: patch-ab,v 1.8 2006/01/22 00:11:27 adam Exp $

--- configure.orig	2005-10-02 14:06:30.000000000 +0200
+++ configure
@@ -4281,13 +4281,13 @@ done
 ##################
 
 
-	echo "$as_me:$LINENO: checking for pthread_create in -lpthread" >&5
-echo $ECHO_N "checking for pthread_create in -lpthread... $ECHO_C" >&6
+	echo "$as_me:$LINENO: checking for pthread_create in ${PTHREAD_LDFLAGS} ${PTHREAD_LIBS}" >&5
+echo $ECHO_N "checking for pthread_create in ${PTHREAD_LDFLAGS} ${PTHREAD_LIBS}... $ECHO_C" >&6
 if test "${ac_cv_lib_pthread_pthread_create+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-lpthread  $LIBS"
+LIBS="${PTHREAD_LDFLAGS} ${PTHREAD_LIBS}  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -4348,8 +4348,8 @@ echo "${ECHO_T}$ac_cv_lib_pthread_pthrea
 if test $ac_cv_lib_pthread_pthread_create = yes; then
 
 		PTHREAD_CPPFLAGS=
-		PTHREAD_LDFLAGS=
-		PTHREAD_LIBS=-lpthread
+		PTHREAD_LDFLAGS=${PTHREAD_LDFLAGS}
+		PTHREAD_LIBS=${PTHREAD_LIBS}
 
 else
 
@@ -9549,12 +9549,12 @@ echo "$as_me: error: libgadu.h not found
 fi
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
 
-	GADU_LIBS=-lgadu
+	GADU_LIBS="-lgadu -lssl -lcrypto ${PTHREAD_LDFLAGS} ${PTHREAD_LIBS}"
 
 	echo "$as_me:$LINENO: checking if libgadu is in system directories" >&5
 echo $ECHO_N "checking if libgadu is in system directories... $ECHO_C" >&6
 	save_CFLAGS="$CFLAGS"
-	CFLAGS="$CFLAGS  -lgadu"
+	CFLAGS="$CFLAGS ${GADU_LIBS}"
 	cat >conftest.$ac_ext <<_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -9919,7 +9919,11 @@ echo "$as_me: error: $mod download faile
 	echo "$as_me:$LINENO: checking if lib$lib is in system directories" >&5
 echo $ECHO_N "checking if lib$lib is in system directories... $ECHO_C" >&6
 	save_CFLAGS="$CFLAGS"
+	if [ x$lib = xssl ]; then
+		CFLAGS="$CFLAGS $MODULE_LDFLAGS -l$lib -lcrypto"
+	else
 	CFLAGS="$CFLAGS $MODULE_LDFLAGS -l$lib"
+	fi
 	cat >conftest.$ac_ext <<_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -10053,7 +10057,7 @@ fi
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
  \
-				MODULE_LDFLAGS="$MODULE_LDFLAGS -l$lib"; \
+				MODULE_LDFLAGS="$MODULE_LDFLAGS -l$lib -Wl,-R${X11BASE}/lib"; \
 			done && \
 			for hdr in $MODULE_INCLUDES; do \
 
