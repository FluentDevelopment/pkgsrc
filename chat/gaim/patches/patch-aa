$NetBSD: patch-aa,v 1.23 2004/12/03 12:43:24 adam Exp $

--- src/gtkconv.c.orig	2004-11-27 19:25:41.000000000 +0000
+++ src/gtkconv.c
@@ -1804,6 +1804,11 @@ entry_key_press_cb(GtkWidget *entry, Gdk
 				if (!(event->state & (GDK_SHIFT_MASK | GDK_CONTROL_MASK)) &&
 					gaim_prefs_get_bool("/gaim/gtk/conversations/enter_sends"))
 				{
+					if (gtk_im_context_filter_keypress (GTK_TEXT_VIEW (entry)->im_context, event))
+					{
+						GTK_TEXT_VIEW (entry)->need_im_reset = TRUE;
+						return TRUE;
+					}
 					send_cb(NULL, conv);
 					return TRUE;
 				}
