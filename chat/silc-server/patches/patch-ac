$NetBSD: patch-ac,v 1.12 2005/09/13 22:02:24 salo Exp $

--- apps/silcd/silcd.c.orig	2005-05-10 15:22:52.000000000 +0200
+++ apps/silcd/silcd.c	2005-09-13 21:06:01.000000000 +0200
@@ -261,14 +261,22 @@
 SILC_TASK_CALLBACK(dump_stats)
 {
   FILE *fdd;
+  int fild;
   char filename[256];
 
   memset(filename, 0, sizeof(filename));
-  snprintf(filename, sizeof(filename) - 1, "/tmp/silcd.%d.stats", getpid());
-  fdd = fopen(filename, "w+");
-  if (!fdd)
+  snprintf(filename, sizeof(filename) - 1, "/tmp/silcd.%d.stats-XXXXXX", getpid());
+  fild = mkstemp(filename);
+  if (fild == -1)
     return;
 
+  fdd = fdopen(fild, "w");
+  if (fdd == NULL) {
+    close(fild);
+    unlink(filename);
+    return;
+  }
+
 #define STAT_OUTPUT(fmt, stat) fprintf(fdd, fmt "\n", (int)stat);
 
   fprintf(fdd, "SILC Server %s Statistics\n\n", silcd->server_name);
