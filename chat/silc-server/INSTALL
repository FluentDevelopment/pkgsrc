#!/bin/sh
#
# $NetBSD: INSTALL,v 1.2 2001/12/17 00:43:10 hubertf Exp $

PKGNAME=$1
STAGE=$2

CAT="@CAT@"
CHMOD="@CHMOD@"
CHOWN="@CHOWN@"
CP="@CP@"
MKDIR="@MKDIR@"

SERVERROOT="@SILCD_CONF_DIR@"
LOGDIR=/var/log/silcd
SAMPLECONFDIR=${PKG_PREFIX}/share/doc/silcd
CONFDIR=${SERVERROOT}
CONFFILES="silcd.conf motd.txt"
PUBKEY="silcd.pub"
PRIVKEY="silcd.prv"

case ${STAGE} in
PRE-INSTALL)
	;;

POST-INSTALL)
	${MKDIR} ${SERVERROOT}
        ${CAT} << EOF
===========================================================================

  * creating directory for log files owned by root, group nobody:

EOF

	if [ -d ${LOGDIR} ]
	then
		echo "        WARNING: ${LOGDIR} already exists, owner"
		echo "                 and permissions may be changed."
	else
		${MKDIR} ${LOGDIR}
		echo "        ${LOGDIR}"
	fi

	${CHOWN} root:nobody ${LOGDIR}
	${CHMOD} 2775 ${LOGDIR}

        ${CAT} << EOF

  * don't forget to change this if you will setup silcd to run with
    different UID and GID in silcd.conf!

===========================================================================

  * installing configuration files:

EOF
     
	for file in ${CONFFILES}
	do
		FILE=${CONFDIR}/${file}
		SAMPLEFILE=${SAMPLECONFDIR}/${file}.default
		if [ -f ${FILE} ]
		then
			echo "        ${FILE} already exists"
		else
			echo "        ${FILE}"
			${CP} ${SAMPLEFILE} ${FILE}
		fi
	done
	${CHMOD} 600 ${CONFDIR}/silcd.conf
	${CHMOD} 644 ${CONFDIR}/motd.txt
	${CAT} << EOF

  * you might need to customize your configuration file and the MOTD

===========================================================================

EOF

	if [ -f ${CONFDIR}/${PUBKEY} ] && [ -f ${CONFDIR}/${PRIVKEY} ]
	then
	  echo "  * ${PUBKEY} and ${PRIVKEY} already exist:"
	  echo
	  echo "        ${CONFDIR}/${PUBKEY}"
	  echo "        ${CONFDIR}/${PRIVKEY}"
	else
	  echo "  * one or all of your server keys is missing,"
	  echo
	  ${PKG_PREFIX}/sbin/silcd -C ${CONFDIR}
	fi

        ${CAT} << EOF

===========================================================================
EOF
	;;

*)
	echo "Unexpected argument: ${STAGE}"
	exit 1
	;;
esac
exit 0
