$NetBSD: patch-aa,v 1.5 2005/06/18 05:57:05 hira Exp $

--- Makefile.defs.orig	2002-11-13 02:21:28.000000000 +0900
+++ Makefile.defs	2005-06-18 11:11:16.000000000 +0900
@@ -16,7 +16,6 @@
 			-e s/armv4l/arm/)
 
  # install location
-PREFIX = /usr/local
 prefix = $(PREFIX)
 # install path is $(basedir) $(prefix) 
 # example:
@@ -33,7 +32,8 @@
 ut-prefix = $(basedir)$(prefix)
 
 # dirs
-cfg-dir = etc/ser/
+cfg-dir = ser/
+eg-dir  = $(EGDIR)/
 bin-dir = sbin/
 modules-dir = lib/ser/modules/
 ifeq ($(OS), linux)
@@ -45,7 +45,7 @@
 endif
 ut-prefix = bin/
 # target dirs for various stuff
-cfg-target = $(prefix)/$(cfg-dir)
+cfg-target = $(PKG_SYSCONFDIR)/$(cfg-dir)
 modules-target = $(prefix)/$(modules-dir)
 
 
@@ -59,10 +59,10 @@
 endif
 
 # INSTALL-CFG = $(INSTALL) -m 644
-INSTALL-BIN = $(INSTALL) -m 755
-INSTALL-MODULES = $(INSTALL) -m 755
-INSTALL-DOC = $(INSTALL) -m 644
-INSTALL-MAN = $(INSTALL) -m 644
+INSTALL-BIN = $(INSTALL) -c -m 755
+INSTALL-MODULES = $(INSTALL) -c -m 755
+INSTALL-DOC = $(INSTALL) -c -m 644
+INSTALL-MAN = $(INSTALL) -c -m 644
 
 #set some vars from the environment (and not make builtins)
 CC   := $(shell echo "$${CC}")
@@ -446,6 +446,7 @@
 endif
 
 endif #mode=release
+LDFLAGS+= -L${BUILDLINK_PREFIX.pthread}/lib ${COMPILER_RPATH_FLAG}${BUILDLINK_PREFIX.pthread}/lib
 
 
 #*FLAGS used for compiling the modules
@@ -473,8 +474,10 @@
 	DEFS+=-DHAVE_GETHOSTBYNAME2 -DHAVE_UNION_SEMUN
 endif
 ifneq ($(OS), openbsd)
+ifneq ($(OS), netbsd)
 	DEFS+=-DHAVE_SCHED_YIELD
 endif
+endif
 
 
 #os specific stuff
@@ -520,7 +523,7 @@
 ifeq ($(OS), netbsd)
 	DEFS+=-DHAVE_SOCKADDR_SA_LEN
 	YACC=yacc
-	LIBS= -lfl  -lc_r
+	LIBS= -lfl  -lpthread
 endif
 
 ifneq (,$(findstring CYGWIN, $(OS)))
