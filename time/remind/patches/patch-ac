$NetBSD: patch-ac,v 1.4 2006/10/01 08:26:56 schwarz Exp $

--- src/files.c.orig	2005-09-30 05:29:32.000000000 +0200
+++ src/files.c	2006-09-17 19:33:26.000000000 +0200
@@ -19,6 +19,11 @@
 
 #include <string.h>
 #include <ctype.h>
+#ifdef NBCOMPAT_GLOB_H
+# include <nbcompat/glob.h>
+#else
+# include <glob.h>
+#endif
 #include <sys/stat.h>
 
 #ifdef TM_IN_SYS_TIME
@@ -365,16 +370,27 @@
 {     
     DynamicBuffer buf;
     int r, e;
+    glob_t g;
+    char **gp;
 
     DBufInit(&buf);
+    memset(&g, 0, sizeof(g));
+
     if ( (r=ParseToken(p, &buf)) ) return r;
     e = VerifyEoln(p); 
     if (e) Eprint("%s", ErrMsg[e]);
-    if ( (r=IncludeFile(DBufValue(&buf))) ) {
-	DBufFree(&buf);
-	return r;
-    }
+
+    glob(DBufValue(&buf), GLOB_NOCHECK|GLOB_BRACE|GLOB_TILDE, NULL, &g);
     DBufFree(&buf);
+
+    for (gp = g.gl_pathv; gp && *gp; gp++) {
+	if ( (r=IncludeFile(*gp)) ) {
+	    globfree(&g);
+	    return r;
+	}
+    }
+
+    globfree(&g);
     NumIfs = 0;
     IfFlags = 0;
     return OK;
