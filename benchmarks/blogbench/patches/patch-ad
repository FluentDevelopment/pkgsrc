$NetBSD: patch-ad,v 1.1 2006/10/15 12:53:04 xtraeme Exp $

--- src/helpers.c.orig	2005-02-11 15:46:26.000000000 +0100
+++ src/helpers.c	2006-10-15 13:25:58.000000000 +0200
@@ -49,8 +49,13 @@
     ssize_t written;    
     int fd;
     
-    if ((fd = open(file_name, O_CREAT | O_TRUNC | O_WRONLY,
-		   (mode_t) 0600)) == -1) {
+    if (do_directio)
+	   fd = open(file_name, O_CREAT|O_TRUNC|O_WRONLY|O_DIRECT,
+		    (mode_t)0600);
+    else
+	   fd = open(file_name, O_CREAT|O_TRUNC|O_WRONLY, (mode_t)0600);
+
+    if (fd == -1) {
 	if (errno != ENOENT) {	    
 	    reentrant_printf("open(\"%s\"): %s\n",
 			     file_name, strerror(errno));
