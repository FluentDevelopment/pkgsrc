$NetBSD: patch-aa,v 1.4 2002/09/12 21:20:32 wiz Exp $

--- bozohttpd.c.orig	Fri Aug 23 07:43:44 2002
+++ bozohttpd.c
@@ -1434,6 +1434,12 @@ process_cgi(request)
 	if (request->method == HTTP_HEAD)
 		goto print_cgi_header;
 
+	if ((s = strchr(url, '?')) != NULL) {
+		*s++ = '\0';
+		query = s;
+	} else
+		query = NULL;
+
 	if ((s = strchr(url + 1, '/')) != NULL) {
 		command = malloc(s - url);
 		if (command == NULL)
@@ -1449,12 +1455,6 @@ process_cgi(request)
 		if (*command == '/')
 			command++;
 	}
-
-	if ((s = strchr(url, '?')) != NULL) {
-		*s++ = '\0';
-		query = s;
-	} else
-		query = NULL;
 
 	debug((DEBUG_FAT, "process_cgi: cmd %s info %s query %s",
 	    command, info, query ? query : "<null>"));
