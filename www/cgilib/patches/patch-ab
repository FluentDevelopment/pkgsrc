$NetBSD: patch-ab,v 1.7 2002/12/27 14:36:02 cjep Exp $

--- Makefile.orig	Fri Aug 20 22:14:07 1999
+++ Makefile
@@ -14,30 +14,50 @@
 #   along with this program; if not, write to the Free Software
 #   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111, USA.
 
-CFLAGS = -I. -Wall -O2 -g
+NROFF=	nroff -mandoc
+
+CFLAGS += -I. -Wall -O2
 LDFLAGS = -L.
-LIBS = -lcgi
+LIBS = libcgi.la
 
 OBJS = cgi.o cookies.o
 
-libcgi.a: $(OBJS)
-	ar rc $@ $^
+all: libcgi.la cgitest jumpto htmlman
 
-cgitest: cgitest.o libcgi.a
-	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $^ $(LIBS)
+.SUFFIXES:	.lo
 
-jumpto: jumpto.o libcgi.a
-	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $^ $(LIBS)
+.c.lo:
+	${LIBTOOL} --mode=compile ${CC} ${CFLAGS} -o $@ -c $<
 
-all: libcgi.a cgitest jumpto
+libcgi.la: $(OBJS:.o=.lo)
+	${LIBTOOL} --mode=link ${CC} -o $@ ${OBJS:.o=.lo} \
+		-rpath ${PREFIX}/lib \
+		-version-info 0:0
 
-install: cgitest
-	install -m 755 cgitest /usr/lib/cgi-bin
+cgitest: cgitest.lo libcgi.la
+	${LIBTOOL} --mode=link $(CC) $(CFLAGS) $(LDFLAGS) -o $@ cgitest.lo $(LIBS)
 
-clean:
-	rm -f cgitest cgitest.o jumpto jumpto.o libcgi.a $(OBJS) *.[35].html
+jumpto: jumpto.lo libcgi.la
+	${LIBTOOL} --mode=link $(CC) $(CFLAGS) $(LDFLAGS) -o $@ jumpto.lo $(LIBS)
 
 htmlman:
 	for f in *.[35]; do \
-	  man -l $$f|rman -f HTML --title $$f -r "%s.%s.html" > $$f.html; \
+	${NROFF} $$f|rman -f HTML --title $$f -r "%s.%s.html" > $$f.html; \
 	done
+
+install:
+	-mkdir -p ${PREFIX}/libexec/cgi-bin
+	-mkdir -p ${PREFIX}/share/examples/cgilib
+	${INSTALL} -c -m 444 cgitest.c ${PREFIX}/share/examples/cgilib
+	${INSTALL} -c -m 444 jumpto.c ${PREFIX}/share/examples/cgilib
+	${LIBTOOL} --mode=install ${INSTALL} -c -m 444 libcgi.la ${PREFIX}/lib
+	${LIBTOOL} --mode=install ${INSTALL} -c -m 755 cgitest ${PREFIX}/libexec/cgi-bin
+	${LIBTOOL} --mode=install ${INSTALL} -c -m 755 jumpto ${PREFIX}/libexec/cgi-bin
+	${INSTALL} -c -m 444 cgi.h ${PREFIX}/include
+	-mkdir -p ${PREFIX}/share/doc/html/cgilib
+	for i in *.html; do \
+          ${INSTALL} -c -m 444 $$i ${PREFIX}/share/doc/html/cgilib ; \
+        done
+
+clean:
+	rm -f cgitest cgitest.o jumpto jumpto.o libcgi.a $(OBJS) *.[35].html
