$NetBSD: patch-be,v 1.6 2002/04/25 15:52:46 taya Exp $

diff -ru ../mozilla-current.orig/mozilla/nsprpub/pr/src/io/prsocket.c ./nsprpub/pr/src/io/prsocket.c
--- ../mozilla-current.orig/mozilla/nsprpub/pr/src/io/prsocket.c	Sun Mar 17 20:00:21 2002
+++ ./nsprpub/pr/src/io/prsocket.c	Sun Apr  7 01:18:55 2002
@@ -1299,6 +1299,15 @@
 	if (osfd == -1) {
 		return 0;
 	}
+#if defined(__NetBSD__) && defined(_PR_INET6) && defined(IPV6_V6ONLY)
+	if(domain == PR_AF_INET6){
+		int	opt = 0;
+		if(setsockopt(osfd, IPPROTO_IPV6, IPV6_V6ONLY, &opt, sizeof(opt))){
+			close(osfd);
+			return -1;
+		}
+	}
+#endif
 	if (type == SOCK_STREAM)
 		fd = PR_AllocFileDesc(osfd, PR_GetTCPMethods());
 	else
