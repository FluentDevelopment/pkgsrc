$NetBSD: patch-aj,v 1.1 2001/09/28 10:10:41 itojun Exp $

plug security hole.
http://mi.med.tohoku.ac.jp/~satodai/w3m-dev/200109.month/2226.html

--- url.c.orig	Fri Sep 28 18:57:05 2001
+++ url.c	Fri Sep 28 18:59:14 2001
@@ -949,7 +949,7 @@
 	    pu->file = cleanupName(pu->file);
 	}
 	if (pu->scheme == SCM_LOCAL)
-	    pu->real_file = file_unquote(pu->file);
+            pu->real_file = cleanupName2(file_unquote(pu->file), FALSE);
     }
 }
 
@@ -1247,7 +1247,7 @@
 	    Str tmp2 = Strnew_charp("#");
 	    Strcat_charp(tmp2, pu->label);
 	    pu->file = tmp2->ptr;
-	    pu->real_file = file_unquote(pu->file);
+            pu->real_file = cleanupName2(file_unquote(pu->file), FALSE);
 	    pu->label = NULL;
 	}
 	else {
@@ -1284,7 +1284,7 @@
 	else if ((q = strchr(pu->file, '?')) != NULL) {
 	    /* local CGI: GET */
 	    p = Strnew_charp_n(pu->file, (int)(q - pu->file))->ptr;
-	    pu->real_file = file_unquote(p);
+            pu->real_file = cleanupName2(file_unquote(p), FALSE);
 	    uf.stream = newFileStream(localcgi_get(pu->real_file, q + 1, option->referer),
 				      (void (*)()) pclose);
 	    if (uf.stream != NULL) {
@@ -1322,7 +1322,7 @@
 		    Strcat_char(tmp, '/');
 		Strcat_charp(tmp, pu->file);
 		p = cleanupName(tmp->ptr);
-		q = file_unquote(p);
+                q = cleanupName2(file_unquote(p), FALSE);
 		if (dir_exist(q)) {
 		    pu->file = p;
 		    pu->real_file = q;
@@ -1606,7 +1606,7 @@
     }
     p = Strnew_m_charp(pu->file, "/", file_quote(index_file), NULL)->ptr;
     p = cleanupName(p);
-    q = file_unquote(p);
+    q = cleanupName2(file_unquote(p), FALSE);
     examineFile(q, uf);
     if (uf->stream == NULL)
 	return;
