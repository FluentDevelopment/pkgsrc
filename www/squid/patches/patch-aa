$NetBSD: patch-aa,v 1.7 2001/11/23 10:22:54 tron Exp $

--- src/Makefile.in.orig	Wed Apr  4 09:01:12 2001
+++ src/Makefile.in	Fri Nov 23 10:56:52 2001
@@ -12,6 +12,8 @@
 cgi_suffix	= @cgi_suffix@
 top_srcdir	= @top_srcdir@
 bindir		= @bindir@
+sbindir		= @sbindir@
+datadir		= @datadir@
 libexecdir      = @libexecdir@
 sysconfdir	= @sysconfdir@
 localstatedir   = @localstatedir@
@@ -34,20 +36,20 @@
 DISKD_EXE	= diskd$(exec_suffix)
 
 DEFAULT_PREFIX		= $(prefix)
-DEFAULT_CONFIG_FILE     = $(sysconfdir)/squid.conf
-DEFAULT_MIME_TABLE	= $(sysconfdir)/mime.conf
+DEFAULT_CONFIG_FILE     = $(prefix)/etc/squid/squid.conf
+DEFAULT_MIME_TABLE	= $(prefix)/etc/squid/mime.conf
 DEFAULT_DNSSERVER       = $(libexecdir)/$(DNSSERVER_EXE)
 DEFAULT_CACHE_LOG       = $(localstatedir)/logs/cache.log
 DEFAULT_ACCESS_LOG      = $(localstatedir)/logs/access.log
 DEFAULT_STORE_LOG       = $(localstatedir)/logs/store.log
-DEFAULT_PID_FILE        = $(localstatedir)/logs/squid.pid
+DEFAULT_PID_FILE        = /var/run/squid.pid
 DEFAULT_SWAP_DIR        = $(localstatedir)/cache
 DEFAULT_PINGER		= $(libexecdir)/$(PINGER_EXE)
 DEFAULT_UNLINKD		= $(libexecdir)/$(UNLINKD_EXE)
 DEFAULT_DISKD		= $(libexecdir)/$(DISKD_EXE)
-DEFAULT_ICON_DIR	= $(sysconfdir)/icons
-DEFAULT_ERROR_DIR	= $(sysconfdir)/errors
-DEFAULT_MIB_PATH	= $(sysconfdir)/mib.txt
+DEFAULT_ICON_DIR	= $(datadir)/squid/icons
+DEFAULT_ERROR_DIR	= $(datadir)/squid/errors
+DEFAULT_MIB_PATH	= $(datadir)/squid/mib.txt
 
 CC		= @CC@
 MAKEDEPEND	= @MAKEDEPEND@
@@ -310,9 +312,9 @@
 		echo "mkdir $(exec_prefix)"; \
 		mkdir -p $(exec_prefix); \
 	fi
-	-@if test ! -d $(bindir); then \
-		echo "mkdir $(bindir)"; \
-		mkdir -p $(bindir); \
+	-@if test ! -d $(sbindir); then \
+		echo "mkdir $(sbindir)"; \
+		mkdir -p $(sbindir); \
 	fi
 	-@if test ! -d $(libexecdir); then \
 		echo "mkdir $(libexecdir)"; \
@@ -322,14 +324,14 @@
 		echo "mkdir $(sysconfdir)"; \
 		mkdir -p $(sysconfdir); \
 	fi
-	-@if test ! -d $(localstatedir); then \
-		echo "mkdir $(localstatedir)"; \
-		mkdir -p $(localstatedir); \
-	fi
-	-@if test ! -d $(localstatedir)/logs; then \
-		echo "mkdir $(localstatedir)/logs"; \
-		mkdir -p $(localstatedir)/logs; \
-	fi
+#	-@if test ! -d $(localstatedir); then \
+#		echo "mkdir $(localstatedir)"; \
+#		mkdir -p $(localstatedir); \
+#	fi
+#	-@if test ! -d $(localstatedir)/logs; then \
+#		echo "mkdir $(localstatedir)/logs"; \
+#		mkdir -p $(localstatedir)/logs; \
+#	fi
 
 # Michael Lupp <mike@nemesis.saar.de> wants to know about additions
 # to the install target.
@@ -339,15 +341,15 @@
 		(cd $$dir ; $(MAKE) $(MFLAGS) prefix="$(prefix)" $@) || exit 1; \
 	done
 	@for f in $(PROGS); do \
-		if test -f $(bindir)/$$f; then \
-			echo $(MV) $(bindir)/$$f $(bindir)/-$$f; \
-			$(MV) $(bindir)/$$f $(bindir)/-$$f; \
+		if test -f $(sbindir)/$$f; then \
+			echo $(MV) $(sbindir)/$$f $(sbindir)/-$$f; \
+			$(MV) $(sbindir)/$$f $(sbindir)/-$$f; \
 		fi; \
-		echo $(INSTALL_BIN) $$f $(bindir); \
-		$(INSTALL_BIN) $$f $(bindir); \
-		if test -f $(bindir)/-$$f; then \
-			echo $(RM) -f $(bindir)/-$$f; \
-			$(RM) -f $(bindir)/-$$f; \
+		echo $(INSTALL_BIN) $$f $(sbindir); \
+		$(INSTALL_BIN) $$f $(sbindir); \
+		if test -f $(sbindir)/-$$f; then \
+			echo $(RM) -f $(sbindir)/-$$f; \
+			$(RM) -f $(sbindir)/-$$f; \
 		fi; \
 	done
 	@if test -n "$(UTILS)"; then \
@@ -377,21 +379,21 @@
 		fi; \
 	done
 	$(INSTALL_FILE) $(srcdir)/mib.txt $(DEFAULT_MIB_PATH)
-	$(INSTALL_FILE) squid.conf $(sysconfdir)/squid.conf.default
-	@if test -f $(sysconfdir)/squid.conf ; then \
-		echo "$@ will not overwrite existing $(sysconfdir)/squid.conf" ; \
-	else \
-		echo "$(INSTALL_FILE) squid.conf $(sysconfdir)"; \
-		$(INSTALL_FILE) squid.conf $(sysconfdir); \
-	fi
-
-	$(INSTALL_FILE) $(srcdir)/mime.conf $(sysconfdir)/mime.conf.default
-	@if test -f $(sysconfdir)/mime.conf ; then \
-		echo "$@ will not overwrite existing $(sysconfdir)/mime.conf" ; \
-	else \
-		echo "$(INSTALL_FILE) $(srcdir)/mime.conf $(sysconfdir)"; \
-		$(INSTALL_FILE) $(srcdir)/mime.conf $(sysconfdir); \
-	fi
+	$(INSTALL_FILE) squid.conf $(DEFAULT_CONFIG_FILE).default
+#	@if test -f $(DEFAULT_CONFIG_FILE) ; then \
+#		echo "$@ will not overwrite existing $(DEFAULT_CONFIG_FILE)" ; \
+#	else \
+#		echo "$(INSTALL_FILE) squid.conf $(DEFAULT_CONFIG_FILE)"; \
+#		$(INSTALL_FILE) squid.conf $(DEFAULT_CONFIG_FILE); \
+#	fi
+
+	$(INSTALL_FILE) $(srcdir)/mime.conf $(DEFAULT_MIME_TABLE).default
+#	@if test -f $(DEFAULT_MIME_TABLE) ; then \
+#		echo "$@ will not overwrite existing $(DEFAULT_MIME_TABLE)" ; \
+#	else \
+#		echo "$(INSTALL_FILE) $(srcdir)/mime.conf $(DEFAULT_MIME_TABLE)"; \
+#		$(INSTALL_FILE) $(srcdir)/mime.conf $(DEFAULT_MIME_TABLE); \
+#	fi
 
 install-pinger:
 	@f=$(PINGER_EXE); \
