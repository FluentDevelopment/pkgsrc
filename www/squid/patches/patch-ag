$NetBSD: patch-ag,v 1.12 2002/10/13 16:43:21 taca Exp $

--- configure.orig	Wed Sep 25 05:00:03 2002
+++ configure
@@ -2150,7 +2150,7 @@ if test "${enable_snmp+set}" = set; then
 #define SQUID_SNMP 1
 EOF
 
-    SNMPLIB='-L../snmplib -lsnmp'
+    SNMPLIB='../snmplib/libsnmp.a'
     
 
 if true; then
@@ -3710,6 +3710,7 @@ for ac_hdr in \
 	libc.h \
 	limits.h \
 	linux/netfilter_ipv4.h \
+	machine/byte_swap.h \
 	malloc.h \
 	math.h \
 	memory.h \
@@ -3760,6 +3761,7 @@ for ac_hdr in \
 	syslog.h \
 	time.h \
 	unistd.h \
+	util.h \
 	utime.h \
 	varargs.h \
 	byteswap.h \
@@ -5955,44 +5957,42 @@ fi
 echo "$ac_t""$ac_cv_type_mode_t" 1>&6
 if test $ac_cv_type_mode_t = no; then
   cat >> confdefs.h <<\EOF
-#define mode_t u_short
+#define mode_t unsigned short
 EOF
 
 fi
 
-echo $ac_n "checking for fd_mask""... $ac_c" 1>&6
-echo "configure:5965: checking for fd_mask" >&5
-if eval "test \"`echo '$''{'ac_cv_type_fd_mask'+set}'`\" = set"; then
+
+echo $ac_n "checking for fd_set""... $ac_c" 1>&6
+echo "configure:5968: checking for fd_set" >&5
+if eval "test \"`echo '$''{'ac_cv_have_fd_mask'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
+  
   cat > conftest.$ac_ext <<EOF
-#line 5970 "configure"
+#line 5974 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
-#if STDC_HEADERS
-#include <stdlib.h>
-#include <stddef.h>
-#endif
+#include <sys/time.h>
+#include <sys/unistd.h>
+int main() {
+fd_mask fds;
+; return 0; }
 EOF
-if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  egrep "(^|[^a-zA-Z_0-9])fd_mask[^a-zA-Z_0-9]" >/dev/null 2>&1; then
+if { (eval echo configure:5983: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
-  ac_cv_type_fd_mask=yes
+  ac_cv_have_fd_mask="yes"
 else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
   rm -rf conftest*
-  ac_cv_type_fd_mask=no
+  ac_cv_have_fd_mask="no"
 fi
 rm -f conftest*
 
 fi
-echo "$ac_t""$ac_cv_type_fd_mask" 1>&6
-if test $ac_cv_type_fd_mask = no; then
-  cat >> confdefs.h <<\EOF
-#define fd_mask int
-EOF
-
-fi
 
+echo "$ac_t""$ac_cv_have_fd_mask" 1>&6
 
 echo $ac_n "checking size of off_t""... $ac_c" 1>&6
 echo "configure:5999: checking size of off_t" >&5
@@ -7246,8 +7246,8 @@ if test "$GCC" = "yes"; then
 	GCCVER=`$CC -v 2>&1 | awk '$2 ==  "version" {print $3}'`
 	case "$GCCVER" in
 	2.95.[123])
-		echo "Removing -O for gcc on $host with GCC $GCCVER"
-		CFLAGS="`echo $CFLAGS | sed -e 's/-O[0-9]*//'`"
+		echo "Making -O\[2-9\] to -O for gcc on $host with GCC $GCCVER"
+		CFLAGS="`echo $CFLAGS | sed -e 's/-O[0-9]*/-O/'`"
 		;;
 	esac
 fi
@@ -7338,6 +7338,7 @@ for ac_func in \
 	setrlimit \
 	getrlimit \
 	setsid \
+	setproctitle \
 	sigaction \
 	snprintf \
 	srand48 \
