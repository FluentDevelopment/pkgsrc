$NetBSD: patch-bd,v 1.1 2005/10/25 14:05:22 taca Exp $

--- src/cache_cf.c.orig	2005-09-29 06:42:33.000000000 +0900
+++ src/cache_cf.c
@@ -440,8 +440,15 @@ configDoConfigure(void)
 		    Config.effectiveUser);
 	    Config2.effectiveUserID = pwd->pw_uid;
 	    Config2.effectiveGroupID = pwd->pw_gid;
-	    if (pwd->pw_dir && *pwd->pw_dir)
-		setenv("HOME", pwd->pw_dir, 1);
+#if HAVE_PUTENV
+	    if (pwd->pw_dir && *pwd->pw_dir) {
+		int len;
+		char *env_str = xcalloc((len = strlen(pwd->pw_dir) + 6), 1);
+		snprintf(env_str, len, "HOME=%s", pwd->pw_dir);
+		putenv(env_str);
+		xfree(env_str);
+	    }
+#endif
 	}
     } else {
 	Config2.effectiveUserID = geteuid();
