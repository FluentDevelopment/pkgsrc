$NetBSD: patch-ai,v 1.7 2004/07/13 12:22:29 jdolecek Exp $

--- Zend/zend_constants.c.orig	2004-07-13 14:01:27.000000000 +0200
+++ Zend/zend_constants.c	2004-07-13 14:01:54.000000000 +0200
@@ -265,11 +265,11 @@
 	}
 
 	if (zend_hash_add(EG(zend_constants), name, c->name_len, (void *) c, sizeof(zend_constant), NULL)==FAILURE) {
+		zend_error(E_NOTICE,"Constant %s already defined", name);
 		free(c->name);
 		if (!(c->flags & CONST_PERSISTENT)) {
 			zval_dtor(&c->value);
 		}
-		zend_error(E_NOTICE,"Constant %s already defined", name);
 		ret = FAILURE;
 	}
 	if (lowercase_name) {
