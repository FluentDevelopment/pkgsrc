$NetBSD: patch-ab,v 1.18 2005/10/05 15:59:47 tron Exp $

--- main/fopen_wrappers.c.orig	2005-02-02 23:44:07.000000000 +0000
+++ main/fopen_wrappers.c	2005-10-05 16:52:55.000000000 +0100
@@ -120,8 +120,8 @@
 		/* Handler for basedirs that end with a / */
 		resolved_basedir_len = strlen(resolved_basedir);
 		if (basedir[strlen(basedir) - 1] == PHP_DIR_SEPARATOR) {
-			if (resolved_basedir[resolved_basedir_len - 1] == '/') {
-				resolved_basedir[resolved_basedir_len - 1] = PHP_DIR_SEPARATOR;
+			if (resolved_basedir[resolved_basedir_len - 1] != PHP_DIR_SEPARATOR) {
+				resolved_basedir[resolved_basedir_len] = PHP_DIR_SEPARATOR;
 				resolved_basedir[++resolved_basedir_len] = '\0';
 			}
 		}
