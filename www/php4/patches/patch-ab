$NetBSD: patch-ab,v 1.8 2001/10/16 04:54:24 jlam Exp $

--- Zend/zend_alloc.c.orig	Tue Jun 19 14:04:53 2001
+++ Zend/zend_alloc.c
@@ -446,6 +446,9 @@
 		for (i=1; i<MAX_CACHED_MEMORY; i++) {
 			for (j=0; j<AG(cache_count)[i]; j++) {
 				ptr = (zend_mem_header *) AG(cache)[i][j];
+#if MEMORY_LIMIT
+				AG(allocated_memory) -= REAL_SIZE(ptr->size);
+#endif
 				REMOVE_POINTER_FROM_LIST(ptr);
 				free(ptr);
 			}
