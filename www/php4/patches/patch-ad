$NetBSD: patch-ad,v 1.15 2003/06/07 14:37:02 cjep Exp $
--- configure.orig	Thu Sep  5 23:40:53 2002
+++ configure	Fri May 30 10:04:07 2003
@@ -3220,9 +3220,10 @@
     { echo "configure: error: Please specify the path to the root of AOLserver using --with-aolserver=DIR" 1>&2; exit 1; }
   fi
   
-  enable_experimental_zts=yes
   if test "$pthreads_working" != "yes"; then
-    { echo "configure: error: ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." 1>&2; exit 1; }
+      enable_experimental_zts=no
+  else
+      enable_experimental_zts=yes
   fi
 
   
@@ -3772,9 +3773,10 @@
   php_build_target=shared
 
   
-  enable_experimental_zts=yes
   if test "$pthreads_working" != "yes"; then
-    { echo "configure: error: ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." 1>&2; exit 1; }
+      enable_experimental_zts=no
+  else
+      enable_experimental_zts=yes
   fi
 
   echo "$ac_t""yes" 1>&6
@@ -3794,6 +3796,7 @@
 
 
   PHP_VAR_SUBST="$PHP_VAR_SUBST APXS"
+  INCLUDES="$INCLUDES `apr-config --includes`"
 
 
 
@@ -3951,9 +3954,10 @@
 	*** Pike include dir(s) used: $PIKE_INCLUDE_DIR
 	*** Pike version:             $PIKE_VERSION"
         
-  enable_experimental_zts=yes
   if test "$pthreads_working" != "yes"; then
-    { echo "configure: error: ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." 1>&2; exit 1; }
+      enable_experimental_zts=no
+  else
+      enable_experimental_zts=yes
   fi
 
 
@@ -4304,9 +4308,10 @@
 	fi
 	test -f "$ZEUSPATH/web/include/httpext.h" || { echo "configure: error: Unable to find httpext.h in $ZEUSPATH/web/include" 1>&2; exit 1; }
 	
-  enable_experimental_zts=yes
   if test "$pthreads_working" != "yes"; then
-    { echo "configure: error: ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." 1>&2; exit 1; }
+      enable_experimental_zts=no
+  else
+      enable_experimental_zts=yes
   fi
 
 	cat >> confdefs.h <<\EOF
@@ -4424,9 +4429,10 @@
   fi
 
   
-  enable_experimental_zts=yes
   if test "$pthreads_working" != "yes"; then
-    { echo "configure: error: ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." 1>&2; exit 1; }
+      enable_experimental_zts=no
+  else
+      enable_experimental_zts=yes
   fi
 
   cat >> confdefs.h <<\EOF
@@ -4454,9 +4460,10 @@
 		{ echo "configure: error: You did not specify a directory" 1>&2; exit 1; }
 	fi
 	
-  enable_experimental_zts=yes
   if test "$pthreads_working" != "yes"; then
-    { echo "configure: error: ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." 1>&2; exit 1; }
+      enable_experimental_zts=no
+  else
+      enable_experimental_zts=yes
   fi
 
 	PHTTPD_DIR=$withval
@@ -4565,9 +4572,10 @@
 	fi
 	test -f "$PI3PATH/PiAPI/PiAPI.h" || { echo "configure: error: Unable to find PiAPI.h in $PI3PATH/PiAPI" 1>&2; exit 1; }
 	
-  enable_experimental_zts=yes
   if test "$pthreads_working" != "yes"; then
-    { echo "configure: error: ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." 1>&2; exit 1; }
+      enable_experimental_zts=no
+  else
+      enable_experimental_zts=yes
   fi
 
 	cat >> confdefs.h <<\EOF
@@ -4855,9 +4863,10 @@
   php_build_target=shared
 
     
-  enable_experimental_zts=yes
   if test "$pthreads_working" != "yes"; then
-    { echo "configure: error: ZTS currently requires working POSIX threads. We were unable to verify that your system supports Pthreads." 1>&2; exit 1; }
+      enable_experimental_zts=no
+  else
+      enable_experimental_zts=yes
   fi
 
     echo "$ac_t""yes" 1>&6
@@ -5396,10 +5405,6 @@
 
   fi
 
-if test -d /usr/pkg/include -a -d /usr/pkg/lib ; then
-       CPPFLAGS="$CPPFLAGS -I/usr/pkg/include"
-       LDFLAGS="$LDFLAGS -L/usr/pkg/lib"
-fi
 INCLUDES="$INCLUDES -I\$(top_builddir)/Zend"
 test -d /usr/ucblib && 
   if test "/usr/ucblib" != "/usr/lib"; then
@@ -26847,19 +26852,10 @@
 
 
   else
-    cat >> confdefs.h <<\EOF
-#define HYPERWAVE 0
-EOF
-
     echo "$ac_t""no" 1>&6
   fi
 
 else
-  
-  cat >> confdefs.h <<\EOF
-#define HYPERWAVE 0
-EOF
-
   echo "$ac_t""no" 1>&6
 
 fi
@@ -67729,8 +67725,8 @@
     if test "$lib_build_shared" != "yes"; then
         enable_shared=no
     fi
-    PHP_COMPILE='$(CC) $(COMMON_FLAGS) $(CFLAGS_CLEAN) $(EXTRA_CFLAGS) -c $< && touch $@'
-    CXX_PHP_COMPILE='$(CXX) $(COMMON_FLAGS) $(CXXFLAGS_CLEAN) $(EXTRA_CXXFLAGS)  -c $< && touch $@'
+    PHP_COMPILE='$(LIBTOOL) --mode=compile $(COMPILE) -c $<'
+    CXX_PHP_COMPILE='$(LIBTOOL) --mode=compile $(CXX_COMPILE) -c $<'
 ;;
 shared)
     enable_static=no
@@ -72831,7 +72827,7 @@
 
 TSRM_LIB='TSRM/libtsrm.la'
 TSRM_DIR=TSRM
-CPPFLAGS="$CPPFLAGS -I\$(top_builddir)/TSRM"
+INCLUDES="$INCLUDES -I\$(top_builddir)/TSRM"
 
 if test "$ZEND_EXPERIMENTAL_ZTS" = "yes"; then
   cat >> confdefs.h <<\EOF
@@ -73625,7 +73621,7 @@
 
 if test "$enable_debug" != "yes"; then
   
-  LIBTOOL='$(SHELL) $(top_builddir)/libtool --silent'
+  LIBTOOL='$(SHELL) $(top_builddir)/libtool'
 
 fi
 
