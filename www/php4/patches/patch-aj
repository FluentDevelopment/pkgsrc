$NetBSD: patch-aj,v 1.6 2003/11/08 06:58:10 jdolecek Exp $

--- ext/gettext/gettext.c.orig	2003-09-24 04:08:48.000000000 +0200
+++ ext/gettext/gettext.c	2003-11-07 21:47:25.000000000 +0100
@@ -31,6 +31,11 @@
 #include "ext/standard/info.h"
 #include "php_gettext.h"
 
+#define CHECK(a) if (a == NULL) {										\
+		fprintf(stderr, "%s, %d: NULL value\n", __FILE__, __LINE__);	\
+		a = "";															\
+}
+
 /* {{{ php_gettext_functions[]
  */
 function_entry php_gettext_functions[] = {
@@ -103,6 +108,7 @@
 
 	retval = textdomain(domain_name);
 
+	CHECK(retval);
 	RETURN_STRING(retval, 1);
 }
 /* }}} */
@@ -140,6 +146,7 @@
 
 	msgstr = dgettext(Z_STRVAL_PP(domain_name), Z_STRVAL_PP(msgid));
 
+	CHECK(msgstr);
 	RETURN_STRING(msgstr, 1);
 }
 /* }}} */
@@ -160,6 +167,7 @@
 
 	msgstr = dcgettext(Z_STRVAL_PP(domain_name), Z_STRVAL_PP(msgid), Z_LVAL_PP(category));
 
+	CHECK(msgstr);
 	RETURN_STRING(msgstr, 1);
 }
 /* }}} */
@@ -190,6 +198,7 @@
 
 	retval = bindtextdomain(Z_STRVAL_PP(domain_name), dir_name);
 
+	CHECK(retval);
 	RETURN_STRING(retval, 1);
 }
 /* }}} */
