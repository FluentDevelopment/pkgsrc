#!/bin/sh
#
# $NetBSD: DEINSTALL,v 1.2 2001/11/06 10:58:03 jlam Exp $

PKGNAME=$1
STAGE=$2

CAT="@CAT@"
CMP="@CMP@"
ECHO="@ECHO@"
RM="@RM@"
RMDIR="@RMDIR@"
TR="@TR@"
TRUE="@TRUE@"

SAMPLECONFDIR=${PKG_PREFIX}/share/examples/@PKGBASE@
CONFDIR=@SURFRAW_SYSCONFDIR@
MAKEDIRS=""

CONFFILES=" \
	${SAMPLECONFDIR}/surfraw.conf ${CONFDIR}/surfraw.conf : \
	${SAMPLECONFDIR}/surfraw_elvi.list ${CONFDIR}/surfraw_elvi.list \
	"

case ${STAGE} in
DEINSTALL)
	# Remove configuration files if they don't differ from the default
	# config file.
	#
	${ECHO} ${CONFFILES} | ${TR} ":" "\012" | while read SAMPLEFILE FILE
	do
		if ${CMP} -s ${FILE} ${SAMPLEFILE}
		then
			${RM} -f ${FILE}
		fi
	done
	;;

POST-DEINSTALL)
	modified_files=''
	for file in ${CONFFILES}
	do
		FILE=${CONFDIR}/${file}
		if [ -f ${FILE} ]
		then
			modified_files="${modified_files} ${FILE}"
		fi
	done

	existing_dirs=''
	for dir in __dummy ${MAKEDIRS}
	do
		if [ "${dir}" != "__dummy" -a			\
		     "${dir}" != "/etc" -a			\
		     "${dir}" != "${PKG_PREFIX}/etc" ]
		then
			${RMDIR} -p ${dir} 2>/dev/null || ${TRUE}
			if [ -d ${dir} ]
			then
				existing_dirs="${existing_dirs} ${dir}"
			fi
		fi
	done

	if [ -n "${modified_files}" -o -n "${existing_dirs}" ]
	then
		${CAT} << EOF
===========================================================================
If you won't be using ${PKGNAME} any longer, you may want to remove
EOF
		if [ -n "${modified_files}" ]
		then
			${CAT} << EOF

  * the following files:

EOF
			for file in ${modified_files}
			do
				${ECHO} "	${file}"
			done
		fi
		if [ -n "${existing_dirs}" ]
		then
			${CAT} << EOF

* the following directories:

EOF
			for dir in ${existing_dirs}
			do
				${ECHO} "	${dir}"
			done
		fi
		${CAT} << EOF
===========================================================================
EOF
	fi
	;;

*)
	${ECHO} "Unexpected argument: ${STAGE}"
	exit 1
	;;
esac
exit 0
