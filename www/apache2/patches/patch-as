$NetBSD: patch-as,v 1.5 2004/12/18 08:42:12 adrianp Exp $

--- modules/ssl/ssl_engine_kernel.c.orig	2004-12-18 07:10:37.000000000 +0000
+++ modules/ssl/ssl_engine_kernel.c	2004-12-18 07:13:50.000000000 +0000
@@ -719,6 +719,21 @@
                 X509_free(peercert);
             }
         }
+
+	/*
+	 * Also check that SSLCipherSuite has been enforced as expected.
+	 */
+	if (cipher_list) {
+	    cipher = SSL_get_current_cipher(ssl);
+	    if (sk_SSL_CIPHER_find(cipher_list, cipher) < 0) {
+	        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
+	                      "SSL cipher suite not renegotiated: "
+	                      "access to %s denied using cipher %s",
+	                      r->filename,
+	                      SSL_CIPHER_get_name(cipher));
+	        return HTTP_FORBIDDEN;
+	    }
+	}
     }
 
     /*
