--- Makefile.in.orig	Fri Feb 20 21:16:54 2004
+++ Makefile.in	Thu Sep  9 01:18:45 2004
@@ -33,8 +33,8 @@
   ifdef CXXPICFLAG
     %.oct : pic/%.o octave$(EXEEXT)
-	  $(DL_LD) $(DL_LDFLAGS) -o $@ $< $(OCT_LINK_DEPS)
+	  ${LIBTOOL} --mode=link $(DL_LD) $(DL_LDFLAGS) -o $@ $< $(OCT_LINK_DEPS)
   else
     %.oct : %.o octave$(EXEEXT)
-	  $(DL_LD) $(DL_LDFLAGS) -o $@ $< $(OCT_LINK_DEPS)
+	  ${LIBTOOL} --mode=link $(DL_LD) $(DL_LDFLAGS) -o $@ $< $(OCT_LINK_DEPS)
   endif
 endif
@@ -247,6 +247,7 @@
 liboctinterp.$(LIBEXT): $(OBJECTS) $(XERBLA)
 	rm -f $@
-	$(TEMPLATE_AR) $(TEMPLATE_ARFLAGS) $@ $^
-	$(RANLIB) $@
+	${LIBTOOL} --mode=link ${CC} -o liboctinterp.$(LIBEXT) \
+		$(OBJECTS:.o=.lo) $(XERBLA:.o=.lo) -rpath ${PREFIX}/lib \
+		-version-info ${version:2.1.%=2:%}
 
 liboctinterp.$(SHLEXT_VER): liboctinterp.$(SHLEXT)
@@ -256,5 +257,5 @@
 liboctinterp.$(SHLEXT): $(PICOBJ) $(PIC_XERBLA)
 	rm -f $@
-	$(SH_LD) $(SH_LDFLAGS) $(SONAME_FLAGS) -o $@ $^ $(OCTINTERP_LINK_DEPS)
+	${LIBTOOL} --mode=link $(SH_LD) $(SH_LDFLAGS) $(SONAME_FLAGS) -o $@ $^ $(OCTINTERP_LINK_DEPS)
 
 stamp-oct-links: $(OCT_FILES)
@@ -268,4 +269,5 @@
 
 octave$(EXEEXT): stamp-prereq $(LIBRARIES) main.o $(DLD_STATIC_OBJ)
+	${LIBTOOL} --mode=link \
 	$(LD_CXX) $(CPPFLAGS) $(ALL_CXXFLAGS) $(RDYNAMIC_FLAG) \
 	$(ALL_LDFLAGS) -o $@ \
@@ -348,4 +350,5 @@
 	$(top_srcdir)/mkinstalldirs $(DESTDIR)$(bindir)
 	rm -f $(DESTDIR)$(bindir)/octave$(EXEEXT)
+	${LIBTOOL} --mode=install \
 	$(INSTALL_PROGRAM) octave$(EXEEXT) $(DESTDIR)$(bindir)/octave-$(version)$(EXEEXT)
 	$(LN_S) octave-$(version)$(EXEEXT) $(DESTDIR)$(bindir)/octave$(EXEEXT)
@@ -367,7 +370,6 @@
 	if $(STATIC_LIBS); then \
 	  rm -f $(DESTDIR)$(octlibdir)/liboctinterp.$(LIBEXT); \
-	  $(INSTALL_DATA) liboctinterp.$(LIBEXT) \
-	    $(DESTDIR)$(octlibdir)/liboctinterp.$(LIBEXT); \
-	  $(RANLIB) $(DESTDIR)$(octlibdir)/liboctinterp.$(LIBEXT); \
+	  ${LIBTOOL} --mode=install $(INSTALL_DATA) liboctinterp.$(LIBEXT) \
+	    ${PREFIX}/lib; \
 	fi
 	if $(SHARED_LIBS); then \
