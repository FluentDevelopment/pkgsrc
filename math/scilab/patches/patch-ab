$NetBSD: patch-ab,v 1.11 2006/05/12 12:39:32 joerg Exp $

--- configure.orig	2005-05-25 15:00:45.000000000 +0000
+++ configure
@@ -18362,7 +18362,7 @@ case "$host" in
     else
       CC=cc
       CC_OPTIONS='-std -O -DNDEBUG -ieee_with_inexact'
-      CC_LDFLAGS='-ieee_with_inexact'
+      CC_LDFLAGS="${CC_LDFLAGS} -ieee_with_inexact"
     fi
     #fortran compiler
     if test "$WITH_G77" = yes; then
@@ -18422,7 +18422,7 @@ echo "$as_me: error: Unable to configure
       FC="$F77"
       FC_OPTIONS='-O -fpe3'
       FC_OPTIONS_O0='-fpe3'
-      FC_LDFLAGS=
+      FC_LDFLAGS="${FC_LDFLAGS}"
       FC_USE_CDEC='   '
       if test "$enable_debug" = yes; then
         CC_OPTIONS='-std -g -ieee_with_inexact'
@@ -18439,7 +18439,7 @@ echo "$as_me: error: Unable to configure
     # standard compilers
     CC=cc
     CC_OPTIONS='-O -DNDEBUG -ieee_with_inexact'
-    CC_LDFLAGS='-ieee_with_inexact'
+    CC_LDFLAGS="${CC_LDFLAGS} -ieee_with_inexact"
     if test "$WITH_G77" != yes; then
       #AC_CHECK_PROG(F77,f77,yes,no)
       for ac_prog in f77 f90 f2c-f77
@@ -18493,7 +18493,7 @@ echo "$as_me: error: Unable to configure
     #FC="$F77"
     FC_OPTIONS='-O -fpe3 -switch nosqrt_recip'
     FC_OPTIONS_O0='-fpe3 -switch nosqrt_recip'
-    FC_LDFLAGS=
+    FC_LDFLAGS="${FC_LDFLAGS}"
     FC_USE_CDEC='   '
     LD=ld
     LD_LDFLAGS=
@@ -18524,7 +18524,7 @@ echo "$as_me: error: Unable to configure
     # standard compilers
     CC=cc
     CC_OPTIONS='-Daix -DSYSV'
-    CC_LDFLAGS=
+    CC_LDFLAGS="${CC_LDFLAGS}"
     if test "$WITH_G77" != yes; then
       #AC_CHECK_PROG(F77,f77,yes,no)
       for ac_prog in f77 f90 f2c-f77
@@ -18578,7 +18578,7 @@ echo "$as_me: error: Unable to configure
     #FC="$F77"
     FC_OPTIONS='-qcharlen=4096'
     FC_OPTIONS_O0='-qcharlen=4096'
-    FC_LDFLAGS=
+    FC_LDFLAGS="${FC_LDFLAGS}"
     LD=ld
     LD_LDFLAGS=
     if test "$enable_debug" = yes; then
@@ -18661,7 +18661,7 @@ fi
     GCC=yes
     CC=gcc
     CC_OPTIONS='-O -DNDEBUG -Dlinux -fwritable-strings'
-    CC_LDFLAGS=$LIEEELIB
+    CC_LDFLAGS="${CC_LDFLAGS} $LIEEELIB"
     # find Fortran compiler
     # g77 already asked and found: good
     if test "$WITH_G77" = yes; then
@@ -18801,7 +18801,7 @@ echo "$as_me: error: Unable to configure
     fi
     FC_OPTIONS=-O
     FC_OPTIONS_O0=
-    FC_LDFLAGS="$LIEEELIB -ldl -rdynamic"
+    FC_LDFLAGS="${FC_LDFLAGS} $LIEEELIB -ldl -rdynamic"
     LD=ld
     LD_LDFLAGS=$LIEEELIB
     if test "$enable_debug" = yes; then
@@ -18815,7 +18815,7 @@ echo "$as_me: error: Unable to configure
     # standard compilers
     CC=cc
     CC_OPTIONS=-O -DNDEBUG
-    CC_LDFLAGS=
+    CC_LDFLAGS="${CC_LDFLAGS}"
     CC_PICFLAGS=-PIC
     if test "$WITH_G77" != yes; then
       #AC_CHECK_PROG(F77,f77,yes,no)
@@ -18870,7 +18870,7 @@ echo "$as_me: error: Unable to configure
     #FC="$F77"
     FC_OPTIONS=-O
     FC_OPTIONS_O0=
-    FC_LDFLAGS=
+    FC_LDFLAGS="${FC_LDFLAGS}"
     FC_PICFLAGS=-PIC
     LD=ld
     LD_LDFLAGS=
@@ -18895,7 +18895,7 @@ echo "$as_me: error: Unable to configure
       if test "$enable_debug" = yes; then
         FC_OPTIONS=-g
       fi
-      FC_LDFLAGS='-Xlinker'
+      FC_LDFLAGS="${FC_LDFLAGS} -Xlinker"
     fi
     MAKEFILE_TARGET=Makefile.sunos
     ;;
@@ -18903,8 +18903,8 @@ echo "$as_me: error: Unable to configure
   *-*-solaris*)
     # standard compilers
     CC=cc
-    CC_OPTIONS='-O -DNDEBUG -DSVR4 -DSYSV -Dsolaris'
-    CC_LDFLAGS=
+    CC_OPTIONS="${CFLAGS} -DNDEBUG -DSVR4 -DSYSV -Dsolaris"
+    CC_LDFLAGS="${CC_LDFLAGS}"
     if test "$WITH_G77" != yes; then
       #AC_CHECK_PROG(F77,f77,yes,no)
       for ac_prog in f77 f90 f2c-f77
@@ -18958,9 +18958,9 @@ echo "$as_me: error: Unable to configure
     #FC="$F77"
     FC_OPTIONS=-O
     FC_OPTIONS_O0=
-    FC_LDFLAGS=
+    FC_LDFLAGS="${FC_LDFLAGS}"
     LD=ld
-    LD_LDFLAGS=
+    LD_LDFLAGS="${FC_LDFLAGS}"
     if test "$enable_debug" = yes; then
       CC_OPTIONS='-g -DSVR4 -DSYSV -Dsolaris'
       FC_OPTIONS=-g
@@ -18977,7 +18977,7 @@ echo "$as_me: error: Unable to configure
       FC=g77
       FC_OPTIONS=-O2
       FC_OPTIONS_O0=
-      FC_LDFLAGS='-t'
+      FC_LDFLAGS="${FC_LDFLAGS} -t"
 #     for solaris 2.7 with gcc/g77 2.95.2, binutils 2.9
 #     the correct value should be
 #     FC_LDFLAGS='-t -Wl,-export-dynamic'
@@ -19341,7 +19341,7 @@ fi
     GCC=yes
     CC=gcc
     CC_OPTIONS='-O -DNDEBUG -Dlinux -fwritable-strings'
-    CC_LDFLAGS=$LIEEELIB
+    CC_LDFLAGS="${CC_LDFLAGS} $LIEEELIB"
     # find Fortran compiler
     # g77 already asked and found: good
     if test "$WITH_G77" = yes; then
@@ -19481,7 +19481,7 @@ echo "$as_me: error: Unable to configure
     fi
     FC_OPTIONS=-O
     FC_OPTIONS_O0=
-    FC_LDFLAGS=$LIEEELIB
+    FC_LDFLAGS="${FC_LDFLAGS} $LIEEELIB"
     LD=ld
     LD_LDFLAGS=$LIEEELIB
     if test "$enable_debug" = yes; then
@@ -19560,8 +19560,8 @@ fi
          CC_OPTIONS='-g -Wall -Dlinux  -DNARROWPROTO  -mp -pc64 -ffnalias -falias'
          FC_OPTIONS="-g -cm  -w90 -w95 -mp -pc64 -ffnalias -falias"
        fi
-       CC_LDFLAGS=$LIEEELIB
-       FC_LDFLAGS="$LIEEELIB -ldl"
+       CC_LDFLAGS="${CC_LDFLAGS} $LIEEELIB"
+       FC_LDFLAGS="${FC_LDFLAGS} $LIEEELIB -ldl"
        LD=xild
        LD_LDFLAGS="$LIEEELIB"
     else
@@ -19569,7 +19569,7 @@ fi
        GCCFIX=fix.o
        CC=gcc
        CC_OPTIONS='-O -DNDEBUG -Dlinux -fwritable-strings -DNARROWPROTO'
-       CC_LDFLAGS=$LIEEELIB
+       CC_LDFLAGS="${CC_LDFLAGS} $LIEEELIB"
        CC_PICFLAGS=-fPIC
        # find Fortran compiler
        # g77 already asked and found: good
@@ -19712,7 +19712,7 @@ echo "$as_me: error: Unable to configure
        fi
        FC_OPTIONS=-O
        FC_OPTIONS_O0=
-       FC_LDFLAGS="$LIEEELIB -ldl -rdynamic"
+       FC_LDFLAGS="${FC_LDFLAGS} $LIEEELIB -ldl -rdynamic"
        if test "$enable_debug" = yes; then
          CC_OPTIONS='-g -Wall -Dlinux -fwritable-strings -DNARROWPROTO'
          FC_OPTIONS=-g
@@ -19791,15 +19791,15 @@ fi
          CC_OPTIONS='-g -Wall -Dlinux  -DNARROWPROTO  -mp '
          FC_OPTIONS="-g -cm  -w90 -w95 -mp "
        fi
-       CC_LDFLAGS="$LIEEELIB  -Wl,-relax"
-       FC_LDFLAGS="$LIEEELIB -ldl -Wl,-relax "
+       CC_LDFLAGS="${CCFLAGS} $LIEEELIB  -Wl,-relax"
+       FC_LDFLAGS="${FC_LDFLAGS} $LIEEELIB -ldl -Wl,-relax "
        LD=xild
        LD_LDFLAGS="$LIEEELIB  -Wl,-relax "
     else
        GCC=yes
        CC=gcc
        CC_OPTIONS='-O -DNDEBUG -Dlinux -fwritable-strings -DNARROWPROTO'
-       CC_LDFLAGS=$LIEEELIB
+       CC_LDFLAGS="${CC_LDFLAGS} $LIEEELIB"
        CC_PICFLAGS=-fPIC
        # find Fortran compiler
        # g77 already asked and found: good
@@ -19942,7 +19942,7 @@ echo "$as_me: error: Unable to configure
        fi
        FC_OPTIONS=-O
        FC_OPTIONS_O0=
-       FC_LDFLAGS="$LIEEELIB -ldl -rdynamic -Wl,-relax"
+       FC_LDFLAGS="${FC_LDFLAGS} $LIEEELIB -ldl -rdynamic -Wl,-relax"
        LD=ld
        LD_LDFLAGS=$LIEEELIB  -Wl,-relax
        if test "$enable_debug" = yes; then
@@ -20021,8 +20021,8 @@ fi
          CC_OPTIONS='-g -Wall -Dlinux  -DNARROWPROTO  -mp '
          FC_OPTIONS="-g -cm  -w90 -w95 -mp "
        fi
-       CC_LDFLAGS="$LIEEELIB  -Wl,-relax"
-       FC_LDFLAGS="$LIEEELIB -ldl  -lPEPCF90 -Wl,-relax "
+       CC_LDFLAGS="${CC_LDFLAGS} $LIEEELIB  -Wl,-relax"
+       FC_LDFLAGS="${FC_LDFLAGS} $LIEEELIB -ldl  -lPEPCF90 -Wl,-relax "
        LD=xild
        LD_LDFLAGS="$LIEEELIB -lPEPCF90 -Wl,-relax "
     else
@@ -20031,7 +20031,7 @@ fi
        # CC_PLAT_OPTIONS is optional, and is used to add CPU specific code generation tuning for Athlon64 presumably Opteron could benefit too but these are not optimized for the Opteron
        CC_PLAT_OPTIONS='-march=athlon64 -mfpmath=sse -msse2 -m3dnow -m64 '
        CC_OPTIONS="-O2 -DNDEBUG -Dlinux -fwritable-strings -DNARROWPROTO $CC_PLAT_OPTIONS"
-       CC_LDFLAGS=$LIEEELIB
+       CC_LDFLAGS="${CC_LDFLAGS} $LIEEELIB"
        CC_PICFLAGS=-fPIC
        # find Fortran compiler
        # g77 already asked and found: good
@@ -20174,7 +20174,7 @@ echo "$as_me: error: Unable to configure
        fi
        FC_OPTIONS="-O $CC_PLAT_OPTIONS"
        FC_OPTIONS_O0=
-       FC_LDFLAGS="$LIEEELIB -ldl -rdynamic -Wl,-relax "
+       FC_LDFLAGS="${FC_LDFLAGS} $LIEEELIB -ldl -rdynamic -Wl,-relax "
        LD=ld
        LD_LDFLAGS="$LIEEELIB  -Wl,-relax "
        if test "$enable_debug" = yes; then
@@ -20192,7 +20192,7 @@ echo "$as_me: error: Unable to configure
     GCC=yes
     CC=gcc
     CC_OPTIONS='-O -DNDEBUG -mieee-with-inexact -Dlinux -fwritable-strings'
-    CC_LDFLAGS='-ldl -rdynamic -mieee-with-inexact'
+    CC_LDFLAGS="${CC_LDFLAGS} -ldl -rdynamic -mieee-with-inexact"
     CC_PICFLAGS=-fPIC
     # find Fortran compiler
     # g77 already asked and found: good
@@ -20333,7 +20333,7 @@ echo "$as_me: error: Unable to configure
     fi
     FC_OPTIONS='-O -mieee-with-inexact'
     FC_OPTIONS_O0='-mieee-with-inexact'
-    FC_LDFLAGS='-ldl -rdynamic -mieee-with-inexact'
+    FC_LDFLAGS="${FC_LDFLAGS} -ldl -rdynamic -mieee-with-inexact"
     LD=ld
     LD_LDFLAGS=
     if test "$enable_debug" = yes; then
@@ -20400,7 +20400,7 @@ fi
     GCC=yes
     CC=gcc
     CC_OPTIONS='-O -DNDEBUG -D_GNU_SOURCE -Dlinux -fwritable-strings'
-    CC_LDFLAGS=$LIEEELIB
+    CC_LDFLAGS="${CC_LDFLAGS} $LIEEELIB"
     CC_PICFLAGS=-fPIC
     # find Fortran compiler
     # g77 already asked and found: good
@@ -20541,7 +20541,7 @@ echo "$as_me: error: Unable to configure
     fi
     FC_OPTIONS=-O
     FC_OPTIONS_O0=
-    FC_LDFLAGS="$LIEEELIB -ldl -rdynamic"
+    FC_LDFLAGS="${FC_LDFLAGS} $LIEEELIB -ldl -rdynamic"
     FC_PICFLAGS=-fPIC
     LD=ld
     LD_LDFLAGS=$LIEEELIB
@@ -20556,7 +20556,7 @@ echo "$as_me: error: Unable to configure
     # standard compilers
     CC=cc
     CC_OPTIONS=-O0 -DNDEBUG
-    CC_LDFLAGS=
+    CC_LDFLAGS="${CC_LDFLAGS}"
     if test "$WITH_G77" != yes; then
       #AC_CHECK_PROG(F77,f77,yes,no)
       for ac_prog in f77 f90 f2c-f77
@@ -20610,7 +20610,7 @@ echo "$as_me: error: Unable to configure
     #FC="$F77"
     FC_OPTIONS='-O0 -fpe1'
     FC_OPTIONS_O0='-O0 -fpe1'
-    FC_LDFLAGS=
+    FC_LDFLAGS="${FC_LDFLAGS}"
     LD=ld
     LD_LDFLAGS=
     if test "$enable_debug" = yes; then
@@ -20641,7 +20641,7 @@ echo "$as_me: error: Unable to configure
     # standard compilers
     CC=cc
     CC_OPTIONS='-O -DNDEBUG -DSYSV -DSVR4'
-    CC_LDFLAGS=
+    CC_LDFLAGS="${CC_LDFLAGS}"
     if test "$WITH_G77" != yes; then
       #AC_CHECK_PROG(F77,f77,yes,no)
       for ac_prog in f77 f90 f2c-f77
@@ -20696,7 +20696,7 @@ echo "$as_me: error: Unable to configure
     FC_OPTIONS='-O '
     FC_OPTIONS_O0=
 
-    FC_LDFLAGS=
+    FC_LDFLAGS="${FC_LDFLAGS}"
     LD=ld
     LD_LDFLAGS=
     if test "$enable_debug" = yes; then
@@ -20728,7 +20728,7 @@ echo "$as_me: error: Unable to configure
     HPPA_OLD=-Dhppa_old
     CC=cc
     CC_OPTIONS='-O -DNDEBUG -DSYSV -Dhpux'
-    CC_LDFLAGS='-Wl,-a,archive'
+    CC_LDFLAGS="${CC_LDFLAGS} -Wl,-a,archive"
     if test "$WITH_G77" != yes; then
       #AC_CHECK_PROG(F77,fort77,yes,no)
       for ac_prog in fort77 f77 f90 f2c-f77
@@ -20782,7 +20782,7 @@ echo "$as_me: error: Unable to configure
     #FC="$F77"
     FC_OPTIONS='-O +Obb1200 +E4'
     FC_OPTIONS_O0='+Obb1200 +E4'
-    FC_LDFLAGS='-Wl,-a,archive'
+    FC_LDFLAGS="${FC_LDFLAGS} -Wl,-a,archive"
     LD=ld
     LD_LDFLAGS='-a archive'
     if test "$enable_debug" = yes; then
@@ -20813,7 +20813,7 @@ echo "$as_me: error: Unable to configure
     # standard compilers
     CC=cc
     CC_OPTIONS='-O -DNDEBUG -DSYSV -Dhpux +Z +DAportable'
-    CC_LDFLAGS='-Wl,+vnocompatwarnings,-E /usr/lib/libdld.sl'
+    CC_LDFLAGS="${CC_LDFLAGS} -Wl,+vnocompatwarnings,-E /usr/lib/libdld.sl"
     if test "$WITH_G77" != yes; then
       #AC_CHECK_PROG(F77,fort77,yes,no)
       for ac_prog in fort77 f77 f90 f2c-f77
@@ -21162,7 +21162,7 @@ ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
     FC_OPTIONS='+O2 +E4 +Z +DAportable'
     FC_OPTIONS_O0='+E4 +Z +DAportable'
-    FC_LDFLAGS='-Wl,+vnocompatwarnings,-E /usr/lib/libdld.sl'
+    FC_LDFLAGS="${FC_LDFLAGS} -Wl,+vnocompatwarnings,-E /usr/lib/libdld.sl"
     LD=ld
     LD_LDFLAGS=
     if test "$enable_debug" = yes; then
@@ -21194,7 +21194,7 @@ ac_compiler_gnu=$ac_cv_c_compiler_gnu
     # standard compilers
     CC=cc
     CC_OPTIONS='-O -DNDEBUG -DSYSV -Dhpux -Dhppa +Z +DAportable'
-    CC_LDFLAGS='-Wl,+vnocompatwarnings,-E /usr/lib/libdld.sl'
+    CC_LDFLAGS="${CC_LDFLAGS} -Wl,+vnocompatwarnings,-E /usr/lib/libdld.sl"
     if test "$WITH_G77" != yes; then
       for ac_prog in fort77 f77 f90 f2c-f77
 do
@@ -21251,7 +21251,7 @@ echo "$as_me: error: Unable to configure
     #AC_F77_LIBRARY_LDFLAGS
     FLIBS='-ldld -lnsl -lU77 -lm'
 
-    FC_LDFLAGS='-Wl,+vnocompatwarnings,-E /usr/lib/libdld.sl'
+    FC_LDFLAGS="${FC_LDFLAGS} -Wl,+vnocompatwarnings,-E /usr/lib/libdld.sl"
     LD=ld
     LD_LDFLAGS=
     if test "$enable_debug" = yes; then
@@ -21308,7 +21308,7 @@ echo "$as_me: error: Unable to configure
       if test "$enable_debug" = yes; then
 	CC_OPTIONS='-mno-cygwin -g -fwritable-strings  -Wall'
       fi
-    CC_LDFLAGS=
+    CC_LDFLAGS="${CC_LDFLAGS}"
     FC=g77
     if test "$WITH_G77" = yes; then
       FC=g77
@@ -21318,7 +21318,7 @@ echo "$as_me: error: Unable to configure
       if test "$enable_debug" = yes; then
         FC_OPTIONS="-g -mno-cygwin"
       fi
-    FC_LDFLAGS=
+    FC_LDFLAGS="${FC_LDFLAGS}"
     if test "$with_f2c" = yes; then
       # ignore with_f2c here
       FC=g77
@@ -21329,17 +21329,17 @@ echo "$as_me: error: Unable to configure
     MAKEFILE_TARGET=Makefile.gcwin32
     ;;
 # FreeBSD  systems (not supported by INRIA)
-  *-*-freebsd*)
+  *-*-freebsd* | *-*-dragonfly*)
      GCC=yes
      CC=gcc
      CC_OPTIONS="${CFLAGS} -Dfreebsd"
-     CC_LDFLAGS=-lm
+     CC_LDFLAGS="${CC_LDFLAGS} -lm"
      CC_PICFLAGS='-fPIC'
      # script shell f77 have bugs, get ours
      FC=f77
      FC_OPTIONS="${CFLAGS} -Dfreebsd"
      FC_OPTIONS_O0='-Dfreebsd'
-     FC_LDFLAGS='-lm -Wl,--export-dynamic'
+     FC_LDFLAGS="${FC_LDFLAGS} -lm -Wl,--export-dynamic"
      FC_PICFLAGS='-fPIC'
      LD=ld
      LD_LDFLAGS=-lm
@@ -22028,7 +22028,7 @@ ac_link='$CC -o conftest$ac_exeext $CFLA
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
     CC_OPTIONS="${CFLAGS} -Dnetbsd"
-    CC_LDFLAGS="${LDFLAGS} -Wl,-R${X11BASE}/lib"
+    CC_LDFLAGS="${CC_LDFLAGS} -Wl,-R${X11BASE}/lib"
     CC_PICFLAGS='-fPIC'
     # check for --export-dynamic
     ac_save_LDFLAGS="$LDFLAGS"
@@ -22591,7 +22591,7 @@ ac_compiler_gnu=$ac_cv_c_compiler_gnu
    FC="$F77"
    FC_OPTIONS="${FFLAGS}"
    FC_OPTIONS_O0=`echo $FC_OPTIONS | sed 's/-O0-9*//g'`
-   FC_LDFLAGS="${LDLAGS} -Wl,-R${X11BASE}/lib"
+   FC_LDFLAGS="${FC_LDFLAGS} -Wl,-R${X11BASE}/lib"
    FC_PICFLAGS='-fPIC'
    # check for --export-dynamic
    ac_save_LDFLAGS="$LDFLAGS"
@@ -22698,13 +22698,13 @@ rm -f conftest.$ac_objext conftest$ac_ex
      GCC=yes
      CC=gcc
      CC_OPTIONS='-no-cpp-precomp -O2 -DNDEBUG -I/sw/include -L/sw/lib'
-     CC_LDFLAGS='-L/sw/lib'
+     CC_LDFLAGS="${CC_LDFLAGS} -L/sw/lib"
      CC_PICFLAGS='-fPIC'
      # script shell f77 have bugs, get ours
      FC=g77
      FC_OPTIONS='-O2'
      FC_OPTIONS_O0=
-     FC_LDFLAGS='-L/sw/lib -ldl -lcc_dynamic'
+     FC_LDFLAGS="${FC_LDFLAGS} -L/sw/lib -ldl -lcc_dynamic"
      FC_PICFLAGS='-fPIC'
      LD=ld
      LD_LDFLAGS=
@@ -24208,7 +24208,8 @@ _ACEOF
 cat confdefs.h >>conftest.$ac_ext
 cat >>conftest.$ac_ext <<_ACEOF
 /* end confdefs.h.  */
-#include <X11/IntrinsicP.h> #include <X11/Xaw3d/ViewportP.h>
+#include <X11/IntrinsicP.h>
+#include <X11/Xaw3d/ViewportP.h>
 int
 main ()
 {
@@ -25800,6 +25801,10 @@ CHK_TCL_MIN=$TCL_MINOR_VERSION
 TCL_LIB_OK=0
   echo "$as_me:$LINENO: checking for tcl library tcl$TCL_MAJOR_VERSION.$TCL_MINOR_VERSION" >&5
 echo $ECHO_N "checking for tcl library tcl$TCL_MAJOR_VERSION.$TCL_MINOR_VERSION... $ECHO_C" >&6
+if test -n "$TCL_CONFIG_SH" ; then  
+	. $TCL_CONFIG_SH
+fi    
+LDFLAGS="$LDFLAGS $TCL_LIBS" 
 dirs="$USER_TCL_LIB_PATH /lib /usr/lib /usr/lib/tcl /usr/lib/tcl8.* /shlib /shlib/tcl /shlib/tcl8.* /usr/shlib /shlib/tcl /usr//shlib/tcl8.* /usr/local/lib /usr/local/lib/tcl /usr/local/lib/tcl8.* /usr/local/shlib /usr/X11/lib/tcl /usr/X11/lib/tcl8.* /usr/lib/X11 /usr/lib/X11/tcl /usr/lib/X11/tcl8.* ../lib ../../lib  /usr/local/tcl /usr/tcl /usr/tcl/lib /usr/local/tcl/lib /sw/lib/ ."
 libexts="so so.1.0 sl dylib a"
 libnames="tcl$CHK_TCL_MAJ.$CHK_TCL_MIN tcl.$CHK_TCL_MAJ.$CHK_TCL_MIN tcl$CHK_TCL_MAJ$CHK_TCL_MIN tcl.$CHK_TCL_MAJ$CHK_TCL_MIN"
@@ -25966,7 +25971,7 @@ fi
 done
 
 			if test $TCL_LIB_OK = 1; then
-				TCLTK_LIBS=" $TCL_LIB $TCLTK_LIBS"
+				TCLTK_LIBS=" $TCL_LIB $TCL_LIBS $TCLTK_LIBS"
 				break;
 			fi
 		fi
@@ -26098,6 +26103,10 @@ TK_LIB_OK=0
 
 echo "$as_me:$LINENO: checking for tk library tk$TK_MAJOR_VERSION.$TK_MINOR_VERSION" >&5
 echo $ECHO_N "checking for tk library tk$TK_MAJOR_VERSION.$TK_MINOR_VERSION... $ECHO_C" >&6
+if test -n "$TK_CONFIG_SH" ; then  
+	. $TK_CONFIG_SH
+fi    
+LDFLAGS="$LDFLAGS $TK_LIBS" 
 dirs="$USER_TK_LIB_PATH /lib /usr/lib /usr/lib/tk /usr/lib/tk8.* /shlib /shlib/tk /shlib/tk8.* /usr/shlib /shlib/tk /usr/shlib/tk8.* /usr/local/lib /usr/local/lib/tk /usr/local/lib/tk8.* /usr/local/shlib /usr/X11/lib/tk /usr/X11/lib/tk8.*  /usr/lib/X11 /usr/lib/X11/tk /usr/lib/X11/tk8.* ../lib ../../lib /usr/tk /usr/local/tk /usr/local/tk/lib /usr/tk/lib /usr/local/tcl /usr/tcl /usr/local/tcl/lib /usr/tcl/lib /sw/lib "
 libexts="so so.1.0 sl dylib a"
 libnames="tk$CHK_TK_MAJ.$CHK_TK_MIN tk.$CHK_TK_MAJ.$CHK_TK_MIN tk$CHK_TK_MAJ$CHK_TK_MIN tk.$CHK_TK_MAJ$CHK_TK_MIN"
@@ -26262,8 +26271,8 @@ fi
 				LDFLAGS="$saved_ldflags"
 				if test $TK_LIB_OK = 1; then
 					if test "$USER_TK_LIB_PATH" = ""
-					then TK_LIB=" -L$PATH_LIB_TK -l$NAME_LIB_TK"
-					else TK_LIB=" -L$USER_TK_LIB_PATH  -l$NAME_LIB_TK"
+					then TK_LIB=" -Wl,--rpath,$PATH_LIB_TL -L$PATH_LIB_TK -l$NAME_LIB_TK"
+					else TK_LIB=" -Wl,--rpath,$PATH_LIB_TL -L$USER_TK_LIB_PATH  -l$NAME_LIB_TK"
 					fi
 					break 3;
 				fi
@@ -26292,7 +26301,7 @@ echo "$as_me: error: header file tk.h  h
         fi
 
   else
-        TCLTK_LIBS=$TK_LIB" $TCLTK_LIBS"
+        TCLTK_LIBS=" $TK_LIB $TCLTK_LIBS"
         WITH_TKSCI=1
   fi
 
@@ -26321,13 +26330,13 @@ case "$host" in
     ;;
 esac
 
-GETLIBTK=libtk$TK_MAJOR_VERSION.$TK_MINOR_VERSION.$SONAME
+GETLIBTK=libtk$TK_MAJOR_VERSION$TK_MINOR_VERSION.$SONAME
 
-case "$host" in
-  *-*-darwin*)
-  GETLIBTK=/sw/lib/libtk$TK_MAJOR_VERSION.$TK_MINOR_VERSION.dylib
-  ;;
-esac
+#case "$host" in
+#  *-*-darwin*)
+#  GETLIBTK=/sw/lib/libtk$TK_MAJOR_VERSION.$TK_MINOR_VERSION.dylib
+#  ;;
+#esac
 
 fi
 
