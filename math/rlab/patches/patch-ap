$NetBSD: patch-ap,v 1.1 2002/10/02 20:56:35 dillo Exp $

--- configure.orig	Wed Oct  2 21:50:59 2002
+++ configure
@@ -38,7 +38,7 @@ ac_help="$ac_help
 ac_help="$ac_help
    --with-pgplot           use PGplot"
 ac_help="$ac_help
-  --disable-GC            disable use of the Garbage-Collector"
+  --with-GC            use the Garbage-Collector"
 
 # Initialize some variables set by options.
 # The variables have the same names as the options, with
@@ -1950,7 +1950,7 @@ echo "configure:1947: checking C -> Fort
   ar r libfitest_f.a fitest_f.o
   OLD_LIBS="$LIBS"
   LIBS="-L. -lfitest_f"  
-  CFLAGS="-DUSE_UPPER"
+  CFLAGS="$CFLAGS -DUSE_UPPER"
 
 
   if test "$cross_compiling" = yes; then
@@ -1982,7 +1982,7 @@ fi
 
 
  if test "$F77CONV" = "no" ; then 
-  CFLAGS="-DUSE_F2C" 
+  CFLAGS="$CFLAGS -DUSE_F2C" 
 if test "$cross_compiling" = yes; then
     { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
@@ -2013,7 +2013,7 @@ fi
  fi 
 
  if test "$F77CONV" = "no" ; then 
-  CFLAGS="-DUSE_LOWER" 
+  CFLAGS="$CFLAGS -DUSE_LOWER" 
 if test "$cross_compiling" = yes; then
     { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
@@ -2044,7 +2044,7 @@ fi
  fi 
 
  if test "$F77CONV" = "no" ; then 
-  CFLAGS="-DUSE_FRONT" 
+  CFLAGS="$CFLAGS -DUSE_FRONT" 
 if test "$cross_compiling" = yes; then
     { echo "configure: error: can not run test program while cross compiling" 1>&2; exit 1; }
 else
@@ -3926,7 +3926,7 @@ fi
 if test -z "$x_libraries" ; then
   xlibdir=""
 else
-  xlibdir="-L$x_libraries"
+  xlibdir="-Wl,-R$x_libraries -L$x_libraries"
 fi
 
 X11LIB="$xlibdir -lX11"
@@ -4025,41 +4025,6 @@ fi
 
 
 
-if test -n "$PLOT_PROG" ; then
-   # Extract the first word of "gnuplot", so it can be a program name with args.
-set dummy gnuplot; ac_word=$2
-echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:4033: checking for $ac_word" >&5
-if eval "test \"`echo '$''{'ac_cv_prog_PLOT_PROG'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
-else
-  if test -n "$PLOT_PROG"; then
-  ac_cv_prog_PLOT_PROG="$PLOT_PROG" # Let the user override the test.
-else
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
-  ac_dummy="$PATH"
-  for ac_dir in $ac_dummy; do
-    test -z "$ac_dir" && ac_dir=.
-    if test -f $ac_dir/$ac_word; then
-      ac_cv_prog_PLOT_PROG="gnuplot"
-      break
-    fi
-  done
-  IFS="$ac_save_ifs"
-  test -z "$ac_cv_prog_PLOT_PROG" && ac_cv_prog_PLOT_PROG="nothing"
-fi
-fi
-PLOT_PROG="$ac_cv_prog_PLOT_PROG"
-if test -n "$PLOT_PROG"; then
-  echo "$ac_t""$PLOT_PROG" 1>&6
-else
-  echo "$ac_t""no" 1>&6
-fi
- 
-fi
-
-
-
 # Check whether --with-plplot or --without-plplot was given.
 if test "${with_plplot+set}" = set; then
   withval="$with_plplot"
@@ -4073,11 +4038,15 @@ if test "${with_plplot+set}" = set; then
     exit 1;
   fi
 
+  cat >> confdefs.h <<\EOF
+#define HAVE_RLAB_PLPLOT 1
+EOF
+
   PLOT_PROG="plplot"
-  PLIB_DIR=-L$withval
+  PLIB_DIR=-L$withval/lib
   PLOT_DIR="$withval"
-  PLIB_INC_DIR="-I$withval"
-  PLIBS="-L$withval -lplplotdX $X11LIB"
+  PLIB_INC_DIR=-I$withval/include
+  PLIBS=`plplot_linkage`
 
 fi
 
@@ -4098,41 +4067,6 @@ fi
 
 
 
-if test "$PLOT_PROG" = "plotmtv" ; then
-   # Extract the first word of "plotmtv", so it can be a program name with args.
-set dummy plotmtv; ac_word=$2
-echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:4106: checking for $ac_word" >&5
-if eval "test \"`echo '$''{'ac_cv_prog_PLOT_PROG'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
-else
-  if test -n "$PLOT_PROG"; then
-  ac_cv_prog_PLOT_PROG="$PLOT_PROG" # Let the user override the test.
-else
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
-  ac_dummy="$PATH"
-  for ac_dir in $ac_dummy; do
-    test -z "$ac_dir" && ac_dir=.
-    if test -f $ac_dir/$ac_word; then
-      ac_cv_prog_PLOT_PROG="plotmtv"
-      break
-    fi
-  done
-  IFS="$ac_save_ifs"
-  test -z "$ac_cv_prog_PLOT_PROG" && ac_cv_prog_PLOT_PROG="nothing"
-fi
-fi
-PLOT_PROG="$ac_cv_prog_PLOT_PROG"
-if test -n "$PLOT_PROG"; then
-  echo "$ac_t""$PLOT_PROG" 1>&6
-else
-  echo "$ac_t""no" 1>&6
-fi
- 
-fi
-
-
-
 # Check whether --with-pgraf or --without-pgraf was given.
 if test "${with_pgraf+set}" = set; then
   withval="$with_pgraf"
@@ -4148,41 +4082,6 @@ fi
 
 
 
-if test "$PLOT_PROG" = "pgraf" ; then
-   # Extract the first word of "pgraf", so it can be a program name with args.
-set dummy pgraf; ac_word=$2
-echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:4156: checking for $ac_word" >&5
-if eval "test \"`echo '$''{'ac_cv_prog_PLOT_PROG'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
-else
-  if test -n "$PLOT_PROG"; then
-  ac_cv_prog_PLOT_PROG="$PLOT_PROG" # Let the user override the test.
-else
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
-  ac_dummy="$PATH"
-  for ac_dir in $ac_dummy; do
-    test -z "$ac_dir" && ac_dir=.
-    if test -f $ac_dir/$ac_word; then
-      ac_cv_prog_PLOT_PROG="pgraf"
-      break
-    fi
-  done
-  IFS="$ac_save_ifs"
-  test -z "$ac_cv_prog_PLOT_PROG" && ac_cv_prog_PLOT_PROG="nothing"
-fi
-fi
-PLOT_PROG="$ac_cv_prog_PLOT_PROG"
-if test -n "$PLOT_PROG"; then
-  echo "$ac_t""$PLOT_PROG" 1>&6
-else
-  echo "$ac_t""no" 1>&6
-fi
- 
-fi
-
-
-
 # Check whether --with-pgplot or --without-pgplot was given.
 if test "${with_pgplot+set}" = set; then
   withval="$with_pgplot"
@@ -4209,27 +4108,22 @@ fi
 
 
 
-# Check whether --enable-GC or --disable-GC was given.
-if test "${enable_GC+set}" = set; then
-  enableval="$enable_GC"
-  if test "$enableval" = "yes" ; then
-               cat >> confdefs.h <<\EOF
-#define HAVE_GC 1
-EOF
- LIBGC="../gc/gc.a"; 
-                                   IGC="-I./gc"
-             fi
-else
+# Check whether --with-GC or --without-GC was given.
+if test "${with_GC+set}" = set; then
+  withval="$with_GC"
   cat >> confdefs.h <<\EOF
 #define HAVE_GC 1
 EOF
- LIBGC="./gc/gc.a";
-                                 IGC="-I./gc"
+
+	     LIBGC="-L$withval/lib -lgc"
+             IGC="-I$withval/include -I./gc"
+
 fi
 
 
+
 cat > conftest.$ac_ext <<EOF
-#line 4233 "configure"
+#line 4127 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 int main() {
@@ -4526,12 +4421,13 @@ s%@CC@%$CC%g
 s%@CPP@%$CPP%g
 s%@PAGER@%$PAGER%g
 s%@ALLOCA@%$ALLOCA%g
 s%@PLOT_PROG@%$PLOT_PROG%g
 s%@BUILD_DIR@%$BUILD_DIR%g
 s%@SYSTEM@%$SYSTEM%g
 s%@VER@%$VER%g
 s%@F2C@%$F2C%g
 s%@INSTALL@%$INSTALL%g
+s%@LDLAGS@%$LDLAGS%g
 s%@EXFLAGS@%$EXFLAGS%g
 s%@C_SH_FLAGS@%$C_SH_FLAGS%g
 s%@F_SH_FLAGS@%$F_SH_FLAGS%g
