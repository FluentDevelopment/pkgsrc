# $NetBSD: Makefile,v 1.10 2002/02/13 18:55:53 jlam Exp $

DISTNAME=	cupsomatic
PKGNAME=	${DISTNAME}-2.2
CATEGORIES=	print
EXTRACT_SUFX=	# empty

# Not sure why ${MASTER_SITE_LOCAL:=${PKGNAME}} doesn't work, but the
# following does the correct substitution.
#
.for subdir in ${PKGNAME}
MASTER_SITES=	${MASTER_SITE_LOCAL:=${subdir}/}
.endfor

# The definitive location of the distfile is at www.linuxprinting.org,
# but this file has no revision number.
#
#MASTER_SITES+=	http://www.linuxprinting.org/

MAINTAINER=	jlam@netbsd.org
HOMEPAGE=	http://www.linuxprinting.org/cups-doc.html
COMMENT=	Foomatic CUPS printer filter

CONFLICTS+=	cupsomatic-200012??

DIST_SUBDIR=	${PKGNAME}

DEPENDS+=	cups>=1.1.10:../../print/cups
DEPENDS+=	foomatic-gswrapper>=1.2:../../print/foomatic-gswrapper
DEPENDS+=	ghostscript{,-nox11}-[6-9]*:../../print/ghostscript
DEPENDS+=	mpage-[0-9]*:../../print/mpage

USE_PERL5=	yes
WRKSRC=		${WRKDIR}
EXTRACT_CMD=	${CP} ${DOWNLOADED_DISTFILE} ${WRKSRC}/${DISTNAME}

FILTERDIR=	${PREFIX}/libexec/cups/filter

do-build:
	cd ${WRKSRC};							\
	for file in cupsomatic; do					\
		${SED}	-e "s|/usr/bin/perl|${PERL5}|g"			\
			-e "s|/usr/local|${LOCALBASE}|g"		\
			-e "s|/etc/foomatic|${PKG_SYSCONFDIR}/foomatic|g" \
			$${file} > $${file}.fixed;			\
		${MV} $${file}.fixed $${file};				\
	done

do-install:
	cd ${WRKSRC};							\
	for file in cupsomatic; do					\
		${INSTALL_SCRIPT} ${WRKSRC}/$${file} ${FILTERDIR};	\
	done

.include "../../mk/bsd.pkg.mk"
