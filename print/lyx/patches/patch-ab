$NetBSD: patch-ab,v 1.4 2002/08/23 09:08:09 martti Exp $

Avoid the following error with gcc-2.95.3 (NetBSD-1.5ZC-m68k):

    c++ -DHAVE_CONFIG_H -I. -I. -I. -I.. -I.. -I../boost   -I/usr/X11R6/include
	-I/usr/X11R6/include/X11   -isystem /usr/X11R6/include  -O2 -c lyxfunc.C
    lyxfunc.C: In method `const class string LyXFunc::Dispatch(int, const string & = string())':
    lyxfunc.C:3027: Internal compiler error.
    lyxfunc.C:3027: Please submit a full bug report.
    lyxfunc.C:3027: See <URL:http://www.gnu.org/software/gcc/bugs.html> for instructions.
    *** Error code 1

    Stop.
    make: stopped in /t/pkgobj/print/lyx/work.m68k/lyx-1.1.6fix4/src
    [and so on]

Line 3027 is a single close bracket, the end of a switch statement that starts
on line 675. Increasing the process stack size to 32768 didn't help.


Also avoid a c++ bug with gcc-2.95.3 on alpha where the assembler runs for ever and never
finishes

--- src/Makefile.in.orig	Tue Aug 20 12:10:20 2002
+++ src/Makefile.in	Thu Aug 22 14:07:44 2002
@@ -549,6 +549,11 @@
 @AMDEP_TRUE@	$(DEPDIR)/undo_funcs.Po $(DEPDIR)/undostack.Po \
 @AMDEP_TRUE@	$(DEPDIR)/vc-backend.Po $(DEPDIR)/version.Po \
 @AMDEP_TRUE@	$(DEPDIR)/vspace.Po
+CXXCOMPILE_NOOPT = $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) \
+	$(AM_CPPFLAGS) $(CPPFLAGS_NOOPT) $(AM_CXXFLAGS) $(CXXFLAGS_NOOPT)
+LTCXXCOMPILE_NOOPT = $(LIBTOOL) --mode=compile $(CXX) $(DEFS) \
+	$(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS_NOOPT) \
+	$(AM_CXXFLAGS) $(CXXFLAGS_NOOPT)
 CXXCOMPILE = $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) \
 	$(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS)
 LTCXXCOMPILE = $(LIBTOOL) --mode=compile $(CXX) $(DEFS) \
@@ -559,6 +564,8 @@
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 CXXFLAGS = @CXXFLAGS@
 CFLAGS = @CFLAGS@
+CPPFLAGS_NOOPT = $(CPPFLAGS:C/-O[0-9]*//)
+CXXFLAGS_NOOPT = $(CXXFLAGS:C/-O[0-9]*//)
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 LTCOMPILE = $(LIBTOOL) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) \
@@ -580,8 +587,15 @@
 all: $(BUILT_SOURCES) config.h
 	$(MAKE) $(AM_MAKEFLAGS) all-recursive
 
+buffer.o: buffer.cc
+buffer.lo: buffer.cc
+lyxfunc.o: lyxfunc.cc
+lyxfunc.lo: lyxfunc.cc
+tex-accent.o: tex-accent.cc
+tex-accent.lo: tex-accent.cc
+
 .SUFFIXES:
-.SUFFIXES: .C .lo .o .obj
+.SUFFIXES: .C .cc .lo .o .obj
 
 mostlyclean-libtool:
 	-rm -f *.lo
@@ -753,6 +767,14 @@
 
 distclean-depend:
 	-rm -rf $(DEPDIR)
+.C.cc:
+	cp -f $< $@
+
+.cc.o:
+@AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+	$(CXXCOMPILE_NOOPT) -c -o $@ `test -f $< || echo '$(srcdir)/'`$<
 
 .C.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -765,6 +787,12 @@
 @AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
 @AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 	$(CXXCOMPILE) -c -o $@ `cygpath -w $<`
+
+.cc.lo:
+@AMDEP_TRUE@	source='$<' object='$@' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@	depfile='$(DEPDIR)/$*.Plo' tmpdepfile='$(DEPDIR)/$*.TPlo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+	$(LTCXXCOMPILE_NOOPT) -c -o $@ `test -f $< || echo '$(srcdir)/'`$<
 
 .C.lo:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=yes @AMDEPBACKSLASH@
