$NetBSD: patch-am,v 1.4 2004/07/19 22:41:16 dmcmahill Exp $

--- xep/Makefile.aimk.orig	Fri Aug 29 14:17:48 1997
+++ xep/Makefile.aimk	Thu Mar 25 03:16:56 2004
@@ -22,9 +22,8 @@
 #CFLOPTS	=	-O
 CFLOPTS		=	-g
-CFLAGS		=	$(CFLOPTS) -I$(PVMIDIR) -L$(PVMLDIR) $(ARCHCFLAGS)
+CFLAGS		=	$(CFLOPTS) -I$(PVMIDIR) $(ARCHCFLAGS)
 LIBS		=	-l$(PVMLIB) $(ARCHLIB) $(OS2XEPLIBS)
-XLIBS		=	-lXaw -lXmu -lXext -lXt -lX11
-XCFLAGS		=	-I/usr/local/X11R5/include -I/usr/local/X11/include \
-				-L/usr/local/X11R5/lib -L/usr/local/X11/lib
+XLIBS		=	-L${X11BASE}/lib -Wl,${RPATH_FLAG}$(X11BASE)/lib -lXaw -lXmu -lXext -lXt -lX11
+XCFLAGS		=	-I${X11BASE}/include 
 
 HEADERS		=	$(SDIR)/hostc.h $(SDIR)/imp.h $(SDIR)/myalloc.h \
@@ -39,16 +38,23 @@
 	- mkdir $(XDIR)
 
+LTCC=		$(LIBTOOL) --mode=compile $(CC)
+LTCC_LINK=	$(LIBTOOL) --mode=link $(CC) ${PVM_STATIC} -L$(PVMLDIR) 
+
 mmain$(EXESFX):	$(SDIR)/mmain.c $(XDIR) $(PVMLIBDEP)
-	$(CC) $(CFLAGS) -o $@ $(SDIR)/mmain.c $(LIBS)
-	mv $@ $(XDIR)
+	$(LTCC_LINK) $(CFLAGS) -o $@ $(SDIR)/mmain.c $(LIBS)
+	cp $@ $(XDIR)
 
 mtile$(EXESFX):	$(SDIR)/mtile.c $(XDIR) $(PVMLIBDEP)
-	$(CC) $(CFLAGS) -o $@ $(SDIR)/mtile.c $(LIBS) -lm
-	mv $@ $(XDIR)
+	$(LTCC_LINK) $(CFLAGS) -o $@ $(SDIR)/mtile.c $(LIBS) -lm
+	${MKDIR} $(XDIR)/.libs
+	-cp .libs/$@ $(XDIR)/.libs
+	cp $@ $(XDIR)
 
 xep$(EXESFX):	xep.o hostc.o calc.o imp.o $(XDIR) $(PVMLIBDEP)
-	$(CC) $(XCFLAGS) $(CFLAGS) -o $@ xep.o calc.o imp.o hostc.o \
+	$(LTCC_LINK) $(XCFLAGS) $(CFLAGS) -o $@ xep.lo calc.lo imp.lo hostc.lo \
 		$(XLIBS) $(LIBS) -lm
-	mv $@ $(XDIR)
+	${MKDIR} $(XDIR)/.libs
+	-cp .libs/$@ $(XDIR)/.libs
+	cp $@ $(XDIR)
 
 clean:
@@ -56,13 +62,13 @@
 
 xep.o:	$(SDIR)/xep.c $(HEADERS)
-	$(CC) $(XCFLAGS) $(CFLAGS) -c $(SDIR)/xep.c
+	$(LTCC) $(XCFLAGS) $(CFLAGS) -c $(SDIR)/xep.c
 
 imp.o:	$(SDIR)/imp.c $(HEADERS)
-	$(CC) $(XCFLAGS) $(CFLAGS) -c $(SDIR)/imp.c
+	$(LTCC) $(XCFLAGS) $(CFLAGS) -c $(SDIR)/imp.c
 
 calc.o:	$(SDIR)/calc.c $(HEADERS)
-	$(CC) $(XCFLAGS) $(CFLAGS) -c $(SDIR)/calc.c
+	$(LTCC) $(XCFLAGS) $(CFLAGS) -c $(SDIR)/calc.c
 
 hostc.o:	$(SDIR)/hostc.c $(HEADERS)
-	$(CC) $(XCFLAGS) $(CFLAGS) -c $(SDIR)/hostc.c
+	$(LTCC) $(XCFLAGS) $(CFLAGS) -c $(SDIR)/hostc.c
 
