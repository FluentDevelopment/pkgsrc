$NetBSD: patch-br,v 1.1 2004/07/19 22:41:16 dmcmahill Exp $

--- tracer/Makefile.aimk.orig	Thu Oct  1 21:13:24 1998
+++ tracer/Makefile.aimk	Wed Mar 24 18:26:39 2004
@@ -24,4 +24,5 @@
 
 CFLAGS		=	$(CFLOPTS) $(PVMVERSION) -DIMA_$(PVM_ARCH) $(ARCHCFLAGS)
+LTCC=	${LIBTOOL} --mode=compile ${CC}
 
 
@@ -107,30 +108,34 @@
 
 $(PVMXDIR)/tracer$(EXESFX):  tracer$(EXESFX)
-	@ cp tracer$(EXESFX) $(PVMXDIR)
+	${MKDIR} $(PVMXDIR)/.libs
+	-cp .libs/tracer$(EXESFX) $(PVMXDIR)/.libs
+	cp tracer$(EXESFX) $(PVMXDIR)
 
 $(PVMXDIR)/trcsort$(EXESFX):  trcsort$(EXESFX)
-	@ cp trcsort$(EXESFX) $(PVMXDIR)
+	${MKDIR} $(PVMXDIR)/.libs
+	-cp .libs/trcsort$(EXESFX) $(PVMXDIR)/.libs
+	cp trcsort$(EXESFX) $(PVMXDIR)
 
 local:  tracer$(EXESFX) trcsort$(EXESFX)
 
 tracer$(EXESFX):  $(OBJS) $(TRCLIBDEP) $(PVMLIBDEP)
-	$(CC) $(CFLAGS) -o $@ $(OBJS) $(LIBS)
+	${LIBTOOL} --mode=link $(CC) ${PVM_STATIC} $(CFLAGS) -o $@ $(OBJS) $(LIBS)
 
 objs:  $(OBJS)
 
 trcsort$(EXESFX):  trcsort.o $(TRCLIBDEP) $(PVMLIBDEP)
-	$(CC) $(CFLAGS) -o $@ trcsort.o $(LIBS)
+	${LIBTOOL} --mode=link $(CC) ${PVM_STATIC} $(CFLAGS) -o $@ trcsort.lo $(LIBS)
 
 trcsort.o:  $(SRCDIR)/trcsort.c
-	$(CC) $(CFLAGS) -c $(INCL) $(SRCDIR)/trcsort.c
+	$(LTCC) $(CFLAGS) -c $(INCL) $(SRCDIR)/trcsort.c
 
 $(TRCLIBDEP):  $(LIBPVMTRC)
-	@ cp $(LIBPVMTRC) $(PVMLDIR)
+	${MKDIR} $(PVMLDIR)/.libs
+	-cp .libs/* $(PVMLDIR)/.libs
+	cp $(LIBPVMTRC:.a=.*) $(PVMLDIR)
 
 $(LIBPVMTRC):  $(TRCOBJS) $(PVMLDIR)
-	$(AR) rcv $(LIBPVMTRC) $(TRCOBJS)
-	@ case x$(HASRANLIB) in \
-		xt ) echo "ranlib $(LIBPVMTRC)"; ranlib $(LIBPVMTRC) ;; \
-		xf ) echo "No Ranlib Necessary." ;; esac
+	${LIBTOOL} --mode=link ${CC} ${PVM_STATIC} -o ${.TARGET:.a=.la} ${TRCOBJS:.o=.lo} \
+		-rpath ${PVM_DIR}/lib/$(PVM_ARCH)  -version-info ${PVMLIB_VER}
 
 $(PVMXDIR):
@@ -157,13 +162,13 @@
 tracer.o:  $(SRCDIR)/tracer.c $(HEADERS)
 	@ touch tracer.o
-	$(CC) $(CFLAGS) -c $(INCL) $(SRCDIR)/tracer.c
+	$(LTCC) $(CFLAGS) -c $(INCL) $(SRCDIR)/tracer.c
 
 cmd.o:  $(SRCDIR)/cmd.c $(HEADERS)
 	@ touch cmd.o
-	$(CC) $(CFLAGS) -c $(INCL) $(SRCDIR)/cmd.c
+	$(LTCC) $(CFLAGS) -c $(INCL) $(SRCDIR)/cmd.c
 
 trcglob.o:  $(SRCDIR)/trcglob.c $(HEADERS)
 	@ touch trcglob.o
-	$(CC) $(CFLAGS) -c $(INCL) $(SRCDIR)/trcglob.c
+	$(LTCC) $(CFLAGS) -c $(INCL) $(SRCDIR)/trcglob.c
 
 
@@ -174,24 +179,24 @@
 trcmess.o:  $(TRCDIR)/trcmess.c $(TRCHEADERS)
 	@ touch trcmess.o
-	$(CC) $(CFLAGS) -c $(INCL) $(TRCDIR)/trcmess.c
+	$(LTCC) $(CFLAGS) -c $(INCL) $(TRCDIR)/trcmess.c
 
 trcfile.o:  $(TRCDIR)/trcfile.c $(TRCHEADERS)
 	@ touch trcfile.o
-	$(CC) $(CFLAGS) -c $(INCL) $(TRCDIR)/trcfile.c
+	$(LTCC) $(CFLAGS) -c $(INCL) $(TRCDIR)/trcfile.c
 
 trccompat.o:  $(TRCDIR)/trccompat.c $(TRCHEADERS)
 	@ touch trccompat.o
-	$(CC) $(CFLAGS) -c $(INCL) $(TRCDIR)/trccompat.c
+	$(LTCC) $(CFLAGS) -c $(INCL) $(TRCDIR)/trccompat.c
 
 trccompatglob.o:  $(TRCDIR)/trccompatglob.c $(TRCHEADERS)
 	@ touch trccompatglob.o
-	$(CC) $(CFLAGS) -c $(INCL) $(TRCDIR)/trccompatglob.c
+	$(LTCC) $(CFLAGS) -c $(INCL) $(TRCDIR)/trccompatglob.c
 
 trcutil.o:  $(TRCDIR)/trcutil.c $(TRCHEADERS)
 	@ touch trcutil.o
-	$(CC) $(CFLAGS) -c $(INCL) $(TRCDIR)/trcutil.c
+	$(LTCC) $(CFLAGS) -c $(INCL) $(TRCDIR)/trcutil.c
 
 trclib.o:  $(TRCDIR)/trclib.c $(TRCHEADERS)
 	@ touch trclib.o
-	$(CC) $(CFLAGS) -c $(INCL) $(TRCDIR)/trclib.c
+	$(LTCC) $(CFLAGS) -c $(INCL) $(TRCDIR)/trclib.c
 
