$NetBSD: patch-aa,v 1.4 2002/03/23 15:29:00 magick Exp $

--- PilotMgr.pm.orig	Wed Mar 24 23:59:59 1999
+++ PilotMgr.pm
@@ -604,14 +604,18 @@
     my ($image);
 
     my (@TTYMENU) =
-	("/dev/ttya", [],
-	 "/dev/ttyb", [],
-	 "/dev/cua/a", [],
-	 "/dev/cua/b", [],
-	 "/dev/cua0", [],
-	 "/dev/cua1", [],
-	 "/dev/cua2", [],
-	 "/dev/cua3", [],
+	("/dev/tty00", [],
+	 "/dev/tty01", [],
+	 "/dev/tty02", [],
+	 "/dev/tty03", [],
+	 "/dev/ttyA0", [],
+	 "/dev/ttyA1", [],
+	 "/dev/ttyB0", [],
+	 "/dev/ttyB1", [],
+	 "/dev/ttyC0", [],
+	 "/dev/ttyC1", [],
+	 "/dev/ttyD0", [],
+	 "/dev/ttyD1", [],
 	 "/dev/pilot", [],
 	 "Other...", []);
 
@@ -1586,7 +1590,7 @@
 	do "$RCFILE";
     }
 
-    $PREFS->{'gPort'} = '/dev/ttya'
+    $PREFS->{'gPort'} = '/dev/pilot'
 	unless (exists $PREFS->{'gPort'});
     $PREFS->{'gRate'} = '9600'
 	unless (exists $PREFS->{'gRate'});
@@ -2636,7 +2640,7 @@
 
     $mon++;
     return sprintf("%02d/%02d/%02d %2d:%02d:%02d",
-		   $mon, $mday, $year, $hour, $min, $sec);
+		   $mon, $mday, 1900 + $year, $hour, $min, $sec);
 }
 
 sub loadDBList
@@ -2656,14 +2660,17 @@
 	$count_max = 0;
     }
 
-    do
-    {
-	status("Refreshing Database List", int(100 * $count++ / $count_max))
-	    if ($count_max);
-	push(@$result, $dlp->getDBInfo($i,1,0));
-	$i = $result->[-1]->{"index"}+1;
+    my $rec;
+    eval { do
+     {
+      status("Refreshing Database List", int(100 * $count++ / $count_max))
+	if ($count_max);
+      $rec = $dlp->getDBInfo($i,1,0);
+      push(@$result, $rec) if (exists $rec->{"name"} and $rec->{"name"});
+      $i = $rec->{"index"}+1;
     }
-    while ($result->[-1]->{"more"});
+    while ($rec->{"more"}); };
+
 
     fullStatus("Pilot Manager", "Refreshing Database List", 100);
 
