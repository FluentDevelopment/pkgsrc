$NetBSD: patch-aj,v 1.3 2003/03/11 13:22:32 markd Exp $

--- klaptopdaemon/Makefile.am.orig	Mon Sep 16 09:16:37 2002
+++ klaptopdaemon/Makefile.am
@@ -1,16 +1,20 @@
-lib_LTLIBRARIES = klaptopdaemon.la
+lib_LTLIBRARIES = libklaptopdaemon_main.la klaptopdaemon.la
 kde_module_LTLIBRARIES = kcm_laptop.la
 bin_PROGRAMS = klaptopdaemon
 SUBDIRS = pics applnk
 
-klaptopdaemon_la_SOURCES = laptop_daemon.cpp kpcmcia.cpp \
+libklaptopdaemon_main_la_SOURCES = laptop_daemon.cpp kpcmcia.cpp \
 	kpcmciainfo.cpp daemondock.cpp notify.cpp portable.cpp acpi_config.cpp
+libklaptopdaemon_main_la_LDFLAGS = $(all_libraries)
+libklaptopdaemon_main_la_LIBADD   = $(LIB_KDEUI)
+
+klaptopdaemon_la_SOURCES = klaptopdaemon_main.cpp
 klaptopdaemon_la_LDFLAGS = $(all_libraries) -module -avoid-version
-klaptopdaemon_la_LIBADD   = $(LIB_KDEUI)
+klaptopdaemon_la_LIBADD   = libklaptopdaemon_main.la
 
-klaptopdaemon_SOURCES = dummy.cpp
+klaptopdaemon_SOURCES = klaptopdaemon_main.cpp
 klaptopdaemon_LDFLAGS = $(all_libraries)
-klaptopdaemon_LDADD = klaptopdaemon.la
+klaptopdaemon_LDADD = libklaptopdaemon_main.la
 
 kcm_laptop_la_SOURCES = battery.cpp main.cpp pcmcia.cpp power.cpp warning.cpp \
 	portable.cpp acpi_config.cpp
@@ -19,13 +23,10 @@ kcm_laptop_la_LIBADD = $(LIB_KFILE)
 
 INCLUDES= $(all_includes)
 
-LDFLAGS = $(all_libraries) $(KDE_RPATH) -export-dynamic
+LDFLAGS = $(all_libraries) $(KDE_RPATH) $(EXPORT_SYMBOLS_LDFLAGS)
 
 kcm_laptop_la_METASOURCES = AUTO
 
 messages:
 	$(XGETTEXT) $(klaptopdaemon_la_SOURCES) -o $(podir)/klaptopdaemon.pot
 	$(XGETTEXT) $(kcm_laptop_la_SOURCES) -o $(podir)/kcmlaptop.pot
-
-dummy.cpp:
-	echo >dummy.cpp
