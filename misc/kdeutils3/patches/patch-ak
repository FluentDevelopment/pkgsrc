$NetBSD: patch-ak,v 1.7 2004/01/15 11:12:40 markd Exp $

--- klaptopdaemon/Makefile.in.orig	2003-12-29 11:33:18.000000000 +1300
+++ klaptopdaemon/Makefile.in
@@ -91,7 +91,7 @@ KDE_USE_FINAL_FALSE = @KDE_USE_FINAL_FAL
 KDE_USE_FINAL_TRUE = @KDE_USE_FINAL_TRUE@
 KDE_XSL_STYLESHEET = @KDE_XSL_STYLESHEET@
 
-LDFLAGS = $(all_libraries) $(KDE_RPATH) -export-dynamic
+LDFLAGS = $(all_libraries) $(KDE_RPATH) $(EXPORT_SYMBOLS_LDFLAGS)
 LIBCOMPAT = @LIBCOMPAT@
 LIBCRYPT = @LIBCRYPT@
 LIBDL = @LIBDL@
@@ -272,20 +272,24 @@ target_os = @target_os@
 target_vendor = @target_vendor@
 x_includes = @x_includes@
 x_libraries = @x_libraries@
-lib_LTLIBRARIES = klaptopdaemon.la
+lib_LTLIBRARIES = libklaptopdaemon_main.la klaptopdaemon.la
 kde_module_LTLIBRARIES = kcm_laptop.la
 bin_PROGRAMS = klaptopdaemon
 SUBDIRS = pics applnk
 
-klaptopdaemon_la_SOURCES = laptop_daemon.cpp kpcmcia.cpp \
+libklaptopdaemon_main_la_SOURCES = laptop_daemon.cpp kpcmcia.cpp \
 	kpcmciainfo.cpp daemondock.cpp notify.cpp portable.cpp acpi_config.cpp
 
+libklaptopdaemon_main_la_LDFLAGS = $(all_libraries)
+libklaptopdaemon_main_la_LIBADD = $(LIB_KDEUI)
+
+klaptopdaemon_la_SOURCES = klaptopdaemon_main.cpp
 klaptopdaemon_la_LDFLAGS = $(all_libraries) -module -avoid-version
-klaptopdaemon_la_LIBADD = $(LIB_KDEUI)
+klaptopdaemon_la_LIBADD = libklaptopdaemon_main.la
 
-klaptopdaemon_SOURCES = dummy.cpp
+klaptopdaemon_SOURCES = klaptopdaemon_main.cpp
 klaptopdaemon_LDFLAGS = $(all_libraries)
-klaptopdaemon_LDADD = klaptopdaemon.la
+klaptopdaemon_LDADD = libklaptopdaemon_main.la
 
 kcm_laptop_la_SOURCES = battery.cpp main.cpp pcmcia.cpp power.cpp warning.cpp \
 	portable.cpp acpi_config.cpp
@@ -313,49 +317,60 @@ kcm_laptop_la_nofinal_OBJECTS = battery.
 	warning.lo portable.lo acpi_config.lo
 @KDE_USE_FINAL_FALSE@kcm_laptop_la_OBJECTS = $(kcm_laptop_la_nofinal_OBJECTS)
 @KDE_USE_FINAL_TRUE@kcm_laptop_la_OBJECTS = $(kcm_laptop_la_final_OBJECTS)
-klaptopdaemon_la_DEPENDENCIES =
-am_klaptopdaemon_la_OBJECTS = laptop_daemon.lo kpcmcia.lo kpcmciainfo.lo \
-	daemondock.lo notify.lo portable.lo acpi_config.lo
+klaptopdaemon_la_DEPENDENCIES = libklaptopdaemon_main.la
+am_klaptopdaemon_la_OBJECTS = klaptopdaemon_main.lo
 #>- klaptopdaemon_la_OBJECTS = $(am_klaptopdaemon_la_OBJECTS)
-#>+ 5
-klaptopdaemon_la_final_OBJECTS = klaptopdaemon_la.all_cpp.lo 
-klaptopdaemon_la_nofinal_OBJECTS = laptop_daemon.lo kpcmcia.lo kpcmciainfo.lo \
-	daemondock.lo notify.lo portable.lo acpi_config.lo
-@KDE_USE_FINAL_FALSE@klaptopdaemon_la_OBJECTS = $(klaptopdaemon_la_nofinal_OBJECTS)
-@KDE_USE_FINAL_TRUE@klaptopdaemon_la_OBJECTS = $(klaptopdaemon_la_final_OBJECTS)
+#>+ 1
+klaptopdaemon_la_OBJECTS = klaptopdaemon_main.lo
+libklaptopdaemon_main_la_DEPENDENCIES =
+am_libklaptopdaemon_main_la_OBJECTS = laptop_daemon.lo kpcmcia.lo \
+	kpcmciainfo.lo daemondock.lo notify.lo portable.lo \
+	acpi_config.lo
+#>- libklaptopdaemon_main_la_OBJECTS = \
+#>- 	$(am_libklaptopdaemon_main_la_OBJECTS)
+#>+ 6
+libklaptopdaemon_main_la_final_OBJECTS = libklaptopdaemon_main_la.all_cpp.lo 
+libklaptopdaemon_main_la_nofinal_OBJECTS = laptop_daemon.lo kpcmcia.lo \
+	kpcmciainfo.lo daemondock.lo notify.lo portable.lo \
+	acpi_config.lo
+@KDE_USE_FINAL_FALSE@libklaptopdaemon_main_la_OBJECTS = $(libklaptopdaemon_main_la_nofinal_OBJECTS)
+@KDE_USE_FINAL_TRUE@libklaptopdaemon_main_la_OBJECTS = $(libklaptopdaemon_main_la_final_OBJECTS)
 bin_PROGRAMS = klaptopdaemon$(EXEEXT)
 PROGRAMS = $(bin_PROGRAMS)
 
-am_klaptopdaemon_OBJECTS = dummy.$(OBJEXT)
+am_klaptopdaemon_OBJECTS = klaptopdaemon_main.$(OBJEXT)
 #>- klaptopdaemon_OBJECTS = $(am_klaptopdaemon_OBJECTS)
 #>+ 1
-klaptopdaemon_OBJECTS = dummy.$(OBJEXT)
-klaptopdaemon_DEPENDENCIES = klaptopdaemon.la
+klaptopdaemon_OBJECTS = klaptopdaemon_main.$(OBJEXT)
+klaptopdaemon_DEPENDENCIES = libklaptopdaemon_main.la
 
 DEFAULT_INCLUDES =  -I. -I$(srcdir) -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/admin/depcomp
 am__depfiles_maybe = depfiles
 #>- @AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/acpi_config.Plo \
 #>- @AMDEP_TRUE@	./$(DEPDIR)/battery.Plo ./$(DEPDIR)/daemondock.Plo \
-#>- @AMDEP_TRUE@	./$(DEPDIR)/dummy.Po ./$(DEPDIR)/kpcmcia.Plo \
-#>- @AMDEP_TRUE@	./$(DEPDIR)/kpcmciainfo.Plo \
+#>- @AMDEP_TRUE@	./$(DEPDIR)/klaptopdaemon_main.Plo \
+#>- @AMDEP_TRUE@	./$(DEPDIR)/klaptopdaemon_main.Po \
+#>- @AMDEP_TRUE@	./$(DEPDIR)/kpcmcia.Plo ./$(DEPDIR)/kpcmciainfo.Plo \
 #>- @AMDEP_TRUE@	./$(DEPDIR)/laptop_daemon.Plo ./$(DEPDIR)/main.Plo \
 #>- @AMDEP_TRUE@	./$(DEPDIR)/notify.Plo ./$(DEPDIR)/pcmcia.Plo \
 #>- @AMDEP_TRUE@	./$(DEPDIR)/portable.Plo ./$(DEPDIR)/power.Plo \
 #>- @AMDEP_TRUE@	./$(DEPDIR)/warning.Plo
-#>+ 17
-@AMDEP_TRUE@@KDE_USE_FINAL_TRUE@DEP_FILES =   $(DEPDIR)/kcm_laptop_la.all_cpp.P $(DEPDIR)/klaptopdaemon_la.all_cpp.P  ./$(DEPDIR)/acpi_config.Plo \
+#>+ 19
+@AMDEP_TRUE@@KDE_USE_FINAL_TRUE@DEP_FILES =   $(DEPDIR)/kcm_laptop_la.all_cpp.P $(DEPDIR)/libklaptopdaemon_main_la.all_cpp.P  ./$(DEPDIR)/acpi_config.Plo \
 @AMDEP_TRUE@@KDE_USE_FINAL_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/battery.Plo ./$(DEPDIR)/daemondock.Plo \
-@AMDEP_TRUE@@KDE_USE_FINAL_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/dummy.Po ./$(DEPDIR)/kpcmcia.Plo \
-@AMDEP_TRUE@@KDE_USE_FINAL_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/kpcmciainfo.Plo \
+@AMDEP_TRUE@@KDE_USE_FINAL_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/klaptopdaemon_main.Plo \
+@AMDEP_TRUE@@KDE_USE_FINAL_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/klaptopdaemon_main.Po \
+@AMDEP_TRUE@@KDE_USE_FINAL_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/kpcmcia.Plo ./$(DEPDIR)/kpcmciainfo.Plo \
 @AMDEP_TRUE@@KDE_USE_FINAL_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/laptop_daemon.Plo ./$(DEPDIR)/main.Plo \
 @AMDEP_TRUE@@KDE_USE_FINAL_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/notify.Plo ./$(DEPDIR)/pcmcia.Plo \
 @AMDEP_TRUE@@KDE_USE_FINAL_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/portable.Plo ./$(DEPDIR)/power.Plo \
 @AMDEP_TRUE@@KDE_USE_FINAL_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/warning.Plo
 @AMDEP_TRUE@@KDE_USE_FINAL_FALSE@DEP_FILES =   ./$(DEPDIR)/acpi_config.Plo \
 @AMDEP_TRUE@@KDE_USE_FINAL_FALSE@	@AMDEP_TRUE@	./$(DEPDIR)/battery.Plo ./$(DEPDIR)/daemondock.Plo \
-@AMDEP_TRUE@@KDE_USE_FINAL_FALSE@	@AMDEP_TRUE@	./$(DEPDIR)/dummy.Po ./$(DEPDIR)/kpcmcia.Plo \
-@AMDEP_TRUE@@KDE_USE_FINAL_FALSE@	@AMDEP_TRUE@	./$(DEPDIR)/kpcmciainfo.Plo \
+@AMDEP_TRUE@@KDE_USE_FINAL_FALSE@	@AMDEP_TRUE@	./$(DEPDIR)/klaptopdaemon_main.Plo \
+@AMDEP_TRUE@@KDE_USE_FINAL_FALSE@	@AMDEP_TRUE@	./$(DEPDIR)/klaptopdaemon_main.Po \
+@AMDEP_TRUE@@KDE_USE_FINAL_FALSE@	@AMDEP_TRUE@	./$(DEPDIR)/kpcmcia.Plo ./$(DEPDIR)/kpcmciainfo.Plo \
 @AMDEP_TRUE@@KDE_USE_FINAL_FALSE@	@AMDEP_TRUE@	./$(DEPDIR)/laptop_daemon.Plo ./$(DEPDIR)/main.Plo \
 @AMDEP_TRUE@@KDE_USE_FINAL_FALSE@	@AMDEP_TRUE@	./$(DEPDIR)/notify.Plo ./$(DEPDIR)/pcmcia.Plo \
 @AMDEP_TRUE@@KDE_USE_FINAL_FALSE@	@AMDEP_TRUE@	./$(DEPDIR)/portable.Plo ./$(DEPDIR)/power.Plo \
@@ -380,7 +395,7 @@ CXXLD = $(CXX)
 CXXLINK = $(LIBTOOL) --mode=link --tag=CXX $(CXXLD) $(AM_CXXFLAGS) $(CXXFLAGS) $(KDE_CXXFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 DIST_SOURCES = $(kcm_laptop_la_SOURCES) $(klaptopdaemon_la_SOURCES) \
-	$(klaptopdaemon_SOURCES)
+	$(libklaptopdaemon_main_la_SOURCES) $(klaptopdaemon_SOURCES)
 
 RECURSIVE_TARGETS = info-recursive dvi-recursive pdf-recursive \
 	ps-recursive install-info-recursive uninstall-info-recursive \
@@ -389,7 +404,7 @@ RECURSIVE_TARGETS = info-recursive dvi-r
 	check-recursive installcheck-recursive
 DIST_COMMON = README Makefile.am Makefile.in
 DIST_SUBDIRS = $(SUBDIRS)
-SOURCES = $(kcm_laptop_la_SOURCES) $(klaptopdaemon_la_SOURCES) $(klaptopdaemon_SOURCES)
+SOURCES = $(kcm_laptop_la_SOURCES) $(klaptopdaemon_la_SOURCES) $(libklaptopdaemon_main_la_SOURCES) $(klaptopdaemon_SOURCES)
 
 #>- all: all-recursive
 #>+ 1
@@ -469,6 +484,8 @@ clean-libLTLIBRARIES:
 	$(CXXLINK) -rpath $(kde_moduledir) $(kcm_laptop_la_LDFLAGS) $(kcm_laptop_la_OBJECTS) $(kcm_laptop_la_LIBADD) $(LIBS)
 klaptopdaemon.la: $(klaptopdaemon_la_OBJECTS) $(klaptopdaemon_la_DEPENDENCIES) 
 	$(CXXLINK) -rpath $(libdir) $(klaptopdaemon_la_LDFLAGS) $(klaptopdaemon_la_OBJECTS) $(klaptopdaemon_la_LIBADD) $(LIBS)
+libklaptopdaemon_main.la: $(libklaptopdaemon_main_la_OBJECTS) $(libklaptopdaemon_main_la_DEPENDENCIES) 
+	$(CXXLINK) -rpath $(libdir) $(libklaptopdaemon_main_la_LDFLAGS) $(libklaptopdaemon_main_la_OBJECTS) $(libklaptopdaemon_main_la_LIBADD) $(LIBS)
 binPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
 install-binPROGRAMS: $(bin_PROGRAMS)
 	@$(NORMAL_INSTALL)
@@ -511,7 +528,8 @@ distclean-compile:
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/acpi_config.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/battery.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/daemondock.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/dummy.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/klaptopdaemon_main.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/klaptopdaemon_main.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/kpcmcia.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/kpcmciainfo.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/laptop_daemon.Plo@am__quote@
@@ -693,7 +711,7 @@ distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 #>- DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 #>+ 4
-KDE_DIST=laptop_daemon.h pcmcia.h acpi_config.h warning.h notify.h power.h configure.in.in version.h battery.h portable.h kpcmciainfo.h main.h kpcmcia.h daemondock.h 
+KDE_DIST=power.h warning.h configure.in.in kpcmciainfo.h acpi_config.h battery.h version.h pcmcia.h portable.h daemondock.h main.h Makefile.in.rej kpcmcia.h laptop_daemon.h notify.h 
 
 DISTFILES= $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST) $(KDE_DIST)
 
@@ -859,9 +877,6 @@ uninstall-info: uninstall-info-recursive
 messages:
 	$(XGETTEXT) $(klaptopdaemon_la_SOURCES) -o $(podir)/klaptopdaemon.pot
 	$(XGETTEXT) $(kcm_laptop_la_SOURCES) -o $(podir)/kcmlaptop.pot
-
-dummy.cpp:
-	echo >dummy.cpp
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
 .NOEXPORT:
@@ -876,17 +891,17 @@ kcm_laptop.la.closure: $(kcm_laptop_la_O
 
 
 #>+ 3
-pcmcia.moc: $(srcdir)/pcmcia.h
-	$(MOC) $(srcdir)/pcmcia.h -o pcmcia.moc
+kpcmcia.moc: $(srcdir)/kpcmcia.h
+	$(MOC) $(srcdir)/kpcmcia.h -o kpcmcia.moc
 
 #>+ 1
-mocs: pcmcia.moc
+mocs: kpcmcia.moc
 #>+ 3
-battery.moc: $(srcdir)/battery.h
-	$(MOC) $(srcdir)/battery.h -o battery.moc
+pcmcia.moc: $(srcdir)/pcmcia.h
+	$(MOC) $(srcdir)/pcmcia.h -o pcmcia.moc
 
 #>+ 1
-mocs: battery.moc
+mocs: pcmcia.moc
 #>+ 3
 daemondock.moc: $(srcdir)/daemondock.h
 	$(MOC) $(srcdir)/daemondock.h -o daemondock.moc
@@ -894,41 +909,35 @@ daemondock.moc: $(srcdir)/daemondock.h
 #>+ 1
 mocs: daemondock.moc
 #>+ 3
-acpi_config.moc: $(srcdir)/acpi_config.h
-	$(MOC) $(srcdir)/acpi_config.h -o acpi_config.moc
-
-#>+ 1
-mocs: acpi_config.moc
-#>+ 3
-kpcmcia.moc: $(srcdir)/kpcmcia.h
-	$(MOC) $(srcdir)/kpcmcia.h -o kpcmcia.moc
-
-#>+ 1
-mocs: kpcmcia.moc
-#>+ 3
 notify.moc: $(srcdir)/notify.h
 	$(MOC) $(srcdir)/notify.h -o notify.moc
 
 #>+ 1
 mocs: notify.moc
 #>+ 3
-warning.moc: $(srcdir)/warning.h
-	$(MOC) $(srcdir)/warning.h -o warning.moc
+main.moc: $(srcdir)/main.h
+	$(MOC) $(srcdir)/main.h -o main.moc
 
 #>+ 1
-mocs: warning.moc
+mocs: main.moc
 #>+ 3
-laptop_daemon.moc: $(srcdir)/laptop_daemon.h
-	$(MOC) $(srcdir)/laptop_daemon.h -o laptop_daemon.moc
+kpcmciainfo.moc: $(srcdir)/kpcmciainfo.h
+	$(MOC) $(srcdir)/kpcmciainfo.h -o kpcmciainfo.moc
 
 #>+ 1
-mocs: laptop_daemon.moc
+mocs: kpcmciainfo.moc
 #>+ 3
-main.moc: $(srcdir)/main.h
-	$(MOC) $(srcdir)/main.h -o main.moc
+battery.moc: $(srcdir)/battery.h
+	$(MOC) $(srcdir)/battery.h -o battery.moc
 
 #>+ 1
-mocs: main.moc
+mocs: battery.moc
+#>+ 3
+acpi_config.moc: $(srcdir)/acpi_config.h
+	$(MOC) $(srcdir)/acpi_config.h -o acpi_config.moc
+
+#>+ 1
+mocs: acpi_config.moc
 #>+ 3
 power.moc: $(srcdir)/power.h
 	$(MOC) $(srcdir)/power.h -o power.moc
@@ -936,14 +945,20 @@ power.moc: $(srcdir)/power.h
 #>+ 1
 mocs: power.moc
 #>+ 3
-kpcmciainfo.moc: $(srcdir)/kpcmciainfo.h
-	$(MOC) $(srcdir)/kpcmciainfo.h -o kpcmciainfo.moc
+warning.moc: $(srcdir)/warning.h
+	$(MOC) $(srcdir)/warning.h -o warning.moc
 
 #>+ 1
-mocs: kpcmciainfo.moc
+mocs: warning.moc
+#>+ 3
+laptop_daemon.moc: $(srcdir)/laptop_daemon.h
+	$(MOC) $(srcdir)/laptop_daemon.h -o laptop_daemon.moc
+
+#>+ 1
+mocs: laptop_daemon.moc
 #>+ 3
 clean-metasources:
-	-rm -f  pcmcia.moc battery.moc daemondock.moc acpi_config.moc kpcmcia.moc notify.moc warning.moc laptop_daemon.moc main.moc power.moc kpcmciainfo.moc
+	-rm -f  kpcmcia.moc pcmcia.moc daemondock.moc notify.moc main.moc kpcmciainfo.moc battery.moc acpi_config.moc power.moc warning.moc laptop_daemon.moc
 
 #>+ 3
 clean-closures:
@@ -960,7 +975,7 @@ force-reedit:
 
 
 #>+ 11
-kcm_laptop_la.all_cpp.cpp: $(srcdir)/Makefile.in $(srcdir)/battery.cpp $(srcdir)/main.cpp $(srcdir)/pcmcia.cpp $(srcdir)/power.cpp $(srcdir)/warning.cpp $(srcdir)/portable.cpp $(srcdir)/acpi_config.cpp  pcmcia.moc battery.moc acpi_config.moc warning.moc main.moc power.moc
+kcm_laptop_la.all_cpp.cpp: $(srcdir)/Makefile.in $(srcdir)/battery.cpp $(srcdir)/main.cpp $(srcdir)/pcmcia.cpp $(srcdir)/power.cpp $(srcdir)/warning.cpp $(srcdir)/portable.cpp $(srcdir)/acpi_config.cpp  pcmcia.moc main.moc battery.moc acpi_config.moc warning.moc power.moc
 	@echo 'creating kcm_laptop_la.all_cpp.cpp ...'; \
 	rm -f kcm_laptop_la.all_cpp.files kcm_laptop_la.all_cpp.final; \
 	echo "#define KDE_USE_FINAL 1" >> kcm_laptop_la.all_cpp.final; \
@@ -972,33 +987,33 @@ kcm_laptop_la.all_cpp.cpp: $(srcdir)/Mak
 	rm -f kcm_laptop_la.all_cpp.final kcm_laptop_la.all_cpp.files
 
 #>+ 11
-klaptopdaemon_la.all_cpp.cpp: $(srcdir)/Makefile.in $(srcdir)/laptop_daemon.cpp $(srcdir)/kpcmcia.cpp $(srcdir)/kpcmciainfo.cpp $(srcdir)/daemondock.cpp $(srcdir)/notify.cpp $(srcdir)/portable.cpp $(srcdir)/acpi_config.cpp  daemondock.moc acpi_config.moc kpcmcia.moc notify.moc laptop_daemon.moc kpcmciainfo.moc
-	@echo 'creating klaptopdaemon_la.all_cpp.cpp ...'; \
-	rm -f klaptopdaemon_la.all_cpp.files klaptopdaemon_la.all_cpp.final; \
-	echo "#define KDE_USE_FINAL 1" >> klaptopdaemon_la.all_cpp.final; \
+libklaptopdaemon_main_la.all_cpp.cpp: $(srcdir)/Makefile.in $(srcdir)/laptop_daemon.cpp $(srcdir)/kpcmcia.cpp $(srcdir)/kpcmciainfo.cpp $(srcdir)/daemondock.cpp $(srcdir)/notify.cpp $(srcdir)/portable.cpp $(srcdir)/acpi_config.cpp  daemondock.moc kpcmcia.moc notify.moc kpcmciainfo.moc acpi_config.moc laptop_daemon.moc
+	@echo 'creating libklaptopdaemon_main_la.all_cpp.cpp ...'; \
+	rm -f libklaptopdaemon_main_la.all_cpp.files libklaptopdaemon_main_la.all_cpp.final; \
+	echo "#define KDE_USE_FINAL 1" >> libklaptopdaemon_main_la.all_cpp.final; \
 	for file in laptop_daemon.cpp kpcmcia.cpp kpcmciainfo.cpp daemondock.cpp notify.cpp portable.cpp acpi_config.cpp ; do \
-	  echo "#include \"$$file\"" >> klaptopdaemon_la.all_cpp.files; \
-	  test ! -f $(srcdir)/$$file || egrep '^#pragma +implementation' $(srcdir)/$$file >> klaptopdaemon_la.all_cpp.final; \
+	  echo "#include \"$$file\"" >> libklaptopdaemon_main_la.all_cpp.files; \
+	  test ! -f $(srcdir)/$$file || egrep '^#pragma +implementation' $(srcdir)/$$file >> libklaptopdaemon_main_la.all_cpp.final; \
 	done; \
-	cat klaptopdaemon_la.all_cpp.final klaptopdaemon_la.all_cpp.files > klaptopdaemon_la.all_cpp.cpp; \
-	rm -f klaptopdaemon_la.all_cpp.final klaptopdaemon_la.all_cpp.files
+	cat libklaptopdaemon_main_la.all_cpp.final libklaptopdaemon_main_la.all_cpp.files > libklaptopdaemon_main_la.all_cpp.cpp; \
+	rm -f libklaptopdaemon_main_la.all_cpp.final libklaptopdaemon_main_la.all_cpp.files
 
 #>+ 3
 clean-final:
-	-rm -f kcm_laptop_la.all_cpp.cpp klaptopdaemon_la.all_cpp.cpp
+	-rm -f kcm_laptop_la.all_cpp.cpp libklaptopdaemon_main_la.all_cpp.cpp
 
 #>+ 2
 final:
-	$(MAKE) kcm_laptop_la_OBJECTS="$(kcm_laptop_la_final_OBJECTS)" klaptopdaemon_la_OBJECTS="$(klaptopdaemon_la_final_OBJECTS)" all-am
+	$(MAKE) kcm_laptop_la_OBJECTS="$(kcm_laptop_la_final_OBJECTS)" libklaptopdaemon_main_la_OBJECTS="$(libklaptopdaemon_main_la_final_OBJECTS)" all-am
 #>+ 2
 final-install:
-	$(MAKE) kcm_laptop_la_OBJECTS="$(kcm_laptop_la_final_OBJECTS)" klaptopdaemon_la_OBJECTS="$(klaptopdaemon_la_final_OBJECTS)" install-am
+	$(MAKE) kcm_laptop_la_OBJECTS="$(kcm_laptop_la_final_OBJECTS)" libklaptopdaemon_main_la_OBJECTS="$(libklaptopdaemon_main_la_final_OBJECTS)" install-am
 #>+ 2
 no-final:
-	$(MAKE) kcm_laptop_la_OBJECTS="$(kcm_laptop_la_nofinal_OBJECTS)" klaptopdaemon_la_OBJECTS="$(klaptopdaemon_la_nofinal_OBJECTS)" all-am
+	$(MAKE) kcm_laptop_la_OBJECTS="$(kcm_laptop_la_nofinal_OBJECTS)" libklaptopdaemon_main_la_OBJECTS="$(libklaptopdaemon_main_la_nofinal_OBJECTS)" all-am
 #>+ 2
 no-final-install:
-	$(MAKE) kcm_laptop_la_OBJECTS="$(kcm_laptop_la_nofinal_OBJECTS)" klaptopdaemon_la_OBJECTS="$(klaptopdaemon_la_nofinal_OBJECTS)" install-am
+	$(MAKE) kcm_laptop_la_OBJECTS="$(kcm_laptop_la_nofinal_OBJECTS)" libklaptopdaemon_main_la_OBJECTS="$(libklaptopdaemon_main_la_nofinal_OBJECTS)" install-am
 #>+ 3
 cvs-clean:
 	$(MAKE) admindir=$(top_srcdir)/admin -f $(top_srcdir)/admin/Makefile.common cvs-clean
@@ -1008,25 +1023,25 @@ kde-rpo-clean:
 	-rm -f *.rpo
 
 #>+ 23
-laptop_daemon.lo: laptop_daemon.moc 
-daemondock.o: daemondock.moc 
-pcmcia.o: pcmcia.moc 
-kpcmciainfo.lo: kpcmciainfo.moc 
-battery.lo: battery.moc 
-power.o: power.moc 
+kpcmcia.o: kpcmcia.moc 
+kpcmcia.lo: kpcmcia.moc 
+laptop_daemon.o: laptop_daemon.moc 
 notify.o: notify.moc 
-power.lo: power.moc 
-daemondock.lo: daemondock.moc 
-pcmcia.lo: pcmcia.moc 
+power.o: power.moc 
+notify.lo: notify.moc 
 warning.lo: warning.moc 
-kpcmcia.o: kpcmcia.moc 
-kpcmciainfo.o: kpcmciainfo.moc 
+warning.o: warning.moc 
 acpi_config.lo: acpi_config.moc 
 main.lo: main.moc 
+laptop_daemon.lo: laptop_daemon.moc 
+kpcmciainfo.o: kpcmciainfo.moc 
+battery.o: battery.moc 
 acpi_config.o: acpi_config.moc 
-notify.lo: notify.moc 
-warning.o: warning.moc 
+pcmcia.lo: pcmcia.moc 
+battery.lo: battery.moc 
+daemondock.lo: daemondock.moc 
+daemondock.o: daemondock.moc 
+pcmcia.o: pcmcia.moc 
 main.o: main.moc 
-battery.o: battery.moc 
-kpcmcia.lo: kpcmcia.moc 
-laptop_daemon.o: laptop_daemon.moc 
+kpcmciainfo.lo: kpcmciainfo.moc 
+power.lo: power.moc 
