$NetBSD: patch-bz,v 1.2 2007/04/02 01:25:49 hira Exp $

Security fixes for CVE-2007-0238.  This has been fixed in OOo 2.2.

--- sc/source/filter/starcalc/scflt.cxx.orig	2006-12-02 02:56:27.000000000 +0900
+++ sc/source/filter/starcalc/scflt.cxx	2007-04-02 10:07:28.000000000 +0900
@@ -1770,12 +1770,13 @@
 			rStream >> NoteLen;
 			if (NoteLen != 0)
 			{
-				sal_Char Note[4096];
-				rStream.Read(Note, NoteLen);
-				Note[NoteLen] = 0;
-			        String aText( SC10TOSTRING(Note));
-			        ScPostIt aNote(aText, pDoc);
+				sal_Char* pNote = new sal_Char[NoteLen+1];
+				rStream.Read(pNote, NoteLen);
+				pNote[NoteLen] = 0;
+				String aText( SC10TOSTRING(pNote));
+				ScPostIt aNote(aText, pDoc);
 				pDoc->SetNote(Col, static_cast<SCROW> (Row), Tab, aNote );
+				delete [] pNote;
 			}
 		}
 		pPrgrsBar->Progress();
