$NetBSD: patch-ac,v 1.3 2002/03/01 02:25:37 fredb Exp $

--- pan/pan.c.orig	Fri Nov  9 10:53:07 2001
+++ pan/pan.c
@@ -42,6 +42,24 @@
 #include <pan/thread-watch.h>
 #include <pan/util.h>
 
+#ifdef __NetBSD__
+#include <gtk/gtk.h>
+#include <pthread.h>
+
+/*
+ * NetBSD uses non-preemptive pth, so we yield the processor periodically
+ */
+
+gint
+pth_nbschedule (gpointer data)
+{
+	pthread_yield_np();
+
+	return TRUE;
+}
+#endif
+
+
 static gint save_session (GnomeClient        * client,
 			  gint                 phase,
 			  GnomeSaveStyle       save_style,
@@ -196,6 +214,10 @@
 				newsrc_import (s, newsrc_filename, newsrc_port_subscribed_only);
 		}
 	}
+
+#ifdef __NetBSD__
+	gtk_timeout_add (200, pth_nbschedule, NULL);
+#endif
 
 	gtk_main ();
 
