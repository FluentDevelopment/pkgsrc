$NetBSD: patch-aa,v 1.3 2006/10/25 23:17:30 dmcmahill Exp $

http://www.musicpd.org/mantis/view.php?id=1379

setenv() doesn't exist on all systems (e.g. solaris 9)

--- src/main.c.orig	2006-10-25 15:26:10.800946000 -0400
+++ src/main.c
@@ -262,7 +262,14 @@ void changeToUser(Options * options) {
                 }
 
 		if(userpwd->pw_dir) {
-			setenv("HOME", userpwd->pw_dir, 1);
+			char *tmps;
+			/* HOME=%s so we need 5 for HOME= and 1 for the terminating \0 */
+			tmps = (char *) malloc (strlen(userpwd->pw_dir) + 6);
+			if (tmps != NULL) {
+				sprintf (tmps, "HOME=%s", userpwd->pw_dir);
+				putenv (tmps);
+				free (tmps);
+			}
 		}
         }
 }
