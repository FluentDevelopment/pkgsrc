$NetBSD: patch-ac,v 1.4 2001/08/24 08:27:43 lukem Exp $

--- src/io_ogg123.c.orig	Fri Feb 16 13:53:18 2001
+++ src/io_ogg123.c	Fri Aug 24 17:28:58 2001
@@ -35,6 +35,7 @@ gint ogg123_enabled = FALSE;
 
 gint ogg123_device = 0;
 gchar *ogg123_device_options = NULL;
+gchar *ogg123_extra_options = NULL;
 
 /* internal stuff */
 static SongData *ogg123_current_sd = NULL;
@@ -52,10 +53,15 @@ static int ogg123_pipe[2];
 
 static const gchar *ogg123_output_devices[] =
 {
+#ifdef __NetBSD__
+	"sun",
+#endif
 	"oss",
 	"esd",
 	"irix",
+#ifndef __NetBSD__
 	"solaris",
+#endif
 	"wav",
 	NULL
 };
@@ -332,11 +338,13 @@ static void ogg123_input_read_cb(gpointe
  *-----------------------------------------------------------------------------
  */
 
+#define OGG123_MAX_COMMANDS 32
+
 static gint ogg123_child_run(SongData *sd, gint position)
 {
 	pid_t frk_pid;
-	char cmd_arguments[16][512];
-	char *cmd_ptr[16];
+	char cmd_arguments[OGG123_MAX_COMMANDS][512];
+	char *cmd_ptr[OGG123_MAX_COMMANDS];
 	int cmd_cnt = 0;
 	gchar *exec_bin = OGG123_BINARY;
 
@@ -370,6 +378,26 @@ static gint ogg123_child_run(SongData *s
 		sprintf(cmd_arguments[cmd_cnt], "--device-option=%s", ogg123_device_options);
 		cmd_ptr[cmd_cnt] = cmd_arguments[cmd_cnt];
 		cmd_cnt++;
+		}
+
+	if (ogg123_extra_options &&
+	    strlen(ogg123_extra_options) > 0 &&
+	    cmd_cnt + 2 < OGG123_MAX_COMMANDS)
+		{
+		gchar **vector;
+		gint i;
+
+		vector = g_strsplit(ogg123_extra_options, " ", OGG123_MAX_COMMANDS - 2 - cmd_cnt);
+		i = 0;
+
+		while(vector && vector[i] != NULL)
+			{
+			strcpy(cmd_arguments[cmd_cnt], vector[i]);
+			cmd_ptr[cmd_cnt] = cmd_arguments[cmd_cnt];
+			cmd_cnt++;
+			i++;
+			}
+		g_strfreev(vector);
 		}
 
 	strcpy(cmd_arguments[cmd_cnt], sd->path);
