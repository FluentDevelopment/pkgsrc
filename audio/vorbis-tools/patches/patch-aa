$NetBSD: patch-aa,v 1.6 2003/07/12 22:35:30 wiz Exp $

--- ogg123/buffer.c.orig	2002-07-14 07:38:00.000000000 +0200
+++ ogg123/buffer.c
@@ -35,9 +35,10 @@
 #define MIN4(w,x,y,z)  MIN( MIN(w,x), MIN(y,z) )
 
 /* Special debugging code.  THIS IS NOT PORTABLE! */
+#define DEBUG_BUFFER
 #ifdef DEBUG_BUFFER
 FILE *debugfile;
-#define DEBUG(x, y...) { fprintf (debugfile, "%d: " x "\n", getpid(),  ## y); }
+#define DEBUG(...) { fprintf (debugfile, "%d: ", getpid());fprintf(debugfile, __VA_ARGS__);fprintf(debugfile,"\n"); }
 #else
 #define DEBUG(x, y...)
 #endif
@@ -434,7 +435,9 @@ void buffer_destroy (buf_t *buf)
 
   /* Cleanup pthread variables */
   pthread_mutex_destroy(&buf->mutex);
+  COND_SIGNAL(buf->write_cond);
   pthread_cond_destroy(&buf->write_cond);
+  COND_SIGNAL(buf->playback_cond);
   pthread_cond_destroy(&buf->playback_cond);
   
   free(buf);
