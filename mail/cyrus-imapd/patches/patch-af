$NetBSD: patch-af,v 1.4 2002/10/21 06:12:54 jlam Exp $

--- configure.orig	Fri Jul 27 19:53:11 2001
+++ configure
@@ -1159,49 +1159,27 @@ fi
 rm -f conftest*
 
 
-
-        echo $ac_n "checking for strerror in -lcposix""... $ac_c" 1>&6
-echo "configure:1165: checking for strerror in -lcposix" >&5
-ac_lib_var=`echo cposix'_'strerror | sed 'y%./+-%__p_%'`
-if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
-else
-  ac_save_LIBS="$LIBS"
-LIBS="-lcposix  $LIBS"
-cat > conftest.$ac_ext <<EOF
-#line 1173 "configure"
-#include "confdefs.h"
-/* Override any gcc2 internal prototype to avoid an error.  */
-/* We use char because int might match the return type of a gcc2
-    builtin and then its argument prototype would still apply.  */
-char strerror();
-
-int main() {
-strerror()
-; return 0; }
+echo $ac_n "checking for POSIXized ISC""... $ac_c" 1>&6
+echo "configure:1164: checking for POSIXized ISC" >&5
+if test -d /etc/conf/kconfig.d &&
+  grep _POSIX_VERSION /usr/include/sys/unistd.h >/dev/null 2>&1
+then
+  echo "$ac_t""yes" 1>&6
+  ISC=yes # If later tests want to check for ISC.
+  cat >> confdefs.h <<\EOF
+#define _POSIX_SOURCE 1
 EOF
-if { (eval echo configure:1184: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
-  rm -rf conftest*
-  eval "ac_cv_lib_$ac_lib_var=yes"
-else
-  echo "configure: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-  rm -rf conftest*
-  eval "ac_cv_lib_$ac_lib_var=no"
-fi
-rm -f conftest*
-LIBS="$ac_save_LIBS"
 
-fi
-if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
-  echo "$ac_t""yes" 1>&6
-  LIBS="$LIBS -lcposix"
+  if test "$GCC" = yes; then
+    CC="$CC -posix"
+  else
+    CC="$CC -Xp"
+  fi
 else
   echo "$ac_t""no" 1>&6
+  ISC=
 fi
 
-  
-
 for ac_prog in mawk gawk nawk awk
 do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
@@ -4179,6 +4157,44 @@ fi
 
 	SASLFLAGS=""
 	LIB_SASL=""
+	# Extract the first word of "sasl-config", so it can be a program name with args.
+set dummy sasl-config; ac_word=$2
+echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:4164: checking for $ac_word" >&5
+if eval "test \"`echo '$''{'ac_cv_path_SASL_CONFIG'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  case "$SASL_CONFIG" in
+  /*)
+  ac_cv_path_SASL_CONFIG="$SASL_CONFIG" # Let the user override the test with a path.
+  ;;
+  ?:/*)			 
+  ac_cv_path_SASL_CONFIG="$SASL_CONFIG" # Let the user override the test with a dos path.
+  ;;
+  *)
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
+    test -z "$ac_dir" && ac_dir=.
+    if test -f $ac_dir/$ac_word; then
+      ac_cv_path_SASL_CONFIG="$ac_dir/$ac_word"
+      break
+    fi
+  done
+  IFS="$ac_save_ifs"
+  test -z "$ac_cv_path_SASL_CONFIG" && ac_cv_path_SASL_CONFIG="no"
+  ;;
+esac
+fi
+SASL_CONFIG="$ac_cv_path_SASL_CONFIG"
+if test -n "$SASL_CONFIG"; then
+  echo "$ac_t""$SASL_CONFIG" 1>&6
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+
+	if test "$SASL_CONFIG" = no; then
 
 	cmu_saved_CPPFLAGS=$CPPFLAGS
 	cmu_saved_LDFLAGS=$LDFLAGS
@@ -4277,6 +4293,15 @@ fi
 	  LIB_SASL=""
 	  SASLFLAGS=""
 	fi
+
+	else	# SASL_CONFIG
+
+	ac_cv_found_sasl=yes
+	SASLFLAGS=`$SASL_CONFIG --cflags`
+	LIB_SASL=`$SASL_CONFIG --libs`
+
+	fi
+
 	
 	
 	
@@ -5084,6 +5109,7 @@ s%@COMPILE_ET@%$COMPILE_ET%g
 s%@COM_ERR_LIBS@%$COM_ERR_LIBS%g
 s%@COM_ERR_LDFLAGS@%$COM_ERR_LDFLAGS%g
 s%@COM_ERR_CPPFLAGS@%$COM_ERR_CPPFLAGS%g
+s%@SASL_CONFIG@%$SASL_CONFIG%g
 s%@LIB_SASL@%$LIB_SASL%g
 s%@SASLFLAGS@%$SASLFLAGS%g
 s%@SNMP_SUBDIRS@%$SNMP_SUBDIRS%g
