# $NetBSD: Makefile,v 1.6 2003/02/17 02:12:44 jtb Exp $

DISTNAME=		nullmailer-1.00RC7
CATEGORIES=		mail
MASTER_SITES=		http://untroubled.org/nullmailer/

MAINTAINER=		packages@netbsd.org
HOMEPAGE=		http://untroubled.org/nullmailer/
COMMENT=		Simple relay-only mail transport agent

GNU_CONFIGURE=		yes
CONFIGURE_ARGS+= 	--sysconfdir=${PKG_SYSCONFDIR} --localstatedir=/var/spool
CONFIGURE_ARGS+=	--bindir=${PREFIX}/libexec/nullmailer
CONFIGURE_ARGS+=	--sbindir=${PREFIX}/libexec/nullmailer

INSTALL_TARGET=		install install-data-local install-root

.include "../../mk/bsd.prefs.mk"

NULLMAILER_GROUP?=	nullmail
NULLMAILER_USER?=	nullmail
PKG_GROUPS?=		${NULLMAILER_GROUP}
PKG_USERS?=		${NULLMAILER_USER}:${NULLMAILER_GROUP}

MAKE_ENV+=		NULLMAILER_GROUP=${NULLMAILER_GROUP}
MAKE_ENV+=		NULLMAILER_USER=${NULLMAILER_USER}

PLIST_SUBST+=		NULLMAILER_GROUP=${NULLMAILER_GROUP}		\
			NULLMAILER_USER=${NULLMAILER_USER}

pre-configure:
	for f in ${WRKSRC}/doc/nullmailer-send.8; do			\
		${SED} -e 's:@PREFIX@:${PREFIX}:g'			\
			-e 's:@PKG_SYSCONFDIR@:${PKG_SYSCONFDIR}:g'	\
		$$f > $$f.tmp && ${MV} -f $$f.tmp $$f;			\
	done

post-configure:
	${SED} -e 's:@PREFIX@:${PREFIX}:g'			\
		-e 's:@PKG_SYSCONFDIR@:${PKG_SYSCONFDIR}:g'	\
		${FILESDIR}/nullmailer > ${WRKDIR}/nullmailer

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/nullmailer
	cd ${WRKSRC} && ${INSTALL_DATA} AUTHORS BUGS COPYING ChangeLog	\
		HOWTO NEWS README TODO ${PREFIX}/share/doc/nullmailer
	${INSTALL_SCRIPT} ${WRKDIR}/nullmailer ${PKG_SYSCONFDIR}/rc.d

.include "../../mk/bsd.pkg.install.mk"
.include "../../mk/bsd.pkg.mk"
