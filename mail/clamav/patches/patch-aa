$NetBSD: patch-aa,v 1.6 2004/02/02 00:00:48 recht Exp $

--- configure.in.orig	2003-11-12 02:27:29.000000000 +0100
+++ configure.in	2004-02-02 00:03:11.000000000 +0100
@@ -74,12 +74,15 @@
     AC_CHECK_LIB(bz2, bzReadOpen, AC_DEFINE(NOBZ2PREFIX),)
 fi
 
-have_milter="no"
-AC_CHECK_HEADER(libmilter/mfapi.h,have_milter="yes",)
-
 AC_ARG_ENABLE(milter,
 [  --enable-milter	  Build clamav-milter (if milter library found)],
-,have_milter="no")
+want_milter=$enableval, want_milter=no)
+
+have_milter=no
+if test "$want_milter" = "yes"
+then
+	AC_CHECK_HEADER(libmilter/mfapi.h,[have_milter=yes],)
+fi
 
 want_dsig="yes"
 AC_ARG_ENABLE(dsig,
@@ -193,7 +196,7 @@
 AC_DEFINE_UNQUOTED(CONFDIR,"$cfg_dir",)
 
 dnl Do not overwrite the current config file
-AM_CONDITIONAL(INSTALL_CONF, test ! -r "$cfg_dir/clamav.conf")
+AM_CONDITIONAL(INSTALL_CONF, test "yes" = "yes")
 
 if test "$test_urandom" = "yes"
 then
@@ -271,8 +274,12 @@
     AC_DEFINE(C_BSD)
     ;;
 netbsd*)
-    AC_MSG_RESULT(NetBSD detected. Disabling thread support.)
-    have_pthreads="no"
+    if test "$have_pthreads" = "yes"; then
+    	LIBCLAMAV_LIBS="$LIBCLAMAV_LIBS -lpthread"
+	CLAMD_LIBS="-lpthread"
+	TH_SAFE="-thread-safe"
+	AC_DEFINE(CL_THREAD_SAFE)
+    fi
     AC_DEFINE(C_BSD)
     ;;
 bsd*)
