$NetBSD: patch-ab,v 1.21 2006/09/11 13:44:27 tron Exp $

--- src/osdep/unix/Makefile.orig	2005-04-30 21:51:13.000000000 +0100
+++ src/osdep/unix/Makefile	2006-09-11 14:19:56.000000000 +0100
@@ -124,7 +124,7 @@
 
 # Normally no need to change any of these
 
-ARCHIVE=c-client.a
+ARCHIVE=libc-client.la
 BINARIES=osdep.o mail.o misc.o newsrc.o smanager.o utf8.o siglocal.o \
  dummy.o pseudo.o netmsg.o flstring.o fdstring.o \
  rfc822.o nntp.o smtp.o imap4r1.o pop3.o \
@@ -403,9 +403,9 @@
 	 SPOOLDIR=/var/spool MAILSPOOL=/var/mail \
 	 ACTIVEFILE=/usr/share/news/active \
 	 RSHPATH=/usr/bin/rsh \
-	 BASECFLAGS="-g $(GCCOPTLEVEL)" \
+	 BASECFLAGS="" \
 	 BASELDFLAGS="-lsocket -lnsl -lgen" \
-	 RANLIB=true CC=gcc
+	 RANLIB=true
 
 gsu:	# GCC SUN-OS
 	$(BUILD) `$(CAT) SPECIALS` OS=sun \
@@ -495,9 +495,9 @@
 	$(BUILD) `$(CAT) SPECIALS` OS=bsi \
 	 CRXTYPE=nfs \
 	 SPOOLDIR=/var \
-	 ACTIVEFILE=/var/db/news/active \
+	 ACTIVEFILE=/var/news/db/active \
 	 RSHPATH=/usr/bin/rsh \
-	 BASECFLAGS="-g -O -pipe" \
+	 BASECFLAGS="-pipe" \
 	 BASELDFLAGS="-lcrypt"
 
 nec:	# NEC UX
@@ -510,6 +510,16 @@
 	 BASELDFLAGS="-lsocket -lnsl -lgen" \
 	 RANLIB=true CC=/usr/abiccs/bin/cc
 
+nep:	# NetBSD with PAM
+	$(BUILD) `$(CAT) SPECIALS` OS=bsi \
+	 CHECKPW=pam \
+	 CRXTYPE=nfs \
+	 SPOOLDIR=/var \
+	 ACTIVEFILE=/var/news/db/active \
+	 RSHPATH=/usr/bin/rsh \
+	 BASECFLAGS="-pipe" \
+	 BASELDFLAGS="-lpam"
+
 nto:	# QNX Neutrino RTP
 	$(BUILD) `$(CAT) SPECIALS` OS=$@ \
 	 CRXTYPE=nfs \
@@ -549,7 +559,7 @@
 	$(BUILD) `$(CAT) SPECIALS` OS=$@ \
 	 CRXTYPE=nfs \
 	 SPOOLDIR=/var/spool MAILSPOOL=/var/mail \
-	 BASECFLAGS="-g -O -Wno-pointer-sign"
+	 BASECFLAGS="-Wno-pointer-sign"
 
 ptx:	# PTX
 	$(BUILD) `$(CAT) SPECIALS` OS=$@ \
@@ -811,7 +821,7 @@
 	@$(SH) ARCHIVE
 
 .c.o:
-	`$(CAT) CCTYPE` -c `$(CAT) CFLAGS` $*.c
+	$(LTCOMPILE) `$(CAT) CCTYPE` -c `$(CAT) CFLAGS` $*.c
 
 
 # Cleanup
@@ -869,7 +879,7 @@
 	@echo pem.h, buffer.h, bio.h, and crypto.h, that means that OpenSSL
 	@echo is not installed on your system.  Either install OpenSSL first
 	@echo or build with command: make `$(CAT) OSTYPE` SSLTYPE=none
-	`$(CAT) CCTYPE` -c `$(CAT) CFLAGS` `$(CAT) OSCFLAGS` -c osdep.c
+	$(LTCOMPILE) `$(CAT) CCTYPE` -c `$(CAT) CFLAGS` `$(CAT) OSCFLAGS` -c osdep.c
 
 osdep.c: osdepbas.c osdepckp.c osdeplog.c osdepssl.c
 	$(CAT) osdepbas.c osdepckp.c osdeplog.c osdepssl.c > osdep.c
@@ -924,7 +934,7 @@
 	 -DACTIVEFILE=\"$(ACTIVEFILE)\" -DNEWSSPOOL=\"$(NEWSSPOOL)\" \
 	 -DRSHPATH=\"$(RSHPATH)\" -DLOCKPGM=\"$(LOCKPGM)\" > OSCFLAGS
 	echo $(BASELDFLAGS) $(EXTRALDFLAGS) > LDFLAGS
-	echo "$(ARRC) $(ARCHIVE) $(BINARIES);$(RANLIB) $(ARCHIVE)" > ARCHIVE
+	echo "$(LTLINK) $(CC) -o $(ARCHIVE) $(BINARIES:.o=.lo) -rpath $(PREFIX)/lib -version-info $(CCLIENT_MAJOR):$(CCLIENT_MINOR) \`$(CAT) LDFLAGS\`" > ARCHIVE
 	echo $(OS) > OSTYPE
 	./drivers $(EXTRADRIVERS) $(DEFAULTDRIVERS) dummy
 	./mkauths $(EXTRAAUTHENTICATORS) $(DEFAULTAUTHENTICATORS)
