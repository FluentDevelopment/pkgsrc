$NetBSD: patch-ac,v 1.10 2004/12/23 13:51:28 kim Exp $

See http://archives.neohapsis.com/archives/postfix/2004-08/1114.html
and the preceding thread.  Fixes "smtp killed by signal 11" problems.

--- src/util/vstream.c.orig	2003-07-09 22:01:21.000000000 -0400
+++ src/util/vstream.c	2004-12-23 01:21:52.000000000 -0500
@@ -920,6 +920,10 @@
      * policies. Either this, or the vstream*open() routines would have to
      * have a really ugly interface with lots of mostly-unused arguments (can
      * you say VMS?).
+     *
+     * Initialize the I/O time (as documented) so that a time sensitive, "write
+     * before read" application does not force flush the first data written
+     * to a stream, potentially triggering NAGLE delays or other trouble.
      */
     stream = (VSTREAM *) mymalloc(sizeof(*stream));
     stream->fd = fd;
@@ -933,7 +937,7 @@
     stream->timeout = 0;
     stream->context = 0;
     stream->jbuf = 0;
-    stream->iotime = 0;
+    stream->iotime = time((time_t *) 0); /* as documented */
     return (stream);
 }
 
