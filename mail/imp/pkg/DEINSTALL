#!/bin/sh
#
# $NetBSD: DEINSTALL,v 1.4 2001/07/29 14:25:06 bouyer Exp $

PKGNAME=$1
STAGE=$2

CAT="@CAT@"
CMP="@CMP@"
RM="@RM@"
RMDIR="@RMDIR@"
TRUE="@TRUE@"

APACHE_SYSCONFDIR="@APACHE_SYSCONFDIR@"
SAMPLECONFDIR=${PKG_PREFIX}/share/examples/imp
CONFDIR=${APACHE_SYSCONFDIR}
IMPDIR=${PKG_PREFIX}/@IMPDIR@

CONFFILES="	${IMPDIR}/config/defaults.php3				\
		${IMPDIR}/config/ldap.php3				\
		${IMPDIR}/config/servers.php3"
NONCONFFILES="	${IMPDIR}/config/MOTD.html				\
		${IMPDIR}/config/header.txt				\
		${IMPDIR}/config/html.php3				\
		${IMPDIR}/config/imp_module_config.php3			\
		${IMPDIR}/config/lang.php3				\
		${IMPDIR}/config/mailbox.php3				\
		${IMPDIR}/config/menu.txt				\
		${IMPDIR}/config/mime.php3				\
		${IMPDIR}/config/trailer.txt"

case ${STAGE} in
DEINSTALL)
	# Remove configuration files if they don't differ from the default
	# config file.
	#
	FILE=${CONFDIR}/imp.conf
	SAMPLEFILE=${SAMPLECONFDIR}/imp.conf
	if ${CMP} -s ${FILE} ${SAMPLEFILE}
	then
		${RM} -f ${FILE}
	fi
	for FILE in ${CONFFILES} ${NONCONFFILES}
	do
		SAMPLEFILE=${FILE}.dist
		if ${CMP} -s ${FILE} ${SAMPLEFILE}
		then
			${RM} -f ${FILE}
		fi
	done
	;;

POST-DEINSTALL)
	modified_files=''
	for FILE in ${CONFDIR}/imp.conf ${CONFFILES} ${NONCONFFILES}
	do
		if [ -f ${FILE} ]
		then
			modified_files="${modified_files} ${FILE}"
		fi
	done

	${RMDIR} ${IMPDIR}/config 2>/dev/null || ${TRUE}
	${RMDIR} ${IMPDIR} 2>/dev/null || ${TRUE}
	${RMDIR} ${CONFDIR} 2>/dev/null || ${TRUE}

	existing_dirs=''
	for dir in ${IMPDIR}
	do
		if [ -d ${dir} ]
		then
			existing_dirs="${existing_dirs} ${dir}"
		fi
	done

	if [ -n "${modified_files}" -o -n "${existing_dirs}" ]
	then
		${CAT} << EOF
===========================================================================
If you won't be using ${PKGNAME} any longer, you may want to remove:
EOF
		if [ -n "${modified_files}" ]
		then
			${CAT} << EOF

  * the following files:

EOF
			for file in ${modified_files}
			do
				echo "	${file}"
			done
		fi
		if [ -n "${existing_dirs}" ]
		then
			${CAT} << EOF

  * the following directories:

EOF
			for dir in ${existing_dirs}
			do
				echo "	${dir}"
			done
		fi
		${CAT} << EOF
===========================================================================
EOF
	fi
	;;

*)
	echo "Unexpected argument: ${STAGE}"
	exit 1
	;;
esac
exit 0
