# $NetBSD: Makefile,v 1.35 2004/07/23 14:14:23 wiz Exp $
#

DISTNAME=	popa3d-0.6.4.1
CATEGORIES=	mail
MASTER_SITES=	http://www.openwall.com/popa3d/ \
		ftp://ftp.openwall.com/pub/projects/popa3d/ \
		ftp://ftp.false.com/pub/security/popa3d/

MAINTAINER=	wiz@NetBSD.org
HOMEPAGE=	http://www.openwall.com/popa3d/
COMMENT=	Secure, reliable, performant, and small pop3 server

POPA3D_USER?=	popa3d
POPA3D_GROUP?=	popa3d

PKG_GROUPS=	${POPA3D_GROUP}
PKG_USERS=	${POPA3D_USER}:${POPA3D_GROUP}

USE_BUILDLINK3=	YES
USE_PKGINSTALL=	YES

DEINSTALL_EXTRA_TMPL+=	${.CURDIR}/DEINSTALL

RCD_SCRIPTS=	popa3d

FILES_SUBST+=	POPA3D_USER=${POPA3D_USER}
FILES_SUBST+=	POPA3D_GROUP=${POPA3D_GROUP}

post-patch:
	cd ${WRKSRC} && \
		${SED} "s,/var/empty,${PREFIX}/share/empty," \
			params.h > params.h.new && \
		${MV} params.h.new params.h

do-install:
	${INSTALL_PROGRAM} -m 500 ${WRKSRC}/popa3d ${PREFIX}/sbin
	${INSTALL_DATA} ${WRKSRC}/popa3d.8 ${PREFIX}/man/man8/
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/popa3d
	cd ${WRKSRC} && ${INSTALL_DATA} DESIGN INSTALL LICENSE \
		${PREFIX}/share/doc/popa3d
	${INSTALL_DATA_DIR} ${PREFIX}/share/empty

.include "../../security/tcp_wrappers/buildlink3.mk"
.include "../../mk/bsd.pkg.mk"
