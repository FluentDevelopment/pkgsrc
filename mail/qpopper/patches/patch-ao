$NetBSD: patch-ao,v 1.1 2004/05/06 13:46:23 taca Exp $

--- common/maillock.c.orig	Thu Mar 13 11:06:36 2003
+++ common/maillock.c
@@ -272,13 +272,13 @@ Qmaillock ( char         *drop_name,
 
         if ( bNo_atomic_open ) {
             while ( fd == -1 ) {
+		char tempdir[FILENAME_MAX];
                 /* 
                  * Create a temporary file and link it to lock file 
                  */
-                pTmp = tempnam ( pSpool_dir, "POP" );
-                if ( pTmp != NULL ) {
-                    fd = open ( pTmp, O_CREAT | O_EXCL, 0600 );
-                }
+		Qsprintf(tempdir, "%s/POPXXXXXXXXXX", pSpool_dir);
+		fd = mkstemp(tempdir);
+                pTmp = strdup(tempdir);
                 if ( fd == -1 ) {
                     if ( DEBUGGING && bDebugging ) {
                         logit ( fTrace, POP_DEBUG, HERE,
