$NetBSD: patch-aa,v 1.8 2007/06/10 21:55:39 tonio Exp $

--- Makefile.orig	2007-02-14 02:08:35.000000000 +0100
+++ Makefile
@@ -1,18 +1,11 @@
-DESTDIR = /usr/local
-BINDIR = /usr/local/bin
-SHAREDIR = /usr/local/share/imapfilter
-MANDIR = /usr/local/man
-
-INCDIRS = -I/usr/local/include
-LIBDIRS = -L/usr/local/lib
-
-MYCFLAGS = -Wall -g
-MYLDFLAGS = 
+DESTDIR = $(PREFIX)
+BINDIR = $(PREFIX)/bin
+SHAREDIR = $(PREFIX)/share/imapfilter
+MANDIR = $(PREFIX)/$(PKGMANDIR)
 
 DEFS = -DMAKEFILE_SHAREDIR='"$(SHAREDIR)"'
 
-CFLAGS = $(MYCFLAGS) $(DEFS) $(INCDIRS)
-LDFLAGS = $(MYLDFLAGS) $(LIBDIRS)
+CFLAGS+= $(DEFS)
 
 LIBS = -lm -llua -lssl -lcrypto -lpcre
 
@@ -31,7 +24,7 @@ OBJ = auth.o buffer.o cert.o core.o file
 all: $(BIN)
 
 $(BIN): $(OBJ)
-	$(CC) -o $(BIN) $(LDFLAGS) $(OBJ) $(LIBS)
+	$(CC) -o $(BIN) $(LDFLAGS) $(CFLAGS) $(OBJ) $(LIBS)
 
 $(OBJ): imapfilter.h
 buffer.o imap.o imapfilter.o namespace.o request.o response.o: buffer.h
@@ -43,21 +36,16 @@ auth.o cert.o imap.o imapfilter.o log.o 
 imapfilter.o: version.h
 
 install: $(BIN)
-	if test ! -d $(BINDIR); then mkdir -p $(BINDIR); fi
-	cp -f $(BIN) $(BINDIR) && chmod 0755 $(BINDIR)/$(BIN)
-	if test ! -d $(SHAREDIR); then mkdir -p $(SHAREDIR); fi
-	cp -f $(INTERFACE_LUA) $(SHAREDIR) && \
-		chmod 0644 $(SHAREDIR)/$(INTERFACE_LUA)
-	cp -f $(AUXILIARY_LUA) $(SHAREDIR) && \
-		chmod 0644 $(SHAREDIR)/$(AUXILIARY_LUA)
-	cp -f $(REGEX_LUA) $(SHAREDIR) && \
-		chmod 0644 $(SHAREDIR)/$(REGEX_LUA)
-	if test ! -d $(MANDIR)/man1; then mkdir -p $(MANDIR)/man1; fi
-	cp -f $(MAN_BIN) $(MANDIR)/man1 && \
-		chmod 0644 $(MANDIR)/man1/$(MAN_BIN)
-	if test ! -d $(MANDIR)/man5; then mkdir -p $(MANDIR)/man5; fi
-	cp -f $(MAN_CONFIG) $(MANDIR)/man5 && \
-		chmod 0644 $(MANDIR)/man5/$(MAN_CONFIG)
+	$(BSD_INSTALL_PROGRAM_DIR) $(BINDIR)
+	$(BSD_INSTALL_PROGRAM) $(BIN) $(BINDIR)/$(BIN)
+	$(BSD_INSTALL_DATA_DIR) $(SHAREDIR)
+	$(BSD_INSTALL_DATA) $(INTERFACE_LUA) $(SHAREDIR)/$(INTERFACE_LUA)
+	$(BSD_INSTALL_DATA) $(AUXILIARY_LUA) $(SHAREDIR)/$(AUXILIARY_LUA)
+	$(BSD_INSTALL_DATA) $(AUXILIARY_LUA) $(SHAREDIR)/$(REGEX_LUA)
+	$(BSD_INSTALL_MAN_DIR) $(MANDIR)/man1
+	$(BSD_INSTALL_MAN) $(MAN_BIN) $(MANDIR)/man1/$(MAN_BIN)
+	$(BSD_INSTALL_MAN_DIR) $(MANDIR)/man5
+	$(BSD_INSTALL_MAN) $(MAN_CONFIG) $(MANDIR)/man5/$(MAN_CONFIG)
 
 deinstall:
 	rm -f $(BINDIR)/$(BIN) \
