$NetBSD: patch-ab,v 1.3 2002/03/26 20:50:13 rh Exp $

--- mail/main.c.orig	Fri Dec 14 22:28:03 2001
+++ mail/main.c	Tue Mar 26 15:01:12 2002
@@ -36,6 +36,24 @@
 #include "mail.h"
 #include "mail-mt.h"
 
+
+#ifdef __NetBSD__
+#include <gtk/gtk.h>
+#include <pthread.h>
+
+/*
+ * NetBSD uses non-preemptive pth, so we yield the processor periodically
+ */
+
+gint
+pth_nbschedule (gpointer data)
+{
+	pthread_yield_np();
+
+	return TRUE;
+}
+#endif
+
 /*#define DO_MCHECK*/
 
 #ifdef DO_MCHECK
@@ -152,6 +170,10 @@
 		g_mutex_free (gdk_threads_mutex);
 		gdk_threads_mutex = NULL;
 	}
+
+#ifdef __NetBSD__
+	gtk_timeout_add (200, pth_nbschedule, NULL);
+#endif
 
 	GDK_THREADS_ENTER ();
 	bonobo_main ();
