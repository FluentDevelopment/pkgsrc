$NetBSD: patch-ak,v 1.2 2004/05/26 22:18:05 recht Exp $

--- imap/ctl_cyrusdb.c.orig	2004-01-26 18:46:54.000000000 +0100
+++ imap/ctl_cyrusdb.c	2004-05-26 23:57:04.000000000 +0200
@@ -227,9 +227,9 @@
 
     /* create the names of the backup directories */
     strcpy(backup1, dirname);
-    strcat(backup1, ".backup1/");
+    strcat(backup1, ".backup1");
     strcpy(backup2, dirname);
-    strcat(backup2, ".backup2/");
+    strcat(backup2, ".backup2");
 
     syslog(LOG_NOTICE, "%s", msg);
 
@@ -274,6 +274,7 @@
 		struct dirent *dirent;
 
 		tail = backup2 + strlen(backup2);
+		*tail++ = '/';
 
 		/* remove db.backup2 */
 		dirp = opendir(backup2);
@@ -287,7 +288,7 @@
 
 		    closedir(dirp);
 		}
-		*tail = '\0';
+		tail[-1] = '\0';
 		r2 = rmdir(backup2);
 
 		/* move db.backup1 to db.backup2 */
