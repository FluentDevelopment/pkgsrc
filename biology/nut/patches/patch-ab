$NetBSD: patch-ab,v 1.4 2004/03/10 18:37:48 wiz Exp $

--- db.c.orig	2004-02-15 22:36:00.000000000 +0100
+++ db.c
@@ -23,11 +23,12 @@
 #include "meal.h"
 #include "options.h"
 #include "util.h"
-#ifndef DOS
+#ifdef DOS
 #include <tgmath.h>
 #else
 #include <math.h>
 #endif
+#include <errno.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
@@ -691,7 +692,13 @@ void make_filenames(void)
  sprintf(versionfile,"%s/%s","NUTDB",versionfile1);
 #else
 sprintf(nutdir,"%s/%s",getenv("HOME"),nutdir1);
-mkdir (nutdir, 0700 );
+if (mkdir(nutdir, S_IRWXU|S_IRUSR|S_IWUSR|S_IRGRP|S_IROTH) != 0) {
+     if (errno != EEXIST) {
+             printf("Cannot create %s/%s: %s\n", getenv("HOME"), nutdir1,
+                     strerror(errno));
+             exit(1);
+     }
+}
 sprintf(USDAjoined,"%s/%s",FOODDIR,USDAjoined1);
 sprintf(globalFOOD,"%s/%s",FOODDIR,globalFOOD1);
 sprintf(globalNUT,"%s/%s",FOODDIR,globalNUT1);
