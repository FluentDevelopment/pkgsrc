# $NetBSD: transform-sunpro-cc,v 1.20 2006/12/08 05:35:55 rillig Exp $
#
# Copyright (c) 2004 The NetBSD Foundation, Inc.
# All rights reserved.
#
# This code is derived from software contributed to The NetBSD Foundation
# by Johnny C. Lam.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
# 3. All advertising materials mentioning features or use of this software
#    must display the following acknowledgement:
#        This product includes software developed by the NetBSD
#        Foundation, Inc. and its contributors.
# 4. Neither the name of The NetBSD Foundation nor the names of its
#    contributors may be used to endorse or promote products derived
#    from this software without specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY THE NETBSD FOUNDATION, INC. AND CONTRIBUTORS
# ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
# TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
# PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE FOUNDATION OR CONTRIBUTORS
# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
# INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
# CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
# ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
# POSSIBILITY OF SUCH DAMAGE.

transform_setname "transform-sunpro-cc"

case $arg in

# Standard options.
-[cEgOos]	|\
-[DILlU]?*	|\
-O[01]		) transform_pass ;;

# Create dependency lines for Makefiles
-MM		) transform_to "-xM1" ;;

# SunPro can handle -xO<n> (n={1|2|3|4|5}), so optimistically
# convert those GCC -O<n> values to -xO<n>.
-O[2345]	) transform_to "-xO${arg#-O}" ;;

# Ignore all other -O* options.
-O*		) transform_discard_with_warning ;;

# Directories for the runtime library search path are passed via
# simply "-R<dir>", not "-Wl,-R<dir>".
# XXX: Why? For me, -Wl,-R works equally well.
-Wl,-R*		) transform_to "${arg#-Wl,}" ;;
-R*		) transform_pass ;;

# SunPro uses -h to set the shared object name.
-Wl,-soname=*	) transform_to "-h${arg#-Wl,-soname=}" ;;

# Solaris' linker exports all dynamic symbols by default when
# building a shared object.
-Wl,--export-dynamic |\
-Wl,-E		) transform_discard ;;

# Let the options to the linker pass unmodified.
-Wl,*		) transform_pass ;;

# Ignore options that are probably meant for GCC.
-W*		) transform_discard_with_warning ;;

# Solaris' linker uses -Bstatic to create static objects.
-static		) transform_to "-Bstatic" ;;

# Solaris' linker uses -G to create shared objects.
--export-dynamic |\
-shared		) transform_to "-G" ;;

-fPIC		|\
-fpic		) transform_to "-Kpic" ;;

# SunPro needs -mt -lpthread for POSIX threads.
-pthread	) transform_to_and_split "-mt -lpthread" ;;

# -fast implies -xlibmopt, which uses the optimized math
# routines in libsunmath. libsunmath is only available as part of
# SunPro, so disable the use of the optimized math library
# (at least until it can be statically linked).
-fast		) transform_to_and_split "-fast -xnolibmopt" ;;

# Pass through those options that SunPro understands.
-fd		|\
-features*	|\
-flags		|\
-flteval*	|\
-fnonstd*	|\
-fns*		|\
-fprecision*	|\
-fround*	|\
-fsimple*	|\
-fsingle	|\
-fstore		|\
-ftrap*		|\
-mt		|\
-template=*	) transform_pass ;;

# Ignore all other -f flags.
-f*		) transform_discard_with_warning ;;

# Ignore some flags that are unnecessary for SunPro.
-ansi		|\
-pedantic	|\
-pipe		|\
-traditional	) transform_discard ;;

# Unknown options.
-*		) transform_pass_with_warning ;;

esac
