#!/bin/sh
#
######################################################################
#
# NAME
#	list-dependencies -- build package dependencies list
#
# SYNOPSIS
#	list-dependencies bootstrap build full
#
# DESCRIPTION
#	For each (reduced) dependency a line of the following format is
#	printed:
#
#		<depends_type>	<pattern>	<directory>
#
#	Valid dependency types are "bootstrap", "build" and "full".
#
# ENVIRONMENT
#	AWK
#		This is the path to the awk interpreter.
#
#	PKGSRCDIR
#		This is the root of the pkgsrc tree.
#
#	SED
#		This is the path to the sed command.
#
# The following variables are used by the reduce-depends.awk script:
#
#	PKG_ADMIN
#		This is the path to the pkg_admin command.
#
#	PWD_CMD
#		This is the path to the pwd command.
#
######################################################################

: ${ECHO:=echo}
: ${TEST:=test}
: ${CAT:=cat}

set -e

reduce_depends() {
	${AWK} -f ${PKGSRCDIR}/mk/flavor/pkg/reduce-depends.awk "$1"
}

print_entries() {
	reduce_depends "$2" | while read dep; do
		pattern=`${ECHO} "$dep" | ${SED} -e "s,:.*,,"`
		dir=`${ECHO} "$dep" | ${SED} -e "s,.*:,,"`
		[ "$pattern" ]
		[ "$dir" ]
		${ECHO} "$1	$pattern	$dir"
	done
}

if ${TEST} $# != 3;
then
	${ECHO} "list-dependencies must be called with 3 arguments" 1>&2
	exit 1
fi

print_entries bootstrap "$1"
print_entries build "$2"
print_entries full "$3"
