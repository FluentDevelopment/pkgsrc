#!/bin/sh
# $NetBSD: printdepends,v 1.7 2001/07/13 15:14:57 dmcmahill Exp $
#
# Print list of pkg dependencies suitable for tsort(1).
# Start in /usr/pkgsrc.
#
# (c) Copyright 2000 Hubert Feyrer <hubertf@netbsd.org>.
#     All rights reserved.
#

# /usr/pkgsrc
cwd=$PWD

# List of all pkgs, from pkgsrc/*/Makefile
 list=`grep '^[[:space:]]*'SUBDIR */Makefile | sed 's,/Makefile.*=[[:space:]]*,/,'`
#list=`grep '^[^#].*'SUBDIR ma*/Makefile | sed 's,/Makefile.*= *,/,'`
#list=x11/gnome
#list='x11/xteddy x11/xsnow'

for pkgdir in $list
do
	if [ ! -d $pkgdir ]; then
		echo "WARNING:  the package directory $pkgdir is listed in" > /dev/stderr
		echo $pkgdir | sed 's;/.*;/Makefile;g' > /dev/stderr
		echo "but the directory does not exist.  Please fix this!" > /dev/stderr
	else
		cd $pkgdir

		l=`make show-depends-dirs`
		if [ "$l" = "" ]; then
			# No dependencies
			echo "$pkgdir $pkgdir"
		else
			for depdir in $l
			do
				echo "$depdir $pkgdir"
			done
		fi
	fi
	cd $cwd
done

