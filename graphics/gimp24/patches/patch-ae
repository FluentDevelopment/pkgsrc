$NetBSD: patch-ae,v 1.1 2006/04/23 18:29:39 wiz Exp $

--- plug-ins/common/png.c.orig	2005-11-04 21:19:00.000000000 +0100
+++ plug-ins/common/png.c
@@ -1095,12 +1095,10 @@ load_image (const gchar *filename,
    * Done with the file...
    */
 
-  png_read_destroy (pp, info, NULL);
+  png_destroy_read_struct (&pp, &info, NULL);
 
   g_free (pixel);
   g_free (pixels);
-  free (pp);
-  free (info);
 
   fclose (fp);
 
@@ -1553,7 +1551,7 @@ save_image (const gchar *filename,
     }
 
   png_write_end (pp, info);
-  png_write_destroy (pp);
+  png_destroy_read_struct (&pp, &info, NULL);
 
   g_free (pixel);
   g_free (pixels);
@@ -1568,9 +1566,6 @@ save_image (const gchar *filename,
       g_free (text);
     }
 
-  free (pp);
-  free (info);
-
   fclose (fp);
 
   return TRUE;
