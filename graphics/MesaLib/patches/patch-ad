$NetBSD: patch-ad,v 1.3 2004/01/22 12:58:53 adam Exp $

--- src/mesa/Makefile.X11.orig	2004-01-08 23:39:39.000000000 +0000
+++ src/mesa/Makefile.X11
@@ -53,10 +53,10 @@ OBJECTS = \
 ##### RULES #####
 
 .c.o:
-	$(CC) -c $(INCLUDE_DIRS) $(CFLAGS) $< -o $@
+	${LIBTOOL} --mode=compile $(CC) -c $(INCLUDE_DIRS) $(CFLAGS) $< -o $@
 
 .S.o:
-	$(CC) -c $(INCLUDE_DIRS) $(CFLAGS) $< -o $@
+	${LIBTOOL} --mode=compile $(CC) -c $(INCLUDE_DIRS) $(CFLAGS) $< -o $@
 
 
 # need some special rules here, unfortunately
@@ -95,19 +95,16 @@ targets: $(LIBDIR)/$(GL_LIB) $(LIBDIR)/$
 
 # Make the GL library
 $(LIBDIR)/$(GL_LIB): $(OBJECTS)
-	$(TOP)/bin/mklib -o $(GL_LIB_NAME) -major $(GL_MAJOR) \
-		-minor $(GL_MINOR) -patch $(GL_TINY) -install $(LIBDIR) \
-		$(MKLIB_OPTIONS) $(GL_LIB_DEPS) $(OBJECTS)
+	${LIBTOOL} --mode=link ${CC} -o ${GL_LIB:.so=.la} ${OBJECTS:.o=.lo} \
+		-rpath ${PREFIX}/lib -version-info ${GL_MAJOR}:${GL_MINOR}
 
 
 # Make the OSMesa library
 $(LIBDIR)/$(OSMESA_LIB): $(OSMESA_OBJECTS)
 	if [ ${OSMESA_LIB} ] ; then \
-		$(TOP)/bin/mklib -o $(OSMESA_LIB_NAME) -major $(MESA_MAJOR) \
-			-minor $(MESA_MINOR) -patch $(GL_TINY) -L$(LIBDIR) \
-			-l$(GL_LIB_NAME) $(OSMESA_LIB_DEPS) \
-			-install $(LIBDIR) \
-			$(MKLIB_OPTIONS) $(OSMESA_OBJECTS) ; \
+	    ${LIBTOOL} --mode=link ${CC} -o ${OSMESA_LIB:.so=.la} \
+		${OSMESA_OBJECTS:.o=.lo} -rpath ${PREFIX}/lib \
+		-version-info ${MESA_MAJOR}:${MESA_MINOR} ; \
 	fi
 
 
