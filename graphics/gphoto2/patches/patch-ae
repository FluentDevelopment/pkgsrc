$NetBSD: patch-ae,v 1.1 2001/07/08 21:44:27 veego Exp $

--- camlibs/kodak/dc240/library.c	2001/01/22 21:25:24	1.3
+++ camlibs/kodak/dc240/library.c	2001/07/04 08:54:14	1.4
@@ -378,7 +378,10 @@
     free(p1);
     free(p2);
     x=2;
-    while (x < file->size) {
+    /* since directory entries are 20 bytes, it is possible that */
+    /* we find some garbage. Ignore it. TODO: check that there is */
+    /* not another bug involving reading this info */
+    while ((x < file->size) && (file->size - x >= 20)) {
         if ((file->data[x] != '.') &&
             (attrib == (unsigned char)file->data[x+11]))  {
             /* Files have attrib 0x00, Folders have attrib 0x10 */
@@ -448,6 +451,9 @@
 
     free(cmd_packet);
     free(path_packet);
+
+    strcpy(file->name, filename);
+    strcpy(file->type, "image/jpeg");
 
     return (retval);
 }
