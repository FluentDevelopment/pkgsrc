$NetBSD: patch-aa,v 1.23 2006/04/16 19:39:46 wiz Exp $

--- scripts/makefile.std.orig	2006-03-06 17:06:28.000000000 +0000
+++ scripts/makefile.std
@@ -4,7 +4,7 @@
 # For conditions of distribution and use, see copyright notice in png.h
 
 # where make install puts libpng.a and png.h
-prefix=/usr/local
+prefix=${PREFIX}
 INCPATH=$(prefix)/include
 LIBPATH=$(prefix)/lib
 
@@ -24,45 +24,34 @@ DESTDIR=
 ZLIBLIB=../zlib
 ZLIBINC=../zlib
 
-CC=cc
+CC=${LIBTOOL} --mode=compile ${REALCC}
 AR_RC=ar rc
 MKDIR_P=mkdir
 LN_SF=ln -sf
 RANLIB=ranlib
 RM_F=rm -f
 
-CFLAGS=-I$(ZLIBINC) -O # -g -DPNG_DEBUG=5
-LDFLAGS=-L. -L$(ZLIBLIB) -lpng -lz -lm
+#CFLAGS=-I$(ZLIBINC) -O # -g -DPNG_DEBUG=5
+#LDFLAGS=-L. -L$(ZLIBLIB) -lpng -lz -lm
 
 OBJS = png.o pngset.o pngget.o pngrutil.o pngtrans.o pngwutil.o \
 	pngread.o pngrio.o pngwio.o pngwrite.o pngrtran.o \
 	pngwtran.o pngmem.o pngerror.o pngpread.o
 
-all: libpng.a pngtest
+all: libpng.la pngtest
 
-libpng.a: $(OBJS)
-	$(AR_RC) $@  $(OBJS)
-	$(RANLIB) $@
-
-pngtest: pngtest.o libpng.a
-	$(CC) -o pngtest $(CFLAGS) pngtest.o $(LDFLAGS)
+libpng.la: $(OBJS)
+	${LIBTOOL} --mode=link $(REALCC) -o $@ ${OBJS:.o=.lo} -rpath $(LIBPATH) ${LDFLAGS} -lz -lm -version-info ${LIBPNG_SO_MAJOR}:${LIBPNG_SO_MINOR}
+  
+pngtest: pngtest.o libpng.la
+	${LIBTOOL} --mode=link $(REALCC) -o pngtest $(CFLAGS) pngtest.o ${LDFLAGS} libpng.la -lz -lm
 
 test: pngtest
 	./pngtest
 
-install: libpng.a
-	-@$(MKDIR_P) $(DESTDIR)$(INCPATH)
-	-@$(MKDIR_P) $(DESTDIR)$(INCPATH)/libpng
-	-@$(MKDIR_P) $(DESTDIR)$(LIBPATH)
-	-@$(RM_F) $(DESTDIR)$(INCPATH)/png.h
-	-@$(RM_F) $(DESTDIR)$(INCPATH)/pngconf.h
-	cp png.h $(DESTDIR)$(INCPATH)/libpng
-	cp pngconf.h $(DESTDIR)$(INCPATH)/libpng
-	chmod 644 $(DESTDIR)$(INCPATH)/libpng/png.h
-	chmod 644 $(DESTDIR)$(INCPATH)/libpng/pngconf.h
-	(cd $(DESTDIR)$(INCPATH); ln -f -s libpng/* .)
-	cp libpng.a $(DESTDIR)$(LIBPATH)
-	chmod 644 $(DESTDIR)$(LIBPATH)/libpng.a
+install: libpng.la
+	${BSD_INSTALL_DATA} png.h pngconf.h $(INCPATH)
+	${LIBTOOL} --mode=install ${BSD_INSTALL_LIB} libpng.la $(LIBPATH)
 
 clean:
 	$(RM_F) *.o libpng.a pngtest pngout.png
