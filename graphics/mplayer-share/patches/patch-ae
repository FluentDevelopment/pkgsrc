$NetBSD: patch-ae,v 1.1 2003/05/25 07:12:55 dan Exp $

--- libmpdemux/tvi_bsdbt848.c.orig	2003-01-15 05:20:17.000000000 +1100
+++ libmpdemux/tvi_bsdbt848.c	2003-05-25 16:40:00.000000000 +1000
@@ -41,6 +41,7 @@
 
 #ifdef __NetBSD__
 #include <dev/ic/bt8xx.h>
+#include <sys/audioio.h>
 #else
 #include <machine/ioctl_meteor.h>
 #include <machine/ioctl_bt848.h>
@@ -777,14 +778,29 @@
 static int get_audio_framesize(priv_t *priv)
 {
 int bytesavail;
+#ifdef __NetBSD__
+struct audio_info auinf;
+#endif
 
 if(priv->dspready == FALSE) return 0;
 
+#ifdef __NetBSD__
+if(ioctl(priv->dspfd, AUDIO_GETINFO, &auinf) < 0)
+    {
+    perror("AUDIO_GETINFO");
+    return(TVI_CONTROL_FALSE);
+    }
+else
+    {
+    bytesavail = auinf.record.seek; /* * priv->dspsamplesize; */
+    }
+#else
 if(ioctl(priv->dspfd, FIONREAD, &bytesavail) < 0) 
     {
     perror("FIONREAD");
     return(TVI_CONTROL_FALSE);
     }
+#endif
 
 /* When mencoder wants audio data, it wants data..
    it wont go do anything else until it gets it :( */
