$NetBSD: patch-aa,v 1.4 2002/11/01 10:19:18 jlam Exp $

--- configure.orig	Thu Oct 24 14:12:40 2002
+++ configure
@@ -298,8 +298,8 @@ for ac_option do
     _inc_extra=-I`echo $ac_option | cut -d '=' -f 2 | sed 's,:, -I,g'`
     ;;
   --with-extralibdir=*)
-    _ld_extra=-L`echo $ac_option | cut -d '=' -f 2 | sed 's,:, -L,g'`
-#    _ld_extra="${_ld_extra} -Wl,-R"`echo $ac_option | cut -d '=' -f 2 | sed 's,:, -Wl\,-R,g'`" -L"`echo $ac_option | cut -d '=' -f 2 | sed 's,:, -L,g'`
+#    _ld_extra=-L`echo $ac_option | cut -d '=' -f 2 | sed 's,:, -L,g'`
+    _ld_extra="${_ld_extra} -Wl,-R"`echo $ac_option | cut -d '=' -f 2 | sed 's,:, -Wl\,-R,g'`" -L"`echo $ac_option | cut -d '=' -f 2 | sed 's,:, -L,g'`
     ;;
   --enable-runtime-cpudetection)
     _runtime_cpudetection=yes
@@ -2970,8 +2970,22 @@ if test "$_ossaudio" = yes ; then
     _def_ossaudio_devdsp='#define PATH_DEV_DSP "/dev/sound/dsp"'
     _def_ossaudio_devmixer='#define PATH_DEV_MIXER "/dev/sound/mixer"'
   else
-     if netbsd || openbsd ; then
+     cat > $TMPC << EOF
+#include <sys/ioctl.h>
+$_inc_soundcard
+#ifdef OPEN_SOUND_SYSTEM
+int main(void) { return 0; }
+#else
+#error Not the real thing
+#endif
+EOF
+     _real_ossaudio=no
+     cc_check && _real_ossaudio=yes
+     if test "$_real_ossaudio" = yes; then
+       _def_ossaudio_devdsp='#define PATH_DEV_DSP "/dev/dsp"'
+     elif netbsd || openbsd ; then
        _def_ossaudio_devdsp='#define PATH_DEV_DSP "/dev/sound"'
+       netbsd && _ld_arch="$_ld_arch -lossaudio"
        openbsd && _ld_arch="$_ld_arch -lossaudio"
      else
        _def_ossaudio_devdsp='#define PATH_DEV_DSP "/dev/dsp"'
@@ -4324,7 +4338,6 @@ test "$_real" = yes && _ld_dl_dynamic='-
 _ld_arch="$_ld_arch $_ld_pthread $_ld_dl $_ld_dl_dynamic"
 bsdos && _ld_arch="$_ld_arch -ldvd"
 if netbsd ; then
-  _ld_arch="$_ld_arch -lossaudio"
   x86 && _ld_arch="$_ld_arch -li386"
 fi
 
