$NetBSD: patch-ag,v 1.1 2005/03/16 18:32:50 rillig Exp $

gcc-2.95.3 cannot handle declarations intermixed with code.

--- app/convert.c.orig	Tue Nov 23 12:58:15 2004
+++ app/convert.c	Wed Mar 16 18:25:45 2005
@@ -310,6 +310,9 @@ convert_image_colorspace (void *gimage_p
     /*  get the profiles */
     GSList *profiles = NULL;
     CMSProfile *image_profile = gimage_get_cms_profile(image);
+    DWORD lcms_format_in, lcms_format_out;
+    CMSTransform *transform;
+
     if (image_profile == NULL)
     {   g_warning("convert_image_colourspace: No cms profile assigned to gimage. Cannot convert.");
         return;
@@ -318,10 +321,10 @@ convert_image_colorspace (void *gimage_p
     profiles = g_slist_append(profiles, (gpointer)new_profile);
 
     /* assuming all layers have homogenous alpha */
-    DWORD lcms_format_in  = cms_get_lcms_format(
+    lcms_format_in  = cms_get_lcms_format(
                               drawable_tag(GIMP_DRAWABLE(image->active_layer)),
                               gimage_get_cms_profile(image)  );
-    DWORD lcms_format_out = cms_get_lcms_format(
+    lcms_format_out = cms_get_lcms_format(
                               drawable_tag(GIMP_DRAWABLE(image->active_layer)),
                               new_profile  );
     if  (!(int)lcms_format_in || !(int)lcms_format_out)
@@ -330,7 +333,7 @@ convert_image_colorspace (void *gimage_p
         return;
     } 
 
-    CMSTransform *transform = cms_get_transform(profiles, lcms_format_in, lcms_format_out, lcms_intent, cms_default_flags);
+    transform = cms_get_transform(profiles, lcms_format_in, lcms_format_out, lcms_intent, cms_default_flags);
     g_slist_free(profiles);
     gimage_transform_colors(image, transform, TRUE);
     cms_return_transform(transform);    
