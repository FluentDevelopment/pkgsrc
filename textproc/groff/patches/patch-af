$NetBSD: patch-af,v 1.1 2004/05/08 03:21:57 jschauma Exp $

--- ./src/preproc/html/pre-html.cpp.orig	Fri May  7 17:51:50 2004
+++ ./src/preproc/html/pre-html.cpp	Fri May  7 17:52:08 2004
@@ -263,7 +263,7 @@
     n = vsnprintf (p, size, fmt, ap);
     va_end(ap);
     /* If that worked, return the string. */
-    if (n > -1 && n < size) {
+    if (n > -1 && n < size-1) {
       if (size > n+1) {
 	np = strsave(p);
 	free(p);
@@ -272,8 +272,6 @@
       return p;
     }
     /* Else try again with more space. */
-    if (n > -1)    /* glibc 2.1 */
-      size = n+1; /* precisely what is needed */
     else           /* glibc 2.0 */
       size *= 2;  /* twice the old size */
     if ((np = (char *)realloc (p, size)) == NULL) {
