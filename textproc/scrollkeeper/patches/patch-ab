$NetBSD: patch-ab,v 1.3 2003/02/18 14:39:04 jmmv Exp $

--- libs/i18n.c.orig	2003-01-23 07:10:57.000000000 +0100
+++ libs/i18n.c
@@ -62,21 +62,31 @@ static int explode_locale(const char *lo
 
 	if (dot_pos) {
 		mask |= CODESET;
-		*codeset = strndup(dot_pos, at_pos - dot_pos);
-	} else {
+		*codeset = (char*) malloc(at_pos - dot_pos + 1);
+		strncpy(*codeset, dot_pos, at_pos - dot_pos);
+		*codeset[at_pos - dot_pos] = '\0';
+	}
+	if (!dot_pos || !*codeset) {
 		dot_pos = at_pos;
 		*codeset = strdup("");
 	}
 
 	if (uscore_pos) {
 		mask |= TERRITORY;
-		*territory = strndup(uscore_pos, dot_pos - uscore_pos);
-	} else {
+		*territory = (char*) malloc(dot_pos - uscore_pos + 1);
+		strncpy(*territory, uscore_pos, dot_pos - uscore_pos);
+		*territory[dot_pos - uscore_pos] = '\0';
+	}
+	if (!uscore_pos || !*territory) {
 		uscore_pos = dot_pos;
 		*territory = strdup("");
 	}
 
-	*language = strndup(locale, uscore_pos - locale);
+	*language = (char*) malloc(uscore_pos - locale + 1);
+	if (*language) {
+		strncpy(*language, locale, uscore_pos - locale);
+		*language[uscore_pos - locale] = '\0';
+	}
 
 	return mask;
 }
