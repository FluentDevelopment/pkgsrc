$NetBSD: patch-ac,v 1.1 2002/10/06 14:51:28 taca Exp $

--- src/kakasi.c.orig	Sun Sep  2 20:43:21 2001
+++ src/kakasi.c
@@ -41,6 +41,9 @@
 #ifdef HAVE_MALLOC_H
 # include <malloc.h>
 #endif
+#ifdef HAVE_STRING_H
+# include <string.h>
+#endif
 #include <stdlib.h>
 #include "kakasi.h"
 #ifdef LIBRARY
@@ -559,7 +562,13 @@ kakasi_do(str)
 		} else if (c[0].c1 == 0xa5) {
 		    ptype = 5;
 		} else if ((c[0].c1 == 0xa1) && (c[0].c2 == 0xbc)) {
+		  if (pctype == 5) {
+		    ptype = 5;
+		  } else if (pctype == 6) {
+		    ptype = 6;
+		  } else {
 		    ptype = 5;
+		  }
 		} else {
 		    ptype = 4;
 		}
@@ -604,7 +613,7 @@ kakasi_do(str)
     {
 	char *ret = getpbstr();
 	if (ret == NULL)
-	    return "";
+	    return strdup("");
 	return ret;
     }
 #endif
