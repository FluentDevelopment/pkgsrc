#!/bin/sh
#
# $NetBSD: INSTALL,v 1.1 2001/10/31 22:52:48 zuntum Exp $

PKGNAME=$1
STAGE=$2

AMUSER=@AMUSER@
AMGROUP=@AMGROUP@
AMVAR=@AMVAR@
ADDUSER=@ADDUSER@
ADDGROUP=@ADDGROUP@
CHGRP="@CHGRP@"
CHMOD="@CHMOD@"
CHOWN="@CHOWN@"
ID="@ID@"
MKDIR="@MKDIR@"
RM="@RM@"
TOUCH="@TOUCH@"

case ${STAGE} in
PRE-INSTALL)
	# Group... the default's shipped with NetBSD
	# We need to check that ${AMGROUP} exists before adding the user.
	#
	${TOUCH} "/tmp/grouptestamanda.$$"
	${CHGRP} ${AMGROUP} "/tmp/grouptestamanda.$$" >/dev/null 2>&1
	if [ $? -eq 0 ]; then
		echo "Group '${AMGROUP}' already exists...proceeding."
	else
		echo "Creating '${AMGROUP}' group..."
		${ADDGROUP} ${AMGROUP}
		echo "Done."
	fi
	${RM} -f "/tmp/grouptestamanda.$$"

	${ID} ${AMUSER} >/dev/null 2>&1
	if [ $? -eq 0 ]; then
		echo "User '${AMUSER}' already exists...proceeding."
	else
		echo "Creating '${AMUSER}' user..."
		${ADDUSER} -c "Amanda User" -g ${AMGROUP} -s /bin/sh ${AMUSER}
		echo "Done."
	fi
	;;

POST-INSTALL)
	${MKDIR} ${AMVAR}
	${CHMOD} 700 ${AMVAR}
	${CHOWN} ${AMUSER}:${AMGROUP} ${AMVAR}

	${MKDIR} ${AMVAR}/gnutar-lists
	${CHMOD} 700 ${AMVAR}/gnutar-lists
	${CHOWN} ${AMUSER}:${AMGROUP} ${AMVAR}/gnutar-lists
	;;

*)
	echo "Unexpected argument: ${STAGE}"
	exit 1
	;;
esac
exit 0
