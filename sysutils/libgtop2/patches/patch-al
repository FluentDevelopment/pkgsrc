$NetBSD: patch-al,v 1.4 2006/06/26 12:14:25 drochner Exp $

--- sysdeps/freebsd/procmem.c.orig	2005-12-12 11:09:39.000000000 +0100
+++ sysdeps/freebsd/procmem.c
@@ -63,6 +63,10 @@
 #include <uvm/uvm.h>
 #endif
 
+#ifdef __NetBSD__
+#include <sys/resourcevar.h>
+#endif
+
 static const unsigned long _glibtop_sysdeps_proc_mem =
 (1L << GLIBTOP_PROC_MEM_SIZE) +
 (1L << GLIBTOP_PROC_MEM_VSIZE) +
@@ -214,8 +218,8 @@ glibtop_get_proc_mem_p (glibtop *server,
 			return;
 		}
 
-#ifdef __FreeBSD__
-#if __FreeBSD__ >= 4
+#if defined(__FreeBSD__) || defined(__DragonFly__)
+#if defined(__DragonFly__) || (defined(__FreeBSD__) && __FreeBSD__ >= 4)
 		if (entry.eflags & (MAP_ENTRY_IS_SUB_MAP))
 			continue;
 #else
