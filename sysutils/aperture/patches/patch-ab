$NetBSD: patch-ab,v 1.5 2002/09/15 19:25:38 tron Exp $

--- module/xf86_mod.c.orig	Sun Sep 15 21:18:40 2002
+++ module/xf86_mod.c	Sun Sep 15 21:22:02 2002
@@ -31,7 +31,11 @@
 	0,
 	seltrue, xf86mmap, 0};
 
+#if __NetBSD_Version__ >= 106080000
+MOD_DEV("xf86", "xf86ap", NULL, -1, &newdev, -1)
+#else
 MOD_DEV("xf86", LM_DT_CHAR, -1, &newdev)
+#endif
 
 char *xf86_major_version = "2";
 char *xf86_minor_version = "0";
@@ -76,7 +80,10 @@
 		
 	case LKM_E_UNLOAD:
 		/* Free allocated memory */
-		free(mem_range_softc.mr_desc, M_MEMDESC);
+		if (mem_range_softc.mr_desc != NULL) {
+			free(mem_range_softc.mr_desc, M_MEMDESC);
+			mem_range_softc.mr_desc = NULL;
+		}
 		break;
 		
 	case LKM_E_STAT:
