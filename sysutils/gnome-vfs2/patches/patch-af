--- libgnomevfs/gnome-vfs-cdrom.c.orig	Sun Oct 24 16:56:46 2004
+++ libgnomevfs/gnome-vfs-cdrom.c	Sun Oct 24 16:56:17 2004
@@ -37,6 +37,8 @@
 
 #ifdef __linux__
 #include <linux/cdrom.h>
+#else
+#include <modules/cdda-cdrom-extensions.h>
 #endif
 
 #ifdef HAVE_SYS_CDIO_H
@@ -87,8 +89,9 @@
 	}
 
 	return type;
-#elif defined(HAVE_SYS_MNTCTL_H)
-	return CDS_NO_INFO;
+#elif defined(__linux__)
+	*fd = open (vol_dev_path, O_RDONLY|O_NONBLOCK);
+	return ioctl (*fd, CDROM_DISC_STATUS, CDSL_CURRENT);
 #elif defined(__FreeBSD__) || defined(__OpenBSD__) || defined(__NetBSD__) || defined(__DragonFly__)
 	struct ioc_toc_header header;
 #if defined(__FreeBSD__) || defined(__DragonFly__)
@@ -143,6 +146,7 @@
 #endif /* defined(__FreeBSD__) */
 	return type;
 #else
+	#if !defined(__APPLE__)
 	*fd = open (vol_dev_path, O_RDONLY|O_NONBLOCK);
 	if (*fd  < 0) {
 		return -1;
@@ -153,6 +157,7 @@
 		return -1;
 	}
 	return ioctl (*fd, CDROM_DISC_STATUS, CDSL_CURRENT);
+	#endif
 #endif
 }
 
