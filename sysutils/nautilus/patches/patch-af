$NetBSD: patch-af,v 1.1 2003/05/04 01:10:58 rh Exp $

--- src/nautilus-main.c.orig	Sat Mar 15 01:34:55 2003
+++ src/nautilus-main.c
@@ -56,6 +56,24 @@
 #include <stdlib.h>
 #include <unistd.h>
 
+#ifdef __NetBSD__
+#include <pthread.h>
+
+/*
+ * Pth is non-preemptive, so we yield the processor periodically
+ */
+
+#ifdef _PTH_PTHREAD_H_
+static gint
+pth_nbschedule (gpointer data)
+{
+	sched_yield();
+
+	return TRUE;
+}
+#endif /* _PTH_PTHREAD_H_ */
+#endif /* __NetBSD__ */
+
 /* Keeps track of everyone who wants the main event loop kept active */
 static GSList *event_loop_registrants;
 
@@ -259,6 +277,10 @@ main (int argc, char *argv[])
 	} else {
 		/* Run the nautilus application. */
 		application = nautilus_application_new ();
+
+#ifdef _PTH_PTHREAD_H_
+	gtk_timeout_add (200, pth_nbschedule, NULL);
+#endif
 		nautilus_application_startup
 			(application,
 			 kill_shell, restart_shell, no_default_window, no_desktop,
