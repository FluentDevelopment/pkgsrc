#!/bin/sh
#
# Copyright (c) 2003 Hubert Feyrer <hubertf@netbsd.org>
#

tmp=/tmp/dmesg2gif.$$.dot

# Clean up things on ^C
trap "rm -r $tmp ; exit 1" INT

if [ -t 0 -o -t 1 ]
then
	echo 2>&1 "Usage: cat /var/run/dmesg.boot | $0 | xv -"
	exit 1
fi


(
	echo "digraph dmesg { "
	cat \
	| grep -v ^# \
	| perl -ne 'if(/^(\S*) at (\S*) *.*/){
			$from=$1; 
			$to=$2; 
			$to=~s/://; 
			print "\t$from -> $to\n"; 
		}'
	echo "}"
) > $tmp
dot -Tgif $tmp

rm $tmp
