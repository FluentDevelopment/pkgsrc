$NetBSD: patch-aa,v 1.12 2004/05/09 20:32:10 fredb Exp $

--- src/sysdeps/bsd-common.c.orig	2004-01-13 13:32:34.000000000 -0600
+++ src/sysdeps/bsd-common.c
@@ -255,7 +255,11 @@
 gkrellm_sys_fs_get_mounts_list(void)
 	{
 	gchar		*s, *dev, *dir, *type;
+#if (defined(__NetBSD__) && __NetBSD_Version__ >= 200040000) /* NetBSD 2.0D */
+	struct statvfs	*mntbuf;
+#else
 	struct statfs	*mntbuf;
+#endif
 	gint		mntsize, i;
 
 	if ((mntsize = getmntinfo(&mntbuf, MNT_NOWAIT)) == 0)
@@ -281,12 +285,20 @@
 void
 gkrellm_sys_fs_get_fsusage(gpointer fs, gchar *dir)
 	{
+#if (defined(__NetBSD__) && __NetBSD_Version__ >= 200040000) /* NetBSD 2.0D */
+	struct statvfs	st;
+#else
 	struct statfs	st;
+#endif
 
+#if (defined(__NetBSD__) && __NetBSD_Version__ >= 200040000) /* NetBSD 2.0D */
+	if (!statvfs(dir, &st))
+#else
 	if (!statfs(dir, &st))
+#endif
 		gkrellm_fs_assign_fsusage_data(fs,
 					(glong) st.f_blocks, (glong) st.f_bavail,
-					(glong) st.f_bfree, (glong) st.f_bsize);
+					(glong) st.f_bfree, (glong) st.f_frsize);
 	else
 		gkrellm_fs_assign_fsusage_data(fs, 0, 0, 0, 0);
 	}
