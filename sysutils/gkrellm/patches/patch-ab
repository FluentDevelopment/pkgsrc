$NetBSD: patch-ab,v 1.4 2001/09/08 21:53:57 zuntum Exp $

--- src/Makefile.src.orig	Sat Jul 21 20:59:58 2001
+++ src/Makefile.src
@@ -1,4 +1,4 @@
-GTK_CONFIG ?= gtk-config
+#GTK_CONFIG ?= gtk-config
 BINMODE ?= 755
 INSTALLDIR ?= /usr/local/bin
 INCLUDEDIR ?= /usr/local/include
@@ -12,15 +12,17 @@
 GKRELLM_INCLUDES = gkrellm.h gkrellm_public_proto.h
 
 GTK_INCLUDE = `$(GTK_CONFIG) --cflags gthread`
-IMLIB_INCLUDE = `imlib-config --cflags-gdk`
+IMLIB_INCLUDE = `$(IMLIB_CONFIG) --cflags-gdk`
 
 GTK_LIB = `$(GTK_CONFIG) --libs gthread`
-IMLIB_LIB = `imlib-config --libs-gdk`
+IMLIB_LIB = `$(IMLIB_CONFIG) --libs-gdk`
 
-FLAGS = -O2 -I.. $(GTK_INCLUDE) $(IMLIB_INCLUDE) $(GTOP_INCLUDE)
+FLAGS = -I.. $(GTK_INCLUDE) $(IMLIB_INCLUDE) $(GTOP_INCLUDE)
 FLAGS+= $(PTHREAD_INC)
 
-LIBS = $(GTK_LIB) $(IMLIB_LIB) $(GTOP_LIBS) $(SYS_LIBS)
+FLAGS+= -DSYSTEM_PLUGINS_DIR=\"${PREFIX}/lib/gkrellm/plugins\"
+
+LIBS = $(GTK_LIB) $(IMLIB_LIB) $(GTOP_LIBS) $(SYS_LIBS) -Wl,-E
 
 ifeq ($(debug),1)
     FLAGS += -g
@@ -35,7 +37,7 @@
 endif
 
 
-CC = gcc -Wall $(FLAGS) $(CFLAGS)
+CC += -Wall $(FLAGS) $(CFLAGS)
 
 OBJS =	main.o alerts.o apm.o clock.o cpu.o disk.o fs.o hostname.o \
 	inet.o mail.o meminfo.o net.o proc.o sensors.o uptime.o \
