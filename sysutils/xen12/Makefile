# $NetBSD: Makefile,v 1.6 2004/05/23 17:50:57 recht Exp $
#

DISTNAME=		xeno-1.2-src-040418
PKGNAME=		xen12-040418
CATEGORIES=		sysutils
MASTER_SITES=		ftp://ftp.NetBSD.org/pub/NetBSD/arch/xen/misc/
EXTRACT_SUFX=		.tgz
DISTFILES=		${DISTNAME}${EXTRACT_SUFX}
DISTFILES+=		xen12-addtl-ide-dma-040522.tar.gz

MAINTAINER=		cl@NetBSD.org
HOMEPAGE=		http://www.NetBSD.org/Ports/xen/
COMMENT=		Xen Virtual Machine Monitor

ONLY_FOR_PLATFORM=	*-*-i386

WRKSRC=			${WRKDIR}/xeno-1.2/xen
ALL_TARGET=		default

USE_PKGINSTALL=		yes

USE_GNU_TOOLS+=		make

.include "../../mk/bsd.prefs.mk"

BUILD_DEFS+=		XEN12_USE_COM2

.if defined(XEN12_USE_COM2) && !empty(XEN12_USE_COM2:M[Yy][Ee][Ss])
PATCHFILES+=		xen12-com2-support-040522.diff
SITES_xen12-com2-support-040522.diff=ftp://ftp.NetBSD.org/pub/NetBSD/arch/xen/misc/
.endif

post-extract:
	@${CP} ${FILESDIR}/gcc333-stdarg.h ${WRKSRC}/include/stdarg.h
	@${CP} ${WRKDIR}/xen12-addtl-ide-dma-040522/drivers/ide/* ${WRKSRC}/drivers/ide/

do-install:
	${INSTALL_DATA_DIR} ${PREFIX}/mdec
	${INSTALL_DATA} ${WRKSRC}/xen.gz ${PREFIX}/mdec/xen-1.2.gz

.include "../../mk/bsd.pkg.mk"
