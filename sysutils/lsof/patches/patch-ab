$NetBSD: patch-ab,v 1.22 2003/08/13 13:24:16 atatat Exp $

Patch for vnode/DNLC interface change courtesy of lsof maintainer.

--- Configure.orig	2003-06-11 20:55:38.000000000 -0400
+++ Configure
@@ -819,10 +819,13 @@
 	LSOF_CFGF="$LSOF_CFGF -DHASFDLINK"
       fi	# }
     fi	# }
-    grep -q nc_vpid ${LSOF_INCLUDE}/sys/namei.h
-    if test $? -eq 0	# {
+    if test -r ${LSOF_INCLUDE}/sys/namei.h
     then
-      LSOF_CFGF="$LSOF_CFGF -DHASNCVPID"
+      grep -q nc_vpid ${LSOF_INCLUDE}/sys/namei.h
+      if test $? -eq 0	# {
+      then
+        LSOF_CFGF="$LSOF_CFGF -DHASNCVPID"
+      fi	# }
     fi	# }
     if test $LSOF_VERS -ge 40000	# {
     then
@@ -938,6 +941,14 @@
 	exit 1
       fi	# }
     fi	# }
+    if test -r ${LSOF_INCLUDE}/sys/namei.h
+    then
+      grep -q nc_vpid ${LSOF_INCLUDE}/sys/namei.h
+      if test $? -eq 0	# {
+      then
+        LSOF_CFGF="$LSOF_CFGF -DHASNCVPID"
+      fi	# }
+    fi	# }
     LSOF_DINC="$LSOF_DINC -I`pwd`/dialects/darwin/xnu/bsd"
     LSOF_DINC="$LSOF_DINC -I/usr/include"
     LSOF_DINC="$LSOF_DINC -I${DARWIN_SYSDIR}/System.framework/PrivateHeaders"
@@ -1175,6 +1186,14 @@
 
       LSOF_CFGF="$LSOF_CFGF -DHASIPv6"
     fi	# }
+    if test -r ${LSOF_INCLUDE}/sys/namei.h
+    then
+      grep -q nc_vpid ${LSOF_INCLUDE}/sys/namei.h
+      if test $? -eq 0	# {
+      then
+        LSOF_CFGF="$LSOF_CFGF -DHASNCVPID"
+      fi	# }
+    fi	# }
     LSOF_DIALECT_DIR=du
     ;;
 
@@ -1526,10 +1545,13 @@
       fi	# }
       LSOF_CFGF="$LSOF_CFGF -DHAS9660FS"
     fi	# }
-    grep -q nc_vpid ${LSOF_INCLUDE}/sys/namei.h
-    if test $? -eq 0	# {
+    if test -r ${LSOF_INCLUDE}/sys/namei.h
     then
-      LSOF_CFGF="$LSOF_CFGF -DHASNCVPID"
+      grep -q nc_vpid ${LSOF_INCLUDE}/sys/namei.h
+      if test $? -eq 0	# {
+      then
+        LSOF_CFGF="$LSOF_CFGF -DHASNCVPID"
+      fi	# }
     fi	# }
     if test $LSOF_DINC_ADD -eq 1	# {
     then
@@ -2241,10 +2263,13 @@
     then
       LSOF_DINC="-I$LSOF_INCLUDE -I$NETBSD_SYS"
     fi	# }
-    grep -q nc_vpid ${LSOF_INCLUDE}/sys/namei.h
-    if test $? -eq 0	# {
+    if test -r ${LSOF_INCLUDE}/sys/namei.h
     then
-      LSOF_CFGF="$LSOF_CFGF -DHASNCVPID"
+      grep -q nc_vpid ${LSOF_INCLUDE}/sys/namei.h
+      if test $? -eq 0	# {
+      then
+        LSOF_CFGF="$LSOF_CFGF -DHASNCVPID"
+      fi	# }
     fi	# }
     grep -q i_ffs_size ${LSOF_INCLUDE}/ufs/ufs/inode.h
     if test $? -eq 0	# {
@@ -2645,10 +2670,13 @@
 	LSOF_CFGF="$LSOF_CFGF -DHASI_E2FS_PTR"
       fi	# }
     fi	# }
-    grep -q nc_vpid ${LSOF_INCLUDE}/sys/namei.h
-    if test $? -eq 0	# {
+    if test -r ${LSOF_INCLUDE}/sys/namei.h
     then
-      LSOF_CFGF="$LSOF_CFGF -DHASNCVPID"
+      grep -q nc_vpid ${LSOF_INCLUDE}/sys/namei.h
+      if test $? -eq 0	# {
+      then
+        LSOF_CFGF="$LSOF_CFGF -DHASNCVPID"
+      fi	# }
     fi	# }
     if test "X$OPENBSD_UVM" = "X"	# {
     then
