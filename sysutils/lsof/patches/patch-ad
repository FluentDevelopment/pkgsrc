$NetBSD: patch-ad,v 1.7 2004/04/29 04:19:23 atatat Exp $

Make lsof use statvfs on NetBSD where available.

--- dialects/n+obsd/dnode.c.orig	2004-01-14 06:29:19.000000000 -0500
+++ dialects/n+obsd/dnode.c
@@ -745,7 +745,13 @@ process_overlaid_node:
 #if	defined(HASKERNFS)
 	case KERNFSNODE:
 	    if (vfs) {
+
+# if	defined(HASSTATVFS)
+		dev = (dev_t)vfs->fsid.__fsid_val[0];
+# else	/* !defined(HASSTATVFS) */
 		dev = (dev_t)vfs->fsid.val[0];
+# endif	/* defined(HASSTATVFS) */
+
 		devs = 1;
 	    }
 	    break;
@@ -1069,7 +1075,13 @@ process_overlaid_node:
  * 
  */
 	if (nvfs) {
+
+# if	defined(HASSTATVFS)
+	    dev = nvfs->fsid.__fsid_val[0];
+# else	/* !defined(HASSTATVFS) */
 	    dev = nvfs->fsid.val[0];
+# endif	/* defined(HASSTATVFS) */
+
 	    devs = 1;
 	}
 #endif	/* defined(HASNULLFS) */
