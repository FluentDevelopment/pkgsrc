$NetBSD: patch-ad,v 1.11 2006/06/04 21:00:54 christos Exp $

--- dialects/n+obsd/dnode.c.orig	2005-08-08 15:53:32.000000000 -0400
+++ dialects/n+obsd/dnode.c	2006-06-04 16:57:22.000000000 -0400
@@ -38,6 +38,10 @@
 
 #include "lsof.h"
 
+#if __NetBSD_Version__ > 399001800
+#define NOLOCKF
+#endif
+
 
 #if	defined(HASFDESCFS) && HASFDESCFS==1
 _PROTOTYPE(static int lkup_dev_tty,(dev_t *dr, INODETYPE *ir));
@@ -183,7 +187,9 @@
 	unsigned char ns;
 	unsigned char rdevs;
 	char *ep, *ty;
+#ifndef NOLOCKF
 	struct lockf lf, *lff, *lfp;
+#endif
 	struct inode i;
 	struct mfsnode m;
 	struct nfsnode n;
@@ -608,6 +614,7 @@
 
 	    }
 
+#ifndef NOLOCKF
 	    if ((lff = i.i_lockf)) {
 
 	    /*
@@ -656,6 +663,7 @@
 		    break;
 		} while ((lfp = lf.lf_next) && lfp != lff);
 	    }
+#endif
 	    break;
 	default:
 	    if (v->v_type == VBAD || v->v_type == VNON)
