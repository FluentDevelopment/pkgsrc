$NetBSD: patch-ad,v 1.12 2007/05/06 21:41:30 christos Exp $

--- dialects/n+obsd/dnode.c.orig	2007-04-24 12:22:06.000000000 -0400
+++ dialects/n+obsd/dnode.c	2007-05-06 16:43:51.000000000 -0400
@@ -38,6 +38,9 @@
 
 #include "lsof.h"
 
+#if __NetBSD_Version__ > 399001800
+#define NOLOCKF
+#endif
 
 #if	defined(HAS_DINODE_U)
 #define	DINODE_U	dinode_u
@@ -194,7 +197,9 @@
 	unsigned char ns;
 	unsigned char rdevs;
 	char *ep, *ty;
+#ifndef NOLOCKF
 	struct lockf lf, *lff, *lfp;
+#endif
 	struct inode i;
 	struct mfsnode m;
 	struct nfsnode n;
@@ -619,6 +624,7 @@
 
 	    }
 
+#ifndef NOLOCKF
 	    if ((lff = i.i_lockf)) {
 
 	    /*
@@ -667,6 +673,7 @@
 		    break;
 		} while ((lfp = lf.lf_next) && lfp != lff);
 	    }
+#endif
 	    break;
 	default:
 	    if (v->v_type == VBAD || v->v_type == VNON)
