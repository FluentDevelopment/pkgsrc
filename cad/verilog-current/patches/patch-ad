$NetBSD: patch-ad,v 1.10 2002/05/07 00:11:21 dmcmahill Exp $

work around a c++ -O2 bug which is present on at least sparc 
and pmax using egcs-1.1.1 

also don't try to strip a script.

--- Makefile.in.orig	Sun May  5 20:50:38 2002
+++ Makefile.in
@@ -189,7 +189,16 @@
 
 lexor.o: lexor.cc parse.h
 
+# make sure no one sneaks a -O* in on us via one of these variables
+# set in the environment
+CXX_NOOPT=$(CXX:-O%=)
+CPPFLAGS_NOOPT=$(CPPFLAGS:-O%=)
+CXXFLAGS_NOOPT=$(CXXFLAGS:-O%=)
+
 parse.o: parse.cc
+	@[ -d dep ] || mkdir dep
+	$(CXX_NOOPT) $(CPPFLAGS_NOOPT) $(CXXFLAGS_NOOPT) -MD -c $< -o $*.o
+	mv $*.d dep/$*.d
 
 parse.h parse.cc: $(srcdir)/parse.y
 	$(YACC) --verbose -t -p VL -d -o parse.cc $(srcdir)/parse.y
@@ -220,7 +229,7 @@
 	for tgt in $(TARGETS); do (cd $$tgt ; $(MAKE) install); done
 
 $(bindir)/iverilog-vpi: ./iverilog-vpi
-	$(INSTALL_PROGRAM) ./iverilog-vpi $(bindir)/iverilog-vpi
+	$(INSTALL_SCRIPT) ./iverilog-vpi $(bindir)/iverilog-vpi
 
 $(libdir)/libvpi.a : ./libvpi.a
 	$(INSTALL_DATA) libvpi.a $(libdir)/libvpi.a
