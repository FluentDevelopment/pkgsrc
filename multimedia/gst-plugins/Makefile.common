# $NetBSD: Makefile.common,v 1.19 2005/05/25 21:07:59 jmmv Exp $
#

DISTNAME=		gst-plugins-0.8.9
CATEGORIES=		multimedia gnome
MASTER_SITES=		${MASTER_SITE_GNOME:=sources/gst-plugins/0.8/} \
			http://gstreamer.freedesktop.org/src/gst-plugins/
EXTRACT_SUFX=		.tar.bz2

MAINTAINER=		rh@NetBSD.org
HOMEPAGE=		http://www.gstreamer.net/
COMMENT=		GStreamer -

DISTINFO_FILE=		${.CURDIR}/../../multimedia/gst-plugins/distinfo
FILESDIR=		${.CURDIR}/../../multimedia/gst-plugins/files
PATCHDIR=		${.CURDIR}/../../multimedia/gst-plugins/patches

BUILD_DEPENDS+=		nasm>=0.98.38:../../devel/nasm

GNU_CONFIGURE=		yes
USE_TOOLS+=		gmake
USE_LIBTOOL=		yes
USE_PKGLOCALEDIR=	yes

CONFIGURE_ARGS+=	--disable-docs-build
CONFIGURE_ARGS+=	--disable-examples
CONFIGURE_ARGS+=	--disable-tests

.include "../../mk/compiler.mk"

.if !empty(PKGSRC_COMPILER:Msunpro)
# SunPro cc understands __func__ but CC does not, so disable explicitly.
CONFIGURE_ENV+=		have_func=no
.endif

# Disable all drivers and features by default.
.for driver in	a52dec \
		aalib \
		aalibtest \
		alsa \
		amrnb \
		arts \
		artsc \
		artstest \
		audiofile \
		audioresample \
		cairo \
		cdaudio \
		cdio \
		cdparanoia \
		cdrom \
		dirac \
		directfb \
		divx \
		dts \
		dv1394 \
		dvdnav \
		dvdread \
		dxr3 \
		esd \
		esdtest \
		faac \
		faad \
		flac \
		freetypetest \
		gconf \
		gconftool \
		gdk_pixbuf \
		gnome_vfs \
		gsm \
		gst_v4l \
		gst_v4l2 \
		hermes \
		ivorbis \
		jack \
		jpeg \
		ladspa \
		lame \
		lcs \
		libcaca \
		libdv \
		libfame \
		libfametest \
		libmikmodtest \
		libmms \
		libmng \
		libpng \
		libvisual \
		mad \
		mikmod \
		mpeg2dec \
		mpeg2enc \
		mplex \
		musepack \
		musicbrainz \
		nas \
		ogg \
		oggtest \
		opengl \
		oss \
		osx_audio \
		osx_video \
		pango \
		polyp \
		qcam \
		raw1394 \
		sdl \
		sdltest \
		shout \
		shout2 \
		shout2test \
		sidplay \
		smoothwave \
		sndfile \
		sunaudio \
		spc \
		speex \
		swfdec \
		tarkin \
		theora \
		vcd \
		vorbis \
		vorbistest \
		wavpack \
		x \
		xshm \
		xvid \
		xvideo
CONFIGURE_ARGS+=	--disable-${driver}
.endfor
.undef driver

# A package building a single plugin of gst-plugins has to include this
# file and define the following variables:
#    GST_PLUGINS_NAME - The name of the plugin, to be added to the package
#                       name and the comment.
#    GST_PLUGINS_DIR  - The directory where the plugin resides; a relative
#                       path from WRKSRC.
#    GST_PLUGINS_FLAG - The name of the flag used to enable the plugin.
#                       Defaults to GST_PLUGINS_NAME.
.if defined(GST_PLUGINS_NAME) && !empty(GST_PLUGINS_NAME)
PKGNAME=		${DISTNAME:S/plugins/plugins-${GST_PLUGINS_NAME}/}
COMMENT+=		${GST_PLUGINS_NAME} plugin

GST_PLUGINS_FLAG?=	${GST_PLUGINS_NAME}
GST_PLUGINS_DIR?=	non-existent

CONFIGURE_ARGS:=	${CONFIGURE_ARGS:S/--disable-${GST_PLUGINS_FLAG}/--enable-${GST_PLUGINS_FLAG}/}

BUILD_DIRS=		${WRKSRC}/${GST_PLUGINS_DIR}
INSTALL_DIRS=		${WRKSRC}/${GST_PLUGINS_DIR}

# Fix paths to already installed libraries (by the gst-plugins package).
SUBST_CLASSES+=		libs
SUBST_MESSAGE.libs=	"Fixing path to dependent libraries."
SUBST_STAGE.libs=	pre-configure
SUBST_FILES.libs=	${GST_PLUGINS_DIR}/Makefile.in
SUBST_SED.libs=		-e 's|$$(top_builddir)/gst-libs/gst/libgst|${BUILDLINK_PREFIX.gst-plugins}/lib/libgst|g'

BUILDLINK_DEPENDS.gst-plugins+=	gst-plugins>=0.8.9
.include "../../multimedia/gst-plugins/buildlink3.mk"
.endif

BUILDLINK_DEPENDS.gstreamer+=	gstreamer>=0.8.9.1

.include "../../converters/libiconv/buildlink3.mk"
.include "../../devel/gettext-lib/buildlink3.mk"
.include "../../devel/glib2/buildlink3.mk"
.include "../../devel/pkgconfig/buildlink3.mk"
.include "../../multimedia/gstreamer/plugins.mk"
