$NetBSD: patch-af,v 1.4 2004/07/31 11:08:47 recht Exp $

--- libavcodec/libpostproc/postprocess_template.c.orig	Sun Jul 18 18:13:02 2004
+++ libavcodec/libpostproc/postprocess_template.c	Sun Jul 18 19:25:47 2004
@@ -2614,12 +2614,12 @@
 static inline void RENAME(blockCopy)(uint8_t dst[], int dstStride, uint8_t src[], int srcStride,
 	int levelFix, int64_t *packedOffsetAndScale)
 {
-#ifndef HAVE_MMX
+#if !defined(HAVE_MMX) || (__GNUC__ < 3)
 	int i;
 #endif
 	if(levelFix)
 	{
-#ifdef HAVE_MMX
+#if defined(HAVE_MMX) && (__GNUC__ >= 3)
 					asm volatile(
 						"movq (%%eax), %%mm2	\n\t" // packedYOffset
 						"movq 8(%%eax), %%mm3	\n\t" // packedYScale
@@ -2702,7 +2702,7 @@
 	}
 	else
 	{
-#ifdef HAVE_MMX
+#if defined(HAVE_MMX) && (__GNUC__ >= 3)
 					asm volatile(
 						"leal (%0,%2), %%eax	\n\t"
 						"leal (%1,%3), %%edx	\n\t"
