--- ./utils/Makefile.in.orig	2004-02-04 07:58:32.000000000 +0900
+++ ./utils/Makefile.in	2004-04-17 10:57:01.000000000 +0900
@@ -209,10 +209,10 @@
 
 noinst_LTLIBRARIES = libmotion.la libcpuaccel.la
 
-# FIXME: make this libtool (but static-only!) too
-lib_LIBRARIES = libmjpegutils.a
+# transcode depends on a shared libmjpegutils
+lib_LTLIBRARIES = libmjpegutils.la
 
-libmjpegutils_a_SOURCES = \
+libmjpegutils_la_SOURCES = \
 	mjpeg_logging.c \
 	mpegconsts.c \
 	mpegtimecode.c \
@@ -220,6 +220,12 @@
 	yuv4mpeg_ratio.c
 
 
+libmjpegutils_la_LDFLAGS = \
+	-version-info $(LT_CURRENT):$(LT_REVISION):$(LT_AGE) \
+	-release $(LT_RELEASE) \
+	-export-dynamic 
+
+
 noinst_HEADERS = \
 	attributes.h \
 	cpu_accel.h \
@@ -258,15 +264,7 @@
 mkinstalldirs = $(SHELL) $(top_srcdir)/mkinstalldirs
 CONFIG_HEADER = $(top_builddir)/config.h
 CONFIG_CLEAN_FILES =
-LIBRARIES = $(lib_LIBRARIES)
-
-libmjpegutils_a_AR = $(AR) cru
-libmjpegutils_a_LIBADD =
-am_libmjpegutils_a_OBJECTS = mjpeg_logging.$(OBJEXT) \
-	mpegconsts.$(OBJEXT) mpegtimecode.$(OBJEXT) yuv4mpeg.$(OBJEXT) \
-	yuv4mpeg_ratio.$(OBJEXT)
-libmjpegutils_a_OBJECTS = $(am_libmjpegutils_a_OBJECTS)
-LTLIBRARIES = $(noinst_LTLIBRARIES)
+LTLIBRARIES = $(lib_LTLIBRARIES) $(noinst_LTLIBRARIES)
 
 libcpuaccel_la_LDFLAGS =
 @HAVE_ALTIVEC_FALSE@@HAVE_ASM_MMX_FALSE@@HAVE_ASM_NASM_TRUE@libcpuaccel_la_DEPENDENCIES =
@@ -285,6 +283,10 @@
 @HAVE_ALTIVEC_TRUE@@HAVE_ASM_MMX_TRUE@@HAVE_ASM_NASM_FALSE@	$(top_builddir)/utils/altivec/libaltivec.la
 am_libcpuaccel_la_OBJECTS = cpu_accel.lo
 libcpuaccel_la_OBJECTS = $(am_libcpuaccel_la_OBJECTS)
+libmjpegutils_la_LIBADD =
+am_libmjpegutils_la_OBJECTS = mjpeg_logging.lo mpegconsts.lo \
+	mpegtimecode.lo yuv4mpeg.lo yuv4mpeg_ratio.lo
+libmjpegutils_la_OBJECTS = $(am_libmjpegutils_la_OBJECTS)
 libmotion_la_LDFLAGS =
 libmotion_la_LIBADD =
 am_libmotion_la_OBJECTS = motionsearch.lo
@@ -294,11 +296,12 @@
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
 @AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/cpu_accel.Plo \
-@AMDEP_TRUE@	./$(DEPDIR)/mjpeg_logging.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/mjpeg_logging.Plo \
 @AMDEP_TRUE@	./$(DEPDIR)/motionsearch.Plo \
-@AMDEP_TRUE@	./$(DEPDIR)/mpegconsts.Po \
-@AMDEP_TRUE@	./$(DEPDIR)/mpegtimecode.Po ./$(DEPDIR)/yuv4mpeg.Po \
-@AMDEP_TRUE@	./$(DEPDIR)/yuv4mpeg_ratio.Po
+@AMDEP_TRUE@	./$(DEPDIR)/mpegconsts.Plo \
+@AMDEP_TRUE@	./$(DEPDIR)/mpegtimecode.Plo \
+@AMDEP_TRUE@	./$(DEPDIR)/yuv4mpeg.Plo \
+@AMDEP_TRUE@	./$(DEPDIR)/yuv4mpeg_ratio.Plo
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 LTCOMPILE = $(LIBTOOL) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) \
@@ -306,7 +309,7 @@
 CCLD = $(CC)
 LINK = $(LIBTOOL) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
-DIST_SOURCES = $(libmjpegutils_a_SOURCES) $(libcpuaccel_la_SOURCES) \
+DIST_SOURCES = $(libcpuaccel_la_SOURCES) $(libmjpegutils_la_SOURCES) \
 	$(libmotion_la_SOURCES)
 HEADERS = $(noinst_HEADERS) $(pkginclude_HEADERS)
 
@@ -318,7 +321,7 @@
 	check-recursive installcheck-recursive
 DIST_COMMON = $(noinst_HEADERS) $(pkginclude_HEADERS) \
 	$(srcdir)/Makefile.in Makefile.am
-SOURCES = $(libmjpegutils_a_SOURCES) $(libcpuaccel_la_SOURCES) $(libmotion_la_SOURCES)
+SOURCES = $(libcpuaccel_la_SOURCES) $(libmjpegutils_la_SOURCES) $(libmotion_la_SOURCES)
 
 all: all-recursive
 
@@ -329,40 +332,34 @@
 	  $(AUTOMAKE) --gnu  utils/Makefile
 Makefile: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.in  $(top_builddir)/config.status
 	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
-libLIBRARIES_INSTALL = $(INSTALL_DATA)
-install-libLIBRARIES: $(lib_LIBRARIES)
+libLTLIBRARIES_INSTALL = $(INSTALL)
+install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
 	$(mkinstalldirs) $(DESTDIR)$(libdir)
-	@list='$(lib_LIBRARIES)'; for p in $$list; do \
+	@list='$(lib_LTLIBRARIES)'; for p in $$list; do \
 	  if test -f $$p; then \
 	    f="`echo $$p | sed -e 's|^.*/||'`"; \
-	    echo " $(libLIBRARIES_INSTALL) $$p $(DESTDIR)$(libdir)/$$f"; \
-	    $(libLIBRARIES_INSTALL) $$p $(DESTDIR)$(libdir)/$$f; \
-	  else :; fi; \
-	done
-	@$(POST_INSTALL)
-	@list='$(lib_LIBRARIES)'; for p in $$list; do \
-	  if test -f $$p; then \
-	    p="`echo $$p | sed -e 's|^.*/||'`"; \
-	    echo " $(RANLIB) $(DESTDIR)$(libdir)/$$p"; \
-	    $(RANLIB) $(DESTDIR)$(libdir)/$$p; \
+	    echo " $(LIBTOOL) --mode=install $(libLTLIBRARIES_INSTALL) $(INSTALL_STRIP_FLAG) $$p $(DESTDIR)$(libdir)/$$f"; \
+	    $(LIBTOOL) --mode=install $(libLTLIBRARIES_INSTALL) $(INSTALL_STRIP_FLAG) $$p $(DESTDIR)$(libdir)/$$f; \
 	  else :; fi; \
 	done
 
-uninstall-libLIBRARIES:
+uninstall-libLTLIBRARIES:
 	@$(NORMAL_UNINSTALL)
-	@list='$(lib_LIBRARIES)'; for p in $$list; do \
+	@list='$(lib_LTLIBRARIES)'; for p in $$list; do \
 	  p="`echo $$p | sed -e 's|^.*/||'`"; \
-	  echo " rm -f $(DESTDIR)$(libdir)/$$p"; \
-	  rm -f $(DESTDIR)$(libdir)/$$p; \
+	  echo " $(LIBTOOL) --mode=uninstall rm -f $(DESTDIR)$(libdir)/$$p"; \
+	  $(LIBTOOL) --mode=uninstall rm -f $(DESTDIR)$(libdir)/$$p; \
 	done
 
-clean-libLIBRARIES:
-	-test -z "$(lib_LIBRARIES)" || rm -f $(lib_LIBRARIES)
-libmjpegutils.a: $(libmjpegutils_a_OBJECTS) $(libmjpegutils_a_DEPENDENCIES) 
-	-rm -f libmjpegutils.a
-	$(libmjpegutils_a_AR) libmjpegutils.a $(libmjpegutils_a_OBJECTS) $(libmjpegutils_a_LIBADD)
-	$(RANLIB) libmjpegutils.a
+clean-libLTLIBRARIES:
+	-test -z "$(lib_LTLIBRARIES)" || rm -f $(lib_LTLIBRARIES)
+	@list='$(lib_LTLIBRARIES)'; for p in $$list; do \
+	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
+	  test "$$dir" = "$$p" && dir=.; \
+	  echo "rm -f \"$${dir}/so_locations\""; \
+	  rm -f "$${dir}/so_locations"; \
+	done
 
 clean-noinstLTLIBRARIES:
 	-test -z "$(noinst_LTLIBRARIES)" || rm -f $(noinst_LTLIBRARIES)
@@ -374,6 +371,8 @@
 	done
 libcpuaccel.la: $(libcpuaccel_la_OBJECTS) $(libcpuaccel_la_DEPENDENCIES) 
 	$(LINK)  $(libcpuaccel_la_LDFLAGS) $(libcpuaccel_la_OBJECTS) $(libcpuaccel_la_LIBADD) $(LIBS)
+libmjpegutils.la: $(libmjpegutils_la_OBJECTS) $(libmjpegutils_la_DEPENDENCIES) 
+	$(LINK) -rpath $(libdir) $(libmjpegutils_la_LDFLAGS) $(libmjpegutils_la_OBJECTS) $(libmjpegutils_la_LIBADD) $(LIBS)
 libmotion.la: $(libmotion_la_OBJECTS) $(libmotion_la_DEPENDENCIES) 
 	$(LINK)  $(libmotion_la_LDFLAGS) $(libmotion_la_OBJECTS) $(libmotion_la_LIBADD) $(LIBS)
 
@@ -384,12 +383,12 @@
 	-rm -f *.tab.c
 
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/cpu_accel.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/mjpeg_logging.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/mjpeg_logging.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/motionsearch.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/mpegconsts.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/mpegtimecode.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/yuv4mpeg.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/yuv4mpeg_ratio.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/mpegconsts.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/mpegtimecode.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/yuv4mpeg.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/yuv4mpeg_ratio.Plo@am__quote@
 
 .c.o:
 @am__fastdepCC_TRUE@	if $(COMPILE) -MT $@ -MD -MP -MF "$(DEPDIR)/$*.Tpo" \
@@ -622,7 +621,7 @@
 	done
 check-am: all-am
 check: check-recursive
-all-am: Makefile $(LIBRARIES) $(LTLIBRARIES) $(HEADERS)
+all-am: Makefile $(LTLIBRARIES) $(HEADERS)
 installdirs: installdirs-recursive
 installdirs-am:
 	$(mkinstalldirs) $(DESTDIR)$(libdir) $(DESTDIR)$(pkgincludedir)
@@ -654,12 +653,11 @@
 	-test -z "$(MAINTAINERCLEANFILES)" || rm -f $(MAINTAINERCLEANFILES)
 clean: clean-recursive
 
-clean-am: clean-generic clean-libLIBRARIES clean-libtool \
+clean-am: clean-generic clean-libLTLIBRARIES clean-libtool \
 	clean-noinstLTLIBRARIES mostlyclean-am
 
 distclean: distclean-recursive
-	-rm -rf ./$(DEPDIR)
-	-rm -f Makefile
+	-rm -rf ./$(DEPDIR)	-rm -f Makefile
 distclean-am: clean-am distclean-compile distclean-generic \
 	distclean-libtool distclean-tags
 
@@ -673,7 +671,7 @@
 
 install-data-am: install-pkgincludeHEADERS
 
-install-exec-am: install-libLIBRARIES
+install-exec-am: install-libLTLIBRARIES
 
 install-info: install-info-recursive
 
@@ -699,13 +697,13 @@
 
 ps-am:
 
-uninstall-am: uninstall-info-am uninstall-libLIBRARIES \
+uninstall-am: uninstall-info-am uninstall-libLTLIBRARIES \
 	uninstall-pkgincludeHEADERS
 
 uninstall-info: uninstall-info-recursive
 
 .PHONY: $(RECURSIVE_TARGETS) CTAGS GTAGS all all-am check check-am clean \
-	clean-generic clean-libLIBRARIES clean-libtool \
+	clean-generic clean-libLTLIBRARIES clean-libtool \
 	clean-noinstLTLIBRARIES clean-recursive ctags ctags-recursive \
 	distclean distclean-compile distclean-generic distclean-libtool \
 	distclean-recursive distclean-tags distdir dvi dvi-am \
@@ -713,7 +711,7 @@
 	install-data install-data-am install-data-recursive \
 	install-exec install-exec-am install-exec-recursive \
 	install-info install-info-am install-info-recursive \
-	install-libLIBRARIES install-man install-pkgincludeHEADERS \
+	install-libLTLIBRARIES install-man install-pkgincludeHEADERS \
 	install-recursive install-strip installcheck installcheck-am \
 	installdirs installdirs-am installdirs-recursive \
 	maintainer-clean maintainer-clean-generic \
@@ -721,7 +719,7 @@
 	mostlyclean-generic mostlyclean-libtool mostlyclean-recursive \
 	pdf pdf-am pdf-recursive ps ps-am ps-recursive tags \
 	tags-recursive uninstall uninstall-am uninstall-info-am \
-	uninstall-info-recursive uninstall-libLIBRARIES \
+	uninstall-info-recursive uninstall-libLTLIBRARIES \
 	uninstall-pkgincludeHEADERS uninstall-recursive
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
