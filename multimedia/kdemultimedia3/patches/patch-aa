$NetBSD: patch-aa,v 1.11 2007/01/13 18:33:44 wiz Exp $

--- configure.orig	2006-10-02 18:17:13.000000000 +0000
+++ configure
@@ -28862,34 +28862,15 @@ if test $kde_qtver = 1; then
    kde_qt_dirs="$QTDIR /usr/lib/qt"
 fi
 
+  LIBPTHREAD=""
 
-                LIBPTHREAD=""
-
-  if test -n "$PTHREAD_LIBS"; then
-    if test "x$PTHREAD_LIBS" = "x-pthread" ; then
-      LIBPTHREAD="PTHREAD"
-    else
-      PTHREAD_LIBS_save="$PTHREAD_LIBS"
-      PTHREAD_LIBS=`echo "$PTHREAD_LIBS_save" | sed -e 's,^-l,,g'`
-      echo "$as_me:$LINENO: checking for pthread_create in $PTHREAD_LIBS" >&5
-echo $ECHO_N "checking for pthread_create in $PTHREAD_LIBS... $ECHO_C" >&6
-
-     kde_save_LDFLAGS="$LDFLAGS"
-          kde_save_LIBS="$LIBS"
-     LDFLAGS="$LDFLAGS $all_libraries"
-     case $host_os in
-      aix*) LDFLAGS="-brtl $LDFLAGS"
-	test "$GCC" = yes && LDFLAGS="-Wl,$LDFLAGS"
-	;;
-     esac
-     as_ac_Lib=`echo "ac_cv_lib_$PTHREAD_LIBS''_pthread_create" | $as_tr_sh`
-echo "$as_me:$LINENO: checking for pthread_create in -l$PTHREAD_LIBS" >&5
-echo $ECHO_N "checking for pthread_create in -l$PTHREAD_LIBS... $ECHO_C" >&6
-if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for pthread_create in -lpthread" >&5
+echo $ECHO_N "checking for pthread_create in -lpthread... $ECHO_C" >&6
+if test "${ac_cv_lib_pthread_pthread_create+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-l$PTHREAD_LIBS  $LIBS"
+LIBS="-lpthread  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -28934,38 +28915,26 @@ if { (eval echo "$as_me:$LINENO: \"$ac_l
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  eval "$as_ac_Lib=yes"
+  ac_cv_lib_pthread_pthread_create=yes
+  LIBPTHREAD="-lpthread"
 else
   echo "$as_me: failed program was:" >&5
 sed 's/^/| /' conftest.$ac_ext >&5
 
-eval "$as_ac_Lib=no"
+ac_cv_lib_pthread_pthread_create=no
 fi
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
-echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
-if test `eval echo '${'$as_ac_Lib'}'` = yes; then
-  LIBPTHREAD="$PTHREAD_LIBS_save"
-fi
-
-     LDFLAGS="$kde_save_LDFLAGS"
-     LIBS="$kde_save_LIBS"
-
-      PTHREAD_LIBS="$PTHREAD_LIBS_save"
-    fi
-  fi
+echo "$as_me:$LINENO: result: $ac_cv_lib_pthread_pthread_create" >&5
+echo "${ECHO_T}$ac_cv_lib_pthread_pthread_create" >&6
 
-    if test -z "$LIBPTHREAD"; then
-    echo "$as_me:$LINENO: checking for pthread_create in -lpthread" >&5
-echo $ECHO_N "checking for pthread_create in -lpthread... $ECHO_C" >&6
-if test "${ac_cv_lib_pthread_pthread_create+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
+  if test -z "$LIBPTHREAD"; then
+    echo "$as_me:$LINENO: checking for pthread_create in ${PTHREAD_LDFLAGS} ${PTHREAD_LIBS}" >&5
+echo $ECHO_N "checking for pthread_create in ${PTHREAD_LDFLAGS} ${PTHREAD_LIBS}... $ECHO_C" >&6
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-lpthread  $LIBS"
+LIBS="${PTHREAD_LDFLAGS} ${PTHREAD_LIBS} $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -29011,6 +28980,7 @@ if { (eval echo "$as_me:$LINENO: \"$ac_l
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_lib_pthread_pthread_create=yes
+  LIBPTHREAD="$PTHREAD_LDFLAGS $PTHREAD_LIBS"
 else
   echo "$as_me: failed program was:" >&5
 sed 's/^/| /' conftest.$ac_ext >&5
@@ -29020,13 +28990,9 @@ fi
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
-fi
+
 echo "$as_me:$LINENO: result: $ac_cv_lib_pthread_pthread_create" >&5
 echo "${ECHO_T}$ac_cv_lib_pthread_pthread_create" >&6
-if test $ac_cv_lib_pthread_pthread_create = yes; then
-  LIBPTHREAD="-lpthread"
-fi
-
   fi
 
     if test -z "$LIBPTHREAD" ; then
@@ -29088,12 +29054,6 @@ rm -f conftest.err conftest.$ac_objext \
     LIBS=$kde_safe_libs
   fi
 
-    if test "x$LIBPTHREAD" = "xPTHREAD" ; then
-    LIBPTHREAD=""
-  fi
-
-
-
 
       USE_THREADS=""
       if test -z "$LIBPTHREAD"; then
@@ -34615,7 +34575,7 @@ if test "${ac_cv_lib_ossaudio__oss_ioctl
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-lossaudio  $LIBS"
+LIBS="${LIBOSSAUDIO}  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -34682,7 +34642,7 @@ fi
 
   if test "x$have_ossaudio" = xyes; then
     # for kmix/ and akode/
-    LIBOSSAUDIO="-lossaudio"
+    LIBOSSAUDIO="${LIBOSSAUDIO}"
   fi
 
 
@@ -35279,7 +35239,7 @@ cat confdefs.h >>conftest.$ac_ext
 cat >>conftest.$ac_ext <<_ACEOF
 /* end confdefs.h.  */
 $ac_includes_default
-#include <cdda_interface.h>
+#include <cdparanoia/cdda_interface.h>
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
@@ -35323,7 +35283,7 @@ _ACEOF
 cat confdefs.h >>conftest.$ac_ext
 cat >>conftest.$ac_ext <<_ACEOF
 /* end confdefs.h.  */
-#include <cdda_interface.h>
+#include <cdparanoia/cdda_interface.h>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
@@ -35433,7 +35393,7 @@ cat confdefs.h >>conftest.$ac_ext
 cat >>conftest.$ac_ext <<_ACEOF
 /* end confdefs.h.  */
 
-    #include <cdda_interface.h>
+    #include <cdparanoia/cdda_interface.h>
 
 int
 main ()
@@ -37432,7 +37392,7 @@ if test "${ac_cv_lib_tunepimp_tp_SetFile
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ltunepimp  $LIBS"
+LIBS="-ltunepimp ${PTHREAD_LDFLAGS} ${PTHREAD_LIBS} $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -38427,13 +38387,13 @@ if test $ac_cv_header_FLAC_metadata_h = 
 	test "$GCC" = yes && LDFLAGS="-Wl,$LDFLAGS"
 	;;
      esac
-     echo "$as_me:$LINENO: checking for FLAC__seekable_stream_decoder_process_single in -lFLAC" >&5
-echo $ECHO_N "checking for FLAC__seekable_stream_decoder_process_single in -lFLAC... $ECHO_C" >&6
-if test "${ac_cv_lib_FLAC_FLAC__seekable_stream_decoder_process_single+set}" = set; then
+     echo "$as_me:$LINENO: checking for FLAC__stream_decoder_process_single in -lFLAC" >&5
+echo $ECHO_N "checking for FLAC__stream_decoder_process_single in -lFLAC... $ECHO_C" >&6
+if test "${ac_cv_lib_FLAC_FLAC__stream_decoder_process_single+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-lFLAC  $LIBS"
+LIBS="-lFLAC -lm $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -38447,11 +38407,11 @@ extern "C"
 #endif
 /* We use char because int might match the return type of a gcc2
    builtin and then its argument prototype would still apply.  */
-char FLAC__seekable_stream_decoder_process_single ();
+char FLAC__stream_decoder_process_single ();
 int
 main ()
 {
-FLAC__seekable_stream_decoder_process_single ();
+FLAC__stream_decoder_process_single ();
   ;
   return 0;
 }
@@ -38478,20 +38438,20 @@ if { (eval echo "$as_me:$LINENO: \"$ac_l
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_FLAC_FLAC__seekable_stream_decoder_process_single=yes
+  ac_cv_lib_FLAC_FLAC__stream_decoder_process_single=yes
 else
   echo "$as_me: failed program was:" >&5
 sed 's/^/| /' conftest.$ac_ext >&5
 
-ac_cv_lib_FLAC_FLAC__seekable_stream_decoder_process_single=no
+ac_cv_lib_FLAC_FLAC__stream_decoder_process_single=no
 fi
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_FLAC_FLAC__seekable_stream_decoder_process_single" >&5
-echo "${ECHO_T}$ac_cv_lib_FLAC_FLAC__seekable_stream_decoder_process_single" >&6
-if test $ac_cv_lib_FLAC_FLAC__seekable_stream_decoder_process_single = yes; then
+echo "$as_me:$LINENO: result: $ac_cv_lib_FLAC_FLAC__stream_decoder_process_single" >&5
+echo "${ECHO_T}$ac_cv_lib_FLAC_FLAC__stream_decoder_process_single" >&6
+if test $ac_cv_lib_FLAC_FLAC__stream_decoder_process_single = yes; then
   have_libFLAC=yes
 fi
 
@@ -38699,9 +38659,9 @@ if test $ac_cv_header_OggFLAC_seekable_s
 	test "$GCC" = yes && LDFLAGS="-Wl,$LDFLAGS"
 	;;
      esac
-     echo "$as_me:$LINENO: checking for OggFLAC__seekable_stream_decoder_process_single in -lOggFLAC" >&5
-echo $ECHO_N "checking for OggFLAC__seekable_stream_decoder_process_single in -lOggFLAC... $ECHO_C" >&6
-if test "${ac_cv_lib_OggFLAC_OggFLAC__seekable_stream_decoder_process_single+set}" = set; then
+     echo "$as_me:$LINENO: checking for OggFLAC__stream_decoder_process_single in -lOggFLAC" >&5
+echo $ECHO_N "checking for OggFLAC__stream_decoder_process_single in -lOggFLAC... $ECHO_C" >&6
+if test "${ac_cv_lib_OggFLAC_OggFLAC__stream_decoder_process_single+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -38719,11 +38679,11 @@ extern "C"
 #endif
 /* We use char because int might match the return type of a gcc2
    builtin and then its argument prototype would still apply.  */
-char OggFLAC__seekable_stream_decoder_process_single ();
+char OggFLAC__stream_decoder_process_single ();
 int
 main ()
 {
-OggFLAC__seekable_stream_decoder_process_single ();
+OggFLAC__stream_decoder_process_single ();
   ;
   return 0;
 }
@@ -38750,20 +38710,20 @@ if { (eval echo "$as_me:$LINENO: \"$ac_l
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_OggFLAC_OggFLAC__seekable_stream_decoder_process_single=yes
+  ac_cv_lib_OggFLAC_OggFLAC__stream_decoder_process_single=yes
 else
   echo "$as_me: failed program was:" >&5
 sed 's/^/| /' conftest.$ac_ext >&5
 
-ac_cv_lib_OggFLAC_OggFLAC__seekable_stream_decoder_process_single=no
+ac_cv_lib_OggFLAC_OggFLAC__stream_decoder_process_single=no
 fi
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_OggFLAC_OggFLAC__seekable_stream_decoder_process_single" >&5
-echo "${ECHO_T}$ac_cv_lib_OggFLAC_OggFLAC__seekable_stream_decoder_process_single" >&6
-if test $ac_cv_lib_OggFLAC_OggFLAC__seekable_stream_decoder_process_single = yes; then
+echo "$as_me:$LINENO: result: $ac_cv_lib_OggFLAC_OggFLAC__stream_decoder_process_single" >&5
+echo "${ECHO_T}$ac_cv_lib_OggFLAC_OggFLAC__stream_decoder_process_single" >&6
+if test $ac_cv_lib_OggFLAC_OggFLAC__stream_decoder_process_single = yes; then
   have_libOggFLAC=yes
 fi
 
@@ -40613,8 +40573,23 @@ if { (eval echo "$as_me:$LINENO: \"$ac_c
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
 
-                x11_dga2=yes
-
+ 	lib=Xxf86dga
+ 	shared_lib_found=no
+ 	for i in ${LDFLAGS}; do
+ 		case "$i" in
+ 		-L*)
+ 			dir=`echo $i | sed "s,^-L,,"`
+ 			if [ -e $dir/lib${lib}.so ] ||
+ 			   [ "`echo $dir/lib${lib}.so.*`" != "$dir/lib${lib}.so.*" ]; then
+ 				shared_lib_found=yes
+ 				break;
+ 			fi
+ 		esac
+ 	done
+ 	if [ "$shared_lib_found" = "yes" ]; then
+ 		x11_dga2=yes
+ 	fi
+   
 else
   echo "$as_me: failed program was:" >&5
 sed 's/^/| /' conftest.$ac_ext >&5
@@ -40677,7 +40652,22 @@ if { (eval echo "$as_me:$LINENO: \"$ac_c
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
 
+       lib=Xv
+       shared_lib_found=no
+      for i in ${LDFLAGS}; do
+                case "$i" in
+               -L*)
+                       dir=`echo $i | sed "s,^-L,,"`
+                       if [ -e $dir/lib${lib}.so ] ||
+                          [ "`echo $dir/lib${lib}.so.*`" != "$dir/lib${lib}.so.*" ]; then
+                               shared_lib_found=yes
+                               break;
+                       fi
+               esac
+        done
+       if [ "$shared_lib_found" = "yes" ]; then
                 x11_xv=yes
+       fi
 
 else
   echo "$as_me: failed program was:" >&5
@@ -40741,7 +40731,22 @@ if { (eval echo "$as_me:$LINENO: \"$ac_c
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
 
+       lib=Xxf86vm
+       shared_lib_found=no
+       for i in ${LDFLAGS}; do
+                case "$i" in
+               -L*)
+                       dir=`echo $i | sed "s,^-L,,"`
+                       if [ -e $dir/lib${lib}.so ] ||
+                          [ "`echo $dir/lib${lib}.so.*`" != "$dir/lib${lib}.so.*" ]; then
+                               shared_lib_found=yes
+                               break;
+                       fi
+               esac
+       done
+       if [ "$shared_lib_found" = "yes" ]; then
                 x11_xvidmode=yes
+       fi
 
 else
   echo "$as_me: failed program was:" >&5
@@ -40813,6 +40818,9 @@ case "$OS_TYPE" in
   SunOS)
     kde_mpeglib_compiles=yes
     ;;
+  DragonFly)
+    kde_mpeglib_compiles=yes
+    ;;
   *)
     echo "$as_me:$LINENO: result: *** We disable mpeglib for this platform ***" >&5
 echo "${ECHO_T}*** We disable mpeglib for this platform ***" >&6
@@ -40822,33 +40830,14 @@ esac
 
 
 
-                LIBPTHREAD=""
 
-  if test -n "$PTHREAD_LIBS"; then
-    if test "x$PTHREAD_LIBS" = "x-pthread" ; then
-      LIBPTHREAD="PTHREAD"
-    else
-      PTHREAD_LIBS_save="$PTHREAD_LIBS"
-      PTHREAD_LIBS=`echo "$PTHREAD_LIBS_save" | sed -e 's,^-l,,g'`
-      echo "$as_me:$LINENO: checking for pthread_create in $PTHREAD_LIBS" >&5
-echo $ECHO_N "checking for pthread_create in $PTHREAD_LIBS... $ECHO_C" >&6
-
-     kde_save_LDFLAGS="$LDFLAGS"
-          kde_save_LIBS="$LIBS"
-     LDFLAGS="$LDFLAGS $all_libraries"
-     case $host_os in
-      aix*) LDFLAGS="-brtl $LDFLAGS"
-	test "$GCC" = yes && LDFLAGS="-Wl,$LDFLAGS"
-	;;
-     esac
-     as_ac_Lib=`echo "ac_cv_lib_$PTHREAD_LIBS''_pthread_create" | $as_tr_sh`
-echo "$as_me:$LINENO: checking for pthread_create in -l$PTHREAD_LIBS" >&5
-echo $ECHO_N "checking for pthread_create in -l$PTHREAD_LIBS... $ECHO_C" >&6
-if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for pthread_create in -lpthread" >&5
+echo $ECHO_N "checking for pthread_create in -lpthread... $ECHO_C" >&6
+if test "${ac_cv_lib_pthread_pthread_create+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-l$PTHREAD_LIBS  $LIBS"
+LIBS="-lpthread  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -40893,31 +40882,23 @@ if { (eval echo "$as_me:$LINENO: \"$ac_l
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  eval "$as_ac_Lib=yes"
+  ac_cv_lib_pthread_pthread_create=yes
+  LIBPTHREAD="-lpthread"
+
 else
   echo "$as_me: failed program was:" >&5
 sed 's/^/| /' conftest.$ac_ext >&5
 
-eval "$as_ac_Lib=no"
+ac_cv_lib_pthread_pthread_create=no
 fi
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
-echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
-if test `eval echo '${'$as_ac_Lib'}'` = yes; then
-  LIBPTHREAD="$PTHREAD_LIBS_save"
-fi
-
-     LDFLAGS="$kde_save_LDFLAGS"
-     LIBS="$kde_save_LIBS"
-
-      PTHREAD_LIBS="$PTHREAD_LIBS_save"
-    fi
-  fi
+echo "$as_me:$LINENO: result: $ac_cv_lib_pthread_pthread_create" >&5
+echo "${ECHO_T}$ac_cv_lib_pthread_pthread_create" >&6
 
-    if test -z "$LIBPTHREAD"; then
+  if test -z "$LIBPTHREAD"; then
     echo "$as_me:$LINENO: checking for pthread_create in -lpthread" >&5
 echo $ECHO_N "checking for pthread_create in -lpthread... $ECHO_C" >&6
 if test "${ac_cv_lib_pthread_pthread_create+set}" = set; then
@@ -40970,6 +40951,7 @@ if { (eval echo "$as_me:$LINENO: \"$ac_l
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_lib_pthread_pthread_create=yes
+  LIBPTHREAD="$PTHREAD_LDFLAGS $PTHREAD_LIBS"
 else
   echo "$as_me: failed program was:" >&5
 sed 's/^/| /' conftest.$ac_ext >&5
@@ -40982,10 +40964,6 @@ LIBS=$ac_check_lib_save_LIBS
 fi
 echo "$as_me:$LINENO: result: $ac_cv_lib_pthread_pthread_create" >&5
 echo "${ECHO_T}$ac_cv_lib_pthread_pthread_create" >&6
-if test $ac_cv_lib_pthread_pthread_create = yes; then
-  LIBPTHREAD="-lpthread"
-fi
-
   fi
 
     if test -z "$LIBPTHREAD" ; then
@@ -41047,10 +41025,6 @@ rm -f conftest.err conftest.$ac_objext \
     LIBS=$kde_safe_libs
   fi
 
-    if test "x$LIBPTHREAD" = "xPTHREAD" ; then
-    LIBPTHREAD=""
-  fi
-
 
 
 case "$OS_TYPE" in
@@ -41072,7 +41046,7 @@ _ACEOF
 
     ;;
 
-  FreeBSD)
+  FreeBSD | DragonFly)
     OS_TYPE="BSD"
 
 cat >>confdefs.h <<\_ACEOF
@@ -45524,11 +45498,6 @@ cat >>$CONFIG_STATUS <<\_ACEOF
 
 { (exit 0); exit 0; }
 _ACEOF
-if test "x$with_fast_perl" = "xyes"; then    
-  perl -i.bak $ac_aux_dir/conf.change.pl $CONFIG_STATUS    \
-    || mv $CONFIG_STATUS.bak $CONFIG_STATUS    
-  rm -f $CONFIG_STATUS.bak
-fi    
 chmod +x $CONFIG_STATUS
 ac_clean_files=$ac_clean_files_save
 
