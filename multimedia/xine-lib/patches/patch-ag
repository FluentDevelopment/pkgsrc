$NetBSD: patch-ag,v 1.13 2006/09/29 21:20:04 dmcmahill Exp $

--- configure.ac.orig	2006-07-09 10:36:29.000000000 -0400
+++ configure.ac	2006-09-29 12:47:48.000000000 -0400
@@ -197,5 +197,5 @@
 
 case "$host" in
-  *-*-freebsd*)
+  *-*-freebsd* | *-*-dragonfly*)
     if test x"$pthread_prefix" = "xno"; then
       pthread_prefix="/usr/local"
@@ -463,4 +463,7 @@
 AC_SUBST(NET_LIBS)
 
+WINE_LIBS=""
+AC_CHECK_LIB(i386, i386_set_ldt, WINE_LIBS="-li386 $WINE_LIBS",)
+AC_SUBST(WINE_LIBS)
 
 dnl ---------------------------------------------
@@ -567,5 +570,5 @@
   [with_v4l=${enableval}], [with_v4l=yes])
 
-if test "x$with_v4l" == "xyes"; then
+if test "x$with_v4l" = "xyes"; then
   AC_CHECK_HEADER(linux/videodev.h, have_v4l=yes,)
 else
@@ -654,5 +657,5 @@
 AC_MSG_RESULT()
 dnl Check if vld "extended" XvMC is available
-if test x$xxmc_stub == "xXvMCW" && test x$ac_have_xv == "xyes"; then
+if test x$xxmc_stub = "xXvMCW" && test x$ac_have_xv = "xyes"; then
 	AC_CHECK_LIB($xxmc_stub, XvMCPutSlice,
              	     ac_have_xxmc="yes",
@@ -684,5 +687,5 @@
 dnl Try fallback to standard XvMC if vld failed
 if test x$ac_have_xxmc = "xno"; then
-  if test x$xxmc_stub == "xXvMCW"; then
+  if test x$xxmc_stub = "xXvMCW"; then
 	  AC_CHECK_LIB($xxmc_stub, XvMCCreateContext,
                ac_have_xxmc="yes",
@@ -738,5 +741,5 @@
 AC_MSG_CHECKING(whether to enable the xvmc plugin)
 AC_MSG_RESULT()
-if test x$xvmc_stub == "xXvMCW"; then
+if test x$xvmc_stub = "xXvMCW"; then
 	AC_CHECK_LIB($xvmc_stub, XvMCCreateContext,
              ac_have_xvmc="yes",
@@ -783,6 +786,5 @@
 if test "x$with_xinerama" = "xyes"; then
   AC_CHECK_LIB(Xinerama, XineramaQueryExtension, 
-             [X_LIBS="$X_LIBS -lXinerama"
-              AC_DEFINE(HAVE_XINERAMA,1,[Define this if you have libXinerama installed])
+             [AC_DEFINE(HAVE_XINERAMA,1,[Define this if you have libXinerama installed])
               ac_have_xinerama="yes"],,
              [$X_LIBS $X_PRE_LIBS -lXext $X_EXTRA_LIBS])
@@ -1294,8 +1296,19 @@
 
 if test "x$with_oss" = "xyes"; then
+
+  case "$host" in
+    *-*-netbsd*|*-*-openbsd*)
+      OSS_LIBS="-lossaudio"
+      ;;
+    *)
+      OSS_LIBS=""
+      ;;
+  esac
+
   AC_MSG_CHECKING(for OSS audio support)
   have_ossaudio=no
   AC_TRY_COMPILE([
 	    #ifdef __NetBSD__
+	    #include <sys/ioctl.h>
 	    #include <soundcard.h>
 	    #else
@@ -1312,5 +1325,5 @@
 fi
 AM_CONDITIONAL(HAVE_OSS, test x"$have_ossaudio" = "xyes")
-
+AC_SUBST(OSS_LIBS)
 
 dnl ---------------------------------------------
@@ -1393,7 +1406,8 @@
 
 if test "x$with_gnome_vfs" = "xyes"; then
-  PKG_CHECK_MODULES(GNOME_VFS, gnome-vfs-2.0,
-                no_gnome_vfs=no,
-		no_gnome_vfs=yes)
+  dnl PKG_CHECK_MODULES(GNOME_VFS, gnome-vfs-2.0,
+  dnl               no_gnome_vfs=no,
+  dnl 		no_gnome_vfs=yes)
+  no_gnome_vfs=yes
   AC_SUBST(GNOME_VFS_CFLAGS)
   AC_SUBST(GNOME_VFS_LIBS)
@@ -1743,5 +1757,5 @@
                       [Define 1 if you have MinGW CD-ROM support])
 	 ;;
-         freebsd4.*)
+         freebsd4.* | dragonfly*)
      	    AC_DEFINE([HAVE_FREEBSD_CDROM], [1], 
                       [Define 1 if you have FreeBSD CD-ROM support])
