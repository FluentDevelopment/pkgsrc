$NetBSD: patch-ag,v 1.7 2005/03/28 08:12:48 jmmv Exp $

--- configure.ac.orig	2004-12-25 18:40:24.000000000 +0100
+++ configure.ac
@@ -400,6 +400,9 @@ AC_CHECK_LIB(socket, socket, NET_LIBS="-
 AC_CHECK_LIB(nsl, gethostbyname, NET_LIBS="-lnsl $NET_LIBS",)
 AC_SUBST(NET_LIBS)
 
+WINE_LIBS=""
+AC_CHECK_LIB(i386, i386_set_ldt, WINE_LIBS="-li386 $WINE_LIBS",)
+AC_SUBST(WINE_LIBS)
 
 dnl ---------------------------------------------
 dnl socklen_t
@@ -514,6 +517,7 @@ if test x"$no_x" != "xyes"; then
   AC_FIND_LIBXV
 
 fi
+AM_CONDITIONAL(HAVE_XV, test x$ac_have_xv = "xyes")
 
 
 host_or_hostalias="$host"
@@ -576,7 +580,7 @@ XXMC_LIB="-L$xxmc_path -l$xxmc_stub"
 AC_MSG_CHECKING(whether to enable the xxmc plugin with vld extensions)
 AC_MSG_RESULT()
 dnl Check if vld "extended" XvMC is available
-if test x$xxmc_stub == "xXvMCW"; then
+if test x$xxmc_stub = "xXvMCW"; then
 	AC_CHECK_LIB($xxmc_stub, XvMCPutSlice,
              	     ac_have_xxmc="yes",
 	             [ac_have_xxmc="no"
@@ -605,7 +609,7 @@ if test x$ac_have_xxmc = "xyes"; then
 fi
 dnl Try fallback to standard XvMC if vld failed
 if test x$ac_have_xxmc = "xno"; then
-  if test x$xxmc_stub == "xXvMCW"; then
+  if test x$xxmc_stub = "xXvMCW"; then
 	  AC_CHECK_LIB($xxmc_stub, XvMCCreateContext,
                ac_have_xxmc="yes",
 	       [ac_have_xxmc="no"
@@ -659,7 +663,7 @@ saved_libs="$LIBS"
 XVMC_LIB="-L$xvmc_path -l$xvmc_stub"
 AC_MSG_CHECKING(whether to enable the xvmc plugin)
 AC_MSG_RESULT()
-if test x$xvmc_stub == "xXvMCW"; then
+if test x$xvmc_stub = "xXvMCW"; then
 	AC_CHECK_LIB($xvmc_stub, XvMCCreateContext,
              ac_have_xvmc="yes",
 	     [ac_have_xvmc="no"
@@ -699,8 +703,7 @@ dnl Checks for Xinerama extension
 dnl ---------------------------------------------
 
 AC_CHECK_LIB(Xinerama, XineramaQueryExtension, 
-             [X_LIBS="$X_LIBS -lXinerama"
-              AC_DEFINE(HAVE_XINERAMA,1,[Define this if you have libXinerama installed])
+             [AC_DEFINE(HAVE_XINERAMA,1,[Define this if you have libXinerama installed])
               ac_have_xinerama="yes"],,
              [$X_LIBS $X_PRE_LIBS -lXext $X_EXTRA_LIBS])
 dnl AM_CONDITIONAL(HAVE_XINERAMA, test x$ac_have_xinerama = "xyes")
@@ -1073,9 +1076,19 @@ dnl ------------------------------------
 dnl OSS style audio interface
 dnl ---------------------------------------------
 
+case "$host" in
+       *-*-netbsd*|*-*-openbsd*)
+	OSS_LIBS="-lossaudio"
+	;;
+	*)
+	OSS_LIBS=""
+	;;
+esac
+
 AC_MSG_CHECKING(for OSS audio support)
 have_ossaudio=no
 AC_TRY_COMPILE([
+	    #include <sys/ioctl.h>
 	    #ifdef __NetBSD__
 	    #include <soundcard.h>
 	    #else
@@ -1088,7 +1101,7 @@ AC_TRY_COMPILE([
 	])
 AC_MSG_RESULT($have_ossaudio)
 AM_CONDITIONAL(HAVE_OSS, test x"$have_ossaudio" = "xyes")
-
+AC_SUBST(OSS_LIBS)
 
 dnl ---------------------------------------------
 dnl Alsa support
@@ -1129,9 +1142,10 @@ dnl ------------------------------------
 dnl gnome-vfs support
 dnl ---------------------------------------------
 
-PKG_CHECK_MODULES(GNOME_VFS, gnome-vfs-2.0,
-                no_gnome_vfs=no,
-		no_gnome_vfs=yes)
+dnl PKG_CHECK_MODULES(GNOME_VFS, gnome-vfs-2.0,
+dnl                 no_gnome_vfs=no,
+dnl 		no_gnome_vfs=yes)
+no_gnome_vfs=yes
 AC_SUBST(GNOME_VFS_CFLAGS)
 AC_SUBST(GNOME_VFS_LIBS)
 if test x"$no_gnome_vfs" != "xyes"; then
