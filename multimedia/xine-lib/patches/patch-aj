$NetBSD: patch-aj,v 1.7 2005/05/26 22:47:22 reed Exp $

--- src/input/input_cdda.c.orig	Sat May  7 11:23:26 2005
+++ src/input/input_cdda.c	Sat May  7 12:01:28 2005
@@ -32,6 +32,9 @@
 #include <unistd.h>
 
 #include <sys/types.h>
+#ifdef __FreeBSD__
+#include <sys/param.h>
+#endif
 #include <dirent.h>
 #include <sys/stat.h>
 #include <fcntl.h>
@@ -684,18 +687,26 @@
   unsigned char *data) {
 
   int fd = this_gen->fd;
+#if !defined(__FreeBSD__) || (__FreeBSD_version < 501106)
   struct ioc_read_audio cdda;
+#endif
 
   while( num_frames ) {
+#if !defined(__FreeBSD__) || (__FreeBSD_version < 501106)
     cdda.address_format = CD_MSF_FORMAT;
     cdda.address.msf.minute = frame / CD_SECONDS_PER_MINUTE / CD_FRAMES_PER_SECOND;
     cdda.address.msf.second = (frame / CD_FRAMES_PER_SECOND) % CD_SECONDS_PER_MINUTE;
     cdda.address.msf.frame = frame % CD_FRAMES_PER_SECOND;
     cdda.nframes = 1;
     cdda.buffer = data;
+#endif
 
+#if defined(__FreeBSD__) && (__FreeBSD_version >= 501106)
+    if (pread(fd, data, CD_RAW_FRAME_SIZE, frame * CD_RAW_FRAME_SIZE) != CD_RAW_FRAME_SIZE) {
+#else
     /* read a frame */
     if(ioctl(fd, CDIOCREADAUDIO, &cdda) < 0) {
+#endif
       perror("CDIOCREADAUDIO");
       return -1;
     }
