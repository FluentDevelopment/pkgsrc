$NetBSD: patch-au,v 1.1 2004/05/12 16:19:32 drochner Exp $

--- aclib/Makefile.am.orig	2003-09-15 16:30:20.000000000 +0200
+++ aclib/Makefile.am	2004-05-12 18:27:06.000000000 +0200
@@ -2,7 +2,7 @@
 
 AUTOMAKE_OPTIONS = 1.3 foreign
 
-noinst_LIBRARIES = libac.a
+noinst_LTLIBRARIES = libac.la
 
 if HAVE_ASM_NASM
 ASM_SRC = memcpy.s rescale.s average.s swap.s asm_io.s
@@ -10,7 +10,7 @@
 
 CFLAGS = -funroll-loops -ffast-math -DLINUX @CFLAGS@
 
-libac_a_SOURCES = cputest.c $(ASM_SRC)
+libac_la_SOURCES = cputest.c $(ASM_SRC)
 
 EXTRA_DIST = \
   ac.h \
@@ -26,5 +26,7 @@
 ASM = @NASM@
 ASMFLAGS = @NASMFLAGS@ -g
 
-%.o: %.s ;	$(ASM) $(ASMFLAGS) -o $@ $<
+STRIP_FPIC = sh $(top_srcdir)/strip_fPIC.sh
+
+%.lo: %.s ;	$(LIBTOOL) --tag=CC --mode=compile $(STRIP_FPIC) $(ASM) $(ASMFLAGS) -o $@ $<
 
