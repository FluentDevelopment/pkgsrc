$NetBSD: patch-at,v 1.1 2004/05/12 16:19:32 drochner Exp $

--- bbmpeg/Makefile.am.orig	2003-09-15 16:30:20.000000000 +0200
+++ bbmpeg/Makefile.am	2004-05-12 18:38:26.000000000 +0200
@@ -3,7 +3,7 @@
 AUTOMAKE_OPTIONS = 1.3 foreign
 DEFAULT_INCLUDES = -I$(top_srcdir) -I$(srcdir) -I$(top_builddir) -I. 
 
-noinst_LIBRARIES = libbbmpeg.a
+noinst_LTLIBRARIES = libbbmpeg.la
 
 if HAVE_ASM_NASM
 BB_SRC2 = fdct_mmx.s idct_mmx.s quant_mmx.s motion_mmx.s variance_mmx.s
@@ -20,7 +20,7 @@
 
 CFLAGS = -funroll-loops -ffast-math @CFLAGS@ $(MMX)
 
-libbbmpeg_a_SOURCES = dovideo.c params.c bits.c puthdr.c putpic.c putmpg.c putvlc.c stats.c quantize.c predict.c ratectl.c idct.c motion.c transfrm.c fdctref.c resize.c $(BB_SRC1) $(BB_SRC2) $(BB_SRC3)
+libbbmpeg_la_SOURCES = dovideo.c params.c bits.c puthdr.c putpic.c putmpg.c putvlc.c stats.c quantize.c predict.c ratectl.c idct.c motion.c transfrm.c fdctref.c resize.c $(BB_SRC1) $(BB_SRC2) $(BB_SRC3)
 
 noinst_HEADERS = mtable.h mplex.h mmx.h main.h imgresample.h gmo_read.h encaudio.h consts.h consts1.h common.h bbencode.h 
 
@@ -60,7 +60,9 @@
 ASM = @NASM@
 ASMFLAGS = @NASMFLAGS@
 
-%.o: %.s ;	$(ASM) -g $(ASMFLAGS) -o $@ $<
+STRIP_FPIC = sh $(top_srcdir)/strip_fPIC.sh
+
+%.lo: %.s ;	$(LIBTOOL) --tag=CC --mode=compile $(STRIP_FPIC) $(ASM) $(ASMFLAGS) -o $@ $<
 
 
 
