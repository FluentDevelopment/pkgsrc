$NetBSD: patch-aa,v 1.7 2001/11/13 21:10:46 jlam Exp $

--- configure.orig	Fri Sep  7 20:36:55 2001
+++ configure
@@ -12536,7 +12536,7 @@
 
     ac_save_ldflags="$LDFLAGS"
     ac_save_cflags="$CFLAGS"
-    LDFLAGS="$LDFLAGS $GL_LDFLAGS $X_LDFLAGS $all_libraries -lMesaGL -lMesaGLU -lX11 -lXext -lm $LIBSOCKET"
+    LDFLAGS="$LDFLAGS $GL_LDFLAGS $X_LDFLAGS $all_libraries -lGL -lGLU -lX11 -lXext -lm $LIBSOCKET"
     CFLAGS="$CFLAGS $X_INCLUDES"
     test -n "$GL_INCLUDE" && CFLAGS="-I$GL_INCLUDE $CFLAGS"
     cat > conftest.$ac_ext <<EOF
@@ -12601,13 +12601,13 @@
 
     if test "$GL_LDFLAGS" = ""; then
        if test "$ac_cv_have_gl" = "mesa"; then
-          GLLIB='-lMesaGL -lMesaGLU $(LIB_X11)'
+          GLLIB='-lGL -lGLU $(LIB_X11)'
        else
           GLLIB='-lGL -lGLU $(LIB_X11)'
        fi
     else
        if test "$ac_cv_have_gl" = "mesa"; then
-          GLLIB="$GL_LDFLAGS -lMesaGL -lMesaGLU "'$(LIB_X11)'
+          GLLIB="$GL_LDFLAGS -lGL -lGLU "'$(LIB_X11)'
        else
           GLLIB="$GL_LDFLAGS -lGL -lGLU "'$(LIB_X11)'
        fi
@@ -12621,7 +12621,7 @@
     
 GL_SAVERS="kmorph3d.kss kspace.kss kpipes.kss"
 ac_save_CPPFLAGS="$CPPFLAGS"
-CPPFLAGS="-I$GL_INCLUDE $CPPFLAGS $X_INCLUDES"
+CPPFLAGS="$GLINC $CPPFLAGS $X_INCLUDES"
 for ac_hdr in GL/xmesa.h GL/glut.h memory.h
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
@@ -12810,6 +12810,23 @@
   
                 ac_cv_have_dpms="-lXdpms"
                 
+	lib=Xdpms
+	shared_lib_found=no
+	for i in ${LDFLAGS}; do
+		case "$i" in
+		-L*)
+			dir=`echo $i | sed "s,^-L,,"`
+			if [ -e $dir/lib${lib}.so ] ||
+			   [ "`echo $dir/lib${lib}.so.*`" != "$dir/lib${lib}.so.*" ]; then
+				shared_lib_found=yes
+				break;
+			fi
+		esac
+	done
+	if [ "$shared_lib_found" = "no" ]; then
+		eval "ac_cv_have_dpms=no"
+	fi
+
 else
   echo "configure: failed program was:" >&5
   cat conftest.$ac_ext >&5
@@ -12919,6 +12936,7 @@
 case "$host" in 
   *-*-linux*) ksysguardd_compile=yes; UNAME='Linux' ;;
   *-*-freebsd*) ksysguardd_compile=yes; UNAME='FreeBSD' ;;
+  *-*-netbsd*) ksysguardd_compile=yes; UNAME='FreeBSD' ;;
   *-*-solaris*) ksysguardd_compile=yes; UNAME='Solaris' ;;
   *) ksysguard_compile=no; UNAME='' ;;
 esac
