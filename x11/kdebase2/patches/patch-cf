$NetBSD: patch-cf,v 1.1 2001/10/15 22:46:04 skrll Exp $

--- klipper/Makefile.in.orig	Sat Sep  8 01:36:37 2001
+++ klipper/Makefile.in
-lib_LTLIBRARIES = klipper.la
+lib_LTLIBRARIES = libklipper_main.la klipper.la
@@ -278,4 +278,3 @@
-CLEANFILES = dummy.cpp
-
-klipper_la_LIBADD = $(LIB_KDEUI) $(LIB_KSYCOCA)
-klipper_la_SOURCES = main.cpp toplevel.cpp urlgrabber.cpp configdialog.cpp
+libklipper_main_la_LIBADD = $(LIB_KDEUI) $(LIB_KSYCOCA)
+libklipper_main_la_SOURCES = main.cpp toplevel.cpp urlgrabber.cpp configdialog.cpp
+libklipper_main_la_LDFLAGS = $(all_libraries) -module -avoid-version
@@ -282,0 +282,2 @@
+klipper_la_LIBADD = libklipper_main.la
+klipper_la_SOURCES = klipper_main.cpp
@@ -286,2 +287,2 @@
-klipper_LDADD = klipper.la $(LIB_KSYCOCA)
-klipper_SOURCES = dummy.cpp
+klipper_LDADD = libklipper_main.la $(LIB_KSYCOCA)
+klipper_SOURCES = klipper_main.cpp
@@ -317,8 +318,14 @@
-klipper_la_DEPENDENCIES = 
-#>- klipper_la_OBJECTS =  main.lo toplevel.lo urlgrabber.lo configdialog.lo
-#>+ 5
-klipper_la_final_OBJECTS = klipper_la.all_cpp.lo 
-klipper_la_nofinal_OBJECTS = main.lo toplevel.lo urlgrabber.lo configdialog.lo \
-klipper_la_meta_unload.lo 
-@KDE_USE_FINAL_FALSE@klipper_la_OBJECTS = $(klipper_la_nofinal_OBJECTS)
-@KDE_USE_FINAL_TRUE@klipper_la_OBJECTS = $(klipper_la_final_OBJECTS)
+libklipper_main_la_DEPENDENCIES = 
+#>- libklipper_main_la_OBJECTS =  main.lo toplevel.lo urlgrabber.lo \
+#>- configdialog.lo
+#>+ 6
+libklipper_main_la_final_OBJECTS = libklipper_main_la.all_cpp.lo 
+libklipper_main_la_nofinal_OBJECTS = main.lo toplevel.lo urlgrabber.lo \
+configdialog.lo \
+libklipper_main_la_meta_unload.lo 
+@KDE_USE_FINAL_FALSE@libklipper_main_la_OBJECTS = $(libklipper_main_la_nofinal_OBJECTS)
+@KDE_USE_FINAL_TRUE@libklipper_main_la_OBJECTS = $(libklipper_main_la_final_OBJECTS)
+klipper_la_DEPENDENCIES =  libklipper_main.la
+#>- klipper_la_OBJECTS =  klipper_main.lo
+#>+ 1
+klipper_la_OBJECTS = klipper_main.lo
@@ -328 +335 @@
-#>- klipper_OBJECTS =  dummy.$(OBJEXT)
+#>- klipper_OBJECTS =  klipper_main.$(OBJEXT)
@@ -330,2 +337,2 @@
-klipper_OBJECTS = dummy.$(OBJEXT)
-klipper_DEPENDENCIES =  klipper.la
+klipper_OBJECTS = klipper_main.$(OBJEXT)
+klipper_DEPENDENCIES =  libklipper_main.la
@@ -350 +357 @@
-KDE_DIST=klipperrc hi16-app-klipper.png hi32-app-klipper.png klipper-1-2.pl klipperrc.upd klipperbindings.cpp urlgrabber.h toplevel.h klipper.desktop hi48-app-klipper.png configdialog.h 
+KDE_DIST=klipperrc hi48-app-klipper.png toplevel.h hi16-app-klipper.png hi32-app-klipper.png klipperbindings.cpp configdialog.h klipper-1-2.pl klipper.desktop klipperrc.upd urlgrabber.h 
@@ -357,2 +364,2 @@
-SOURCES = $(klipper_la_SOURCES) $(klipper_SOURCES)
-OBJECTS = $(klipper_la_OBJECTS) $(klipper_OBJECTS)
+SOURCES = $(libklipper_main_la_SOURCES) $(klipper_la_SOURCES) $(klipper_SOURCES)
+OBJECTS = $(libklipper_main_la_OBJECTS) $(klipper_la_OBJECTS) $(klipper_OBJECTS)
@@ -444,0 +452,3 @@
+libklipper_main.la: $(libklipper_main_la_OBJECTS) $(libklipper_main_la_DEPENDENCIES)
+	$(CXXLINK) -rpath $(libdir) $(libklipper_main_la_LDFLAGS) $(libklipper_main_la_OBJECTS) $(libklipper_main_la_LIBADD) $(LIBS)
+
@@ -593,11 +602,0 @@
-#>- 	@for file in $(DISTFILES); do \
-#>- 	  d=$(srcdir); \
-#>- 	  if test -d $$d/$$file; then \
-#>- 	    cp -pr $$/$$file $(distdir)/$$file; \
-#>- 	  else \
-#>- 	    test -f $(distdir)/$$file \
-#>- 	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
-#>- 	    || cp -p $$d/$$file $(distdir)/$$file || :; \
-#>- 	  fi; \
-#>- 	done
-#>+ 10
@@ -656 +654,0 @@
-	-test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
@@ -718,3 +715,0 @@
-dummy.cpp:
-	echo > dummy.cpp
-
@@ -765,8 +760,8 @@
-klipper_la_meta_unload.cpp:  urlgrabber.moc toplevel.moc configdialog.moc
-	@echo 'creating klipper_la_meta_unload.cpp'
-	@-rm -f klipper_la_meta_unload.cpp
-	@echo 'static const char * _metalist_klipper_la[] = {' > klipper_la_meta_unload.cpp
-	@cat  urlgrabber.moc toplevel.moc configdialog.moc | grep 'char.*className' | sed -e 's/.*[^A-Za-z0-9_:]\([A-Za-z0-9_:]*\)::className.*$$/\"\1\",/' | sort | uniq >> klipper_la_meta_unload.cpp
-	@echo '0};' >> klipper_la_meta_unload.cpp
-	@echo '#include <kunload.h>' >> klipper_la_meta_unload.cpp
-	@echo '_UNLOAD(klipper_la)' >> klipper_la_meta_unload.cpp
+libklipper_main_la_meta_unload.cpp:  urlgrabber.moc toplevel.moc configdialog.moc
+	@echo 'creating libklipper_main_la_meta_unload.cpp'
+	@-rm -f libklipper_main_la_meta_unload.cpp
+	@echo 'static const char * _metalist_libklipper_main_la[] = {' > libklipper_main_la_meta_unload.cpp
+	@cat  urlgrabber.moc toplevel.moc configdialog.moc | grep 'char.*className' | sed -e 's/.*[^A-Za-z0-9_:]\([A-Za-z0-9_:]*\)::className.*$$/\"\1\",/' | sort | uniq >> libklipper_main_la_meta_unload.cpp
+	@echo '0};' >> libklipper_main_la_meta_unload.cpp
+	@echo '#include <kunload.h>' >> libklipper_main_la_meta_unload.cpp
+	@echo '_UNLOAD(libklipper_main_la)' >> libklipper_main_la_meta_unload.cpp
@@ -777 +772,13 @@
-	-rm -f  klipper_la_meta_unload.cpp
+	-rm -f  libklipper_main_la_meta_unload.cpp
+
+#>+ 11
+libklipper_main_la.all_cpp.cpp: $(srcdir)/Makefile.in $(srcdir)/main.cpp $(srcdir)/toplevel.cpp $(srcdir)/urlgrabber.cpp $(srcdir)/configdialog.cpp libklipper_main_la_meta_unload.cpp  
+	@echo 'creating libklipper_main_la.all_cpp.cpp ...'; \
+	rm -f libklipper_main_la.all_cpp.files libklipper_main_la.all_cpp.final; \
+	echo "#define KDE_USE_FINAL 1" >> libklipper_main_la.all_cpp.final; \
+	for file in main.cpp toplevel.cpp urlgrabber.cpp configdialog.cpp libklipper_main_la_meta_unload.cpp ; do \
+	  echo "#include \"$$file\"" >> libklipper_main_la.all_cpp.files; \
+	  test ! -f $(srcdir)/$$file || egrep '^#pragma +implementation' $(srcdir)/$$file >> libklipper_main_la.all_cpp.final; \
+	done; \
+	cat libklipper_main_la.all_cpp.final libklipper_main_la.all_cpp.files  > libklipper_main_la.all_cpp.cpp; \
+	rm -f libklipper_main_la.all_cpp.final libklipper_main_la.all_cpp.files
@@ -780 +787 @@
-klipper_la.all_cpp.cpp: $(srcdir)/Makefile.in $(srcdir)/main.cpp $(srcdir)/toplevel.cpp $(srcdir)/urlgrabber.cpp $(srcdir)/configdialog.cpp klipper_la_meta_unload.cpp   urlgrabber.moc toplevel.moc configdialog.moc 
+klipper_la.all_cpp.cpp: $(srcdir)/Makefile.in $(srcdir)/klipper_main.cpp   urlgrabber.moc toplevel.moc configdialog.moc 
@@ -784 +791 @@
-	for file in main.cpp toplevel.cpp urlgrabber.cpp configdialog.cpp klipper_la_meta_unload.cpp ; do \
+	for file in klipper_main.cpp ; do \
@@ -792 +799 @@
-klipper.all_cpp.cpp: $(srcdir)/Makefile.in dummy.cpp  
+klipper.all_cpp.cpp: $(srcdir)/Makefile.in $(srcdir)/klipper_main.cpp  
@@ -796 +803 @@
-	for file in dummy.cpp ; do \
+	for file in klipper_main.cpp ; do \
@@ -805 +812 @@
-	-rm -f klipper_la.all_cpp.cpp klipper.all_cpp.cpp
+	-rm -f libklipper_main_la.all_cpp.cpp klipper_la.all_cpp.cpp klipper.all_cpp.cpp
@@ -809 +816 @@
-	$(MAKE) klipper_la_OBJECTS="$(klipper_la_final_OBJECTS)" all-am
+	$(MAKE) libklipper_main_la_OBJECTS="$(libklipper_main_la_final_OBJECTS)" all-am
@@ -812 +819 @@
-	$(MAKE) klipper_la_OBJECTS="$(klipper_la_nofinal_OBJECTS)" all-am
+	$(MAKE) libklipper_main_la_OBJECTS="$(libklipper_main_la_nofinal_OBJECTS)" all-am
