$NetBSD: patch-am,v 1.3 2004/10/20 14:33:30 reed Exp $

--- programs/xdm/Imakefile.orig	2004-07-26 15:56:33.000000000 -0700
+++ programs/xdm/Imakefile
@@ -195,6 +195,13 @@ LIFREQ_FLAGS = -Xa
 #endif
 #endif
 
+XDMLOGDIR = $(LOGDIRECTORY)
+#ifdef VarRunDirectory
+XDMPIDDIR = $(VARRUNDIR)
+#else
+XDMPIDDIR = $(XDMDIR)
+#endif
+
   SYS_LIBRARIES = $(SYS_LIBRARIES1) $(SYS_LIBRARIES2) $(SYS_LIBRARIES3)
 
    XDMCONFIGDIR = XdmConfigurationSubdirectory
@@ -252,7 +259,8 @@ LOCAL_LIBRARIES = $(GREETLIBS) $(XMULIB)
 #endif
        PROGRAMS = ProgramTargetName(xdm) ProgramTargetName(xdmshell) ProgramTargetName(sessreg) $(CHOOSER) $(XDM_SHADOW)
 
-    CHOOSERPATH = $(XDMDIR)/chooser
+    CHOOSERPATH = $(BINDIR)/chooser
+ GREETERLIBPATH = $(USRLIBDIR)/libXdmGreet.so
  OSMAJORVERSION = OSMajorVersion
  OSMINORVERSION = OSMinorVersion
    CONN_DEFINES = $(CONNECTION_FLAGS)
@@ -267,6 +275,10 @@ LOCAL_LIBRARIES = $(GREETLIBS) $(XMULIB)
 		$(XPM_DEFINES) $(XINERAMA_DEFINES) $(PROCTITLE_DEFINES) \
 		$(IFADDRS_DEFINES) $(IPV6_DEFINES) $(MKSTEMP_DEFINES)
    EXTRAMANDEFS = $(RANDOM_DEFINES) -DCHOOSERPATH=$(CHOOSERPATH) \
+		-DGREETERLIBPATH=$(GREETERLIBPATH) \
+		-DXDMDIR=$(XDMDIR) \
+		-DXDMAUTHDIR=$(XDMVARDIR) \
+		-DXDMPIDDIR=$(XDMPIDDIR) \
 		-DXDMLOGDIR=$(XDMLOGDIR)
 
 XCOMM
@@ -290,8 +302,8 @@ RES_DEFINES = '-DDEF_SERVER_LINE=":0 loc
 		  '-DDEF_FAILSAFE_CLIENT="$(BINDIR)/xterm"' \
 		  '-DDEF_XDM_CONFIG="$(XDMDIR)/xdm-config"' \
 		  '-DDEF_CHOOSER="$(CHOOSERPATH)"' \
-		  '-DDEF_AUTH_DIR="$(XDMDIR)"' \
-		  '-DDEF_GREETER_LIB="$(XDMDIR)/libXdmGreet.so"'
+		  '-DDEF_AUTH_DIR="$(XDMVARDIR)"' \
+		  '-DDEF_GREETER_LIB="$(GREETERLIBPATH)"'
 
 ComplexProgramTarget_1(xdm,$(LOCAL_LIBRARIES),NullParameter)
 #ifdef LinkConfDirectory
@@ -316,7 +328,7 @@ SpecialCObjectRule(daemon,$(ICONFIGFILES
 #if BuildChooser
 SpecialCObjectRule(chooser, $(ICONFIGFILES), $(SOCK_DEFINES) $(LIFREQ_FLAGS))
 NormalProgramTarget(chooser,$(OBJS3),$(DEPLIBS3),$(LIBS3),NullParameter)
-InstallProgram(chooser,$(XDMDIR))
+InstallProgram(chooser,$(BINDIR))
 InstallAppDefaults(Chooser)
 #endif
 #if BuildBoth
