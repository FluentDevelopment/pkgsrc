$NetBSD: patch-aj,v 1.5 2006/02/14 15:54:55 joerg Exp $

--- programs/xdm/Imakefile.orig	2005-12-06 12:35:11.000000000 +0100
+++ programs/xdm/Imakefile	2005-12-06 12:38:07.000000000 +0100
@@ -107,7 +107,7 @@ PWD_DEFINES = -DUSESHADOW -DSHADOWSUITE
 #endif
 #endif
 
-#if !defined(i386IscArchitecture) && !defined(i386ScoArchitecture) && !defined(LinuxArchitecture) && !defined(NTOArchitecture) && !defined(SGIArchitecture) && !defined(AIXArchitecture)
+#if !defined(i386IscArchitecture) && !defined(i386ScoArchitecture) && !defined(LinuxArchitecture) && !defined(NTOArchitecture) && !defined(SGIArchitecture) && !defined(AIXArchitecture) && !defined(DragonFlyArchitecture) && !defined(FreeBSDArchitecture)
 SYS_LIBRARIES3 = -lresolv
 #endif
 #if SystemV || defined(SequentArchitecture)
@@ -208,6 +208,13 @@ LIFREQ_FLAGS = -Xa
 #endif
 #endif
 
+XDMLOGDIR = $(LOGDIRECTORY)
+#ifdef VarRunDirectory
+XDMPIDDIR = $(VARRUNDIR)
+#else
+XDMPIDDIR = $(XDMDIR)
+#endif
+
   SYS_LIBRARIES = $(SYS_LIBRARIES1) $(SYS_LIBRARIES2) $(SYS_LIBRARIES3)
 
    XDMCONFIGDIR = XdmConfigurationSubdirectory
@@ -265,7 +272,8 @@ LOCAL_LIBRARIES = $(GREETLIBS) $(XMULIB)
 #endif
        PROGRAMS = ProgramTargetName(xdm) ProgramTargetName(xdmshell) ProgramTargetName(sessreg) $(CHOOSER) $(XDM_SHADOW)
 
-    CHOOSERPATH = $(XDMDIR)/chooser
+    CHOOSERPATH = $(BINDIR)/chooser
+ GREETERLIBPATH = $(USRLIBDIR)/libXdmGreet.so
  OSMAJORVERSION = OSMajorVersion
  OSMINORVERSION = OSMinorVersion
    CONN_DEFINES = $(CONNECTION_FLAGS)
@@ -282,7 +290,8 @@ LOCAL_LIBRARIES = $(GREETLIBS) $(XMULIB)
    EXTRAMANDEFS = $(RANDOM_DEFINES) -DCHOOSERPATH=$(CHOOSERPATH) \
 		-DXDMLOGDIR=$(XDMLOGDIR) -DXDMPIDDIR=$(XDMPIDDIR) \
 		-DXDMDIR=$(XDMDIR) -DBINDIR=$(BINDIR) \
-
+		-DGREETERLIBPATH=$(GREETERLIBPATH) \
+		-DXDMAUTHDIR=$(XDMVARDIR)
 
 XCOMM
 XCOMM Special definitions for compiling default resources; these parameters
@@ -298,11 +307,11 @@ DEF_SYSTEM_PATH = DefaultSystemPath	/* i
 BOURNE_SHELL = DefaultSystemShell
 RES_DEFINES = '-DDEF_SERVER_LINE=":0 local $(DEF_SERVER) :0"' \
 		  '-DXRDB_PROGRAM="$(BINDIR)/xrdb"' \
-		  '-DDEF_SESSION="$(BINDIR)/xterm -ls"' \
+		  '-DDEF_SESSION="xterm -ls"' \
 		  '-DDEF_USER_PATH="$(DEF_USER_PATH)"' \
 		  '-DDEF_SYSTEM_PATH="$(DEF_SYSTEM_PATH)"' \
 		  '-DDEF_SYSTEM_SHELL="$(BOURNE_SHELL)"' \
-		  '-DDEF_FAILSAFE_CLIENT="$(BINDIR)/xterm"' \
+		  '-DDEF_FAILSAFE_CLIENT="xterm"' \
 		  '-DDEF_XDM_CONFIG="$(XDMDIR)/xdm-config"' \
 		  '-DDEF_CHOOSER="$(CHOOSERPATH)"' \
 		  '-DDEF_AUTH_DIR="$(XDMDIR)"' \
@@ -331,7 +340,7 @@ SpecialCObjectRule(daemon,$(ICONFIGFILES
 #if BuildChooser
 SpecialCObjectRule(chooser, $(ICONFIGFILES), $(SOCK_DEFINES) $(LIFREQ_FLAGS))
 NormalProgramTarget(chooser,$(OBJS3),$(DEPLIBS3),$(LIBS3),NullParameter)
-InstallProgram(chooser,$(XDMDIR))
+InstallProgram(chooser,$(BINDIR))
 InstallAppDefaults(Chooser)
 #endif
 #if BuildBoth
