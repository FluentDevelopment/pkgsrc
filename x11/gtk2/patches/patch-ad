$NetBSD: patch-ad,v 1.9 2005/01/04 23:52:16 jmmv Exp $

--- gdk-pixbuf/gdk-pixbuf-animation.c.orig	2004-12-05 13:43:47.000000000 +0100
+++ gdk-pixbuf/gdk-pixbuf-animation.c
@@ -139,7 +139,7 @@ gdk_pixbuf_animation_new_from_file (cons
 	guchar buffer [128];
 	GdkPixbufModule *image_module;
         gchar *display_name;
-        gboolean locked;
+        gboolean locked = FALSE;
 
 	g_return_val_if_fail (filename != NULL, NULL);
         g_return_val_if_fail (error == NULL || *error == NULL, NULL);
@@ -184,8 +184,6 @@ gdk_pixbuf_animation_new_from_file (cons
                         return NULL;
                 }
 
-        locked = _gdk_pixbuf_lock (image_module);
-
 	if (image_module->load_animation == NULL) {
 		GdkPixbuf *pixbuf;
 
@@ -221,6 +219,8 @@ gdk_pixbuf_animation_new_from_file (cons
 
                 g_object_unref (pixbuf);
 	} else {
+		locked = _gdk_pixbuf_lock (image_module);
+
 		fseek (f, 0, SEEK_SET);
 		animation = (* image_module->load_animation) (f, error);
 
