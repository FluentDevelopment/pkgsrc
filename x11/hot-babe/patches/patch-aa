$NetBSD: patch-aa,v 1.4 2006/05/31 11:42:45 rillig Exp $

--- hot-babe.c.orig	2004-12-05 23:59:38.000000000 +0100
+++ hot-babe.c	2006-05-31 13:36:52.000000000 +0200
@@ -68,20 +68,15 @@ typedef struct
 
 HotBabeData bm;
 
-#if 0
+#if defined(__NetBSD__)
 /* FIXME New BSD and Solaris code.. to check.
  * doesn't work with Linux (getloadavg return 1.000) */
 static int system_cpu(void)
 {
-  int rc;
-  double loadavg[15];
-  rc=getloadavg(loadavg, 1); 
-  while( rc-- )
-    printf( "load = %f\n", loadavg[rc] );
-  rc=100*loadavg[0];
-  return rc;
+  double loadavg;
+  return ((getloadavg(&loadavg, 1) == -1) ? 0 : (100 * loadavg));
 }
-#endif
+#else
 
 /* returns current CPU load in percent, 0 to 256 */
 static int system_cpu(void)
@@ -144,6 +139,7 @@ static int system_cpu(void)
 
   return cpuload;
 }
+#endif
 
 GdkPixmap     *pixmap;
 GdkGC *gc;
