$NetBSD: patch-am,v 1.3 2007/08/04 00:02:35 joerg Exp $

--- src/corelib/io/qfsfileengine_iterator_unix.cpp.orig	2007-08-03 22:54:41.000000000 +0000
+++ src/corelib/io/qfsfileengine_iterator_unix.cpp
@@ -99,7 +99,11 @@ bool QFSFileEngineIterator::hasNext() co
             // ### Race condition; we should use fpathconf and dirfd().
             long maxPathName = ::pathconf(QFile::encodeName(path()).data(), _PC_NAME_MAX);
             if (maxPathName == -1)
+#ifdef NAME_MAX
+                maxPathName = (sizeof(dirent) + NAME_MAX + 1);
+#else
                 maxPathName = (sizeof(dirent) + MAXNAMLEN + 1);
+#endif
 #if defined(_POSIX_THREAD_SAFE_FUNCTIONS) && !defined(Q_OS_CYGWIN)
             if (that->platform->mt_file)
                 delete [] that->platform->mt_file;
