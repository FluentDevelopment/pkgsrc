$NetBSD: patch-ag,v 1.3 2001/12/16 20:33:41 skrll Exp $

--- dcop/Makefile.am.orig	Wed Apr 18 17:19:12 2001
+++ dcop/Makefile.am
@@ -25,12 +25,12 @@
 KDE_OPTIONS = qtonly
 
 INCLUDES=  $(all_includes)
-LDFLAGS = $(all_libraries)
+LDFLAGS = $(all_libraries) $(KDE_RPATH)
 
 bin_PROGRAMS = dcopserver
 check_PROGRAMS = testdcop testdcopc
 
-lib_LTLIBRARIES  = libDCOP.la dcopserver.la
+lib_LTLIBRARIES  = libDCOP.la libdcopserver_main.la dcopserver.la
 libDCOP_la_LIBADD = KDE-ICE/libkICE.la $(LIB_QT)
 libDCOP_la_LDFLAGS = -version-info 1:0 $(all_libraries) -no-undefined
 
@@ -44,13 +44,16 @@
 # dcopstub needs to go first for --enable-final to work
 libDCOP_la_SOURCES = dcopstub.cpp dcopclient.cpp dcopobject.cpp dcopref.cpp
 
+libdcopserver_main_la_SOURCES = dcopserver.cpp dcopsignals.cpp
+libdcopserver_main_la_LIBADD = libDCOP.la
+
 dcopserver_la_LDFLAGS = -module -avoid-version
-dcopserver_la_SOURCES = dcopserver.cpp dcopsignals.cpp
-dcopserver_la_LIBADD   = libDCOP.la
+dcopserver_la_SOURCES = dcopserver_main.cpp
+dcopserver_la_LIBADD  = libdcopserver_main.la
 
 dcopserver_LDFLAGS = $(KDE_RPATH)
-dcopserver_SOURCES = dummy.cpp
-dcopserver_LDADD   = dcopserver.la
+dcopserver_SOURCES = dcopserver_main.cpp
+dcopserver_LDADD   = libdcopserver_main.la
 
 testdcop_SOURCES = testdcop.cpp
 testdcop_LDADD = ../kdecore/libkdecore.la
@@ -59,6 +62,3 @@
 testdcopc_LDADD =  KDE-ICE/libkICE.la $(LIBSM)
 
 EXTRA_DIST = HOWTO ICE
-
-dummy.cpp:
-	echo > dummy.cpp
