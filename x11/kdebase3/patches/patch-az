$NetBSD: patch-az,v 1.3 2003/03/11 13:10:21 markd Exp $

--- kdesktop/Makefile.am.orig	Mon Sep 16 09:08:45 2002
+++ kdesktop/Makefile.am
@@ -1,10 +1,16 @@
 ## Makefile.am of kdebase/kdesktop
 
 INCLUDES = -I$(top_srcdir)/kcontrol/background -I$(top_srcdir)/libkonq $(all_includes)
+
+libkdesktop_main_la_LDFLAGS  = $(KDE_RPATH) $(all_libraries)
+libkdesktop_main_la_LIBADD   = $(top_builddir)/libkonq/libkonq.la \
+	$(top_builddir)/kcontrol/background/libbgnd.la 
+
 kdesktop_la_LDFLAGS  = $(KDE_RPATH) $(all_libraries) -module -avoid-version
-kdesktop_la_LIBADD   = $(top_builddir)/libkonq/libkonq.la $(top_builddir)/kcontrol/background/libbgnd.la 
+kdesktop_la_LIBADD   = libkdesktop_main.la
+
 kdesktop_LDFLAGS  = $(all_libraries) $(KDE_RPATH)
-kdesktop_LDADD    = kdesktop.la
+kdesktop_LDADD    = libkdesktop_main.la
 
 SUBDIRS = . lock pics patterns programs init kwebdesktop
 
@@ -12,15 +18,17 @@ SUBDIRS = . lock pics patterns programs 
 
 bin_PROGRAMS = kdesktop
 bin_SCRIPTS = kdeeject
-lib_LTLIBRARIES = kdesktop.la
+lib_LTLIBRARIES = libkdesktop_main.la kdesktop.la
 
-kdesktop_la_SOURCES = main.cc krootwm.cc xautolock.cc kdiconview.cc desktop.cc \
+libkdesktop_main_la_SOURCES = main.cc krootwm.cc xautolock.cc kdiconview.cc desktop.cc \
 	lockeng.cc KDesktopIface.skel \
 	bgmanager.cc init.cc KScreensaverIface.skel \
 	minicli.cpp KBackgroundIface.skel pixmapserver.cc kcustommenu.cc \
 	startupid.cpp
 
-kdesktop_SOURCES = dummy.cc
+kdesktop_la_SOURCES = kdesktop_main.cc
+
+kdesktop_SOURCES = kdesktop_main.cc
 
 include_HEADERS = KDesktopIface.h KScreensaverIface.h KBackgroundIface.h
 
