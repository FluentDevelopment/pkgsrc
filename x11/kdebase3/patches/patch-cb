$NetBSD: patch-cb,v 1.4 2005/12/17 19:36:27 markd Exp $

--- khelpcenter/searchhandlers/khc_docbookdig.pl.in.orig	2005-10-11 04:03:56.000000000 +1300
+++ khelpcenter/searchhandlers/khc_docbookdig.pl.in
@@ -26,8 +26,8 @@ use strict;
 
 use Getopt::Long;
 
-my $htdigdata = "/srv/www/htdig/common/";
-my $htdigbin = "/usr/bin";
+my $htdigdata = "@prefix@/share/htdig/common/";
+my $htdigbin = "@prefix@/bin";
 my $kdeprefix = "@prefix@";
 chomp $kdeprefix;
 
@@ -85,7 +85,7 @@ if ( !open( START, ">$startfile" ) ) {
   exit 1;
 }
 
-my $findcmd = "find $kdeprefix/share/doc/HTML/$lang/ -name index.docbook";
+my $findcmd = "find $kdeprefix/share/doc/kde/HTML/$lang/ -name index.docbook";
 
 print STDERR "FINDCMD: $findcmd\n";
 
@@ -121,21 +121,24 @@ if ( !open( PARSER, ">$parserfile" ) ) {
 print PARSER << "EOT";
 #! /bin/sh
 
+PATH=/bin:/usr/bin:\$PATH
+export PATH
+
 file=\$1
 shift
 mime=\$1
 shift
 
 if test "\$#" -gt 0; then
-  orig=\${1/file:\/\//}
+  orig=`echo \$1 | sed -e 's=file:=/='`
   shift
 fi
 
 case "\$orig" in
   help:/*)
-	orig=\${orig/help:\//}
-	orig=\${orig/\/index.docbook//}
-	cd $kdeprefix/share/doc/HTML/en/\$orig
+	orig=\${orig#help:}
+	orig=\${orig\%/index.docbook}
+	cd $kdeprefix/share/doc/kde/HTML/en/\$orig
 	file=index.docbook
 	;;
   *)	
@@ -162,14 +165,14 @@ common_dir:		$commondir
 locale:                 $locale
 database_dir:           $htdigdb
 database_base:		\${database_dir}/$identifier
-local_urls:             help://=$kdeprefix/share/doc/HTML/en/ file://=/
+local_urls:             help://=$kdeprefix/share/doc/kde/HTML/en/ file://=/
 local_urls_only:        true
 limit_urls_to:          file:// help:/
 ignore_noindex:         true
 max_hop_count:          4
 robotstxt_name:         kdedig
 compression_level:      6
-template_map:           Long long $kdeprefix/share/apps/khelpcenter/searchhandlers/htdig/htdig_long.html
+template_map:           Long long $kdeprefix/share/kde/apps/khelpcenter/searchhandlers/htdig/htdig_long.html
 search_algorithm:       exact:1 prefix:0.8
 maximum_pages:          1
 matches_per_page:       10
