$NetBSD: patch-as,v 1.8 2001/09/10 08:23:19 skrll Exp $

--- kfm/kioslave/main.cpp.orig	Wed Apr  7 23:56:48 1999
+++ kfm/kioslave/main.cpp
@@ -319,7 +319,7 @@
     return;
 }
 
-void KIOSlave::unmount( const char *_point )
+void KIOSlave::unmount( const char *_dev )
 {
     char buffer[ 1024 ];
     int t = (int)time( 0L );
@@ -331,7 +331,7 @@
     char *res;
  
     if( volmgt_running() ) {
-        if( (res = volmgt_symname( (char *) _point )) == NULL ) {
+        if( (res = volmgt_symname( (char *) _dev )) == NULL ) {
             retvalue = 1;
             err = QString( strerror( errno ));
         } else {
@@ -352,8 +352,10 @@
  	err = QString( "Volume Management is not running." );
     }
 #else
-    sprintf( buffer, "umount %s 2>"_PATH_TMP"mnt%i", _point, t );
+    sprintf( buffer, "umount %s 2>"_PATH_TMP"mnt%i", _dev, t );
     retvalue = system( buffer );
+    sprintf( buffer, "eject %s", _dev);
+    system( buffer );
     
     // test logfile here to remove it if it exists
     // (if there is a warning, it can exist even if revalue==0)
