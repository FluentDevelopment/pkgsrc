$NetBSD: patch-bn,v 1.7 2004/01/15 09:52:51 markd Exp $

--- kioslave/http/Makefile.in.orig	2003-12-29 11:17:01.000000000 +1300
+++ kioslave/http/Makefile.in
@@ -385,7 +385,7 @@ INCLUDES = -I$(top_srcdir)/interfaces $(
 
 ####### Files
 bin_PROGRAMS = kio_http_cache_cleaner
-lib_LTLIBRARIES = kio_http_cache_cleaner.la
+lib_LTLIBRARIES = libkio_http_cache_cleaner_main.la kio_http_cache_cleaner.la
 kde_module_LTLIBRARIES = kio_http.la
 
 kio_http_la_SOURCES = http.cc httpfilter.cc
@@ -393,12 +393,15 @@ kio_http_la_SOURCES = http.cc httpfilter
 kio_http_la_LIBADD = $(LIB_KIO) $(LIBZ)
 kio_http_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
-kio_http_cache_cleaner_SOURCES = dummy.cpp
-kio_http_cache_cleaner_LDADD = kio_http_cache_cleaner.la
+kio_http_cache_cleaner_SOURCES = http_cache_cleaner_main.cpp
+kio_http_cache_cleaner_LDADD = libkio_http_cache_cleaner_main.la
 kio_http_cache_cleaner_LDFLAGS = $(KDE_RPATH) $(all_libraries)
 
-kio_http_cache_cleaner_la_SOURCES = http_cache_cleaner.cpp
-kio_http_cache_cleaner_la_LIBADD = $(LIB_KIO)
+libkio_http_cache_cleaner_main_la_SOURCES = http_cache_cleaner.cpp
+libkio_http_cache_cleaner_main_la_LIBADD = $(LIB_KIO)
+
+kio_http_cache_cleaner_la_SOURCES = http_cache_cleaner_main.cpp
+kio_http_cache_cleaner_la_LIBADD = libkio_http_cache_cleaner_main.la
 kio_http_cache_cleaner_la_LDFLAGS = -module -avoid-version $(all_libraries)
 
 noinst_HEADERS = http.h
@@ -422,33 +425,47 @@ kio_http_la_final_OBJECTS = kio_http_la.
 kio_http_la_nofinal_OBJECTS = http.lo httpfilter.lo
 @KDE_USE_FINAL_FALSE@kio_http_la_OBJECTS = $(kio_http_la_nofinal_OBJECTS)
 @KDE_USE_FINAL_TRUE@kio_http_la_OBJECTS = $(kio_http_la_final_OBJECTS)
-kio_http_cache_cleaner_la_DEPENDENCIES =
-am_kio_http_cache_cleaner_la_OBJECTS = http_cache_cleaner.lo
+kio_http_cache_cleaner_la_DEPENDENCIES = \
+	libkio_http_cache_cleaner_main.la
+am_kio_http_cache_cleaner_la_OBJECTS = http_cache_cleaner_main.lo
 #>- kio_http_cache_cleaner_la_OBJECTS = \
 #>- 	$(am_kio_http_cache_cleaner_la_OBJECTS)
 #>+ 1
-kio_http_cache_cleaner_la_OBJECTS = http_cache_cleaner.lo
+kio_http_cache_cleaner_la_OBJECTS = http_cache_cleaner_main.lo
+libkio_http_cache_cleaner_main_la_LDFLAGS =
+libkio_http_cache_cleaner_main_la_DEPENDENCIES =
+am_libkio_http_cache_cleaner_main_la_OBJECTS = http_cache_cleaner.lo
+#>- libkio_http_cache_cleaner_main_la_OBJECTS = \
+#>- 	$(am_libkio_http_cache_cleaner_main_la_OBJECTS)
+#>+ 1
+libkio_http_cache_cleaner_main_la_OBJECTS = http_cache_cleaner.lo
 bin_PROGRAMS = kio_http_cache_cleaner$(EXEEXT)
 PROGRAMS = $(bin_PROGRAMS)
 
-am_kio_http_cache_cleaner_OBJECTS = dummy.$(OBJEXT)
+am_kio_http_cache_cleaner_OBJECTS = http_cache_cleaner_main.$(OBJEXT)
 #>- kio_http_cache_cleaner_OBJECTS = $(am_kio_http_cache_cleaner_OBJECTS)
 #>+ 1
-kio_http_cache_cleaner_OBJECTS = dummy.$(OBJEXT)
-kio_http_cache_cleaner_DEPENDENCIES = kio_http_cache_cleaner.la
+kio_http_cache_cleaner_OBJECTS = http_cache_cleaner_main.$(OBJEXT)
+kio_http_cache_cleaner_DEPENDENCIES = libkio_http_cache_cleaner_main.la
 
 DEFAULT_INCLUDES =  -I. -I$(srcdir) -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/admin/depcomp
 am__depfiles_maybe = depfiles
-#>- @AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/dummy.Po ./$(DEPDIR)/http.Plo \
+#>- @AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/http.Plo \
 #>- @AMDEP_TRUE@	./$(DEPDIR)/http_cache_cleaner.Plo \
+#>- @AMDEP_TRUE@	./$(DEPDIR)/http_cache_cleaner_main.Plo \
+#>- @AMDEP_TRUE@	./$(DEPDIR)/http_cache_cleaner_main.Po \
 #>- @AMDEP_TRUE@	./$(DEPDIR)/httpfilter.Plo
-#>+ 7
-@AMDEP_TRUE@@KDE_USE_FINAL_TRUE@DEP_FILES =   $(DEPDIR)/kio_http_la.all_cc.P  ./$(DEPDIR)/dummy.Po ./$(DEPDIR)/http.Plo \
+#>+ 11
+@AMDEP_TRUE@@KDE_USE_FINAL_TRUE@DEP_FILES =   $(DEPDIR)/kio_http_la.all_cc.P  ./$(DEPDIR)/http.Plo \
 @AMDEP_TRUE@@KDE_USE_FINAL_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/http_cache_cleaner.Plo \
+@AMDEP_TRUE@@KDE_USE_FINAL_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/http_cache_cleaner_main.Plo \
+@AMDEP_TRUE@@KDE_USE_FINAL_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/http_cache_cleaner_main.Po \
 @AMDEP_TRUE@@KDE_USE_FINAL_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/httpfilter.Plo
-@AMDEP_TRUE@@KDE_USE_FINAL_FALSE@DEP_FILES =   ./$(DEPDIR)/dummy.Po ./$(DEPDIR)/http.Plo \
+@AMDEP_TRUE@@KDE_USE_FINAL_FALSE@DEP_FILES =   ./$(DEPDIR)/http.Plo \
 @AMDEP_TRUE@@KDE_USE_FINAL_FALSE@	@AMDEP_TRUE@	./$(DEPDIR)/http_cache_cleaner.Plo \
+@AMDEP_TRUE@@KDE_USE_FINAL_FALSE@	@AMDEP_TRUE@	./$(DEPDIR)/http_cache_cleaner_main.Plo \
+@AMDEP_TRUE@@KDE_USE_FINAL_FALSE@	@AMDEP_TRUE@	./$(DEPDIR)/http_cache_cleaner_main.Po \
 @AMDEP_TRUE@@KDE_USE_FINAL_FALSE@	@AMDEP_TRUE@	./$(DEPDIR)/httpfilter.Plo
 
 #>- CXXCOMPILE = $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) \
@@ -471,6 +488,7 @@ CXXLINK = $(LIBTOOL) --mode=link --tag=C
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 DIST_SOURCES = $(kio_http_la_SOURCES) \
 	$(kio_http_cache_cleaner_la_SOURCES) \
+	$(libkio_http_cache_cleaner_main_la_SOURCES) \
 	$(kio_http_cache_cleaner_SOURCES)
 DATA = $(kdelnk_DATA)
 
@@ -484,7 +502,7 @@ RECURSIVE_TARGETS = info-recursive dvi-r
 	check-recursive installcheck-recursive
 DIST_COMMON = $(noinst_HEADERS) Makefile.am Makefile.in TODO
 DIST_SUBDIRS = $(SUBDIRS)
-SOURCES = $(kio_http_la_SOURCES) $(kio_http_cache_cleaner_la_SOURCES) $(kio_http_cache_cleaner_SOURCES)
+SOURCES = $(kio_http_la_SOURCES) $(kio_http_cache_cleaner_la_SOURCES) $(libkio_http_cache_cleaner_main_la_SOURCES) $(kio_http_cache_cleaner_SOURCES)
 
 #>- all: all-recursive
 #>+ 1
@@ -564,6 +582,8 @@ clean-libLTLIBRARIES:
 	$(CXXLINK) -rpath $(kde_moduledir) $(kio_http_la_LDFLAGS) $(kio_http_la_OBJECTS) $(kio_http_la_LIBADD) $(LIBS)
 kio_http_cache_cleaner.la: $(kio_http_cache_cleaner_la_OBJECTS) $(kio_http_cache_cleaner_la_DEPENDENCIES) 
 	$(CXXLINK) -rpath $(libdir) $(kio_http_cache_cleaner_la_LDFLAGS) $(kio_http_cache_cleaner_la_OBJECTS) $(kio_http_cache_cleaner_la_LIBADD) $(LIBS)
+libkio_http_cache_cleaner_main.la: $(libkio_http_cache_cleaner_main_la_OBJECTS) $(libkio_http_cache_cleaner_main_la_DEPENDENCIES) 
+	$(CXXLINK) -rpath $(libdir) $(libkio_http_cache_cleaner_main_la_LDFLAGS) $(libkio_http_cache_cleaner_main_la_OBJECTS) $(libkio_http_cache_cleaner_main_la_LIBADD) $(LIBS)
 binPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
 install-binPROGRAMS: $(bin_PROGRAMS)
 	@$(NORMAL_INSTALL)
@@ -603,9 +623,10 @@ mostlyclean-compile:
 distclean-compile:
 	-rm -f *.tab.c
 
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/dummy.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/http.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/http_cache_cleaner.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/http_cache_cleaner_main.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/http_cache_cleaner_main.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/httpfilter.Plo@am__quote@
 
 distclean-depend:
@@ -830,7 +851,7 @@ distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 #>- DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 #>+ 4
-KDE_DIST=http_cache_cleaner.desktop rfc2818.txt webdavs.protocol rfc2518.txt rfc2817.txt webdav.protocol rfc2616.txt https.protocol rfc3253.txt http.protocol README.webdav rfc2617.txt README.http_cache_cleaner THOUGHTS httpfilter.h 
+KDE_DIST=README.http_cache_cleaner http_cache_cleaner.desktop rfc2817.txt httpfilter.h webdavs.protocol rfc3253.txt rfc2818.txt http.protocol webdav.protocol README.webdav https.protocol rfc2616.txt rfc2518.txt rfc2617.txt Makefile.in.rej THOUGHTS 
 
 DISTFILES= $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST) $(KDE_DIST)
 
@@ -994,9 +1015,6 @@ uninstall-info: uninstall-info-recursive
 	uninstall-kdelnkDATA uninstall-libLTLIBRARIES \
 	uninstall-recursive
 
-
-dummy.cpp:
-	echo > dummy.cpp
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
 .NOEXPORT:
@@ -1011,20 +1029,20 @@ kio_http.la.closure: $(kio_http_la_OBJEC
 
 
 #>+ 3
-httpfilter.moc: $(srcdir)/httpfilter.h
-	$(MOC) $(srcdir)/httpfilter.h -o httpfilter.moc
-
-#>+ 1
-mocs: httpfilter.moc
-#>+ 3
 http.moc: $(srcdir)/http.h
 	$(MOC) $(srcdir)/http.h -o http.moc
 
 #>+ 1
 mocs: http.moc
 #>+ 3
+httpfilter.moc: $(srcdir)/httpfilter.h
+	$(MOC) $(srcdir)/httpfilter.h -o httpfilter.moc
+
+#>+ 1
+mocs: httpfilter.moc
+#>+ 3
 clean-metasources:
-	-rm -f  httpfilter.moc http.moc
+	-rm -f  http.moc httpfilter.moc
 
 #>+ 3
 clean-closures:
@@ -1041,7 +1059,7 @@ force-reedit:
 
 
 #>+ 11
-kio_http_la.all_cc.cc: $(srcdir)/Makefile.in $(srcdir)/http.cc $(srcdir)/httpfilter.cc  httpfilter.moc http.moc
+kio_http_la.all_cc.cc: $(srcdir)/Makefile.in $(srcdir)/http.cc $(srcdir)/httpfilter.cc  http.moc httpfilter.moc
 	@echo 'creating kio_http_la.all_cc.cc ...'; \
 	rm -f kio_http_la.all_cc.files kio_http_la.all_cc.final; \
 	echo "#define KDE_USE_FINAL 1" >> kio_http_la.all_cc.final; \
@@ -1077,7 +1095,7 @@ kde-rpo-clean:
 	-rm -f *.rpo
 
 #>+ 5
-httpfilter.o: httpfilter.moc 
+http.o: http.moc 
 httpfilter.lo: httpfilter.moc 
+httpfilter.o: httpfilter.moc 
 http.lo: http.moc 
-http.o: http.moc 
