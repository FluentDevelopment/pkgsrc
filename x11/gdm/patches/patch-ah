$NetBSD: patch-ah,v 1.3 2005/06/26 16:52:14 jmmv Exp $

--- daemon/slave.c.orig	2005-05-06 17:05:17.000000000 +0200
+++ daemon/slave.c
@@ -4051,6 +4051,14 @@ gdm_slave_session_start (void)
 
 	    g_free (msg);
 
+	    if G_UNLIKELY (setegid (pwent->pw_gid) != 0 ||
+			   seteuid (pwent->pw_uid) != 0) {
+		    gdm_error ("Cannot set effective user/group id");
+		    gdm_verify_cleanup (d);
+		    session_started = FALSE;
+		    return;
+	    }
+
 	    home_dir_ok = FALSE;
 	    home_dir = "/";
     } else {
@@ -4058,14 +4066,6 @@ gdm_slave_session_start (void)
 	    home_dir = pwent->pw_dir;
     }
 
-    if G_UNLIKELY (setegid (pwent->pw_gid) != 0 ||
-		   seteuid (pwent->pw_uid) != 0) {
-	    gdm_error ("Cannot set effective user/group id");
-	    gdm_verify_cleanup (d);
-	    session_started = FALSE;
-	    return;
-    }
-
     if G_LIKELY (home_dir_ok) {
 	    /* Sanity check on ~user/.dmrc */
 	    usrcfgok = gdm_file_check ("gdm_slave_session_start", pwent->pw_uid,
