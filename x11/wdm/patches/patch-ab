$NetBSD: patch-ab,v 1.2 2003/06/03 13:06:57 jmmv Exp $

--- src/wdm/loghelpers.c.orig	2003-06-01 10:00:09.000000000 +0200
+++ src/wdm/loghelpers.c
@@ -19,6 +19,7 @@
  * loghelpers.c: helper functions for intecepting messages in stderr
  *               and redirecting them to standard logging functions.
  */
+#include <assert.h>
 #include <wdmlib.h>
 #include <string.h>
 #include <sys/time.h>
@@ -26,6 +27,20 @@
 #include <sys/wait.h>
 #include <unistd.h>
 
+static char *
+own_strndup(const char *str, size_t len)
+{
+	char *copy;
+
+	assert(str != NULL);
+
+	len = len < strlen(str) ? len : strlen(str);
+	copy = strncpy((char *)malloc(len+1), str, len);
+	copy[len] = '\0';
+
+	return copy;
+}
+
 /*
  * Function that treats buffer as set of lines separated with '\n'
  * These lines will be directed to WDMLogMessage function with
@@ -40,9 +55,9 @@ WDMLogMessages(int level, char *buffer, 
 
 	while((pos = memchr(buffer, '\n', n)) != NULL)
 	{
-		tmpmsg = wstrndup(buffer, pos - buffer + 1);
+		tmpmsg = own_strndup(buffer, pos - buffer + 1);
 		WDMLogMessage(level, "%s", tmpmsg);
-		wfree(tmpmsg);
+		free(tmpmsg);
 
 		n -= pos - buffer + 1;
 		buffer = pos + 1;
