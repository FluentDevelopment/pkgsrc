$NetBSD: patch-af,v 1.1 2006/05/21 17:09:53 joerg Exp $

--- linux/zfilew.c.orig	2005-01-14 14:11:19.000000000 +0100
+++ linux/zfilew.c
@@ -471,14 +471,17 @@ void obtaindir()
 {
   char *homedir = 0;
   DIR *tmp;
+  int getenvSuccess = 0;
 
   if ((homedir = (char *)getenv("HOME")) == 0)
   {
     homedir = (char *)malloc(ZCFG_DIR_LEN);
     getcwd(homedir, ZCFG_DIR_LEN);
+    getenvSuccess = 1;
   }
   strcpy(zcfgdir, homedir);
-  free(homedir);
+  if (getenvSuccess == 1)
+    free(homedir);
   strcat(zcfgdir, ZCFG_DIR);
   tmp = opendir(zcfgdir);
   if (tmp == NULL) 
