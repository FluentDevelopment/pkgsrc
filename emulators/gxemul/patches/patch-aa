$NetBSD: patch-aa,v 1.1 2005/11/30 19:11:01 rillig Exp $

ISO C90 does not allow code intermixed with declarations.

--- src/cpus/memory_ppc.c.orig	Tue Nov 22 22:56:18 2005
+++ src/cpus/memory_ppc.c	Wed Nov 30 20:08:16 2005
@@ -57,11 +57,13 @@ int ppc_bat(struct cpu *cpu, uint64_t va
 
 	/*  4 instruction BATs, 4 data BATs...  */
 	for (i=0; i<8; i++) {
+		uint32_t upper, lower, phys, ebs, mask;
+
 		regnr = SPR_IBAT0U + i * 2;
-		uint32_t upper = cpu->cd.ppc.spr[regnr];
-		uint32_t lower = cpu->cd.ppc.spr[regnr + 1];
-		uint32_t phys = lower & BAT_RPN, ebs = upper & BAT_EPI;
-		uint32_t mask = ((upper & BAT_BL) << 15) | 0x1ffff;
+		upper = cpu->cd.ppc.spr[regnr];
+		lower = cpu->cd.ppc.spr[regnr + 1];
+		phys = lower & BAT_RPN, ebs = upper & BAT_EPI;
+		mask = ((upper & BAT_BL) << 15) | 0x1ffff;
 
 		/*  Instruction BAT, but not instruction lookup? Then skip.  */
 		if (i < 4 && !(flags & FLAG_INSTR))
