$NetBSD: patch-ag,v 1.3 2002/07/08 01:04:10 kristerw Exp $
--- unix/unix.cpp.orig	Mon Jul  8 00:54:28 2002
+++ unix/unix.cpp	Mon Jul  8 02:45:13 2002
@@ -51,7 +51,7 @@
 #include <ctype.h>
 #include <dirent.h>
 
-#if defined(__linux) || defined(__sun)
+#if defined(__linux) || defined(__sun) || defined(__NetBSD__)
 #undef USE_THREADS
 #define USE_THREADS
 #include <unistd.h>
@@ -62,7 +62,11 @@
 
 #ifdef USE_THREADS
 #include <pthread.h>
+#ifdef __NetBSD__
+#include <sys/sched.h>
+#else
 #include <sched.h>
+#endif
 
 pthread_t thread;
 pthread_mutex_t mutex;
@@ -72,6 +76,9 @@
 #include <sys/soundcard.h>
 #include <sys/mman.h>
 #endif
+#ifdef __NetBSD__
+#include <soundcard.h>
+#endif
 
 #ifdef __sun
 #ifdef __SVR4
@@ -84,6 +91,9 @@
 #if defined(__sun) && defined(__GNUC__)
 typedef void (*SIG_PF)();
 #endif
+#if defined(__NetBSD__)
+typedef void (*SIG_PF)(int);
+#endif
 
 #include "snes9x.h"
 #include "memmap.h"
@@ -168,7 +178,7 @@
 char *rom_filename = NULL;
 char *snapshot_filename = NULL;
 
-#if defined(__linux) || defined(__sun)
+#if defined(__linux) || defined(__sun) || defined(__NetBSD__)
 static void sigbrkhandler(int)
 {
 #ifdef DEBUGGER
@@ -1422,7 +1432,7 @@
 }
 #endif
 
-#if defined(__linux)
+#if defined(__linux) || defined(__NetBSD__)
 static int Rates[8] =
 {
     0, 8192, 11025, 16500, 22050, 29300, 36600, 44000
@@ -1437,11 +1447,19 @@
 {
     int J, K;
 
+#if defined(__NetBSD__)
+    if ((so.sound_fd = open ("/dev/audio", O_WRONLY)) < 0)
+    {
+	perror ("/dev/audio");
+	return (FALSE);
+    }
+#else
     if ((so.sound_fd = open ("/dev/dsp", O_WRONLY)) < 0)
     {
 	perror ("/dev/dsp");
 	return (FALSE);
     }
+#endif
 
 #ifdef MMAP_SOUND 
    if (ioctl (so.sound_fd, SNDCTL_DSP_GETCAPS, &J) < 0)
@@ -1541,7 +1559,7 @@
 }
 #endif
 
-#if defined (__linux) || defined (__sun)
+#if defined (__linux) || defined (__sun) || defined(__NetBSD__)
 void S9xUnixProcessSound (void)
 {
 }
@@ -1640,7 +1658,7 @@
 
 void *S9xProcessSound (void *)
 {
-#ifdef __linux
+#if defined(__linux) || defined(__NetBSD__)
     audio_buf_info info;
 
     if (!Settings.ThreadSound &&
